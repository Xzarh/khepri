package (
    compile)
with
    import './lexical' lexical,
    import './transform' transform,
    import './khepri_peep' khepri_peep,
    import './ecma_peep' ecma_peep
in {

compile =
    (\root options ->
        ({'ast': root, 'options': options || {}}))
    \>> lexical.checkStage
    \>> khepri_peep.optimize
    \>> transform.transform
    \>> ecma_peep.optimize
    \>> \{ast} -> ast;

}