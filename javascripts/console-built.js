/*

  The MIT License (MIT)

  Copyright (c) 2007-2013 Einar Lielmanis and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.

 JS Beautifier
---------------


  Written by Einar Lielmanis, <einar@jsbeautifier.org>
      http://jsbeautifier.org/

  Originally converted to javascript by Vital, <vital76@gmail.com>
  "End braces on own line" added by Chris J. Shull, <chrisjshull@gmail.com>
  Parsing improvements for brace-less statements by Liam Newman <bitwiseman@gmail.com>


  Usage:
    js_beautify(js_source_text);
    js_beautify(js_source_text, options);

  The options are:
    indent_size (default 4)          - indentation size,
    indent_char (default space)      - character to indent with,
    preserve_newlines (default true) - whether existing line breaks should be preserved,
    max_preserve_newlines (default unlimited) - maximum number of line breaks to be preserved in one chunk,

    jslint_happy (default false) - if true, then jslint-stricter mode is enforced.

            jslint_happy   !jslint_happy
            ---------------------------------
             function ()      function()

    brace_style (default "collapse") - "collapse" | "expand" | "end-expand"
            put braces on the same line as control statements (default), or put braces on own line (Allman / ANSI style), or just put end braces on own line.

    space_before_conditional (default true) - should the space before conditional statement be added, "if(true)" vs "if (true)",

    unescape_strings (default false) - should printable characters in strings encoded in \xNN notation be unescaped, "example" vs "\x65\x78\x61\x6d\x70\x6c\x65"

    wrap_line_length (default unlimited) - lines should wrap at next opportunity after this number of characters.
          NOTE: This is not a hard limit. Lines will continue until a point where a newline would
                be preserved if it were present.

    e.g

    js_beautify(js_source_text, {
      'indent_size': 1,
      'indent_char': '\t'
    });

*/

// if (a) if (b) if(c) d(); else e(); else f();

define("nu-stream/stream",["require","exports"],function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L=Function.prototype.call.bind(Array.prototype.reduce),A=function(e){var t;return function(n){return t===undefined&&(t=e(n)),t}};n=null,r=null,i=function(e,t){return{first:e,rest:t}},s=function(e,t){var n=A(t);return{first:e,rest:n}},c=function(e){return e.first},h=function(e){return e.rest()},p=function(e){return null===e},d=function(e){return e&&e.hasOwnProperty("first")&&e.hasOwnProperty("rest")||null===e},o=function(e,t){var n=function(){return t};return{first:e,rest:n}},a=function(e,t){var n,r,i;return null===e?t():(n=e.first,r=a.bind(null,e.rest(),t),i=A(r),{first:n,rest:i})};var O=function(e,t){return a(e,function(){return t})};u=function(){var e=arguments;return L(e,O,null)},f=function(e){return null===e?e:a(e.first,f.bind(null,e.rest()))};var M=function(e,t,n){var r,i,s;return t>=n?null:(r=e[t],i=M.bind(null,e,t+1,n),s=A(i),{first:r,rest:s})};l=function(e){var t,n,r,i=e.length;return 0>=i?null:(t=e[0],n=M.bind(null,e,1,i),r=A(n),{first:t,rest:r})},x=function(e,t,n){var r,i,s;return null===t||null===n?null:(r=e(t.first,n.first),i=x.bind(null,e,t.rest(),n.rest()),s=A(i),{first:r,rest:s})},S=x.bind(null,function(e,t){return[e,t]});var _,D=function(e){var t=D.bind(null,e+1);return{first:e,rest:t}};T=S.bind(null,(_=D.bind(null,1),{first:0,rest:_})),v=function(e,t){var n,r,i;for(var s=t;n=s,null!==n;s=(r=s,r.rest()))e((i=s,i.first))},g=function(e,t,n){var r,i,s=t;for(var o=n;r=o,null!==r;o=(i=o,i.rest())){var u;s=e(s,(u=o,u.first))}return s},m=g.bind(null,function(e,t){var n=function(){return e};return{first:t,rest:n}},null),y=function(e,t,n){return g(e,t,m(n))},b=function(e,t){return g(e,t.first,t.rest())},w=function(e,t){return b(e,m(t))};var P=function(e,t){return e.push(t),e};E=function(e){return g(P,[],e)},N=function(e,t){var n,r,i;return null===t?t:(n=e(t.first),r=N.bind(null,e,t.rest()),i=A(r),{first:n,rest:i})},C=function(e,t){var n,r;for(var i=t;n=i,null!==n;i=(r=i,r.rest())){var s=i,o=s.first;if(e(o)){var u,a=C.bind(null,e,(u=i,u.rest())),f=A(a);return{first:o,rest:f}}}return null};var H=f;k=function(){return H(N.apply(null,arguments))},t.end=n,t.NIL=r,t.stream=i,t.memoStream=s,t.cons=o,t.append=u,t.appendz=a,t.concat=f,t.from=l,t.first=c,t.rest=h,t.isEmpty=p,t.isStream=d,t.forEach=v,t.reverse=m,t.foldl=g,t.foldr=y,t.reduce=b,t.reduceRight=w,t.toArray=E,t.zip=S,t.zipWith=x,t.indexed=T,t.map=N,t.filter=C,t.bind=k}),define("seshet",["require","exports"],function(e,t){var n,r,i,s,o=function(e,t){return e>t?e:t},u=function(e){return e?1+e.height:0},a=function(e){return e?o(u(e.left),u(e.right)):0},f=function(e){return e?u(e.left)-u(e.right):0},l=function(e,t,n){this.id=e,this.val=t,this.delegate=n};l.lookup=function(e,t,n){for(var r=e;r;r=r.delegate)if(t(r.id,n))return r.val;return null};var c=function(e,t,n,r,i){this.key=e,this.cell=t,this.left=n,this.right=r,this.height=i};c.setChildren=function(e,t,n){return new c(e.key,e.cell,t,n,t||n?1+o(a(t),a(n)):0)},c.setLeft=function(e,t){return c.setChildren(e,t,e.right)},c.setRight=function(e,t){return c.setChildren(e,e.left,t)},c.lookup=function(e,t,n,r,i){for(var s=e;s;){var o=t(r,s.key);if(o===0)return l.lookup(s.cell,n,i);s=o<0?s.left:s.right}return null},c.put=function(e,t,n){return new c(e.key,new l(t,n,e.cell),e.left,e.right,e.height)};var h=function(e){return e?c.setLeft(e.right,c.setRight(e,e.right.left)):e},p=function(e){return e?c.setRight(e.left,c.setLeft(e,e.left.right)):e},d=function(e){return p(c.setLeft(e,h(e.left)))},v=function(e){return h(c.setRight(e,p(e.right)))},m=function(e){var t=f(e);return t>1?f(e.left)<=-1?d(e):p(e):t<-1?f(e.right)>=1?v(e):h(e):e};c.update=function(e,t,n,r,i){if(!e)return new c(n,new l(r,i,null),null,null,0);var s=t(n,e.key);return s===0?c.put(e,r,i):m(s<0?c.setLeft(e,c.update(e.left,t,n,r,i)):c.setRight(e,c.update(e.right,t,n,r,i)))},c.rebalance=function(e){return Math.abs(f(e))<=1?e:m(c.setChildren(e,c.rebalance(e.left),c.rebalance(e.right)))},c.prune=function(e,t,n,r){if(!e)return e;if(n!==undefined){var i=t(e.key,n);if(i<0)return c.prune(e.right,t,n,r);if(i===0)return c.setChildren(e,null,c.prune(e.right,t,undefined,r))}return r!==undefined&&t(e.key,r)>=0?c.prune(e.left,t,n,r):c.setChildren(e,c.prune(e.left,t,n,r),c.prune(e.right,t,n,r))};var g=function(e,t,n){this.compare=e,this.eq=t,this.root=n};g.setRoot=function(e,t){return new g(e.compare,e.eq,t)},n=function(){var e=function(e,t){return e===t};return function(t,n){return new g(t,n||e,null)}}.call(this),r=function(e,t,n){return c.lookup(e.root,e.compare,e.eq,t,n)},i=function(e,t,n,r){return g.setRoot(e,c.update(e.root,e.compare,t,n,r))},s=function(e,t,n){return g.setRoot(e,c.rebalance(c.prune(e.root,e.compare,t,n)))},t.create=n,t.lookup=r,t.update=i,t.prune=s}),define("bennu/parse",["require","exports","nu-stream/stream","seshet"],function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt=n.NIL,Tt=n.first,Nt=n.isEmpty,Ct=n.rest,kt=n.reduceRight,Lt=n.foldr,At=function(e){return e},Ot=function(){var e=arguments;return e};i=function(e,t,n,r,i,s,o){var u=this;u.p=e,u.state=t,u.m=n,u.cok=r,u.cerr=i,u.eok=s,u.eerr=o},s=function(e){var t=e;while(t instanceof i)t=t.p(t.state,t.m,t.cok,t.cerr,t.eok,t.eerr);return t};var Mt=function(e,t){var n=this;n.memoer=e,n.frames=t};Mt.empty=new Mt(r.create(function(e,t){return e.compare(t)},function(e,t){return e.id===t.id&&(e.state===t.state||e.state&&e.state.eq(t.state))}),xt),Mt.pushWindow=function(e,t){return new Mt(e.memoer,n.cons(t,e.frames))},Mt.popWindow=function(e){var t=e.frames,n=Ct(t);return new Mt(Nt(n)?r.prune(e.memoer,Tt(t)):e.memoer,n)},Mt.prune=function(e,t){return Nt(e.frames)?new Mt(r.prune(e.memoer,t),e.frames):e},Mt.lookup=function(e,t,n){return r.lookup(e.memoer,t,n)},Mt.update=function(e,t,n,i){return new Mt(r.update(e.memoer,t,n,i),e.frames)},p=function(e){var t=this;t.index=e},p.initial=new p(0),p.prototype.toString=function(){var e=this;return""+e.index},p.prototype.increment=function(e,t){var n=this;return new p(n.index+1)},p.prototype.compare=function(e){var t=this;return t.index-e.index},h=function(e,t,n){var r=this;r.input=e,r.position=t,r.userState=n},h.prototype.eq=function(e){var t=this;return e&&t.input===e.input&&t.userState===e.userState},h.prototype.isEmpty=function(){var e=this;return Nt(e.input)},h.prototype.first=function(){var e=this;return Tt(e.input)},h.prototype.next=function(e){var t=this;if(!t._next){var n=Ct(t.input),r=new h(n,t.position.increment(e,n),t.userState);t._next=new d(function(t,n,i){return i(e,r,n)})}return t._next},h.prototype.setInput=function(e){var t=this;return new h(e,t.position,t.userState)},h.prototype.setPosition=function(e){var t=this;return new h(t.input,e,t.userState)},h.prototype.setUserState=function(e){var t=this;return new h(t.input,t.position,e)},o=function(e){var t=this;t.message=e},o.prototype=new Error,o.prototype.constructor=o,o.prototype.name="ParserError",u=function(e,t){var n=this;n.position=e,n._msg=t||""},u.prototype=new Error,u.prototype.constructor=u,u.prototype.name="ParseError",u.prototype.toString=function(){var e=this;return e.message},Object.defineProperties(u.prototype,{message:{configurable:!0,get:function(){var e=this;return"At "+e.position+" "+e.errorMessage}},errorMessage:{configurable:!0,get:function(){var e=this;return e._msg}}}),a=function(e,t){var n=this;n.position=e,n.errors=t||[]},a.prototype=new u,a.prototype.constructor=a,a.prototype.name="MultipleError",Object.defineProperty(a.prototype,"errorMessage",{get:function(){var e=this;return"["+e.errors.map(function(e){return e.message}).join(", ")+"]"}});var _t=function(e,t,n){var r=this;r.position=e,r._pErr=t,r._qErr=n};_t.prototype=new a,_t.prototype.constructor=a,_t.prototype.name="ChoiceError",Object.defineProperty(_t.prototype,"errors",{get:function(){var e=this;return[e._pErr].concat(e._qErr.errors)}}),f=function(e){var t=this;t.position=e},f.prototype=new u,f.prototype.constructor=f,f.prototype.name="UnknownError",Object.defineProperty(f.prototype,"errorMessage",{value:"unknown error"}),l=function(e,t){var n=this;n.position=e,n.unexpected=t},l.prototype=new u,l.prototype.constructor=l,l.prototype.name="UnexpectError",Object.defineProperty(l.prototype,"errorMessage",{get:function(){var e=this;return"unexpected: "+e.unexpected}}),c=function(e,t,n){var r=this;r.position=e,r.expected=t,r.found=n},c.prototype=new u,c.prototype.constructor=c,c.prototype.name="ExpectError",Object.defineProperty(c.prototype,"errorMessage",{get:function(){var e=this;return"expected: "+e.expected+(e.found?" found: "+e.found:"")}}),d=function(e){var t=this;t.run=e},y=function(e,t,n,r,s,o,u){return new i(e.run,t,n,r,s,o,u)},v=function(e,t){return t.run.hasOwnProperty("displayName")?v(e,new d(y.bind(null,t))):new d(Object.defineProperty(t.run,"displayName",{value:e,writable:!1}))},m=function(e){var t;return new d(function(n,r,i,s,o,u){return t=t||e(),y(t,n,r,i,s,o,u)})},g=function(e){var t=e(m(function(){return t}));return t},d.prototype.of=function(e){return new d(function(t,n,r,i,s,o){return s(e,t,n)})},d.of=d.prototype.of,w=d.of,b=w,E=function(e){return new d(function(t,n,r,i,s,o){return o(e,t,n)})},d.chain=function(e,t){return new d(function(n,r,i,s,o,u){return y(e,n,r,function(e,n,r){return y(t(e),n,r,i,s,i,s)},s,function(e,n,r){return y(t(e),n,r,i,s,o,u)},u)})},x=d.chain,S=x,d.prototype.chain=function(e){var t=this;return x(t,e)},d.prototype.map=function(e){var t,n=this;return S(n,(t=b,function(n){return t(e(n))}))},d.map=function(e,t){return t.map(e)},T=d.map,d.ap=function(e,t){return S(e,function(e){return t.map(e)})},N=d.ap,d.prototype.ap=function(e){var t=this;return N(t,e)},A=function(e){return new d(function(t,n,r,i,s,o){var u=e(t);return s(u,u,n)})};var Dt=new d(function(e,t,n,r,i,s){return i(e,e,t)});k=Dt.run.hasOwnProperty("displayName")?v("Get Parser State",new d(function(e,t,n,r,s,o){return new i(Dt.run,e,t,n,r,s,o)})):new d(Object.defineProperty(Dt.run,"displayName",{value:"Get Parser State",writable:!1}));var Pt=A;L=function(e){return Pt(function(){return e})},C=function(e){return new d(function(t,n,r,i,s,o){return s(e(t),t,n)})},_=function(e){return A(function(t){return t.setUserState(e(t.userState))})};var Ht=new d(function(e,t,n,r,i,s){return i(e.userState,e,t)});O=Ht.run.hasOwnProperty("displayName")?v("Get State",new d(function(e,t,n,r,s,o){return new i(Ht.run,e,t,n,r,s,o)})):new d(Object.defineProperty(Ht.run,"displayName",{value:"Get State",writable:!1}));var Bt=_;M=function(e){return Bt(function(){return e})};var jt=new d(function(e,t,n,r,i,s){return i(e.position,e,t)});H=jt.run.hasOwnProperty("displayName")?v("Get Position",new d(function(e,t,n,r,s,o){return new i(jt.run,e,t,n,r,s,o)})):new d(Object.defineProperty(jt.run,"displayName",{value:"Get Position",writable:!1})),B=function(e){return A(function(t){return t.setPosition(e)})};var Ft=new d(function(e,t,n,r,i,s){return i(e.input,e,t)});D=Ft.run.hasOwnProperty("displayName")?v("Get Input",new d(function(e,t,n,r,s,o){return new i(Ft.run,e,t,n,r,s,o)})):new d(Object.defineProperty(Ft.run,"displayName",{value:"Get Input",writable:!1})),P=function(e){return A(function(t){return t.setInput(e)})};var It=function(e,t,n){return S(e,function(e){return S(t,function(t){return n(e,t)})})},qt=function(e){return S(H,function(t){var n=e(t);return new d(function(e,t,r,i,s,o){return o(n,e,t)})})};j=function(e){var t=e?u:f;return qt(function(n){return new t(n,e)})},F=function(e){return new d(function(t,n,r,i,s,o){var u=function(e,t,n){return o(e,t,Mt.popWindow(n))};return y(e,t,Mt.pushWindow(n,t.position),function(e,t,n){return r(e,t,Mt.popWindow(n))},u,function(e,t,n){return s(e,t,Mt.popWindow(n))},u)})},I=function(e){return It(k,e,function(e,t){return R(L(e),b(t))})},q=function(e){return It(D,H,function(t,n){return S(e,function(e){return W(B(n),P(t),b(e))})})},R=function(e,t){return S(e,function(){return t})};var Rt;U=kt.bind(null,(Rt=R,function(e,t){return Rt(t,e)}));var Ut=n.from,zt=U;z=function(e){return zt(Ut(e))};var Wt=z;W=function(){var e=arguments;return Wt(Ot.apply(null,e))};var Xt=undefined?u:f;d.prototype.empty=S(H,function(e){var t=new Xt(e,undefined);return new d(function(e,n,r,i,s,o){return o(t,e,n)})}),d.empty=d.prototype.empty,X=d.empty,d.concat=function(e,t){return new d(function(n,r,i,s,o,u){var f=n.position,l=function(e,r,l){var c=function(t,r,i){return u(new a(f,[e,t]),n,i)};return y(t,n,l,i,s,o,c)};return y(e,n,r,i,s,o,l)})},$=d.concat,V=$,d.prototype.concat=function(e){var t=this;return $(t,e)};var Vt;J=Lt.bind(null,function(e,t){return new d(function(n,r,i,s,o,u){var a=n.position,f=function(t,r,f){var l=function(e,r,i){return u(new _t(a,t,e),n,i)};return y(e,n,f,i,s,o,l)};return y(t,n,r,i,s,o,f)})},(Vt=new a(null,[]),new d(function(e,t,n,r,i,s){return s(Vt,e,t)})));var $t=n.from,Jt=J;K=function(e){return Jt($t(e))};var Kt=K;Q=function(){var e=arguments;return Kt(Ot.apply(null,e))},G=function(e,t){return t?V(t,b(e)):V(e,b(null))},Y=function(e,t){return new d(function(n,r,i,s,o,u){return y(t,n,r,i,s,o,function(t,n,r){return u(new c(n.position,e),n,r)})})},Z=function(e,t){return F(V(S(F(e),function(e){return qt(function(t){return new l(t,e)})}),b(null)))},et=T.bind(null,n.toArray),tt=function(e,t){return S(et(e),function(e){return t.apply(undefined,e)})};var Qt=n.cons;nt=function(e,t){return S(e,function(e){return t.map(function(t){return Qt(e,t)})})};var Gt=n.append;rt=function(e,t){return S(e,function(e){return t.map(function(t){return Gt(e,t)})})};var Yt;it=Lt.bind(null,(Yt=nt,function(e,t){return Yt(t,e)}),b(xt));var Zt=n.from,en=it;st=function(e){return en(Zt(e))};var tn=st;ot=function(){var e=arguments;return tn(Ot.apply(null,e))};var nn=new o("Many parser applied to parser that accepts an empty string"),rn=function(){throw nn};ut=function(e){var t=new d(function(t,n,r,i,s,o){return y(e,t,n,r,i,rn,o)});return g(function(e){var n=nt(t,e);return n?V(n,b(xt)):V(xt,b(null))})},at=function(e){return nt(e,ut(e))},ft=function(e){return new d(function(t,n,r,i,s,o){var u=t.position,a={id:e,state:t},f=Mt.lookup(n,u,a);if(f){var l=f[0],c=f[1],h=f[2];switch(l){case"cok":return r(c,h,n);case"ceerr":return i(c,h,n);case"eok":return s(c,h,n);case"eerr":return o(c,h,n)}}return y(e,t,n,function(e,t,n){return r(e,t,Mt.update(n,u,a,["cok",e,t]))},function(e,t,n){return i(e,t,Mt.update(n,u,a,["cerr",e,t]))},function(e,t,n){return s(e,t,Mt.update(n,u,a,["eok",e,t]))},function(e,t,n){return o(e,t,Mt.update(n,u,a,["eerr",e,t]))})})};var sn=function(e,t){return new l(e,t===null?"end of input":t)};lt=function(e,t){var n=t||sn;return new d(function(t,r,i,s,o,u){var a,f;return t.isEmpty()?u(n(t.position,null),t,r):(a=t.first(),e(a)?(f=function(e,t,n){return i(e,t,Mt.prune(n,t.position))},y(t.next(a),t,r,f,s,f,s)):u(n(t.position,a),t,r))})};var on=lt(function(){return!0});ct=on.run.hasOwnProperty("displayName")?v("Any Token",new d(function(e,t,n,r,s,o){return new i(on.run,e,t,n,r,s,o)})):new d(Object.defineProperty(on.run,"displayName",{value:"Any Token",writable:!1}));var un=V(S(new d(function(e,t,n,r,i,s){var o=function(e,t,n){return s(e,t,Mt.popWindow(n))};return y(ct,e,Mt.pushWindow(t,e.position),function(e,t,r){return n(e,t,Mt.popWindow(r))},o,function(e,t,n){return i(e,t,Mt.popWindow(n))},o)}),function(e){return qt(function(t){return new l(t,e)})}),b(null)),an=new d(function(e,t,n,r,i,s){var o=function(e,t,n){return s(e,t,Mt.popWindow(n))};return y(un,e,Mt.pushWindow(t,e.position),function(e,t,r){return n(e,t,Mt.popWindow(r))},o,function(e,t,n){return i(e,t,Mt.popWindow(n))},o)});ht=an.run.hasOwnProperty("displayName")?v("EOF",new d(function(e,t,n,r,s,o){return new i(an.run,e,t,n,r,s,o)})):new d(Object.defineProperty(an.run,"displayName",{value:"EOF",writable:!1}));var fn=y;pt=function(){var e=arguments;return s(fn.apply(null,e))},dt=function(e,t,n,r){return pt(e,t,Mt.empty,n,r,n,r)},vt=function(e,t,n,r,i){return dt(e,new h(t,p.initial,n),r,i)},mt=function(e,t,r,i,s){return vt(e,n.from(t),r,i,s)};var ln=function(e){throw e};gt=function(e,t){return dt(e,t,At,ln)},yt=function(e,t,n){return gt(e,new h(t,p.initial,n))},bt=function(e,t,r){return yt(e,n.from(t),r)};var cn=function(){return!0},hn=function(){return!1};wt=function(e,t){return dt(e,t,cn,hn)},Et=function(e,t,n){return wt(e,new h(t,p.initial,n))},St=function(e,t,r){return Et(e,n.from(t),r)},t.Tail=i,t.trampoline=s,t.ParserError=o,t.ParseError=u,t.MultipleError=a,t.UnknownError=f,t.UnexpectError=l,t.ExpectError=c,t.ParserState=h,t.Position=p,t.Parser=d,t.label=v,t.late=m,t.rec=g,t.unparser=y,t.always=b,t.of=w,t.never=E,t.bind=S,t.chain=x,t.map=T,t.ap=N,t.extract=C,t.getParserState=k,t.setParserState=L,t.modifyParserState=A,t.getState=O,t.setState=M,t.modifyState=_,t.getInput=D,t.setInput=P,t.getPosition=H,t.setPosition=B,t.fail=j,t.attempt=F,t.look=I,t.lookahead=q,t.next=R,t.sequences=U,t.sequencea=z,t.sequence=W,t.empty=X,t.either=V,t.concat=$,t.choices=J,t.choicea=K,t.choice=Q,t.optional=G,t.expected=Y,t.not=Z,t.eager=et,t.binds=tt,t.cons=nt,t.append=rt,t.enumerations=it,t.enumerationa=st,t.enumeration=ot,t.many=ut,t.many1=at,t.memo=ft,t.token=lt,t.anyToken=ct,t.eof=ht,t.exec=pt,t.parseState=dt,t.parseStream=vt,t.parse=mt,t.runState=gt,t.runStream=yt,t.run=bt,t.testState=wt,t.testStream=Et,t.test=St}),define("nu-stream/gen",["require","exports","./stream"],function(e,t,n){var r=n.NIL,i=n.memoStream,s,o;s=function(e,t){return e<=0?r:i(t,s.bind(null,e-1,t))};var u=function(e,t,n){return(n>0?t<=e:t>=e)?r:i(e,u.bind(null,e+n,t,n))};o=function(e,t,n){var s=isNaN(e)?Infinity:+e,o=isNaN(n)?1:+n;return isNaN(t)?(o>0?s<=0:s>=0)?r:i(0,u.bind(null,0+o,s,o)):(o>0?t<=s:t>=s)?r:i(s,u.bind(null,s+o,t,o))},t.repeat=s,t.range=o}),define("bennu/lang",["require","exports","nu-stream/stream","nu-stream/gen","./parse"],function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w=n.NIL,E=r.repeat,S=i.append,x=i.always,T=i.bind,N=i.cons,C=i.either,k=i.enumerations,L=i.late,A=i.many,O=i.many1,M=i.next,_=i.optional,D=i.rec,P=x(w),H=_.bind(null,w);s=function(){var e=arguments;return k(E.apply(null,e))},o=function(e,t){return e<=0?P:H(N(t,L(function(){return o(e-1,t)})))},u=function(e,t,n){var r,i;return S((r=[e,n],k(E.apply(null,r))),(i=t-e,i<=0?P:H(N(n,L(function(){return o(i-1,n)})))))},a=function(e,t){return T(e,function(e){return M(t,x(e))})},f=function(e,t,n){return M(e,T(n,function(e){return M(t,x(e))}))},l=function(e,t){return N(t,A(M(e,t)))},c=function(){var e=arguments;return H(l.apply(null,e))},h=function(e,t){return D(function(n){return N(t,H(M(e,H(n))))})},p=function(e,t){return C(D(function(n){return N(t,H(M(e,H(n))))}),M(_(e),P))},d=function(e,t){return O(T(t,function(t){return M(e,x(t))}))},v=function(e,t){return A(T(t,function(t){return M(e,x(t))}))},m=function(e,t){return T(t,function n(r){return _(r,T(e,function(e){return T(t,function(t){return n(e(r,t))})}))})},g=function(e,t,n){return _(t,T(n,function r(t){return _(t,T(e,function(e){return T(n,function(n){return r(e(t,n))})}))}))},y=function(e,t){return D(function(n){return T(t,function(t){return _(t,T(e,function(e){return n.map(function(n){return e(t,n)})}))})})},b=function(e,t,n){return _(t,D(function(t){return T(n,function(n){return _(n,T(e,function(e){return t.map(function(t){return e(n,t)})}))})}))},t.times=s,t.atMostTimes=o,t.betweenTimes=u,t.then=a,t.between=f,t.sepBy1=l,t.sepBy=c,t.sepEndBy1=h,t.sepEndBy=p,t.endBy1=d,t.endBy=v,t.chainl1=m,t.chainl=g,t.chainr1=y,t.chainr=b}),define("khepri-ast/serialization",["require","exports","./node"],function(e,t,n){var r,i,s,o=Object.keys,u=Function.prototype.call.bind(Array.prototype.map),a=Function.prototype.call.bind(Array.prototype.reduce),f=function(e){return e},l={};r=function(e,t){l[e]=t};var c=function(e,t,r){return e?Array.isArray(e)?u(e,function(e){return c(e,t,r)}):e instanceof n.Node?{type:e.type,loc:t(e.loc),ud:r(e.ud),children:a(e.children,function(n,i){return n[i]=c(e[i],t,r),n},{}),attributes:a(e.attributes,function(t,n){return t[n]=e[n],t},{})}:e:e};i=function(e,t,n){var r=c(e,t||f,n||f);return{version:"2.1.0",kind:"ecma",program:r}};var h=function(e,t,r){if(!e)return e;if(Array.isArray(e))return u(e,function(e){return h(e,t,r)});var i=l[e.type];if(!i)return e;var s=t(e.loc),f=r(e.ud),c=a(o(e.children),function(n,i){return n[i]=h(e.children[i],t,r),n},{}),p=a(o(e.attributes),function(t,n){return t[n]=e.attributes[n],t},{});return n.construct(i.prototype,s,f,c,p)};s=function(e,t,n){return h(e.program,t||f,n||f)},t.registerNode=r,t.serialize=i,t.unserialize=s}),define("khepri-ast/node",["require","exports","./serialization"],function(e,t,n){var r=n.registerNode,i,s,o,u,a,f,l,c,h,p,d=Object.keys,v=function(e,t,n){var r={},i=d(e);for(var s=0,o=i.length;s<o;s+=1){var u=i[s];r[u]=e[u]}return r[t]=n,r};i=function(e,t){var n=this;Object.defineProperties(n,{loc:{value:e,enumerable:!1,writable:!0},ud:{value:t||null,enumerable:!1,writable:!0}})},s=function(e,t,n,r,i){var s=new e.constructor(t);s.ud=n;var o=e.children;for(var u=0,a=o.length;u<a;u+=1){var f=o[u];s[f]=r[f]||null}var l=e.attributes;for(var c=0,h=l.length;c<h;c+=1){var p=l[c];s[p]=i[p]||null}return s},o=function(e,t,n){return s(e,e.loc,e.ud,t,n)},u=function(e,t,n){var r=new e.constructor(e.loc);r.ud=e.ud;var i=e.children;for(var s=0,o=i.length;s<o;s+=1){var u=i[s];r[u]=t&&t.hasOwnProperty(u)?t[u]:e[u]}var a=e.attributes;for(var f=0,l=a.length;f<l;f+=1){var c=a[f];r[c]=n&&n.hasOwnProperty(c)?n[c]:e[c]}return r},a=function(e,t){return s(e,t,e.ud,e,e)},f=function(e,t){return s(e,e.loc,t,e,e)},l=function(e,t){return e.ud&&e.ud[t]},c=function(e,t,n){return h(e,t,n(l(e,t)))},h=function(e,t,n){return f(e,v(e.ud||{},t,n))},p=function(e,t,n,i,s){s.type=t,s.prototype=new e,s.prototype.constructor=s,s.prototype.children=n,s.prototype.attributes=i,s.prototype.type=s.type;var o=function(e){var t=this;return s.apply(t,e)};return o.prototype=s.prototype,s.create=function(){var e=arguments;return new o(e)},r(t,s),s},t.Node=i,t.construct=s,t.reconstruct=o,t.modify=u,t.setLoc=a,t.setUserData=f,t.getData=l,t.modifyData=c,t.setData=h,t.defineNode=p}),define("khepri-ast/token",["require","exports","./node"],function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g=n.defineNode,y=n.Node;r=function(e,t){var n=this;y.call(n,e),n.value=t},r.prototype=new y,i=g(r,"String",[],["value"],function(e,t){var n=this;r.call(n,e,t)}),s=g(r,"Number",[],["value"],function(e,t){var n=this;r.call(n,e,t)}),o=g(r,"RegularExpression",[],["value"],function(e,t){var n=this;r.call(n,e,t)}),u=g(r,"Boolean",[],["value"],function(e,t){var n=this;r.call(n,e,t)}),a=g(r,"Null",[],["value"],function(e,t){var n=this;r.call(n,e,t)}),f=g(r,"Identifier",[],["value"],function(e,t){var n=this;r.call(n,e,t)}),l=g(r,"Keyword",[],["value"],function(e,t){var n=this;r.call(n,e,t)}),c=g(r,"Punctuator",[],["value"],function(e,t){var n=this;r.call(n,e,t)}),h=g(r,"PrefixOperator",[],["value","base"],function(e,t,n){var i=this;r.call(i,e,t),i.base=n}),p=g(r,"InfixOperator",[],["value","base"],function(e,t,n){var i=this;r.call(i,e,t),i.base=n}),d=g(r,"Comment",[],["value"],function(e,t){var n=this;r.call(n,e,t)}),v=g(r,"Whitespace",[],["value"],function(e,t){var n=this;r.call(n,e,t)}),m=g(r,"LineTerminator",[],["value"],function(e,t){var n=this;r.call(n,e,t)}),t.Token=r,t.StringToken=i,t.NumberToken=s,t.RegularExpressionToken=o,t.BooleanToken=u,t.NullToken=a,t.IdentifierToken=f,t.KeywordToken=l,t.PunctuatorToken=c,t.PrefixOperatorToken=h,t.InfixOperatorToken=p,t.CommentToken=d,t.WhitespaceToken=v,t.LineTerminatorToken=m}),define("khepri-ast/position",["require","exports"],function(e,t){var n,r;n=function(e,t,n){var r=this;r.line=e,r.column=t,r.file=n},n.initial=new n(1,0),n.prototype.increment=function(e){var t=this;return e==="\n"?new n(t.line+1,0):new n(t.line,t.column+1)},n.prototype.toString=function(){var e=this;return"{line:"+e.line+" col:"+e.column+"}"},n.prototype.compare=function(e){var t=this;return t.line===e.line?t.column-e.column:t.line-e.line},r=function(e,t,n){var r=this;r.start=e,r.end=t,r.file=n},r.prototype.toString=function(){var e=this;return"{"+(e.file?"file:"+e.file+" ":"")+"start:"+e.start+" end:"+e.end+"}"},r.merge=function(e,t){return new r(e.start.compare(t.start)>0?t.start:e.start,e.end.compare(t.end)>0?e.end:t.end,e.file||t.file)},t.SourcePosition=n,t.SourceLocation=r}),define("bennu/text",["require","exports","./parse"],function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p=n.always,d=n.attempt,v=n.bind,m=n.optional,g=n.ExpectError,y=n.next,b=n.label,w=n.token,E=Function.prototype.call.bind(Array.prototype.join),S=Function.prototype.call.bind(Array.prototype.map),x=Function.prototype.call.bind(Array.prototype.reduce),T=Function.prototype.call.bind(Array.prototype.reduceRight),N=function(e,t,n,r,i){var s=this;g.call(s,e,r,i),s.string=t,s.index=n};N.prototype=new g,N.prototype.constructor=N,Object.defineProperty(N.prototype,"errorMessage",{get:function(){var e=this;return"In string: '"+e.string+"' at index: "+e.index+", Expected: "+e.expected+" Found: "+(e.found?e.found:"end of input")}});var C=function(e){return""+e},k=function(e,t){var n;return w((n=""+e,function(e){return n===""+e}),t)};r=function(e){return k(e,function(t,n){return new g(t,e,n===null?"end of input":n)})},i=function(e){var t=S(e,C),n;return w(function(e){return t.indexOf(""+e)>=0},(n=E(t," or "),function(e,t){return new g(e,n,t===null?"end of input":t)}))},s=function(e){var t=S(e,C),n;return w(function(e){var n=t.indexOf(""+e)>=0;return!n},(n="none of:"+E(t," or "),function(e,t){return new g(e,n,t===null?"end of input":t)}))};var L=function(e,t,n,r){return y(k(t,function(e,i){return new N(e,r,n,t,i)}),e)};o=function(e){return d(T(e,L,p(""+e)))};var A=function(e,t){return e[t]=e[t]||{},e[t]},O=function(e,t){var n=x(t,A,e);return n[""]=t,e},M=function(e){var t,n,r=Object.keys(e),i=x(r,function(t,n){return n&&(t[n]=M(e[n])),t},{}),s=d(v((t=S(r,C),w(function(e){return t.indexOf(""+e)>=0},(n=E(t," or "),function(e,t){return new g(e,n,t===null?"end of input":t)}))),function(e){return i[e]}));return e.hasOwnProperty("")?m(e[""],s):s};u=function(e){var t=x(e,O,{}),n,r,i,s,o;return d((i=Object.keys(t),s=x(i,function(e,n){return n&&(e[n]=M(t[n])),e},{}),o=d(v((n=S(i,C),w(function(e){return n.indexOf(""+e)>=0},(r=E(n," or "),function(e,t){return new g(e,r,t===null?"end of input":t)}))),function(e){return s[e]})),t.hasOwnProperty("")?m(t[""],o):o))},a=function(e,t){return w(RegExp.prototype.test.bind(e),function(e,n){return new g(e,t,n===null?"end of input":n)})};var _;f=b("Any Character",(_=/^.$/,w(RegExp.prototype.test.bind(_),function(e,t){return new g(e,"any character",t===null?"end of input":t)})));var D;l=b("Any Letter",(D=/^[a-z]$/i,w(RegExp.prototype.test.bind(D),function(e,t){return new g(e,"any letter character",t===null?"end of input":t)})));var P;c=b("Any Whitespace",(P=/^\s$/i,w(RegExp.prototype.test.bind(P),function(e,t){return new g(e,"any space character",t===null?"end of input":t)})));var H;h=b("Any Digit",(H=/^[0-9]$/i,w(RegExp.prototype.test.bind(H),function(e,t){return new g(e,"any digit character",t===null?"end of input":t)}))),t.character=r,t.oneOf=i,t.noneOf=s,t.string=o,t.trie=u,t.match=a,t.anyChar=f,t.letter=l,t.space=c,t.digit=h}),define("khepri-parse/lex/boolean_lexer",["require","exports","bennu/parse","bennu/text"],function(e,t,n,r){var i=n.always,s=n.either,o=n.next,u=n.label,a=r.string,f,l,c;f=u("True Literal Lexer",o(a("true"),i(!0))),l=u("False Literal Lexer",o(a("false"),i(!1))),c=u("Boolean Literal Lexer",s(f,l)),t.trueLiteral=f,t.falseLiteral=l,t.booleanLiteral=c}),define("khepri-parse/lex/line_terminator_lexer",["require","exports","bennu/parse","bennu/text"],function(e,t,n,r){var i=n.always,s=n.choice,o=n.next,u=n.optional,a=n.label,f=n.token,l=r.character,c=r.oneOf,h,p,d,v,m,g;h=a("Line Feed Lexer",l("\n")),p=a("Carriage Return Lexer",l("\r")),d=a("Line Separator Lexer",l("\u2028")),v=a("Paragraph Separator Lexer",l("\u2029")),m=a("Line Terminator Lexer",c(["\n","\r","\u2028","\u2029"])),g=a("Line Terminator Sequence Lexer",s(h,d,v,o(p,u("\r",o(h,i("\r\n")))))),t.lf=h,t.cr=p,t.ls=d,t.ps=v,t.lineTerminator=m,t.lineTerminatorSequence=g}),define("khepri-parse/lex/comment_lexer",["require","exports","bennu/parse","bennu/text","bennu/lang","nu-stream/stream","./line_terminator_lexer"],function(e,t,n,r,i,s,o){var u,a,f,l,c,h,p,d,v,m=n.anyToken,g=n.either,y=n.many,b=n.map,w=n.next,E=n.not,S=n.label,x=r.string,T=i.between,N=s.foldl,C=o.lineTerminator,k=function(e,t){return e+t},L=b.bind(null,N.bind(null,k,""));u=x("//"),a=w(E(C),m),f=y(a),l=S("Single Line Comment Lexer",w(u,L(f))),c=x("/*"),h=x("*/"),p=S("Multi Line Comment Characters Lexer",y(w(E(h),m))),d=S("Multi Line Comment Lexer",T(c,h,L(p))),v=S("Comment Lexer",g(l,d)),t.singleLineCommentMarker=u,t.singleLineCommentChar=a,t.singleLineCommentChars=f,t.singleLineComment=l,t.multiLineCommentStartMarker=c,t.multiLineCommentEndMarker=h,t.multiLineCommentChars=p,t.multiLineComment=d,t.comment=v}),define("khepri-parse/lex/reserved_word_lexer",["require","exports","bennu/parse","bennu/text"],function(e,t,n,r){var i,s,o=n.label,u=r.trie,a=["break","case","catch","continue","debugger","default","delete","do","else","finally","for","function","if","in","instanceof","typeof","new","var","return","void","switch","while","this","with","throw","try","export","package","class","enum","interface","extends","implements","private","public","protected","super","const","yield","import","let","static","_"];i=a.concat("null","true","false"),s=o("ReservedWordLexer",u(i)),t.reservedWordList=i,t.reservedWord=s}),define("khepri-parse/lex/identifier_lexer",["require","exports","bennu/parse","bennu/text","nu-stream/stream","./reserved_word_lexer"],function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m=n.always,g=n.bind,y=n.cons,b=n.choice,w=n.either,E=n.fail,S=n.many,x=n.label,T=r.character,N=r.oneOf,C=r.digit,k=r.letter,L=i.foldl,A=s.reservedWordList,O=function(e,t){return e+t},M=L.bind(null,O,"");o=T("‌"),u=T("‍"),a=k,f=C,l=N(["_","‿","⁀","⁔","︳","︴","﹍","﹎","﹏","＿"]),c=w(k,N("$_")),h=b(c,C,l,o,u),p=S(h),d=y(c,p),v=x("Identifier Lexer",g(d,function(e){var t=M(e);return A.indexOf(t)>=0?E():m(t)})),t.zwnj=o,t.zwj=u,t.unicodeLetter=a,t.unicodeDigit=f,t.unicodeConnectorPunctuation=l,t.identifierStart=c,t.identifierPart=h,t.identifierParts=p,t.identifierName=d,t.identifier=v}),define("khepri-parse/lex/null_lexer",["require","exports","bennu/parse","bennu/text"],function(e,t,n,r){var i=n.always,s=n.next,o=n.label,u=r.string,a;a=o("Null Lexer",s(u("null"),i(null))),t.nullLiteral=a}),define("khepri-parse/lex/number_lexer",["require","exports","bennu/parse","bennu/text","nu-stream/stream"],function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S=n.always,x=n.attempt,T=n.binds,N=n.either,C=n.enumeration,k=n.expected,L=n.many1,A=n.map,O=n.next,M=n.optional,_=n.label,D=r.character,P=r.oneOf,H=r.string,B=i.foldl,j=function(e){return-e},F=function(e,t){return e+t},I=A.bind(null,B.bind(null,F,""));s=D("."),o=D("-"),u=D("+"),a=P("eE"),f=N(H("0x"),H("0X")),l=P("0123456789"),c=P("123456789"),h=P("0123456789abcdefABCDEF"),p=_("Decimal Digits Lexer",I(L(l))),d=_("Hex Digits Lexer",I(L(h))),v=_("Unsigned Integer Lexer",A(parseInt,p)),m=_("Signed Integer Lexer",N(O(o,A(j,v)),O(M(u),v)));var q=_("Hex Integer Literal Digits Lexer",A(function(e){return parseInt(e,16)},d));g=_("Exponent Part Lexer",O(a,m)),y=_("Hex Integer Literal Lexer",O(f,q)),b=_("Decimal Integer Literal",A(parseInt,p)),w=_("Decimal Literal Lexer",T(C(T(C(p,M(0,x(O(s,p)))),function(e,t){return S(parseFloat(e+"."+t))}),M(0,g)),function(e,t){return S(e*Math.pow(10,parseInt(t)))})),E=_("Numeric Literal Lexer",N(O(x(f),k("hex digits",q)),w)),t.decimal=s,t.negativeSign=o,t.positiveSign=u,t.exponentIndicator=a,t.hexIndicator=f,t.decimalDigit=l,t.nonZeroDigit=c,t.hexDigit=h,t.decimalDigits=p,t.hexDigits=d,t.unsignedInteger=v,t.signedInteger=m,t.exponentPart=g,t.hexIntegerLiteral=y,t.decimalIntegerLiteral=b,t.decimalLiteral=w,t.numericLiteral=E}),define("khepri-parse/lex/punctuator_lexer",["require","exports","bennu/parse","bennu/text","bennu/lang","nu-stream/stream"],function(e,t,n,r,i,s){var o,u,a,f,l=n.attempt,c=n.label,h=n.eager,p=n.either,d=n.enumeration,v=n.map,m=n.many,g=n.next,y=n.not,b=r.trie,w=r.character,E=r.oneOf,S=i.then,x=s.foldl,T=function(e,t){return e+t},N=v.bind(null,x.bind(null,T,"")),C=["{","}","(",")","[","]",",",".",";",":","?","=",":=","=:","@","...","#","\\","->","§","-|","|-"];o=c("Punctuator Lexer",b(C));var k=E("?+-*/%|&^<>=!~@");u=c("Prefix Operator Lexer",h(d(p(b(["~","++","--"]),l(S(w("!"),y(w("="))))),N(m(k))))),a=c("Infix Operator Lexer",g(y(g(b(["->","-|","|-"]),y(k))),h(d(b(["&&","||","<<",">>",">>>","<=","<",">=",">","===","!==","==","!=","&","|","^","+","-","*","/","%","|>","<|","\\>","\\>>","<\\","<<\\"]),N(m(k)))))),f=c("Prefix Operator Lexer",p(u,a)),t.punctuator=o,t.prefixOperator=u,t.infixOperator=a,t.operator=f}),define("khepri-parse/lex/string_lexer",["require","exports","bennu/parse","bennu/text","bennu/lang","nu-stream/stream","./line_terminator_lexer","./number_lexer"],function(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x=n.always,T=n.attempt,N=n.choice,C=n.either,k=n.eof,L=n.many,A=n.map,O=n.not,M=n.next,_=n.sequence,D=n.label,P=n.anyToken,H=r.character,B=r.oneOf,j=r.noneOf,F=i.between,I=i.times,q=s.foldl,R=o.lineTerminatorSequence,U=o.lineTerminator,z=u.decimalDigit,W=u.hexDigit,X,V=function(e,t){return e+t},$=q.bind(null,V,""),J=A.bind(null,function(e){return String.fromCharCode(parseInt($(e),16))});a=H('"'),l=H("'"),f=H("\\"),c=_(f,R,x(""));var K=B("\"'\\bfnrtv").map((X={'"':'"',"'":"'","\\":"\\",b:"\b",f:"\f",n:"\n",r:"\r",t:"	",v:""},function(e){return X[e]})),Q=N(K,z,B("ux")),G=_(O(Q),O(U),P);p=M(H("x"),J(I(2,W))),h=M(H("u"),J(I(4,W))),d=C(K,G),v=N(d,_(H("0"),C(k,M(O(z),P)),x("\0")),p,h),m=D("Single String Character",N(T(c),M(f,v),M(O(U),j("'\\")))),g=L(m),y=D("Single String Literal",F(l,l,A($,g))),b=N(T(c),M(f,v),M(O(U),j('"\\'))),w=L(b),E=D("Double String Literal",F(a,a,A($,w))),S=D("Sting Literal Lexer",C(y,E)),t.doubleQuote=a,t.escape=f,t.singleQuote=l,t.lineContinuation=c,t.unicodeEscapeSequence=h,t.hexEscapeSequence=p,t.characterEscapeSequence=d,t.escapeSequence=v,t.singleStringCharacter=m,t.singleStringCharacters=g,t.singleStringLiteral=y,t.doubleStringCharacter=b,t.doubleStringCharacters=w,t.doubleStringLiteral=E,t.stringLiteral=S}),define("khepri-parse/lex/whitespace_lexer",["require","exports","bennu/parse","bennu/text"],function(e,t,n,r){var i=n.map,s=n.label,o=r.character,u=r.oneOf,a=r.match,f,l,c,h,p,d,v,m;f=o("	"),l=o(""),c=o("\f"),h=o(" "),p=o(" "),d=o("﻿"),v=a(/^\s$/),m=s("Whitespace Character Lexer",u(["	","","\f"," "," ","﻿"])),t.tab=f,t.vt=l,t.ff=c,t.sp=h,t.nbsp=p,t.bom=d,t.usp=v,t.whitespace=m}),define("khepri-parse/lex/regular_expression_lexer",["require","exports","bennu/parse","bennu/lang","bennu/text","nu-stream/stream","./identifier_lexer","./line_terminator_lexer"],function(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g,y,b=n.always,w=n.anyToken,E=n.binds,S=n.choice,x=n.cons,T=n.either,N=n.enumeration,C=n.many,k=n.map,L=n.next,A=n.not,O=n.label,M=r.between,_=i.character,D=i.noneOf,P=s.foldl,H=o.identifierPart,B=u.lineTerminator,j=function(e,t){return e+t},F=P.bind(null,j,"");a=L(A(B),w),f=L(_("\\"),k(function(e){return"\\"+e},a)),l=T(L(A(B),D("]\\")),f),c=C(l),h=M(_("["),_("]"),k(function(e){return"["+F(e)+"]"},c)),v=S(L(A(B),D("*\\`[")),f,h),p=S(L(A(B),D("\\`[")),f,h),d=C(p),m=C(H),g=k(F,x(v,d)),y=O("Regular Expression Lexer",E(N(M(_("`"),_("`"),g),m),function(e,t){return b(new RegExp(e,F(t)))})),t.regularExpressionNonTerminator=a,t.regularExpressionBackslashSequence=f,t.regularExpressionClassChar=l,t.regularExpressionClassChars=c,t.regularExpressionClass=h,t.regularExpressionChar=p,t.regularExpressionChars=d,t.regularExpressionFirstChar=v,t.regularExpressionFlags=m,t.regularExpressionBody=g,t.regularExpressionLiteral=y}),define("khepri-parse/lex/lexer",["require","exports","bennu/parse","bennu/lang","nu-stream/stream","khepri-ast/token","khepri-ast/position","./boolean_lexer","./comment_lexer","./identifier_lexer","./line_terminator_lexer","./null_lexer","./number_lexer","./punctuator_lexer","./reserved_word_lexer","./string_lexer","./whitespace_lexer","./regular_expression_lexer"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){var y,b,w,E,S,x,T=n.always,N=n.attempt,C=n.binds,k=n.choice,L=n.eof,A=n.getPosition,O=n.enumeration,M=n.many,_=n.runState,D=n.ParserState,P=r.then,H=i.from,B=o.SourceLocation,j=o.SourcePosition,F=u.booleanLiteral,I=a.comment,q=f.identifier,R=l.lineTerminator,U=c.nullLiteral,z=h.numericLiteral,W=p.punctuator,X=p.infixOperator,V=p.prefixOperator,$=d.reservedWord,J=v.stringLiteral,K=m.whitespace,Q=g.regularExpressionLiteral,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt=k((G=s.StringToken.create,J.map(function(e){return[G,e]})),(Y=s.RegularExpressionToken.create,Q.map(function(e){return[Y,e]})),(Z=s.BooleanToken.create,F.map(function(e){return[Z,e]})),(et=s.NullToken.create,U.map(function(e){return[et,e]})),(tt=s.NumberToken.create,z.map(function(e){return[tt,e]}))),ct=k(N((nt=s.IdentifierToken.create,q.map(function(e){return[nt,e]}))),N(lt),(rt=s.KeywordToken.create,$.map(function(e){return[rt,e]})),(it=function(e,t){var n=t[0],r=t[1];return s.PrefixOperatorToken.create(e,n+r,n)},V.map(function(e){return[it,e]})),(st=function(e,t){var n=t[0],r=t[1];return s.InfixOperatorToken.create(e,n+r,n)},X.map(function(e){return[st,e]})),(ot=s.PunctuatorToken.create,W.map(function(e){return[ot,e]}))),ht=k((ut=s.CommentToken.create,I.map(function(e){return[ut,e]})),(at=s.WhitespaceToken.create,K.map(function(e){return[at,e]})),(ft=s.LineTerminatorToken.create,R.map(function(e){return[ft,e]})),ct),pt=lt;y=C(O(A,pt,A),function(e,t,n){var r=t[0],i=t[1];return T(r(new B(e,n,e.file||n.file),i))});var dt=ct;b=C(O(A,dt,A),function(e,t,n){var r=t[0],i=t[1];return T(r(new B(e,n,e.file||n.file),i))});var vt=ht;w=C(O(A,vt,A),function(e,t,n){var r=t[0],i=t[1];return T(r(new B(e,n,e.file||n.file),i))}),E=P(M(w),L);var mt=function(e){return new j(j.initial.line,j.initial.column,e)};x=function(e,t){return _(E,new D(e,mt(t)))},S=function(e,t){var n=H(e);return _(E,new D(n,mt(t)))},t.literal=y,t.token=b,t.inputElement=w,t.lexer=E,t.lex=S,t.lexStream=x}),define("khepri-ast/program",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s;s=r(i,"Program",["body"],[],function(e,t){var n=this;i.call(n,e),n.body=t}),t.Program=s}),define("khepri-parse/parse/common",["require","exports","bennu/parse","nu-stream/stream","khepri-ast/position"],function(e,t,n,r,i){var s=n.always,o=n.bind,u=n.binds,a=n.extract,f=n.enumeration,l=n.eager,c=n.optional,h=r.NIL,p=i.SourceLocation,d,v,m,g,y=function(e){var t=[],n=[];while(e.length>0){var r=e.shift();if(r.type)n.push(r);else{while(t.length>0){var i=t[t.length-1];if(!(!r.right&&i.precedence===r.precedence||i.precedence<r.precedence))break;t.pop();var s=n.pop(),o=n.pop();n.push(i.node(p.merge(o.loc,s.loc),i.value,o,s))}t.push(r)}}while(t.length>0){var u=t.pop(),a=n.pop(),f=n.pop();n.push(u.node(p.merge(f.loc,a.loc),u.value,f,a))}return n.pop()};d=function(e,t){var r=n.choicea(t.map(function(e){return e.sep.map(function(t){return{value:t,node:e.node,precedence:e.precedence,right:e.right}})}));return l(n.rec(function(t){return n.cons(e,c(h,n.cons(r,n.expected("binary expression",t))))})).map(y)},g=a(function(e){var t=e.position;return t.sourcePosition});var b=a(function(e){var t=e.position;return t.prevEnd});v=function(e,t){return u(f(g,e,b),function(e,n,r){return s(t(new p(e,r),n))})},m=function(e,t){return u(f(g,e,b),function(e,n,i){return s(t.apply(undefined,r.toArray(r.cons(new p(e,i),n))))})},t.precedence=d,t.node=v,t.nodea=m,t.positionParser=g}),define("khepri-ast/package",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s,o,u;o=r(i,"PackageExport",["id","alias"],[],function(e,t,n){var r=this;i.call(r,e),r.id=t,r.alias=n}),u=r(i,"PackageExports",["exports"],[],function(e,t){var n=this;i.call(n,e),n.exports=t}),s=r(i,"Package",["exports","body"],[],function(e,t,n){var r=this;i.call(r,e),r.exports=t,r.body=n}),t.Package=s,t.PackageExport=o,t.PackageExports=u}),define("khepri-parse/parse/token_parser",["require","exports","bennu/parse"],function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w=n.ExpectError,E=n.token,S=Function.prototype.call.bind(Array.prototype.indexOf),x=Function.prototype.call.bind(Array.prototype.join),T=function(e){return function(t,n){return new w(t,e,n?n.value:"end of input")}};r=function(){var e=arguments;return E(function(t){return t.type==="Punctuator"&&S(e,t.value)>=0},T(x(e,", ")))},i=E(function(e){return e.type==="Punctuator"},function(e,t){return new w(e,"any punctuator",t?t.value:"end of input")}),s=function(){var e=arguments;return E(function(t){return t.type==="Operator"&&S(e,t.value)>=0},T(x(e,", ")))},o=E(function(e){return e.type==="Operator"},function(e,t){return new w(e,"any operator",t?t.value:"end of input")}),u=function(){var e=arguments;return E(function(t){return t.type==="Keyword"&&S(e,t.value)>=0},T(x(e,", ")))},f=E(function(e){return e.type==="Identifier"},function(e,t){return new w(e,"any identifier",t?t.value:"end of input")}),a=function(){var e=arguments;return E(function(t){return t.type==="Identifier"&&S(e,t.value)>=0},T(x(e,", ")))},l=E(function(e){return e.type==="Null"},function(e,t){return new w(e,"Null literal",t?t.value:"end of input")}),c=E(function(e){return e.type==="Boolean"},function(e,t){return new w(e,"boolean literal",t?t.value:"end of input")}),h=E(function(e){return e.type==="Number"},function(e,t){return new w(e,"numeric literal",t?t.value:"end of input")}),p=E(function(e){return e.type==="String"},function(e,t){return new w(e,"string literal",t?t.value:"end of input")}),d=E(function(e){return e.type==="RegularExpression"},function(e,t){return new w(e,"regular expression literal",t?t.value:"end of input")}),v=function(){var e=arguments;return E(function(t){return t.type==="InfixOperator"&&S(e,t.base)>=0})},m=function(){var e=arguments;return E(function(t){return t.type==="PrefixOperator"&&S(e,t.value)>=0},T(x(e,", ")))},g=function(){var e=arguments;return E(function(t){return t.type==="InfixOperator"&&S(e,t.value)>=0},T(x(e,", ")))},y=E(function(e){return e.type==="PrefixOperator"},function(e,t){return new w(e,"prefix operator",t?t.value:"end of input")}),b=E(function(e){return e.type==="InfixOperator"},function(e,t){return new w(e,"infix operator",t?t.value:"end of input")}),t.punctuator=r,t.anyPunctuator=i,t.operator=s,t.anyOperator=o,t.keyword=u,t.identifier=a,t.anyIdentifier=f,t.nullLiteral=l,t.booleanLiteral=c,t.numericLiteral=h,t.stringLiteral=p,t.regularExpressionLiteral=d,t.prefixedOp=v,t.prefixOperator=m,t.infixOperator=g,t.unaryOperator=y,t.binaryOperator=b}),define("khepri-ast/value",["require","exports","./node"],function(e,t,n){var r,i,s,o,u,a,f=n.defineNode,l=n.Node;s=f(l,"Identifier",[],["name"],function(e,t){var n=this;l.call(n,e),n.name=t}),o=f(l,"UnaryOperator",[],["name"],function(e,t){var n=this;l.call(n,e),n.name=t}),u=f(l,"BinaryOperator",[],["name"],function(e,t){var n=this;l.call(n,e),n.name=t}),a=f(l,"TernaryOperator",[],["name"],function(e,t){var n=this;l.call(n,e),n.name=t}),r=f(l,"Literal",[],["kind","value"],function(e,t,n){var r=this;l.call(r,e),r.kind=t,r.value=n}),i=f(l,"ObjectValue",["key","value"],[],function(e,t,n){var r=this;l.call(r,e),r.key=t,r.value=n}),t.Literal=r,t.ObjectValue=i,t.Identifier=s,t.UnaryOperator=o,t.BinaryOperator=u,t.TernaryOperator=a}),define("khepri-parse/parse/value_parser",["require","exports","bennu/parse","bennu/lang","khepri-ast/value","./token_parser"],function(e,t,n,r,i,s){var o=n.bind,u=n.choice,a=n.label,f=r.between,l=s.prefixedOp,c,h,p,d,v,m,g,y,b,w,E;h=a("Null Literal",(E=s.nullLiteral,E.map(function(e){return i.Literal.create(e.loc,"null",e.value)})));var S;p=a("Boolean Literal",(S=s.booleanLiteral,S.map(function(e){return i.Literal.create(e.loc,"boolean",e.value)})));var x;d=a("Numeric Literal",(x=s.numericLiteral,x.map(function(e){return i.Literal.create(e.loc,"number",e.value)})));var T;v=a("String Literal",(T=s.stringLiteral,T.map(function(e){return i.Literal.create(e.loc,"string",e.value)})));var N;m=a("Regular Expression Literal",(N=s.regularExpressionLiteral,N.map(function(e){return i.Literal.create(e.loc,"regexp",e.value)}))),c=a("Literal",u(h,p,d,v,m)),g=a("Identifier",s.anyIdentifier.map(function(e){return i.Identifier.create(e.loc,e.value)})),b=a("Unary Operator",s.unaryOperator.map(function(e){return i.UnaryOperator.create(e.loc,e.value)})),w=a("Binary Operator",s.binaryOperator.map(function(e){return i.BinaryOperator.create(e.loc,e.value)})),y=f(s.punctuator("("),s.punctuator(")"),u(b,w)),t.literal=c,t.nullLiteral=h,t.booleanLiteral=p,t.numericLiteral=d,t.stringLiteral=v,t.regularExpressionLiteral=m,t.identifier=g,t.operator=y,t.unaryOperator=b,t.binaryOperator=w}),define("khepri-ast/clause",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s,o,u;s=function(){},s.prototype=new i,o=r(s,"SwitchCase",["test","consequent"],[],function(e,t,n){var r=this;i.call(r,e),r.test=t||null,r.consequent=n}),u=r(s,"CatchClause",["param","body"],[],function(e,t,n){var r=this;i.call(r,e),r.param=t,r.body=n}),t.Clause=s,t.SwitchCase=o,t.CatchClause=u}),define("khepri-ast/declaration",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s,o,u,a,f,l;s=function(){},s.prototype=new i,o=r(s,"VariableDeclaration",["declarations"],[],function(e,t){var n=this;i.call(n,e),n.declarations=t}),u=r(s,"VariableDeclarator",["id","init"],["immutable","recursive"],function(e,t,n,r,s){var o=this;i.call(o,e),o.id=t,o.init=n||null,o.immutable=!!r,o.recursive=s}),a=r(s,"Binding",["pattern","value"],["recursive"],function(e,t,n,r){var s=this;i.call(s,e),s.pattern=t,s.value=n,s.recursive=r}),f=r(s,"StaticDeclaration",["declarations"],[],function(e,t){var n=this;i.call(n,e),n.declarations=t}),l=r(s,"StaticDeclarator",["id","init"],[],function(e,t,n){var r=this;i.call(r,e),r.id=t,r.init=n}),t.Declaration=s,t.VariableDeclaration=o,t.VariableDeclarator=u,t.Binding=a,t.StaticDeclaration=f,t.StaticDeclarator=l}),define("khepri-ast/statement",["require","exports","./node"],function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b=n.defineNode,w=n.Node;r=function(){var e=this},r.prototype=new w,i=b(r,"EmptyStatement",[],[],function(e){var t=this;w.call(t,e)}),s=b(r,"DebuggerStatement",[],[],function(e){var t=this;w.call(t,e)}),u=b(r,"BlockStatement",["body"],[],function(e,t){var n=this;w.call(n,e),n.body=t}),a=b(r,"ExpressionStatement",["expression"],[],function(e,t){var n=this;w.call(n,e),n.expression=t}),f=b(r,"IfStatement",["test","consequent","alternate"],[],function(e,t,n,r){var i=this;w.call(i,e),i.test=t,i.consequent=n,i.alternate=r||null}),o=b(r,"WithStatement",["bindings","body"],[],function(e,t,n){var r=this;w.call(r,e),r.bindings=t,r.body=n}),c=b(r,"BreakStatement",[],[],function(e){var t=this;w.call(t,e)}),h=b(r,"ContinueStatement",[],[],function(e){var t=this;w.call(t,e)}),l=b(r,"SwitchStatement",["discriminant","cases"],[],function(e,t,n){var r=this;w.call(r,e),r.discriminant=t,r.cases=n}),p=b(r,"ReturnStatement",["argument"],[],function(e,t){var n=this;w.call(n,e),n.argument=t||null}),d=b(r,"ThrowStatement",["argument"],[],function(e,t){var n=this;w.call(n,e),n.argument=t}),v=b(r,"TryStatement",["block","handler","finalizer"],[],function(e,t,n,r){var i=this;w.call(i,e),i.block=t,i.handler=n,i.finalizer=r}),m=b(r,"WhileStatement",["test","body"],[],function(e,t,n){var r=this;w.call(r,e),r.test=t,r.body=n}),g=b(r,"DoWhileStatement",["body","test"],[],function(e,t,n){var r=this;w.call(r,e),r.test=n,r.body=t}),y=b(r,"ForStatement",["init","test","update","body"],[],function(e,t,n,r,i){var s=this;w.call(s,e),s.init=t||null,s.test=n||null,s.update=r||null,s.body=i}),t.Statement=r,t.EmptyStatement=i,t.DebuggerStatement=s,t.WithStatement=o,t.BlockStatement=u,t.ExpressionStatement=a,t.IfStatement=f,t.SwitchStatement=l,t.BreakStatement=c,t.ContinueStatement=h,t.ReturnStatement=p,t.ThrowStatement=d,t.TryStatement=v,t.WhileStatement=m,t.DoWhileStatement=g,t.ForStatement=y}),define("khepri-ast/expression",["require","exports","./node"],function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y=n.defineNode,b=n.Node;r=function(){var e=this},r.prototype=new b,i=y(r,"UnaryExpression",["operator","argument"],[],function(e,t,n){var r=this;b.call(r,e),r.operator=t,r.argument=n}),s=y(r,"BinaryExpression",["operator","left","right"],[],function(e,t,n,r){var i=this;b.call(i,e),i.operator=t,i.left=n,i.right=r}),o=y(r,"AssignmentExpression",["left","right"],["operator"],function(e,t,n,r){var i=this;b.call(i,e),i.operator=t,i.left=n,i.right=r}),u=y(r,"ConditionalExpression",["test","consequent","alternate"],[],function(e,t,n,r){var i=this;b.call(i,e),i.test=t,i.consequent=n,i.alternate=r}),a=y(r,"NewExpression",["callee","args"],[],function(e,t,n){var r=this;b.call(r,e),r.callee=t,r.args=n}),f=y(r,"CallExpression",["callee","args"],[],function(e,t,n){var r=this;b.call(r,e),r.callee=t,r.args=n}),l=y(r,"MemberExpression",["object","property"],["computed"],function(e,t,n,r){var i=this;b.call(i,e),i.object=t,i.property=n,i.computed=r}),c=y(r,"FunctionExpression",["id","params","body"],[],function(e,t,n,r){var i=this;b.call(i,e),i.id=t||null,i.params=n,i.body=r}),h=y(r,"ArrayExpression",["elements"],[],function(e,t){var n=this;b.call(n,e),n.elements=t}),p=y(r,"ObjectExpression",["properties"],[],function(e,t){var n=this;b.call(n,e),n.properties=t}),d=y(r,"LetExpression",["bindings","body"],[],function(e,t,n){var r=this;b.call(r,e),r.bindings=t,r.body=n}),v=y(b,"OperatorExpression",["operator"],["flipped"],function(e,t,n){var r=this;b.call(r,e),r.operator=t,r.flipped=n}),m=y(r,"CurryExpression",["base","args"],[],function(e,t,n){var r=this;b.call(r,e),r.base=t,r.args=n}),g=y(r,"ApplyExpression",["callee","arg"],[],function(e,t,n){var r=this;b.call(r,e),r.callee=t,r.arg=n}),t.Expression=r,t.UnaryExpression=i,t.BinaryExpression=s,t.AssignmentExpression=o,t.ConditionalExpression=u,t.NewExpression=a,t.CallExpression=f,t.MemberExpression=l,t.FunctionExpression=c,t.ArrayExpression=h,t.ObjectExpression=p,t.LetExpression=d,t.OperatorExpression=v,t.CurryExpression=m,t.ApplyExpression=g}),define("khepri-ast/pattern",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s,o,u,a,f,l,c,h,p,d;s=function(e){var t=this;i.call(t,e)},s.prototype=new i,o=r(s,"IdentifierPattern",["id"],[],function(e,t){var n=this;s.call(n,e),n.id=t}),u=r(s,"EllipsisPattern",["id"],[],function(e,t){var n=this;s.call(n,e),n.id=t||null}),a=r(s,"SinkPattern",[],[],function(e){var t=this;s.call(t,e)}),f=r(i,"ImportPattern",["from","pattern"],[],function(e,t,n){var r=this;i.call(r,e),r.from=t,r.pattern=n}),l=r(s,"ArrayPattern",["elements"],[],function(e,t){var n=this;s.call(n,e),n.elements=t}),c=r(s,"ObjectPatternElement",["key","target"],[],function(e,t,n){var r=this;s.call(r,e),r.key=t,r.target=n||null}),h=r(s,"ObjectPattern",["elements"],[],function(e,t){var n=this;s.call(n,e),n.elements=t}),d=r(s,"AsPattern",["id","target"],[],function(e,t,n){var r=this;s.call(r,e),r.id=t,r.target=n}),p=r(s,"ArgumentsPattern",["id","elements","self"],[],function(e,t,n,r){var i=this;s.call(i,e),i.id=t,i.elements=n,i.self=r}),t.Pattern=s,t.IdentifierPattern=o,t.EllipsisPattern=u,t.SinkPattern=a,t.ImportPattern=f,t.ArrayPattern=l,t.ObjectPatternElement=c,t.ObjectPattern=h,t.ArgumentsPattern=p,t.AsPattern=d}),define("khepri-parse/parse/pattern_parser",["require","exports","bennu/parse","bennu/lang","nu-stream/stream","khepri-ast/pattern","./common","./token_parser","./value_parser"],function(e,t,n,r,i,s,o,u,a){var f=n.attempt,l=n.append,c=n.bind,h=n.binds,p=n.choice,d=n.cons,v=n.eager,m=n.either,g=n.expected,y=n.enumeration,b=n.next,w=n.optional,E=n.rec,S=n.label,x=n.late,T=r.between,N=r.sepBy,C=r.sepBy1,k=r.sepEndBy,L=r.then,A=i.NIL,O=o.node,M=o.nodea,_=u.keyword,D=u.punctuator,P=a.identifier,H=a.operator,B=a.stringLiteral,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G=function(e,t,n){return E(function(r){return d(n,w(A,b(e,m(y(t),r))))})},Y=function(e,t,n){return m(y(t),G(e,t,n))},Z=function(e,t,n){return w(A,Y(e,t,n))};R=x(function(){return R}),q=x(function(){return q}),Q=x(function(){return Q});var et=w(D(","));j=function(e,t,n){return l(Y(et,t,e),b(et,N(et,n)))},F=function(e,t,n){return l(Z(et,t,e),b(et,N(et,n)))},U=S("Identifier Pattern",P.map(function(e){return s.IdentifierPattern.create(e.loc,e)})),z=S("Operator Pattern",H.map(function(e){return s.IdentifierPattern.create(e.loc,e)})),W=S("Sink Pattern",_("_").map(function(e){return s.SinkPattern.create(e.loc)})),X=S("Ellipsis Pattern",m(f(T(D("("),D(")"),D("...")).map(function(e){return s.EllipsisPattern.create(e.loc,null)})),O(b(D("..."),w(U)),s.EllipsisPattern.create)));var tt,nt,rt,it,st;$=S("Array Pattern",(tt=R,O(T(D("["),D("]"),v((nt=g("array pattern element",tt),rt=X,it=g("non-ellipsis array pattern element",tt),l((st=et,m(y(rt),E(function(e){return d(nt,w(A,b(st,m(y(rt),e))))}))),b(et,N(et,it)))))),s.ArrayPattern.create))),J=m(M(y(B,b(D(":"),q)),s.ObjectPatternElement.create),O(m(Q,U),s.ObjectPatternElement.create)),K=S("Object Pattern",O(T(D("{"),D("}"),v(C(et,g("object pattern element",J)))),s.ObjectPattern.create)),Q=S("As Pattern",M(y(f(L(U,D("#"))),g("object or array pattern",p($,K))),s.AsPattern.create)),V=S("Import Pattern",b(_("import"),M(y(B,R),s.ImportPattern.create))),q=S("Unpack",p($,K,Q,U,z)),R=S("Top Level Pattern",p(W,q)),t.listPattern=j,t.listPattern0=F,t.pattern=I,t.unpack=q,t.topLevelPattern=R,t.identifierPattern=U,t.operatorPattern=z,t.sinkPattern=W,t.ellipsisPattern=X,t.importPattern=V,t.arrayPattern=$,t.objectPatternElement=J,t.objectPattern=K,t.asPattern=Q}),define("khepri-parse/parse/function_parser",["require","exports","bennu/parse","bennu/lang","khepri-ast/expression","khepri-ast/statement","khepri-ast/pattern","./common","./token_parser","./value_parser","./pattern_parser","./expression_parser"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h,p,d,v,m=n.eager,g=n.either,y=n.enumeration,b=n.expected,w=n.next,E=n.optional,S=n.late,x=n.label,T=r.between,N=r.then,C=u.nodea,k=a.keyword,L=a.punctuator,A=a.infixOperator,O=f.identifier,M=l.topLevelPattern,_=l.listPattern0,D=l.ellipsisPattern,P=l.unpack,H=l.identifierPattern,B=S(function(){var t=e("./statement_parser"),n=t.blockStatement;return n}),j=S(function(){var t=e("./expression_parser"),n=t.expression;return n}),F=m(_(b("pattern",M),D,b("non-ellipsis pattern",M))),I=w(L("="),P);h=x("Argument List",C(y(F,E(I)),function(e,t,n){return o.ArgumentsPattern.create(e,null,t,n)})),p=x("Named Argument List",C(w(A("-"),y(E(H),T(L("("),L(")"),F),E(I))),o.ArgumentsPattern.create)),d=x("Arguments Pattern",g(p,h));var q,R;v=x("Function Expression",(q=E(w(k("function"),E(O))),R=g(B,N(j,E(L("§")))),C(y(q,w(L("\\"),d),w(L("->"),b("function body",R))),i.FunctionExpression.create))),t.argumentList=h,t.namedArgumentList=p,t.argumentsPattern=d,t.functionExpression=v}),define("khepri-parse/parse/expression_parser",["require","exports","bennu/parse","bennu/lang","nu-stream/stream","khepri-ast/declaration","khepri-ast/expression","khepri-ast/value","khepri-ast/position","./common","./token_parser","./value_parser","./pattern_parser","./function_parser"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_=n.always,D=n.append,P=n.attempt,H=n.binds,B=n.choice,j=n.cons,F=n.eager,I=n.either,q=n.enumeration,R=n.expected,U=n.many,z=n.many1,W=n.memo,X=n.next,V=n.optional,$=n.rec,J=n.late,K=n.label,Q=r.between,G=r.chainl1,Y=r.sepBy,Z=r.sepBy1,et=r.then,tt=i.foldl,nt=i.foldr,rt=a.SourceLocation,it=f.node,st=f.nodea,ot=f.precedence,ut=l.keyword,at=l.punctuator,ft=l.prefixedOp,lt=c.identifier,ct=c.literal,ht=c.operator,pt=c.stringLiteral,dt=c.numericLiteral,vt=h.topLevelPattern,mt,gt,yt,bt,wt=J(function(){var t=e("./function_parser"),n=t.functionExpression;return n});O=J(function(){return O}),w=J(function(){return w}),S=J(function(){return w});var Et=K("Arguments",(mt=O,it(Q(at("("),at(")"),F(Y(at(","),R("argument",mt)))),function(e,t){return t.loc=e,t}))),St,xt;d=K("Array Literal",(St=O,xt=Y(at(","),R("array element",St)),it(Q(at("["),at("]"),F(xt)),o.ArrayExpression.create)));var Tt,Nt,Ct;v=K("Object Literal",(Tt=B(pt,dt,lt),Nt=K("Property Initializer",st(q(et(Tt,at(":")),O),u.ObjectValue.create)),Ct=Y(at(","),R("object property",Nt)),it(Q(at("{"),at("}"),F(Ct)),o.ObjectExpression.create)));var kt=K("Let Binding",st(q(R("pattern",vt),at("=","=:",":="),R("bound value",O)),function(e,t,n,r){return s.Binding.create(e,t,r,n.value===":=")})),Lt,At;g=K("Let Expression",(Lt=Z(at(","),kt),At=O,st(X(ut("let"),q(R("let bindings",F(Lt)),X(ut("in"),R("let body expression",At)))),o.LetExpression.create))),k=K("Conditional Expression",st(X(at("?"),q(O,X(at(":"),R("conditional consequent expression",O)),X(at(":"),R("conditional alternate expression",O)))),o.ConditionalExpression.create));var Ot=K("Unary Operator Expression",B(c.unaryOperator,ut("typeof","void").map(function(e){var t=e.loc,n=e.value;return u.UnaryOperator.create(t,n)}),P(X(at("."),lt).map(function(e){var t=e.loc,n=e.name;return u.UnaryOperator.create(t,"."+n)}))).map(function(e){return o.OperatorExpression.create(e.loc,e)})),Mt=K("Binary Operator Expression",st(j(V(ut("_")),I(q(I(ut("new"),at(".")),V(X(at(","),O))),q(B(ut("instanceof"),at("@"),l.binaryOperator),V(X(V(at(",")),O))))),function(e,t,n,r){var i=o.OperatorExpression.create(e,u.BinaryOperator.create(e,n.value),t);return r?o.CurryExpression.create(e,i,[r]):i})),_t=K("Ternary Operator Expression",at("?").map(function(e){var t=e.loc,n=e.value;return o.OperatorExpression.create(t,u.TernaryOperator.create(t,n))}));m=K("Operator Expression",Q(at("("),at(")"),B(Ot,Mt,_t))),y=K("Primary Expression",B(g,k,lt,ct,d,v,wt,P(m),Q(at("("),at(")"),R("expression",O))));var Dt=K("Argument List",I(P(it(m,function(e,t){var n=[t];return n.loc=e,n})),Et));b=K("Accessor",it(X(at("."),I(lt.map(function(e){return[e,!1]}),Q(at("("),at(")"),R("accessor expression",O)).map(function(e){return[e,!0]}))),function(e,t){var n=t[0],r=t[1];return{loc:e,property:n,computed:r}})),E=K("New Expression",st(X(ut("new"),q(R("member expression",w),R("argument list",I(Et,F(q(S)))))),o.NewExpression.create));var Pt;w=K("Member Expression",H(q(I(y,E),U(W(b))),(Pt=tt.bind(null,function(e,t){return o.MemberExpression.create(rt.merge(e.loc,t.loc),e,t.property,t.computed)}),function(){var e=arguments;return _(Pt.apply(null,e))})));var Ht=K("Call Expression",(gt=function(e,t){return t.hasOwnProperty("property")?o.MemberExpression.create(rt.merge(e.loc,t.loc),e,t.property,t.computed):o.CallExpression.create(rt.merge(e.loc,t.loc),e,t)},H(q(w,U(I(Dt,b))),(yt=tt.bind(null,gt),function(){var e=arguments;return _(yt.apply(null,e))})))),Bt,jt;S=K("Curry Expression",(Bt=function(e,t){return o.CurryExpression.create(rt.merge(e.loc,t.loc),e,[].concat(t))},H(q(Ht,U(X(at("@"),R("curry argument",I(Dt,Ht))))),(jt=tt.bind(null,Bt),function(){var e=arguments;return _(jt.apply(null,e))})))),x=K("Call Expression",G(_(function(e,t){return o.CallExpression.create(rt.merge(e.loc,t.loc),e,[t])}),S)),T=K("Unary Operator",I(ut("typeof","void"),l.unaryOperator));var Ft;N=K("Unary Expression",(Ft=function(e,t){return o.UnaryExpression.create(rt.merge(t.loc,e.loc),u.UnaryOperator.create(t.loc,t.value),e)},H(q(U(T),R("unary argument",x)),function(e,t){return _(nt(Ft,t,e))})));var It=function(e,t,n,r){return o.BinaryExpression.create(e,u.BinaryOperator.create(t.loc,t.value),n,r)},qt=[{sep:ft("*","/","%"),precedence:1,node:It},{sep:ft("+","-"),precedence:2,node:It},{sep:ft("<<",">>",">>>"),precedence:3,node:It},{sep:I(ft("<",">","<=",">="),ut("instanceof")),precedence:4,node:It},{sep:ft("==","!=","===","!=="),precedence:5,node:It},{sep:ft("&"),precedence:6,node:It},{sep:ft("^"),precedence:7,node:It},{sep:ft("|"),precedence:8,node:It},{sep:ft("\\>","\\>>"),precedence:9,right:!0,node:It},{sep:ft("<\\","<<\\"),precedence:9,node:It},{sep:ft("|>"),precedence:10,node:It},{sep:ft("<|"),precedence:10,right:!0,node:It},{sep:ft("||"),precedence:11,node:It},{sep:ft("&&"),precedence:12,node:It}];C=K("Binary Expression",ot(W(N),qt)),O=C;var Rt;L=K("Left Hand Reference Expression",I(ht,H(q(lt,U(W(b))),(Rt=tt.bind(null,function(e,t){return o.MemberExpression.create(rt.merge(e.loc,t.loc),e,t.property,t.computed)}),function(){var e=arguments;return _(Rt.apply(null,e))}))));var Ut=K("Left Hand Reference Expression",H(q(lt,z(W(b))),(bt=tt.bind(null,function(e,t){return o.MemberExpression.create(rt.merge(e.loc,t.loc),e,t.property,t.computed)}),function(){var e=arguments;return _(bt.apply(null,e))})));A=K("Assignment Expression",$(function(e){return st(D(P(q(L,at("=",":="))),q(R("expression",I(e,O)))),function(e,t,n,r){return o.AssignmentExpression.create(e,n.value,t,r)})}));var zt=K("Delete Expression",it(X(ut("delete"),R("reference expression",Ut)),function(e,t){return o.UnaryExpression.create(e,"delete",t)}));M=B(zt,A,O),t.arrayLiteral=d,t.objectLiteral=v,t.operatorExpression=m,t.letExpression=g,t.primaryExpression=y,t.accessor=b,t.memberExpression=w,t.newExpression=E,t.curryExpression=S,t.applicationExpression=x,t.unaryOperator=T,t.unaryExpression=N,t.binaryExpression=C,t.conditionalExpression=k,t.leftHandReferenceExpression=L,t.assignmentExpression=A,t.expression=O,t.topLevelExpression=M}),define("khepri-parse/parse/statement_parser",["require","exports","nu-stream/stream","bennu/parse","bennu/lang","khepri-ast/clause","khepri-ast/declaration","khepri-ast/statement","./common","./token_parser","./expression_parser","./pattern_parser","./value_parser"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=n.NIL,d=r.append,v=r.choice,m=r.cons,g=r.eager,y=r.either,b=r.enumeration,w=r.expected,E=r.many,S=r.next,x=r.optional,T=r.label,N=r.late,C=i.between,k=i.sepBy1,L=i.then,A=a.node,O=a.nodea,M=f.keyword,_=f.punctuator,D=l.expression,P=l.topLevelExpression,H=c.importPattern,B=c.topLevelPattern,j=h.identifier,F=h.operator,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at;et=N(function(){return et});var ft=_(";"),lt=g(E(et));I=T("Block Statement",A(C(_("{"),_("}"),lt),u.BlockStatement.create)),U=T("Empty Statement",A(ft,u.EmptyStatement.create)),Z=T("Debugger Statement",A(S(M("debugger"),ft),u.DebuggerStatement.create)),z=T("Expression Statement",A(L(P,ft),u.ExpressionStatement.create));var ct,ht;q=T("Static Statement",(ct=A(j,o.StaticDeclarator.create),ht=g(k(_(","),ct)),A(C(M("static"),ft,ht),o.StaticDeclaration.create)));var pt=(tt=y(j,F),nt=b(_("=",":=","=:"),w("variable initilizer",D)),rt=O(m(tt,x(p,nt)),function(e,t,n,r){return o.VariableDeclarator.create(e,t,r,n&&(n.value===":="||n.value==="=:"),!n||n.value!=="=:")}),g(k(_(","),rt)));R=T("Variable Statement",A(C(M("var"),ft,pt),o.VariableDeclaration.create));var dt,vt,mt;X=T("With Statement",(dt=w("pattern",B),vt=y(H,O(b(dt,_("=","=:",":="),D),function(e,t,n,r){return o.Binding.create(e,t,r,n.value===":=")})),mt=g(k(_(","),vt)),O(b(C(M("with"),M("in"),w("with bindings",mt)),I),u.WithStatement.create)));var gt,yt;W=T("If Statement",(gt=C(_("("),_(")"),w("if condition",D)),yt=S(M("else"),et),O(S(M("if"),b(gt,et,x(yt))),u.IfStatement.create)));var bt,wt,Et,St;Q=T("Switch Statement",(bt=O(b(C(M("case"),_(":"),w("case test",D)),lt),s.SwitchCase.create),wt=A(S(M("default"),S(_(":"),lt)),function(e,t){return s.SwitchCase.create(e,null,t)}),Et=E(bt),St=g(C(_("{"),_("}"),d(x(p,Et),x(p,b(wt))))),O(S(M("switch"),b(C(_("("),_(")"),w("switch discriminant",D)),St)),u.SwitchStatement.create)));var xt=T("While Statement",(it=C(_("("),_(")"),D),O(S(M("while"),b(it,et)),u.WhileStatement.create))),Tt=T("Do While Statement",(st=C(_("("),_(")"),D),O(S(M("do"),b(I,C(M("while"),ft,st))),u.DoWhileStatement.create))),Nt=T("For Statement",(ot=y(A(S(M("var"),pt),o.VariableDeclaration.create),P),ut=D,at=P,O(S(M("for"),b(S(_("("),x(ot)),S(ft,x(ut)),S(ft,x(at)),S(_(")"),et))),u.ForStatement.create)));V=T("Iteration Statement",v(Tt,xt,Nt)),$=T("Continue Statement",A(S(M("continue"),ft),u.ContinueStatement.create)),J=T("Break Statement",A(S(M("break"),ft),u.BreakStatement.create)),K=T("Return Statement",A(C(M("return"),ft,x(D)),u.ReturnStatement.create)),G=T("Throw Statement",A(C(M("throw"),ft,D),u.ThrowStatement.create));var Ct,kt;Y=T("Try Statement",(Ct=O(S(M("catch"),b(C(_("("),_(")"),j),I)),s.CatchClause.create),kt=S(M("finally"),I),O(S(M("try"),b(I,x(Ct),x(kt))),u.TryStatement.create))),et=w("statement",T("Statement",v(I,q,R,U,W,X,V,$,J,K,Q,G,Y,Z,z))),t.blockStatement=I,t.staticStatement=q,t.variableStatement=R,t.emptyStatement=U,t.expressionStatement=z,t.ifStatement=W,t.withStatement=X,t.iterationStatement=V,t.continueStatement=$,t.breakStatement=J,t.returnStatement=K,t.switchStatement=Q,t.throwStatement=G,t.tryStatement=Y,t.debuggerStatement=Z,t.statement=et}),define("khepri-parse/parse/package_parser",["require","exports","bennu/parse","bennu/lang","khepri-ast/package","./common","./token_parser","./value_parser","./statement_parser"],function(e,t,n,r,i,s,o,u,a){var f=n.attempt,l=n.eager,c=n.either,h=n.enumeration,p=n.expected,d=n.next,v=n.optional,m=n.label,g=n.late,y=r.between,b=r.sepBy,w=s.node,E=s.nodea,S=o.keyword,x=o.punctuator,T=u.identifier,N=u.stringLiteral,C=u.operator,k=a.withStatement,L=a.blockStatement,A,O=c(T,C),M=m("Package Export",c(w(O,i.PackageExport.create),E(h(N,d(x(":"),T)),function(e,t,n){return i.PackageExport.create(e,n,t)}))),_=m("Package Export List",w(y(x("("),x(")"),l(b(v(x(",")),M))),i.PackageExports.create)),D=m("Package Exports",c(w(f(O),i.PackageExport.create),_)),P=m("Package Body",c(k,L));A=m("Package",E(d(S("package"),h(p("package exports",D),p("package body",P))),i.Package.create)),t.khepriPackage=A}),define("khepri-parse/parse/program_parser",["require","exports","bennu/parse","bennu/lang","khepri-ast/program","./common","./package_parser","./statement_parser"],function(e,t,n,r,i,s,o,u){var a=n.eager,f=n.either,l=n.eof,c=n.many,h=n.label,p=n.late,d=r.then,v=s.node,m=o.khepriPackage,g=u.statement,y,b,w;y=g,b=a(c(y)),w=h("Program",v(d(f(m,b),l),i.Program.create)),t.sourceElement=y,t.sourceElements=b,t.program=w}),define("khepri-parse/parse/parser",["require","exports","bennu/parse","nu-stream/stream","khepri-ast/position","./program_parser"],function(e,t,n,r,i,s){var o=n.ParserState,u=r.filter,a=r.isEmpty,f=r.first,l=r.from,c=i.SourceLocation,h=i.SourcePosition,p=s.program,d,v,m,g;d=u.bind(null,function(e){switch(e.type){case"Whitespace":case"LineTerminator":case"Comment":return!1;default:return!0}}),v=function(e,t,n){var r=this;r.tokenPosition=e,r.sourcePosition=t,r.prevEnd=n},v.prototype=new n.Position,v.prototype.constructor=v,v.initial=new v(n.Position.initial,h.initial,n.Position.initial),v.prototype.increment=function(e,t){var n=this;return new v(n.tokenPosition.increment(e),a(t)?e.loc.end:f(t).loc.start,e.loc.end)},v.prototype.toString=function(){var e=this;return""+e.sourcePosition},v.prototype.compare=function(e){var t=this;return t.tokenPosition.compare(e.tokenPosition)},g=function(e){return n.runState(p,new o(d(e),v.initial))};var y=l,b=g;m=function(e){return b(y(e))},t.parserStream=d,t.ParserPosition=v,t.parseInput=m,t.parseStream=g}),define("akh/base",["require","exports"],function(e,t){var n,r,i,s,o,u,a,f,l,c,h;n=function(e,t){return e.chain(t)},r=function(e,t){return t.map(e)},i=function(e,t){return e.ap(t)},s=function(e,t){return e.concat(t)},o=r,u=function(e,t,n){return t.chain(function(t){return n.map(function(n){return e(t,n)})})},a=function(e,t){return t.of(e).ap(t)},f=function(e,t,n){return t.of(function(t){return function(n){return e(t,n)}}).ap(t).ap(n)},l=function(e,t){return e.chain(function(){return t})},c=function(e){return Array.prototype.reduce.call(e,l)},h=function(){var e=arguments;return Array.prototype.reduce.call(e,l)},t.chain=n,t.map=r,t.ap=i,t.concat=s,t.liftM=o,t.liftM2=u,t.liftA=a,t.liftA2=f,t.next=l,t.sequencea=c,t.sequence=h}),define("akh/structure",["require","exports","./base"],function(e,t,n){var r=n.liftA2,i,s,o,u,a,f,l,c,h=function(e,t){return e.bind(null,t)};i=function(e,t,i){return e.prototype.of=t,e.of=e.prototype.of,e.ap=n.ap,e.prototype.ap=i,o(e,e.prototype.map||function(e){var n=this;return t(e).ap(n)}),e.ac=r.bind(null,h),e.prototype.ac=function(e){var t=this;return r(h,t,e)},e},s=function(e,t){return e.chain=n.chain,e.prototype.chain=t,e},o=function(e,t){return e.map=n.map,e.prototype.map=t,e},a=function(e,t,n){return e.prototype.zero=t,e.zero=e.prototype.zero,f(e,n),e},u=function(e,t,n){return e.prototype.of=t,e.of=e.prototype.of,s(e,n),o(e,e.prototype.map||function(e){var t,n=this;return n.chain((t=n.of,function(n){return t(e(n))}))}),i(e,t,e.prototype.ap||function(e){var t=this;return t.chain(function(t){return e.map(t)})}),e},f=function(e,t){return e.concat=n.concat,e.prototype.concat=t,e};var p=function(e,t,n){if(n.liftInner){var r;t.liftInner=p(e,(r=n.liftInner,function(t){return e(r(t))}),n.liftInner)}return t};l=function(e,t,n){if(t.lift){var r;e.prototype.liftInner=p(n,(r=t.lift,function(e){return n(r(e))}),t),e.liftInner=e.prototype.liftInner}return e},c=function(e,t,n){return e.prototype.inner=t,e.inner=e.prototype.inner,e.prototype.lift=n,e.lift=e.prototype.lift,l(e,t,n),e},t.Applicative=i,t.Chain=s,t.Functor=o,t.Monad=u,t.Monoid=a,t.Semigroup=f,t.LiftInner=l,t.Transformer=c}),define("akh/identity",["require","exports","./structure"],function(e,t,n){var r=n.Functor,i=n.Monad,s;return s=function(e){var t=this;t.value=e},i(s,function(e){return new s(e)},function(e){var t=this;return e(s.runIdentity(t))}),s.runIdentity=function(e){return e.value},s}),define("akh/spec/error",["require","exports"],function(e,t){var n;return n=function(e,t,n){e.prototype.fail=t,e.fail=e.prototype.fail,e.prototype.handle=n,e.handle=function(e,t){return e.handle(t)}},n}),define("akh/spec/state",["require","exports"],function(e,t){var n;return n=function(e,t,n){e.prototype.get=t,e.get=e.prototype.get,e.prototype.put=n,e.put=e.prototype.put,e.prototype.modify=function(e){return t.chain(function(t){return n(e(t))})},e.modify=e.prototype.modify},n.tryLiftState=function(e,t){var r,i;t.get&&t.put&&n(e,e.lift(t.get),(r=e.lift,i=t.put,function(e){return r(i(e))}))},n}),define("akh/spec/either",["require","exports"],function(e,t){var n;return n=function(e,t,n){e.prototype.right=n,e.right=e.prototype.right,e.prototype.left=t,e.left=e.prototype.left},n}),define("akh/trans/either",["require","exports","../structure","../spec/either","../spec/state"],function(e,t,n,r,i){var s=n.Monad,o=n.Monoid,u=n.Transformer,a;return a=function(e){var t,n,a,f=function(e){var t=this;t.run=e};return s(f,(t=e.of,function(e){var n={right:!0,x:e},r=t(n);return new f(r)}),function(t){var n=this;return new f(n.run.chain(function(n){var r,i=n.right,s=n.x;return i?(r=t(s),r.run):e.of({right:!1,x:s})}))}),o(f,new f(e.of((n=e.zero,{right:!1,x:n}))),function(t){var n=this;return new f(n.run.chain(function(n){var r=n.right,i=n.x;return r?e.of({right:!0,x:i}):t.run}))}),u(f,e,function(t){return new f(t.chain(function(t){return e.of({right:!0,x:t})}))}),r(f,(a=e.of,function(e){var t={right:!1,x:e},n=a(t);return new f(n)}),f.of),i.tryLiftState(f,e),f},a.eitherT=function(e,t,n){return e.run.chain(function(e){var r=e.right,i=e.x;return r?n(i):t(i)})},a}),define("akh/trans/error",["require","exports","../structure","../spec/error","../spec/state","./either"],function(e,t,n,r,i,s){var o=n.Monad,u=n.Monoid,a=s.eitherT,f;return f=function(e){var t=s(e);return r(t,t.left,function(e){var t=this;return f.runErrorT(t,t.of,e)}),i.tryLiftState(t,e),t},f.runErrorT=function(e,t,n){return a(e,n,t)},f}),define("akh/error",["require","exports","./identity","./trans/error"],function(e,t,n,r){var i=r.runErrorT,s,o=function(e){return e};s=r(n);var u=function(e,t,r){var s,o;return i(e,(s=n.of,function(e){return s(t(e))}),(o=n.of,function(e){return o(r(e))}))},a=n.runIdentity;return s.runError=function(){return a(u.apply(null,arguments))},s.tryError=function(e,t){return s.runError(e,o,t)},s.attemptError=function(e,t){return s.tryError(e,function(){return t})},s}),define("nu-stream/select",["require","exports","./stream"],function(e,t,n){var r=n.NIL,i=n.first,s=n.isEmpty,o=n.map,u=n.stream,a=n.rest,f=n.indexed,l,c,h,p,d=function(e){var t=e[1];return t};l=function(e,t){var n;return s(t)?t:(n=i(t),e(n)?u(n,l.bind(null,e,a(t))):r)},c=function(e,t){return isNaN(e)||e<0?t:o(d,l(function(t){var n=t[0];return e>n},f(t)))},h=function(e,t){for(var n=t;!s(n);n=a(n))if(!e(i(n)))return n;return r},p=function(e,t){return isNaN(e)||e<=0?t:o(d,h(function(t){var n=t[0];return e>n},f(t)))},t.takeWhile=l,t.take=c,t.skipWhile=h,t.skip=p}),define("neith/zipper",["require","exports","nu-stream/stream","nu-stream/select"],function(e,t,n,r){var i=n.append,s=n.cons,o=n.first,u=n.rest,a=n.isEmpty,f=n.map,l=n.NIL,c=n.reverse,h=n.stream,p=r.skip,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt=Function.prototype.call.bind(Array.prototype.reduceRight),rt=function(e,t,n){var r=this;r.loc=e,r.children=t,r.constructNode=n};rt.prototype.setLoc=function(e){var t=this;return new rt(e,t.children,t.constructNode)};var it=function(e,t,n){var r=this;r.focus=e,r.dirty=t,r.children=n};it.prototype.setDirty=function(e){var t=this;return t.dirty=e,e&&(t.children=null),t},it.prototype.setChildren=function(e){var t=this;return t.children=e,t};var st=f.bind(null,function(e){return new it(e)}),ot=f.bind(null,function(e){return e.focus}),ut=function(e,t,n,r){var i=this;i.focus=e,i.parent=t,i.left=n,i.right=r};ut.empty=new ut(null,null,l,l),ut.prototype.setFocus=function(e){var t=this;return new ut(e,t.parent,t.left,t.right)},ut.prototype.setParent=function(e){var t=this;return new ut(t.focus,e,t.left,t.right)},ut.prototype.setLeft=function(e){var t=this;return new ut(t.focus,t.parent,e,t.right)},ut.prototype.setRight=function(e){var t=this;return new ut(t.focus,t.parent,t.left,e)};var at=function(e,t,n,r){return new ut(n,e.parent,t,r)},ft=function(e){if(e.loc.focus.children)return e.loc.focus.children;var t=st(v(e));return e.loc.focus.setChildren(t),t},lt=function(e){var t=e.loc;return t.focus},ct=function(e){var t=e.loc;return t.parent},ht=function(e){var t=e.loc;return t.left},pt=function(e){var t=e.loc;return t.right},dt=function(e){var t=e.parent;return t&&t.focus.setDirty(!0),e},vt=function(e,t,n){return new it(e.constructNode(t,ot(n)),!1,n)},mt=function(e){return vt(e,ct(e).focus.focus,i(c(ht(e)),s(lt(e),l),pt(e)))};d=function(e){var t=lt(e);return t.focus},g=function(e){return e?h(d(e),function(){return g(k(e))}):l},y=function(e){return ot(ht(e))},b=function(e){return ot(pt(e))},m=function(e){var t;return d((t=ct(e),t&&t.focus.dirty?dt(t.setFocus(mt(e))):t))},v=function(e){return e.children(d(e))};var gt=a,yt=ft;T=function(e){return gt(yt(e))};var bt=T;w=function(e){var t=bt(e);return!t},E=function(e){var t=ct(e);return null!==t};var wt=E;S=function(e){var t=wt(e);return!t},x=E;var Et=a;N=function(e){return Et(ht(e))};var St=a;C=function(e){return St(pt(e))},k=function(e){var t;return S(e)?null:e.setLoc((t=ct(e),t&&t.focus.dirty?dt(t.setFocus(mt(e))):t))},L=function(e){var t,n=ft(e);return a(n)?null:(t=new ut(o(n),e.loc,l,u(n)),e.setLoc(t))},A=function(e){var t,n;return N(e)?null:(t=ht(e),n=at(e.loc,u(t),o(t),s(lt(e),pt(e))),e.setLoc(n))},O=function(e){var t,n;return C(e)?null:(t=pt(e),n=at(e.loc,s(lt(e),ht(e)),o(t),u(t)),e.setLoc(n))},M=function(e,t,n){return n&&e(n)?M(e,t,t(n)):n},_=function(e,t){var n=e(t);return n?_(e,n):t};var xt=function(e,t){return function(n){var r;return n&&(r=t(n),r&&e(r))}};D=function(){var e=arguments;return nt(e,xt)};var Tt=function(e,t){return function(n){return n&&(t(n)||e(n))}};P=function(){var e=arguments;return nt(e,Tt)},H=_.bind(null,k),B=_.bind(null,A),j=_.bind(null,O),F=_.bind(null,L),I=_.bind(null,D(L,j)),q=function(e){var t=k(e);return t?O(t)||q(t):t},R=P(L,O,q),U=function(e){var t=A(e);return t?I(t):k(e)},z=function(e,t){var n=new it(e),r=t.loc,i=r.setFocus(n),s=t.setLoc(i),o=dt(s.loc);return s.setLoc(o)},W=function(e,t){var n=e(d(t)),r=new it(n),i=t.loc,s=i.setFocus(r),o=t.setLoc(s),u=dt(o.loc);return o.setLoc(u)},X=function(e){var t;return C(e)?N(e)?E(e)?(t=ct(e).setFocus(vt(e,ct(e),l)),e.setLoc(t)):null:J(l,A(e)):$(p.bind(null,1),O(e))},V=function(e,t){var n=t.loc,r=n.setLeft(st(e)),i=t.setLoc(r),s=dt(i.loc);return i.setLoc(s)},$=function(e,t){return V(e(ot(ht(t))),t)},J=function(e,t){var n=t.loc,r=n.setRight(st(e)),i=t.setLoc(r),s=dt(i.loc);return i.setLoc(s)},K=function(e,t){return J(e(ot(pt(t))),t)},Q=function(e,t){return $(s.bind(null,e),t)},G=function(e,t){return K(s.bind(null,e),t)},Y=function(e,t){var n,r,i,o,u,a;return w(t)?k(Q(e,L(t))):(n=vt(t,d(t),s(new it(e),l)).focus,r=new it(n),i=t.loc,o=i.setFocus(r),u=t.setLoc(o),a=dt(u.loc),u.setLoc(a))},Z=function(e,t){return w(t)?k(G(e,j(L(t)))):Y(e,t)},et=function(e){var t=ut.empty.setFocus(new it(d(e)));return e.setLoc(t)},tt=function(e,t,n){return new rt(ut.empty.setFocus(new it(n)),e,t)},t.extract=d,t.children=v,t.parent=m,t.path=g,t.lefts=y,t.rights=b,t.hasChildren=w,t.hasParent=E,t.isRoot=S,t.isChild=x,t.isLeaf=T,t.isFirst=N,t.isLast=C,t.up=k,t.down=L,t.left=A,t.right=O,t.whilst=M,t.recur=_,t.seq=D,t.any=P,t.root=H,t.leftmost=B,t.rightmost=j,t.leftLeaf=F,t.rightLeaf=I,t.nextUpDfs=q,t.nextDfs=R,t.prevDfs=U,t.replace=z,t.modify=W,t.remove=X,t.setLefts=V,t.modifyLefts=$,t.setRights=J,t.modifyRights=K,t.insertLeft=Q,t.insertRight=G,t.insertChild=Y,t.appendChild=Z,t.detach=et,t.zipper=tt}),define("neith/tree",["require","exports","./zipper","nu-stream/stream"],function(e,t,n,r){var i=n.right,s=n.left,o=n.up,u=n.down,a=r.foldl,f=r.map,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;l=function(e,t){return{key:e,value:t}},c=function(e){return e.key},h=function(e){return e.value};var _=n.extract;v=function(e){var t=_(e);return t.value};var D=n.extract;m=function(e){var t=D(e);return t.key};var P=n.path,H=f.bind(null,h);d=function(e){return H(P(e))};var B=n.path,j=f.bind(null,c);p=function(e){return j(B(e))};var F=n.parent;y=function(e){var t=F(e);return t.value};var I=n.children,q=f.bind(null,h);b=function(e){return q(I(e))};var R=n.children,U=f.bind(null,c);w=function(e){return U(R(e))},g=function(e,t){var n=E(e,t);return n&&v(n)},S=function(e,t){var r,o,u;return(r=s,n.whilst(function(t){var n=m(t);return e!==n},r,t))||(o=i,u=i(t),n.whilst(function(t){var n=m(t);return e!==n},o,u))},E=function(e,t){return S(e,u(t))},x=function(e,t){var r;return n.replace((r=m(t),{key:r,value:e}),t)},T=function(e,t){return x(e(v(t)),t)},N=function(e,t){var r;return n.replace((r=v(t),{key:e,value:r}),t)},C=function(e,t){return N(e(m(t)),t)},k=function(e,t,r){return n.insertLeft({key:e,value:t},r)},L=function(e,t,r){return n.insertRight({key:e,value:t},r)},A=function(e,t,r){return n.insertChild({key:e,value:t},r)},O=function(e,t,r){return n.appendChild({key:e,value:t},r)};var z=function(e,t){var n=t.key,r=t.value;return e.hasOwnProperty(n)||(e[n]=r),e};M=function(e,t,r,i){var s=function(n){var r=n.value;return f(function(e){var n=t(r,e);return{key:e,value:n}},e(r))},o=function(e,t){var n=e.key,i=r(e.value,t,a.bind(null,z,{},t));return{key:n,value:i}};return n.zipper(s,o,{key:null,value:i})},t.Pair=l,t.pairKey=c,t.pairValue=h,t.edgePath=p,t.nodePath=d,t.node=v,t.edge=m,t.childNode=g,t.parentNode=y,t.childNodes=b,t.edges=w,t.child=E,t.sibling=S,t.setNode=x,t.modifyNode=T,t.setEdge=N,t.modifyEdge=C,t.insertLeft=k,t.insertRight=L,t.insertChild=A,t.appendChild=O,t.treeZipper=M}),define("khepri-ast-zipper",["require","exports","nu-stream/gen","nu-stream/stream","neith/tree","khepri-ast/node"],function(e,t,n,r,i,s){var o=n.range,u=r.foldl,a=r.from,f=r.NIL,l=i.treeZipper,c=s.Node,h=s.modify,p,d,v,m,g=function(e,t){return e[t]};v=function(e){return Array.isArray(e)?o(0,e.length):e&&e.children?a(e.children):f},d=g,m=function(e,t,n){return Array.isArray(e)?u(function(e,t){var n=t.key,r=t.value;return e[n]=r,e},[],t):e&&e.children?h(e,n(),{}):e},p=l.bind(null,v,d,m),t.khepriZipper=p,t.getChild=d,t.getChildren=v,t.construct=m}),define("khepri-compile/pseudo/pattern",["require","exports","khepri-ast/node","khepri-ast/pattern"],function(e,t,n,r){var i,s,o,u,a=n.defineNode,f=n.Node,l=r.Pattern;i=a(l,"RelativeUnpack",["pattern","target"],["index","min"],function(e,t,n,r,i){var s=this;f.call(s,e),s.pattern=t,s.target=n,s.index=r,s.min=i}),s=a(l,"SliceUnpack",["pattern","target"],["from","to"],function(e,t,n,r,i){var s=this;f.call(s,e),s.pattern=t,s.target=n,s.from=r,s.to=i}),o=a(l,"MemberUnpack",["target","key"],[],function(e,t,n){var r=this;f.call(r,e),r.target=t,r.key=n}),u=a(l,"Import",[],["from"],function(e,t){var n=this;f.call(n,e),n.from=t}),t.RelativeUnpack=i,t.SliceUnpack=s,t.MemberUnpack=o,t.Import=u}),define("khepri-compile/ast",["require","exports","khepri-ast/node"],function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E=n.setData;r=function(e){return e&&e.type},i=function(e){var t=e&&e.type;return"Identifier"===t},s=function(e){return(e&&e.type)==="UnaryOperator"||(e&&e.type)==="BinaryOperator"||(e&&e.type)==="TernaryOperator"},o=function(e){return i(e)||(e&&e.type)==="UnaryOperator"||(e&&e.type)==="BinaryOperator"||(e&&e.type)==="TernaryOperator"},u=function(e){var t=e&&e.type;return"Literal"===t},a=function(e){return f(e)&&!isNaN(e.value)},f=function(e){return u(e)&&(e.kind==="string"||e.kind==="number"||e.kind==="boolean"||e.kind==="null")},l=function(e){return u(e)||(e&&e.type)==="ArrayExpression"||(r&&r.type)==="ObjectExpression"},c=function(e){var t;return(f(e)||(e&&e.type)==="ArrayExpression")&&(e.elements.every(c)||(r&&r.type)==="ObjectExpression")&&e.elements.every((t=c,function(e){return t(e.value)}))},h=function(e){return f(e)&&!!e.value},p=function(e){var t;return(e&&e.type)==="FunctionExpression"&&(t=e.body,t&&t.type)==="BlockStatement"},d=function(e){return(e&&e.type)==="FunctionExpression"&&!e.id&&!p(e)&&!e.params.self},v=function(e){return d(e)&&!e.params.id},m=function(e,t,n){return n&&n.ud&&n.ud.hasOwnProperty(t)?n.ud[t]:e},g=function(e,t){return t&&t.ud&&t.ud.hasOwnProperty(e)?t.ud[e]:null},y=function(e,t,n){return E(n,e,t)},b=function(e){return e&&e.ud&&e.ud.hasOwnProperty("uid")?e.ud.uid:null},w=function(e,t){return E(t,"uid",e)},t.type=r,t.isIdentifier=i,t.isOperator=s,t.isSymbol=o,t.isLiteral=u,t.isNumberish=a,t.isPrimitive=f,t.isSimple=l,t.isPod=c,t.isTruthy=h,t.isBlockFunction=p,t.isLambda=d,t.isLambdaWithoutArgs=v,t.tryGetUd=m,t.getUd=g,t.setUd=y,t.getUid=b,t.setUid=w}),define("khepri-compile/fun",["require","exports"],function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v;n=function(e){return e},r=function(e){return function(){return e}},i=function(e){return function(t,n){return e(n,t)}},s=Array.isArray,l=Array.prototype.concat.bind([]),o=Function.prototype.call.bind(Array.prototype.reduce),u=Function.prototype.call.bind(Array.prototype.reduceRight),a=function(e,t,n){return o(n,e,t)},f=function(e,t,n){return u(n,e,t)},c=function(e,t){return Array.prototype.filter.call(t,e)},h=function(e,t){return Array.prototype.map.call(t,e)},p=function(e){return s(e)?Array.prototype.concat.apply([],e.filter(n)):e},d=function(e){return s(e)?p(e.map(d)):e},v=function(e,t){return e.indexOf(t)>=0},t.id=n,t.constant=r,t.flip=i,t.isArray=s,t.reduce=o,t.reduceRight=u,t.foldl=a,t.foldr=f,t.concat=l,t.filter=c,t.map=h,t.flatten=p,t.flattenr=d,t.contains=v}),define("neith/walk",["require","exports","./zipper"],function(e,t,n){var r=n.isLeaf,i=n.up,s=n.down,o=n.right,u=n.seq,a=n.whilst,f,l,c,h,p=function(e){return e};f=function(e,t){return!t||r(t)?t:i(e(a(o,u(e,o),s(t))))},l=function(e,t,n){var r=function(n){return t(f(r,e(n)))};return t(f(r,e(n)))},c=function(e,t){return l(p,e,t)},h=function(e,t){return l(e,p,t)},t.forChildren=f,t.walk=l,t.postWalk=c,t.preWalk=h}),define("khepri-compile/rewriter",["require","exports","neith/zipper","neith/tree","neith/walk","./fun"],function(e,t,n,r,i,s){var o,u,a,f,l=i.walk,c=s.concat;o=!0,u=!1;var h=function(e,t){return t.length?r.modifyNode(function(e){return t.reduce(function(e,t){return t.map(e)},e)},e):e};a=function(){var e=this;e.peepholes=[]},a.prototype.add=function(e,t,n,r){var i=this;if(Array.isArray(e))return e.map(function(e){return i.add(e,t,n,r)});i.peepholes[e]=c(i.peepholes[e]||[],{condition:n,map:r,up:t})},a.prototype.rewriters=function(e){var t=this;return e&&t.peepholes[e.type]||[]},a.prototype.upTransforms=function(e){var t=this;return t.rewriters(e).filter(function(t){return t.up&&t.condition(e)})},a.prototype.downTransforms=function(e){var t=this;return t.rewriters(e).filter(function(t){return!t.up&&t.condition(e)})},a.prototype.transform=function(e){var t=this,n=r.node(e);return h(e,t.downTransforms(n))},a.prototype.transformPost=function(e){var t=this,n=r.node(e);return h(e,t.upTransforms(n))};var p=function(e,t){return l(e.transform.bind(e),e.transformPost.bind(e),t)},d=n.root;f=function(){var e=arguments;return d(p.apply(null,e))},t.UP=o,t.DOWN=u,t.Rewriter=a,t.rewrite=f}),define("khepri-compile/normalize/pre_normalize",["require","exports","khepri-ast/node","khepri-ast/expression","khepri-ast/pattern","khepri-ast/package","khepri-ast/value","../pseudo/pattern","../ast","../fun","../rewriter"],function(e,t,n,r,i,s,o,u,a,f,l){var c,h=n.modify,p=n.setData,d=n.getData,v=u.SliceUnpack,m=u.RelativeUnpack,g=a.type,y=f.concat,b=f.map,w=f.foldl,E=f.foldr,S=l.UP,x=l.DOWN,T=l.Rewriter,N=l.rewrite,C=o.Literal.create.bind(null,null,"string"),k=o.Literal.create.bind(null,null,"number"),L=function(e){return!0},A=new T;A.add("PackageExport",S,function(e){var t=e.alias;return!t},function(e){var t=e.id,n=e.loc;return s.PackageExport.create(n,t,C(t.name))}),A.add("LetExpression",S,function(e){return e.bindings.length>1},function(e){var t=e.bindings,n=e.body;return E(function(e,t){return r.LetExpression.create(null,[t],e)},n,t)}),A.add("CurryExpression",x,function(e){return e.args.length>1},function(e){var t=e.base,n=e.args;return w(function(e,t){return r.CurryExpression.create(null,e,[t])},t,n)}),A.add("ArrayPattern",x,function(e){return!0},function(e){var t=e.loc,n=e.elements,r=n.map(g).indexOf("EllipsisPattern"),s=r<0?[n,null,[]]:[n.slice(0,r),n[r],n.slice(r+1)],o=s[0],u=s[1],a=s[2],f;return i.ObjectPattern.create(t,(f=b(function(e,t){return i.ObjectPatternElement.create(null,k(t),e)},o),y(f,u&&u.id?v.create(null,u.id,null,f.length,a.length):[],b(function(e,t){return m.create(null,e,null,a.length-t,a.length+f.length)},a))))}),A.add("ArgumentsPattern",S,function(e){return e.elements.map(g).indexOf("EllipsisPattern")>=0},function(e){var t,n=e.elements,r=n.map(g).indexOf("EllipsisPattern"),s=r<0?[n,null,[]]:[n.slice(0,r),n[r],n.slice(r+1)],u=s[0],a=s[1],f=s[2],l=e.id||(t=i.IdentifierPattern.create(null,o.Identifier.create(null,"__args")),p(t,"reserved",!0));return h(e,{id:l,elements:y(u,a&&a.id?v.create(null,a.id,null,u.length,f.length):[],b(function(e,t){return m.create(null,e,null,f.length-t,f.length+u.length)},f))})}),A.add("ObjectPatternElement",x,function(e){var t=e.target;return!t},function(e){var t=e.key;switch(g(t)){case"IdentifierPattern":return i.ObjectPatternElement.create(e.loc,C(t.id.name),t);case"AsPattern":return i.ObjectPatternElement.create(e.loc,C(t.id.id.name),t);default:return e}}),A.add("AsPattern",x,function(e){return!d(e.target,"id")},function(e){return i.AsPattern.create(e.loc,e.id,p(e.target,"id",e.id))}),A.add("ObjectPattern",S,function(e){return!d(e,"id")},function(e){var t=i.IdentifierPattern.create(null,o.Identifier.create(null,"__o")),n=p(t,"reserved",!0);return i.AsPattern.create(null,n,p(e,"id",n))}),A.add("SinkPattern",x,L,function(e){var t=e.loc,n=i.IdentifierPattern.create(t,o.Identifier.create(null,"_"));return p(n,"reserved",!0)}),c=N.bind(null,A),t.normalize=c}),define("khepri-compile/stages/pre_normalize",["require","exports","akh/error","../normalize/pre_normalize"],function(e,t,n,r){var i;return i=function(e){var t=e.options,i=e.tree;return n.of({options:t,tree:r.normalize(i)})},i}),define("bes/object",["require","exports"],function(e,t){var n,r,i,s=function(e){var t=Object.getOwnPropertyNames(e),n=t.length,r={};for(var i=0;i<n;i+=1){var s=t[i];r[s]=Object.getOwnPropertyDescriptor(e,s)}return r};n=function(e,t,n,r){var i=s(e),o=i[t];return i[t]={value:n,enumerable:!o||r!==undefined?r:o.enumerable},Object.create(Object.getPrototypeOf(e),i)},r=function(e,t){var n=s(e),r=Object.keys(e);for(var i=0,o=r.length;i<o;i+=1){var u=r[i],a=n[u],f=t[u].value,l=t[u].enumerable;n[u]={value:f,enumerable:!a||l!==undefined?l:a.enumerable}}return Object.create(Object.getPrototypeOf(e),n)},i=function(e,t){var n=s(e);return delete n[t],Object.create(Object.getPrototypeOf(e),n)},t.setProperty=n,t.setProperties=r,t.deleteProperty=i}),define("akh/trans/statei",["require","exports","../structure","../base","../spec/state"],function(e,t,n,r,i){var s=n.Monad,o=n.Monoid,u=n.Transformer,a=r.map,f,l=function(e,t){return e.run(t)};f=function(e){var t=function(e){var t=this;t.run=e};return s(t,function(n){return new t(function(t){return e.of({x:n,s:t})})},function(e){var n=this;return new t(function(t){return n.run(t).chain(function(t){var n=t.x,r=t.s,i=e(n);return i.run(r)})})}),o(t,new t(function(t){return e.zero}),function(e){var n=this;return new t(function(t){return n.run(t).concat(e.run(t))})}),u(t,e,function(n){return new t(function(t){return n.chain(function(n){return e.of({x:n,s:t})})})}),i(t,new t(function(t){return e.of({x:t,s:t})}),function(n){return new t(function(t){return e.of({x:n,s:n})})}),t},f.runStateT=l;var c=f.runStateT,h=a.bind(null,function(e){var t=e.x;return t});f.evalStateT=function(){return h(c.apply(null,arguments))};var p=f.runStateT,d=a.bind(null,function(e){var t=e.s;return t});return f.execStateT=function(){return d(p.apply(null,arguments))},f}),define("akh/_tail",["require","exports"],function(e,t){var n,r;n=function(e,t){var n=this;n.f=e,n.x=t},r=function(e){var t=e;while(t instanceof n)t=t.f(t.x);return t},t.Tail=n,t.trampoline=r}),define("akh/trans/codensity",["require","exports","../structure","../_tail","../spec/state"],function(e,t,n,r,i){var s=n.Monad,o=n.Monoid,u=n.Transformer,a=r.Tail,f=r.trampoline,l,c=function(e,t){return new a(e.run,t)};l=function(e){var t=function(e){var t=this;t.run=e};return s(t,function(e){return new t(function(t){return t(e)})},function(e){var n=this;return new t(function(t){var r=function(n){var r=e(n);return new a(r.run,t)};return new a(n.run,r)})}),o(t,new t(function(t){return e.zero}),function(e){var n=this;return new t(function(t){return l.runCodensity(n,t).concat(l.runCodensity(e,t))})}),u(t,e,function(e){return new t(function(t){var n;return e.chain((n=f,function(e){return n(t(e))}))})}),i.tryLiftState(t,e),t};var h=f;return l.runCodensity=function(){return h(c.apply(null,arguments))},l}),define("akh/trans/state",["require","exports","../structure","../base","./codensity","./statei"],function(e,t,n,r,i,s){var o=n.LiftInner,u=r.map,a,f=function(e,t){var n=i(e),r=n.lift,s=e.lift;return n.prototype.lift=function(e){return r(s(e))},n.lift=n.prototype.lift,n.inner=t,o(n,t,n.lift),n};a=function(e){return f(s(e),e)},a.runStateT=function(e,t){return s.runStateT(i.runCodensity(e,e.inner.of),t)};var l=a.runStateT,c=u.bind(null,function(e){var t=e.x;return t});a.evalStateT=function(){return c(l.apply(null,arguments))};var h=a.runStateT,p=u.bind(null,function(e){var t=e.s;return t});return a.execStateT=function(){return p(h.apply(null,arguments))},a}),define("akh/trans/unique",["require","exports","./state"],function(e,t,n){var r;return r=function(e){var t=n(e);return t.prototype.unique=t.modify(function(e){return 1+e}),t.unique=t.prototype.unique,t},r.runUniqueT=function(e,t){return n.evalStateT(e,isNaN(t)?1:t)},r}),define("akh/unique",["require","exports","./trans/unique","./identity"],function(e,t,n,r){var i;i=n(r);var s=n.runUniqueT,o=r.runIdentity;return i.runUnique=function(){return o(s.apply(null,arguments))},i}),define("zipper-m/trans/zipper",["require","exports","akh/trans/state","neith/zipper"],function(e,t,n,r){var i,s=function(e,t,n){return e.prototype.inspect=t.map.bind(t),e.inspect=e.prototype.inspect,e.prototype.extract=t.map(r.extract),e.extract=e.prototype.extract,e.inspectWith=e.extract.chain.bind(e.extract),e.prototype.move=n,e.move=e.prototype.move,e.prototype.up=n(r.up),e.up=e.prototype.up,e.prototype.down=n(r.down),e.down=e.prototype.down,e.prototype.left=n(r.left),e.left=e.prototype.left,e.prototype.right=n(r.right),e.right=e.prototype.right,e.prototype.root=n(r.root),e.root=e.prototype.root,e.prototype.leftmost=n(r.leftmost),e.leftmost=e.prototype.leftmost,e.prototype.rightmost=n(r.rightmost),e.rightmost=e.prototype.rightmost,e.prototype.leftLeaf=n(r.leftLeaf),e.leftLeaf=e.prototype.leftLeaf,e.prototype.rightLeaf=n(r.rightLeaf),e.rightLeaf=e.prototype.rightLeaf,e.prototype.replace=function(e){return n(r.replace.bind(null,e))},e.replace=e.prototype.replace,e.prototype.modify=function(e){return n(r.modify.bind(null,e))},e.modify=e.prototype.modify,e.prototype.remove=n(r.remove),e.remove=e.prototype.remove,e.prototype.insertLeft=function(e){return n(r.insertLeft.bind(null,e))},e.insertLeft=e.prototype.insertLeft,e.prototype.insertRight=function(e){return n(r.insertRight.bind(null,e))},e.insertRight=e.prototype.insertRight,e.prototype.insertChild=function(e){return n(r.insertChild.bind(null,e))},e.insertChild=e.prototype.insertChild,e.prototype.appendChild=function(e){return n(r.appendChild.bind(null,e))},e.appendChild=e.prototype.appendChild,e};return i=function(e){var t=n(e);return s(t,t.get,t.modify),t},i.runZipperT=n.evalStateT,i}),define("zipper-m/trans/tree",["require","exports","neith/zipper","neith/tree","./zipper"],function(e,t,n,r,i){var s,o=function(e){return e.node=e.inspect(r.node),e.child=function(t){return e.move(r.child.bind(null,t))},e.sibling=function(t){return e.move(r.sibling.bind(null,t))},e.modifyNode=function(t){return e.move(r.modifyNode.bind(null,t))},e.setNode=function(t){return e.move(r.setNode.bind(null,t))},e};return s=function(e){var t=i(e);return o(t),t},s.runTreeZipperT=i.runZipperT,s}),define("khepri-compile/user_operator",["require","exports","./fun"],function(e,t,n){var r,i,s={"*":"star","/":"slash","+":"plus","-":"minus","%":"percent","<":"lt",">":"gt","=":"eq","&":"and","|":"bar","^":"hat","\\":"bslash","~":"tilde","@":"at","?":"quest"};r=function(e){return"__"+e.split("").map(function(e){return s[e]}).join("_")},i=function(e,t){var n;return e?(n=t.reduce(function(t,n){var r;return(r=n[0],e.substring(0,r.length)===r)&&(!t||n[0].length>t[0].length)?n:t},null),n?[n].concat(i(e.slice(n[0].length),t)):[]):[]},t.opToName=r,t.splitOp=i}),define("bes/record",["require","exports","./object"],function(e,t,n){var r=n.setProperty,i,s,o=Function.prototype.call.bind(Array.prototype.concat),u=Function.prototype.call.bind(Array.prototype.map),a=function(e){return e.match(/\w\S*/g).map(function(e){var t=e[0];return t.toUpperCase()+e.slice(1)}).join("")},f=function(e){return function(){var t=this,n=arguments;return e.apply(t,n)}},l=function(e){var t=e.length;return function(){var n=this,r=arguments;for(var i=0;i<t;i+=1)n[e[i]]=r[i]}},c=function(e){return function(t){var n=this;return r(n,e,t)}},h=function(e){return Function.prototype.call.bind(c(e))};i=function(e,t,n){var r=n||l(t);r.__keys=t,r.prototype=Object.create(e||new Object),r.prototype.constructor=r,t.forEach(function(e){var t="set"+a(e+"");r[t]=h(e),r.prototype[t]=c(e)});var i=function(e){var t=this;return r.apply(t,e)};return i.prototype=r.prototype,r.create=function(){var e=arguments;return new i(e)},r},s=function(e,t,n){return t&&t.length?i(new e,o(e.__keys,t),n):i(new e,e.__keys,n||f(e))},t.declare=i,t.extend=s}),define("hamt",["require","exports"],function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E=Math.pow(2,5),S=E-1,x=E/2,T=E/4,N={},C=function(e){var t=e-(e>>1&1431655765),n=(t&858993459)+(t>>2&858993459),r=n+(n>>4)&252645135,i=r+(r>>8),s=i+(i>>16);return s&127},k=function(e,t,n){var r=n.slice();return r[e]=t,r},L=function(e,t){var n=t.slice();return n.splice(e,1),n},A=function(e,t,n){var r=n.slice();return r.splice(e,0,t),r};n=function(e){if(typeof e=="number")return e;var t=0;for(var n=0,r=e.length;n<r;n+=1){var i=e.charCodeAt(n);t=(t<<5)-t+i|0}return t},r=null;var O=function(e,t,n){var r=this;r.hash=e,r.key=t,r.value=n},M=function(e,t){var n=this;n.hash=e,n.children=t},_=function(e,t){var n=this;n.mask=e,n.children=t},D=function(e,t){var n=this;n.count=e,n.children=t},P=function(e){return e===null||e instanceof O||e instanceof M},H=function(e,t,n,r){var i=n,s=[],o=0;for(var u=0;i;u+=1)i&1&&(s[u]=r[o],o+=1),i>>>=1;return s[e]=t,new D(o+1,s)},B=function(e,t){var n=[],r=0;for(var i=0,s=t.length;i<s;i+=1){var o=t[i];i!==e&&!!o&&(n.push(o),r|=1<<i)}return new _(r,n)},j=function(e,t,n){var r=t.hash,i,s,o=n.hash;return r===o?new M(r,[n,t]):(i=r>>>e&S,s=o>>>e&S,new _(1<<i|1<<s,i===s?[j(e+5,t,n)]:i<s?[t,n]:[n,t]))},F=function(e,t,n){var r,i,s;return e.length?(r=e[0],i=e.slice(1),r.key===n?(s=t(r.value),N===s?i:[s].concat(i)):[r].concat(F(i,t,n))):[]},I;O.prototype.lookup=function(e,t,n){var r=this;return n===r.key?r.value:N},M.prototype.lookup=function(e,t,n){var r=this;for(var i=0,s=r.children.length;i<s;i+=1){var o=r.children[i],u=o.key,a=o.value;if(n===u)return a}return N},_.prototype.lookup=function(e,t,n){var r=this,i=t>>>e&S,s,o=1<<i;return r.mask&o?I(r.children[s=r.mask,C(s&o-1)],e+5,t,n):N},D.prototype.lookup=function(e,t,n){var r=this,i=t>>>e&S,s=r.children[i];return I(s,e+5,t,n)},I=function(e,t,n,r){return e?e.lookup(t,n,r):N};var q;O.prototype.modify=function(e,t,n,r){var i,s,o=this;return r===o.key?(i=t(o.value),N===i?null:new O(n,r,i)):(s=t(),N===s?o:j(e,o,new O(n,r,s)))},M.prototype.modify=function(e,t,n,r){var i=this,s=F(i.children,t,r);return s.length>1?new M(i.hash,s):s[0]},_.prototype.modify=function(e,t,n,r){var i=this,s=i.children,o=n>>>e&S,u=1<<o,a=i.mask,f=C(a&u-1),l=i.mask&u,c=q(l?s[f]:null,e+5,t,n,r),h=l&&!c,p=!l&&!!c,d=h?i.mask&~u:p?i.mask|u:i.mask;return d?h?s.length<=2&&P(s[f^1])?s[f^1]:new _(d,L(f,i.children)):p?i.children.length>=x?H(o,c,i.mask,s):new _(d,A(f,c,s)):new _(d,k(f,c,s)):null},D.prototype.modify=function(e,t,n,r){var i=this,s=n>>>e&S,o=i.children[s],u=q(o,e+5,t,n,r);return!o&&!!u?new D(i.count+1,k(s,u,i.children)):!!o&&!u?i.count-1<=T?B(s,i.children):new D(i.count-1,k(s,null,i.children)):new D(i.count,k(s,u,i.children))},q=function(e,t,n,r,i){var s;return e?e.modify(t,n,r,i):(s=n(),N===s?null:new O(r,i,s))},i=function(e,t,n,r){var i=r?r.lookup(0,t,n):N;return N===i?e:i},s=function(e,t,r){var i=n(t),s=r?r.lookup(0,i,t):N;return N===s?e:s},o=function(e,t,n){var r=n?n.lookup(0,e,t):N;return N===r?null:r},u=function(e,t){var r=n(e),i=t?t.lookup(0,r,e):N;return N===i?null:i},a=function(e,t,n){var r;return r=n?n.lookup(0,e,t):N,N!==r},f=function(e,t){var r,i=n(e);return r=t?t.lookup(0,i,e):N,N!==r},h=function(e,t,n,r){var i;return r?r.modify(0,n,e,t):(i=n(),N===i?null:new O(e,t,i))},p=function(e,t,r){var i,s=n(e);return r?r.modify(0,t,s,e):(i=t(),N===i?null:new O(s,e,i))},l=function(e,t,n,r){var i=function(){return n};return r?r.modify(0,i,e,t):N===n?null:new O(e,t,n)},c=function(e,t,r){var i=n(e),s=function(){return t};return r?r.modify(0,s,i,e):N===t?null:new O(i,e,t)};var R=function(){return N};d=function(e,t,n){return n?n.modify(0,R,e,t):N===N?null:new O(e,t,N)},v=function(e,t){return d(n(e),e,t)},O.prototype.fold=function(e,t){var n=this;return e(t,n)},M.prototype.fold=function(e,t){var n=this,r=n.children;return r.reduce(e,t)},_.prototype.fold=function(e,t){var n=this,r=n.children,i=t;for(var s=0,o=r.length;s<o;s+=1){var u=r[s];i=u instanceof O?e(i,u):u.fold(e,i)}return i},D.prototype.fold=function(e,t){var n=this,r=n.children,i=t;for(var s=0,o=r.length;s<o;s+=1){var u=r[s];u&&(i=u instanceof O?e(i,u):u.fold(e,i))}return i},m=function(e,t,n){return n?n.fold(e,t):t};var U=function(e){return 1+e};g=function(e){return e?e.fold(U,0):0};var z=function(e,t){var n=t.key,r=t.value;return e.push([n,r]),e};y=function(e){var t=[];return e?e.fold(z,t):t};var W=function(e,t){var n=t.key;return e.push(n),e};b=function(e){var t=[];return e?e.fold(W,t):t};var X=function(e,t){var n=t.value;return e.push(n),e};w=function(e){var t=[];return e?e.fold(X,t):t},t.hash=n,t.empty=r,t.tryGetHash=i,t.tryGet=s,t.getHash=o,t.get=u,t.hasHash=a,t.has=f,t.setHash=l,t.set=c,t.modifyHash=h,t.modify=p,t.removeHash=d,t.remove=v,t.fold=m,t.count=g,t.pairs=y,t.keys=b,t.values=w}),define("khepri-compile/lexical/scope",["require","exports","bes/record","hamt"],function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;i=n.declare(null,["record","outer","mapping","definitions","locals","prefixOps"]),i.empty=i.create(r.empty,null,r.empty,r.empty,r.empty,r.empty),i.prototype.hasOwnBinding=function(e){var t=this;return r.has(e,t.record)},s=function(e,t){return t.hasOwnBinding(e)||t.outer&&s(e,t.outer)},o=function(e,t){var n=t.getBinding(e);return n&&n.mutable},i.prototype.getBinding=function(e){var t=this;return r.get(e,t.record)||(t.outer?t.outer.getBinding(e):null)},i.prototype.getUnusedId=function(e){var t=this,n;if(!(t.hasOwnBinding(e)||t.outer&&s(e,t.outer)))return e;for(var r=0;;r+=1)if(!(n=e+r,t.hasOwnBinding(n)||t.outer&&s(n,t.outer)))return e+r},u=function(e,t,n){return e.setRecord(r.set(t,n,e.record))},a=function(e,t,n){return u(n,e,{mutable:1,loc:t})},f=function(e,t,n){return u(n,e,{mutable:0,loc:t})},l=function(e,t,n){return n.hasOwnBinding(e)?u(n,e,{loc:n.getBinding(e).loc,mutable:t?1:0}):n.outer&&n.setOuter(l(e,t,n.outer))},c=function(e,t){return t.hasOwnBinding(e)?r.get(e,t.definitions):t.outer&&c(e,t.outer)},h=function(e,t,n){return n.setDefinitions(r.set(e,t,n.definitions)).setLocals(r.set(t,e,n.locals))},i.prototype.hasOwnMapping=function(e){var t=this;return r.has(e,t.mapping)},i.prototype.hasMapping=function(e){var t=this;return t.hasOwnMapping(e)||t.outer&&t.outer.hasMapping(e)},v=function(e,t){return t.hasOwnMapping(e)?r.get(e,t.mapping):t.outer&&v(e,t.outer)},m=function(e,t,n){return n.setMapping(r.set(e,t,n.mapping))},S=function(e,t,n){var r;return n.hasMapping(t)?u(n,e,{mutable:1,loc:null}):(r=n.getUnusedId(e),m(t,r,u(n,r,{mutable:1,loc:null})))};var x=r.keys;g=function(e){return x(e.locals)},w=function(e){return i.empty.setOuter(e).setDefinitions(e.definitions).setPrefixOps(e.prefixOps)};var T=r.fold.bind(null,function(e,t){var n=t.key,i=t.value;return r.set(n,i,e)});E=function(e){return e.outer.setLocals(T(e.outer.locals,e.locals))},y=function(e,t,n){return n.setPrefixOps(r.set(e,t,n.prefixOps))};var N=r.pairs;b=function(e){return N(e.prefixOps)},t.Scope=i,t.hasBinding=s,t.hasMutableBinding=o,t.addBinding=u,t.addMutableBinding=a,t.addImmutableBinding=f,t.setBindingMutability=l,t.getUid=c,t.addUid=h,t.hasMapping=p,t.hasOwnMapping=d,t.getMapping=v,t.addMapping=m,t.getClosure=g,t.addOperator=y,t.getOperators=b,t.push=w,t.pop=E,t.addVar=S}),define("khepri-compile/lexical/scopet",["require","exports","akh/trans/statei","./scope"],function(e,t,n,r){var i,s=function(e){return e.extractScope=e.get,e.modifyScope=e.modify,e.push=e.modifyScope(r.push),e.pop=e.modifyScope(r.pop),e.getClosure=e.extractScope.map(r.getClosure),e};return i=function(e){return s(n(e))},i}),define("khepri-compile/lexical/lexical",["require","exports","akh/base","akh/trans/statei","akh/error","akh/trans/error","akh/unique","khepri-ast/expression","khepri-ast/value","zipper-m/trans/tree","../ast","../fun","../user_operator","./scope","./scopet"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v,m=n.next,g=n.sequence,y=n.sequencea,b=l.type,w=l.isSymbol,E=l.getUd,S=l.setUd,x=l.setUid,T=c.foldl,N=h.splitOp,C=p.Scope,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Ht,Bt,jt,Ft,It,qt,Rt,Ut,zt,Wt,Xt,Vt,$t,Jt,Kt,Qt,Gt,Yt,Zt,en,tn,nn,rn,sn,on,un,an,fn,ln,cn,hn,pn,dn,vn,mn,gn,yn,bn,wn,En,Sn,xn,Tn,Nn,Cn,kn,Ln,An,On,Mn,_n,Dn,Pn,Hn,Bn,jn,Fn,In,qn,Rn,Un,zn,Wn,Xn,Vn,$n,Jn,Kn,Qn,Gn,Yn,Zn,er,tr,nr,rr,ir,sr,or,ur,ar,fr,lr,cr,hr,pr,dr,vr,mr,gr,yr,br,wr,Er,Sr,xr,Tr,Nr,Cr,kr,Lr,Ar,Or,Mr,_r,Dr,Pr,Hr,Br,jr,Fr,Ir,qr,Rr,Ur,zr,Wr,Xr,Vr,$r,Jr,Kr,Qr,Gr,Yr,Zr,ei,ti,ni,ri,ii=E.bind(null,"reserved"),si=s(f(d(o))),oi=function(e,t,n,i,u){var a,l;return o.runUnique(r.evalStateT(f.runTreeZipperT(s.runErrorT(e,(a=si.inner.of,function(e){return a(i(e))}),(l=si.inner.of,function(e){return l(u(e))})),n),t),1e3)},ui=si.of(null),ai=si.fail,fi=si.lift,li=si.chain.bind(null,si.liftInner.liftInner(o.unique)),ci=si.liftInner(si.inner.inner.extractScope),hi=si.chain.bind(null,ci),pi=(k=si.liftInner,L=si.inner.inner.modify,function(e){return k(L(e))}),di=si.liftInner(si.inner.inner.push),vi=si.liftInner(si.inner.inner.pop),mi=si.chain.bind(null,si.liftInner(si.inner.inner.getClosure)),gi=fi(si.inner.get),yi=fi(si.inner.node),bi=si.chain.bind(null,yi),wi=fi(si.inner.up),Ei=fi(si.inner.down),Si=fi(si.inner.right),xi=fi(si.inner.root),Ti=(A=fi,O=si.inner.child,function(e){return A(O(e))}),Ni=(M=fi,_=si.inner.modifyNode,function(e){return M(_(e))}),Ci=(D=fi,P=si.inner.setNode,function(e){return D(P(e))}),ki=bi(function(e){return ri(e)}),Li=(H=function(e,t,n){return t===n.length-1?ki:m(ki,Si)},function(e){return e.length?g(Ei,y(e.map(H)),wi):ui}),Ai=function(e,t,n){return bi(function(r){return e(r)?t:n||ui})},Oi=function(e){return li(function(t){return pi(p.addUid.bind(null,e,t))})},Mi=function(e,t){return hi(function(n){return p.hasBinding(e,n)?ui:ai("Undeclared symbol:'"+e+"' at:"+(t&&t.start))})},_i=function(e,t){return hi(function(n){var r,i;return n.hasOwnBinding(e)?(r=n.getBinding(e),ai("'"+e+"' at:"+(t&&t.start)+" already bound for scope from:"+(i=r.loc,i&&i.start))):ui})},Di=function(e,t){return hi(function(n){return p.hasMutableBinding(e,n)?ui:ai("Assign to immutable symbol:'"+e+"' at:"+(t&&t.start))})},Pi=function(e,t){return hi(function(n){return n.hasOwnBinding(e)?pi(p.setBindingMutability.bind(null,e,!1)):ai("Cannot mark symbol:'"+e+"' at:"+(t&&t.start)+" immutable in enclosed scope")})},Hi=function(e,t){return g(pi(p.addMutableBinding.bind(null,e,t)),Oi(e))},Bi=function(e,t){return pi(p.addImmutableBinding.bind(null,e,t))},ji=function(e,t){return g(pi(p.addImmutableBinding.bind(null,e,t)),Oi(e))},Fi=function(e,t){return g(_i(e,t),Hi(e,t))},Ii=function(e,t){return g(_i(e,t),ji(e,t))},qi=function(e,t){return g(_i(e,t),Bi(e,t))},Ri=function(e){return ci.map(function(t){return N(e,p.getOperators(t)).map(function(e){return x(e[1],a.UnaryOperator.create(null,e[0]))})})},Ui=function(e,t){return pi(p.addOperator.bind(null,e,t))},zi={},Wi=function(e,t){Array.isArray(e)?e.forEach(function(e){return Wi(e,t)}):zi[e]=t};Wi("Program",(F=[(B=["body",ki],j=[].slice.call(B,1),g(Ti("body"),y(j),wi))],g(di,y(F),vi))),Wi("PackageExports",(I=["exports",ki],q=[].slice.call(I,1),g(Ti("exports"),y(q),wi))),Wi("PackageExport",g(bi(function(e){var t=e.id;return Fi(t.name,t.loc)}),(R=["id",ki],U=[].slice.call(R,1),g(Ti("id"),y(U),wi)))),Wi("Package",(rt=[(z=["exports",ki],W=[].slice.call(z,1),g(Ti("exports"),y(W),wi)),(tt=["body",(G=g((X=["bindings",ki],V=[].slice.call(X,1),g(Ti("bindings"),y(V),wi)),(K=["body",($=["body",ki],J=[].slice.call($,1),g(Ti("body"),y(J),wi))],Q=[].slice.call(K,1),g(Ti("body"),y(Q),wi))),Y=["body",ki],Z=[].slice.call(Y,1),et=g(Ti("body"),y(Z),wi),bi(function(e){var t;return(t=b(e),"WithStatement"===t)?G:et||ui}))],nt=[].slice.call(tt,1),g(Ti("body"),y(nt),wi))],g(di,y(rt),vi))),Wi(["StaticDeclaration","VariableDeclaration"],(it=["declarations",ki],st=[].slice.call(it,1),g(Ti("declarations"),y(st),wi))),Wi("StaticDeclarator",bi(function(e){var t=e.id;return qi(t.name,t.loc)})),Wi("VariableDeclarator",(dt=function(e){return e.immutable?Ii(e.id.name,e.loc):Fi(e.id.name,e.loc)},vt=g(bi(dt),(ot=["id",ki],ut=[].slice.call(ot,1),g(Ti("id"),y(ut),wi)),(at=["init",ki],ft=[].slice.call(at,1),g(Ti("init"),y(ft),wi))),mt=g((lt=["init",ki],ct=[].slice.call(lt,1),g(Ti("init"),y(ct),wi)),bi(dt),(ht=["id",ki],pt=[].slice.call(ht,1),g(Ti("id"),y(pt),wi))),bi(function(e){return e.recursive?vt:mt||ui}))),Wi("Binding",(Nt=g((gt=["pattern",ki],yt=[].slice.call(gt,1),g(Ti("pattern"),y(yt),wi)),(bt=["value",ki],wt=[].slice.call(bt,1),g(Ti("value"),y(wt),wi))),Ct=g((Et=["value",ki],St=[].slice.call(Et,1),g(Ti("value"),y(St),wi)),(xt=["pattern",ki],Tt=[].slice.call(xt,1),g(Ti("pattern"),y(Tt),wi))),bi(function(e){return e.recursive?Nt:Ct||ui}))),Wi("BlockStatement",(At=[(kt=["body",ki],Lt=[].slice.call(kt,1),g(Ti("body"),y(Lt),wi))],g(di,y(At),vi))),Wi("ExpressionStatement",(Ot=["expression",ki],Mt=[].slice.call(Ot,1),g(Ti("expression"),y(Mt),wi))),Wi("IfStatement",g((_t=["test",ki],Dt=[].slice.call(_t,1),g(Ti("test"),y(Dt),wi)),(Bt=[(Pt=["consequent",ki],Ht=[].slice.call(Pt,1),g(Ti("consequent"),y(Ht),wi))],g(di,y(Bt),vi)),(It=[(jt=["alternate",ki],Ft=[].slice.call(jt,1),g(Ti("alternate"),y(Ft),wi))],g(di,y(It),vi)))),Wi("WithStatement",(Vt=[(qt=["bindings",ki],Rt=[].slice.call(qt,1),g(Ti("bindings"),y(Rt),wi)),(Wt=["body",(Ut=["body",ki],zt=[].slice.call(Ut,1),g(Ti("body"),y(zt),wi))],Xt=[].slice.call(Wt,1),g(Ti("body"),y(Xt),wi))],g(di,y(Vt),vi))),Wi("SwitchStatement",(Gt=[($t=["discriminant",ki],Jt=[].slice.call($t,1),g(Ti("discriminant"),y(Jt),wi)),(Kt=["cases",ki],Qt=[].slice.call(Kt,1),g(Ti("cases"),y(Qt),wi))],g(di,y(Gt),vi))),Wi("SwitchCase",g((Yt=["test",ki],Zt=[].slice.call(Yt,1),g(Ti("test"),y(Zt),wi)),(en=["consequent",ki],tn=[].slice.call(en,1),g(Ti("consequent"),y(tn),wi)))),Wi(["ReturnStatement","ThrowStatement"],(nn=["argument",ki],rn=[].slice.call(nn,1),g(Ti("argument"),y(rn),wi))),Wi("TryStatement",g((sn=["block",ki],on=[].slice.call(sn,1),g(Ti("block"),y(on),wi)),(fn=[(un=["handler",ki],an=[].slice.call(un,1),g(Ti("handler"),y(an),wi))],g(di,y(fn),vi)),(hn=[(ln=["finalizer",ki],cn=[].slice.call(ln,1),g(Ti("finalizer"),y(cn),wi))],g(di,y(hn),vi)))),Wi("CatchClause",(bn=[bi(function(e){var t=e.param;return Ii(t.name,t.loc)}),(pn=["param",ki],dn=[].slice.call(pn,1),g(Ti("param"),y(dn),wi)),(gn=["body",(vn=["body",ki],mn=[].slice.call(vn,1),g(Ti("body"),y(mn),wi))],yn=[].slice.call(gn,1),g(Ti("body"),y(yn),wi))],g(di,y(bn),vi))),Wi("WhileStatement",g((wn=["test",ki],En=[].slice.call(wn,1),g(Ti("test"),y(En),wi)),(Tn=[(Sn=["body",ki],xn=[].slice.call(Sn,1),g(Ti("body"),y(xn),wi))],g(di,y(Tn),vi)))),Wi("DoWhileStatement",g((kn=[(Nn=["body",ki],Cn=[].slice.call(Nn,1),g(Ti("body"),y(Cn),wi))],g(di,y(kn),vi)),(Ln=["test",ki],An=[].slice.call(Ln,1),g(Ti("test"),y(An),wi)))),Wi("ForStatement",(In=[(On=["init",ki],Mn=[].slice.call(On,1),g(Ti("init"),y(Mn),wi)),(_n=["test",ki],Dn=[].slice.call(_n,1),g(Ti("test"),y(Dn),wi)),(Pn=["update",ki],Hn=[].slice.call(Pn,1),g(Ti("update"),y(Hn),wi)),(Fn=[(Bn=["body",ki],jn=[].slice.call(Bn,1),g(Ti("body"),y(jn),wi))],g(di,y(Fn),vi))],g(di,y(In),vi))),Wi("FunctionExpression",(zn=[(Un=g(bi(function(e){var t=e.id;return ji(t.name,t.loc)}),(qn=["id",ki],Rn=[].slice.call(qn,1),g(Ti("id"),y(Rn),wi))),bi(function(e){return e.id?Un:undefined||ui})),mi(function(e){var t,n,r,i,s,o;return g((t=["params",ki],n=[].slice.call(t,1),g(Ti("params"),y(n),wi)),(s=["body",Ai(function(e){var t=b(e);return"BlockStatement"===t},(r=["body",ki],i=[].slice.call(r,1),g(Ti("body"),y(i),wi)),ki)],o=[].slice.call(s,1),g(Ti("body"),y(o),wi)),mi(function(t){return Ni(function(n){return S("locals",t.filter(function(t){return e.indexOf(t)<0}),n)})}))})],g(di,y(zn),vi))),Wi("UnaryExpression",g((Wn=["argument",ki],Xn=[].slice.call(Wn,1),g(Ti("argument"),y(Xn),wi)),bi(function(e){var t=e.loc,n=e.operator,r=e.argument;return Ri(n.name).chain(function(e){var n,i;return e.length>1?g(Ci(e.reduceRight(function(e,n){return u.UnaryExpression.create(t,n,e)},r)),ki):(n=["operator",ki],i=[].slice.call(n,1),g(Ti("operator"),y(i),wi))})}))),Wi("AssignmentExpression",g((Vn=["left",ki],$n=[].slice.call(Vn,1),g(Ti("left"),y($n),wi)),bi(function(e){var t=e.immutable,n=e.left;return w(n)?g(Di(n.name,n.loc),t?Pi(n.name,n.loc):ui):ui}),(Jn=["right",ki],Kn=[].slice.call(Jn,1),g(Ti("right"),y(Kn),wi)))),Wi("BinaryExpression",g((Qn=["operator",ki],Gn=[].slice.call(Qn,1),g(Ti("operator"),y(Gn),wi)),(Yn=["left",ki],Zn=[].slice.call(Yn,1),g(Ti("left"),y(Zn),wi)),(er=["right",ki],tr=[].slice.call(er,1),g(Ti("right"),y(tr),wi)))),Wi("ConditionalExpression",g((nr=["test",ki],rr=[].slice.call(nr,1),g(Ti("test"),y(rr),wi)),(ir=["consequent",ki],sr=[].slice.call(ir,1),g(Ti("consequent"),y(sr),wi)),(or=["alternate",ki],ur=[].slice.call(or,1),g(Ti("alternate"),y(ur),wi)))),Wi(["CallExpression","NewExpression"],g((ar=["callee",ki],fr=[].slice.call(ar,1),g(Ti("callee"),y(fr),wi)),(lr=["args",ki],cr=[].slice.call(lr,1),g(Ti("args"),y(cr),wi)))),Wi("MemberExpression",g((hr=["object",ki],pr=[].slice.call(hr,1),g(Ti("object"),y(pr),wi)),(dr=["property",ki],vr=[].slice.call(dr,1),mr=g(Ti("property"),y(vr),wi),bi(function(e){return e.computed?mr:undefined||ui})))),Wi("ArrayExpression",(gr=["elements",ki],yr=[].slice.call(gr,1),g(Ti("elements"),y(yr),wi))),Wi("ObjectExpression",(br=["properties",ki],wr=[].slice.call(br,1),g(Ti("properties"),y(wr),wi))),Wi("LetExpression",(Nr=[(Er=["bindings",ki],Sr=[].slice.call(Er,1),g(Ti("bindings"),y(Sr),wi)),(xr=["body",ki],Tr=[].slice.call(xr,1),g(Ti("body"),y(Tr),wi))],g(di,y(Nr),vi))),Wi("CurryExpression",g((Cr=["base",ki],kr=[].slice.call(Cr,1),g(Ti("base"),y(kr),wi)),(Lr=["args",ki],Ar=[].slice.call(Lr,1),g(Ti("args"),y(Ar),wi)))),Wi("OperatorExpression",(Or=["operator",ki],Mr=[].slice.call(Or,1),g(Ti("operator"),y(Mr),wi))),Wi("EllipsisPattern",(_r=["id",ki],Dr=[].slice.call(_r,1),g(Ti("id"),y(Dr),wi))),Wi(["SliceUnpack","RelativeUnpack","ImportPattern"],(Pr=["pattern",ki],Hr=[].slice.call(Pr,1),g(Ti("pattern"),y(Hr),wi))),Wi("IdentifierPattern",g(bi(function(e){var t=e.loc,n=e.id;return ii(e)?ji(n.name,t):Ii(n.name,t)}),(Br=["id",ki],jr=[].slice.call(Br,1),g(Ti("id"),y(jr),wi)))),Wi("AsPattern",g((Fr=["id",ki],Ir=[].slice.call(Fr,1),g(Ti("id"),y(Ir),wi)),bi(function(e){var t=["target",Ni(function(t){return S("id",e.id,t)}),ki],n=[].slice.call(t,1);return g(Ti("target"),y(n),wi)}))),Wi("ObjectPattern",(qr=["elements",ki],Rr=[].slice.call(qr,1),g(Ti("elements"),y(Rr),wi))),Wi("ObjectPatternElement",g((Ur=["target",ki],zr=[].slice.call(Ur,1),g(Ti("target"),y(zr),wi)),(Wr=["key",ki],Xr=[].slice.call(Wr,1),g(Ti("key"),y(Xr),wi)))),Wi("ArgumentsPattern",g((Vr=["id",ki],$r=[].slice.call(Vr,1),g(Ti("id"),y($r),wi)),(Jr=["elements",ki],Kr=[].slice.call(Jr,1),g(Ti("elements"),y(Kr),wi)),(Qr=["self",ki],Gr=[].slice.call(Qr,1),g(Ti("self"),y(Gr),wi)))),Wi("ObjectValue",(Yr=["value",ki],Zr=[].slice.call(Yr,1),g(Ti("value"),y(Zr),wi))),Wi(["Identifier","BinaryOperator"],bi(function(e){var t=e.loc,n=e.name;return g(Mi(n,t),hi(function(t){return Ci(x(p.getUid(n,t),e))}))})),Wi(["UnaryOperator"],(ei=ui,ti=bi(function(e){var t=e.loc,n=e.name;return g(Mi(n,t),hi(function(t){var r=p.getUid(n,t);return g(Ci(x(r,e)),Ui(n,r))}))}),bi(function(e){var t,n;return(t=e.name,n=t[0],"."===n)?ei:ti||ui}))),ri=function(e){return Array.isArray(e)?Li(e):zi[b(e)]||ui};var Xi=(ni=T(function(e,t){return p.addImmutableBinding(t,"global",e)},C.empty,["*","/","+","-","%","<<",">>",">>>","<",">","<=",">=","==","!=","===","!==","&","^","|","||","&&","|>","\\>","\\>>","<|","<\\","<<\\","!","++","--","~",".","@","void","instanceof","typeof"]),T(function(e,t){return p.addOperator(t,null,e)},ni,["!","++","--","~"])),Vi=T.bind(null,function(e,t){return p.addImmutableBinding(t,"global",e)},Xi),$i=g(ki,xi,gi.chain(function(e){return li(function(t){return ci.map(function(n){return{tree:e,data:{unique:t}}})})}));v=function(e,t){return oi($i,Vi(t||[]),e,i.of,i.fail)},t.check=v}),define("khepri-compile/stages/lexical",["require","exports","akh/error","bes/object","../lexical/lexical"],function(e,t,n,r,i){var s,o=["Array","Boolean","Date","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","Error","eval","EvalError","Function","Infinity","isFinite","isNaN","JSON","Math","NaN","Number","Object","parseInt","parseFloat","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","undefined","URIError"];return s=function(e){var t=e.options,n=e.tree,r=e.data;return i.check(n,t&&t.globals||o,r).map(function(e){var n=e.tree,r=e.data;return{tree:n,data:r,options:t}})},s}),define("akh/state",["require","exports","./identity","./trans/state"],function(e,t,n,r){var i;i=r(n);var s=r.runStateT,o=n.runIdentity;i.runState=function(){return o(s.apply(null,arguments))};var u=r.evalStateT,a=n.runIdentity;i.evalState=function(){return a(u.apply(null,arguments))};var f=r.execStateT,l=n.runIdentity;return i.execState=function(){return l(f.apply(null,arguments))},i}),define("khepri-compile/reachable/state",["require","exports","hamt"],function(e,t,n){var r,i,s,o;r=n.empty;var u=function(e){return e+1||1};i=function(e,t){return n.modify(e,u,t)},s=function(e,t){return n.get(e,t)||0},o=s,t.empty=r,t.addReference=i,t.getCount=s,t.isReachable=o}),define("khepri-compile/reachable/reachable",["require","exports","khepri-ast/node","akh/base","akh/state","zipper-m/trans/tree","../fun","../ast","./state"],function(e,t,n,r,i,s,o,u,a){var f,l=n.modify,c=r.sequence,h=r.sequencea,p=o.flip,d=o.map,v=u.type,m=u.getUd,g=u.getUid,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Ht,Bt,jt,Ft,It,qt,Rt,Ut,zt,Wt,Xt,Vt,$t,Jt,Kt,Qt,Gt,Yt,Zt,en,tn,nn,rn,sn,on,un,an,fn,ln,cn,hn,pn,dn,vn,mn,gn,yn,bn,wn,En,Sn,xn,Tn,Nn,Cn,kn,Ln,An,On,Mn,_n,Dn,Pn,Hn,Bn,jn,Fn=m.bind(null,"reserved"),In=s(i),qn=In.of(null),Rn=In.get,Un=p(In.map).bind(null,In.node),zn=In.chain.bind(null,In.node),Wn=In.setNode,Xn=In.up,Vn=In.down,$n=In.left,Jn=In.rightmost,Kn=In.child,Qn=In.lift(In.inner.get),Gn=(y=In.lift,b=In.inner.modify,function(e){return y(b(e))}),Yn=Wn([]),Zn=zn(function(e){return jn(e)}),er=(w=function(e,t){return t?c(Zn,$n):Zn},function(e){return e.length?c(Vn,Jn,h(d(w,e).reverse()),Xn):qn}),tr={},nr=function(e,t){Array.isArray(e)?e.forEach(function(e){return nr(e,t)}):tr[e]=t};nr("Program",(E=["body",Zn],S=[].slice.call(E,1),c(Kn("body"),h(S),Xn))),nr("Package",c((x=["exports",Zn],T=[].slice.call(x,1),c(Kn("exports"),h(T),Xn)),(N=["body",Zn],C=[].slice.call(N,1),c(Kn("body"),h(C),Xn)))),nr("PackageExports",(k=["exports",Zn],L=[].slice.call(k,1),c(Kn("exports"),h(L),Xn))),nr("PackageExport",(A=["id",Zn],O=[].slice.call(A,1),c(Kn("id"),h(O),Xn))),nr("SwitchCase",c((M=["test",Zn],_=[].slice.call(M,1),c(Kn("test"),h(_),Xn)),(D=["consequent",Zn],P=[].slice.call(D,1),c(Kn("consequent"),h(P),Xn)))),nr("CatchClause",c((H=["param",Zn],B=[].slice.call(H,1),c(Kn("param"),h(B),Xn)),(j=["body",Zn],F=[].slice.call(j,1),c(Kn("body"),h(F),Xn)))),nr("VariableDeclaration",(I=["declarations",Zn],q=[].slice.call(I,1),c(Kn("declarations"),h(q),Xn))),nr("VariableDeclarator",(R=Un(function(e){return g(e.id)}),U=["init",Zn],z=[].slice.call(U,1),W=c(Kn("init"),h(z),Xn),X=Yn,R.chain(function(e){return Qn.chain(function(t){return a.isReachable(e,t)?W:X})}))),nr("Binding",(V=["value",Zn],$=[].slice.call(V,1),J=c(Kn("value"),h($),Xn),K=Un(function(e){var t=e.pattern;return g(t.id)}),Q=["value",Zn],G=[].slice.call(Q,1),Y=c(Kn("value"),h(G),Xn),Z=Yn,et=K.chain(function(e){return Qn.chain(function(t){return a.isReachable(e,t)?Y:Z})}),zn(function(e){return Fn(e)?J:et||qn}))),nr("BlockStatement",(tt=["body",Zn],nt=[].slice.call(tt,1),c(Kn("body"),h(nt),Xn))),nr("ExpressionStatement",(rt=["expression",Zn],it=[].slice.call(rt,1),c(Kn("expression"),h(it),Xn))),nr("WithStatement",c((st=["body",Zn],ot=[].slice.call(st,1),c(Kn("body"),h(ot),Xn)),(ut=["bindings",Zn],at=[].slice.call(ut,1),c(Kn("bindings"),h(at),Xn)))),nr("SwitchStatement",c((ft=["discriminant",Zn],lt=[].slice.call(ft,1),c(Kn("discriminant"),h(lt),Xn)),(ct=["cases",Zn],ht=[].slice.call(ct,1),c(Kn("cases"),h(ht),Xn)))),nr(["ReturnStatement","ThrowStatement"],(pt=["argument",Zn],dt=[].slice.call(pt,1),c(Kn("argument"),h(dt),Xn))),nr("TryStatement",c((vt=["block",Zn],mt=[].slice.call(vt,1),c(Kn("block"),h(mt),Xn)),(gt=["handler",Zn],yt=[].slice.call(gt,1),c(Kn("handler"),h(yt),Xn)),(bt=["finalizer",Zn],wt=[].slice.call(bt,1),c(Kn("finalizer"),h(wt),Xn)))),nr(["WhileStatement","DoWhileStatement"],c((Et=["test",Zn],St=[].slice.call(Et,1),c(Kn("test"),h(St),Xn)),(xt=["body",Zn],Tt=[].slice.call(xt,1),c(Kn("body"),h(Tt),Xn)))),nr("ForStatement",c((Nt=["body",Zn],Ct=[].slice.call(Nt,1),c(Kn("body"),h(Ct),Xn)),(kt=["update",Zn],Lt=[].slice.call(kt,1),c(Kn("update"),h(Lt),Xn)),(At=["test",Zn],Ot=[].slice.call(At,1),c(Kn("test"),h(Ot),Xn)),(Mt=["init",Zn],_t=[].slice.call(Mt,1),c(Kn("init"),h(_t),Xn)))),nr(["ConditionalExpression","IfStatement"],c((Dt=["test",Zn],Pt=[].slice.call(Dt,1),c(Kn("test"),h(Pt),Xn)),(Ht=["consequent",Zn],Bt=[].slice.call(Ht,1),c(Kn("consequent"),h(Bt),Xn)),(jt=["alternate",Zn],Ft=[].slice.call(jt,1),c(Kn("alternate"),h(Ft),Xn)))),nr("FunctionExpression",c((It=["body",Zn],qt=[].slice.call(It,1),c(Kn("body"),h(qt),Xn)),(Rt=["id",Zn],Ut=[].slice.call(Rt,1),c(Kn("id"),h(Ut),Xn)),(zt=["params",Zn],Wt=[].slice.call(zt,1),c(Kn("params"),h(Wt),Xn)))),nr("UnaryExpression",(Xt=["argument",Zn],Vt=[].slice.call(Xt,1),c(Kn("argument"),h(Vt),Xn))),nr("BinaryExpression",c(($t=["left",Zn],Jt=[].slice.call($t,1),c(Kn("left"),h(Jt),Xn)),(Kt=["right",Zn],Qt=[].slice.call(Kt,1),c(Kn("right"),h(Qt),Xn)))),nr("AssignmentExpression",c((Gt=["left",Zn],Yt=[].slice.call(Gt,1),c(Kn("left"),h(Yt),Xn)),(Zt=["right",Zn],en=[].slice.call(Zt,1),c(Kn("right"),h(en),Xn)))),nr("MemberExpression",c((tn=["object",Zn],nn=[].slice.call(tn,1),c(Kn("object"),h(nn),Xn)),(rn=["property",Zn],sn=[].slice.call(rn,1),on=c(Kn("property"),h(sn),Xn),zn(function(e){return e.computed?on:undefined||qn})))),nr("NewExpression",c((un=["callee",Zn],an=[].slice.call(un,1),c(Kn("callee"),h(an),Xn)),(fn=["args",Zn],ln=[].slice.call(fn,1),c(Kn("args"),h(ln),Xn)))),nr("CallExpression",c((cn=["callee",Zn],hn=[].slice.call(cn,1),c(Kn("callee"),h(hn),Xn)),(pn=["args",Zn],dn=[].slice.call(pn,1),c(Kn("args"),h(dn),Xn)))),nr("CurryExpression",c((vn=["base",Zn],mn=[].slice.call(vn,1),c(Kn("base"),h(mn),Xn)),(gn=["args",Zn],yn=[].slice.call(gn,1),c(Kn("args"),h(yn),Xn)))),nr("OperatorExpression",(bn=["operator",Zn],wn=[].slice.call(bn,1),c(Kn("operator"),h(wn),Xn))),nr("LetExpression",c((En=["body",Zn],Sn=[].slice.call(En,1),c(Kn("body"),h(Sn),Xn)),(xn=["bindings",Zn],Tn=[].slice.call(xn,1),c(Kn("bindings"),h(Tn),Xn)))),nr(["SliceUnpack","RelativeUnpack"],(Nn=["target",Zn],Cn=[].slice.call(Nn,1),c(Kn("target"),h(Cn),Xn))),nr("ArgumentsPattern",(kn=Un(function(e){var t=e.id;return g(t.id)}),Ln=qn,An=zn(function(e){return Wn(l(e,{id:null}))}),On=kn.chain(function(e){return Qn.chain(function(t){return a.isReachable(e,t)?Ln:An})}),zn(function(e){return e.id?On:undefined||qn}))),nr("ArrayExpression",(Mn=["elements",Zn],_n=[].slice.call(Mn,1),c(Kn("elements"),h(_n),Xn))),nr("ObjectExpression",(Dn=["properties",Zn],Pn=[].slice.call(Dn,1),c(Kn("properties"),h(Pn),Xn))),nr("ObjectValue",(Hn=["value",Zn],Bn=[].slice.call(Hn,1),c(Kn("value"),h(Bn),Xn))),nr("Identifier",zn(function(e){var t=g(e);return t?Gn(a.addReference.bind(null,t)):qn})),jn=function(e){return Array.isArray(e)?er(e):tr[v(e)]||qn};var rr=c(Zn,Rn);return f=function(e){return i.evalState(s.runTreeZipperT(rr,e),a.Empty)},f}),define("khepri-compile/stages/reachable",["require","exports","bes/object","akh/error","../reachable/reachable"],function(e,t,n,r,i){var s,o=n.setProperty,u=r.of;return s=function(e){var t;return u((t=e.tree,o(e,"tree",i(t))))},s}),define("khepri-compile/normalize/unpack",["require","exports","khepri-ast/expression","khepri-ast/declaration","khepri-ast/pattern","khepri-ast/value","../pseudo/pattern","../ast","../fun"],function(e,t,n,r,i,s,o,u,a){var f,l,c,h=o.SliceUnpack,p=o.RelativeUnpack,d=u.type,v=a.concat,m=a.flatten,g=a.flattenr,y=a.map,b=function(e,t,o){var u=n.MemberExpression.create(null,e,o,!0);return t?m(f(u,t)):r.Binding.create(null,i.IdentifierPattern.create(null,s.Identifier.create(null,o.value)),u)},w=function(e,t){return g(y(function(e){var n,r,i,s,o,u,a,l;return d(e)==="SliceUnpack"?(n=t.ud.id.id,r=e.pattern,i=e.from,s=e.to,f(h.create(null,r,n,i,s),r)):d(e)==="RelativeUnpack"?(o=t.ud.id.id,u=e.min,a=e.index,l=e.pattern,f(p.create(null,l,o,a,u),l)):b(t.ud.id.id,e.target,e.key)},t.elements))},E=function(e,t){return v(f(e,t.id),m(f(t.id,t.target)))};f=function(e,t){switch(d(t)){case"IdentifierPattern":return[r.Binding.create(null,t,e)];case"AsPattern":return E(e,t);case"ObjectPattern":return w(e,t);default:return[]}},l=function(e,t){return m(y(function(t){switch(d(t)){case"IdentifierPattern":return[];case"SliceUnpack":var n=e.id,r=t.pattern,i=t.from,s=t.to;return f(h.create(null,r,n,i,s),r);case"RelativeUnpack":var o=e.id,u=t.min,a=t.index,l=t.pattern;return f(p.create(null,l,o,a,u),l);case"AsPattern":return m(f(t.id,t.target));default:return f(t,t)}},t))};var S=y.bind(null,function(e){switch(d(e)){case"AsPattern":return e.id;case"SliceUnpack":case"RelativeUnpack":return[];default:return e}});c=function(e){return g(S(e))},t.innerPattern=f,t.unpackParameters=l,t.getParameterNames=c}),define("khepri-compile/normalize/post_normalize",["require","exports","khepri-ast/node","khepri-ast/expression","khepri-ast/statement","khepri-ast/value","../pseudo/pattern","../ast","../fun","../rewriter","../user_operator","./unpack"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h,p=n.modify,d=n.setUserData,v=o.Import,m=u.type,g=u.isBlockFunction,y=u.setUd,b=u.getUid,w=a.concat,E=a.flattenr,S=a.map,x=f.UP,T=f.DOWN,N=f.Rewriter,C=f.rewrite,k=l.opToName,L=c.innerPattern,A=c.unpackParameters,O=c.getParameterNames,M,_,D=y.bind(null,"reserved",!0),P=new N,H=function(e){return!0};P.add("ImportPattern",x,H,function(e){var t=e.pattern,n=e.from,r=L(v.create(null,n.value),t),i=r[0],s=[].slice.call(r,1);return w(D(i),s)}),P.add("Binding",x,H,function(e){return L(e.value,e.pattern)}),P.add(["LetExpression","WithStatement"],x,H,function(e){return p(e,{bindings:E(e.bindings)})}),P.add("FunctionExpression",x,H,function(e){var t=O(e.params.elements),n=A(e.params.id,e.params.elements),s=g(e)?i.BlockStatement.create(null,[i.WithStatement.create(null,n,e.body)]):r.LetExpression.create(null,n,e.body);return p(e,{params:p(e.params,{elements:t}),body:s})});var B=function(e){return d(s.Identifier.create(e.loc,k(e.name)),e.ud)};P.add(["UnaryOperator","BinaryOperator"],T,b,B),P.add("BinaryExpression",T,H,function(e){var t=e.loc,n=e.operator,i=e.left,o=e.right;return b(n)?r.CallExpression.create(t,d(s.Identifier.create(n.loc,k(n.name)),n.ud),[i,o]):p(e,{operator:n.name})}),P.add("UnaryExpression",T,H,function(e){var t=e.loc,n=e.operator,i=e.argument;return b(n)?r.CallExpression.create(t,d(s.Identifier.create(n.loc,k(n.name)),n.ud),[i]):p(e,{operator:n.name})});var j=function(e){var t;return m(e.right)==="AssignmentExpression"?(t=j(e.right),w(t,r.AssignmentExpression.create(null,"=",e.left,t[t.length-1].left))):[e]};P.add("ExpressionStatement",x,function(e){var t=e.expression,n=m(t);return"AssignmentExpression"===n},(M=S.bind(null,i.ExpressionStatement.create.bind(null,null)),_=i.BlockStatement.create.bind(null,null),function(e){var t,n=e.expression,i=m(n.right)==="AssignmentExpression"?(t=j(n.right),w(t,r.AssignmentExpression.create(null,"=",n.left,t[t.length-1].left))):[n],s=E(i);return _(M(s))})),P.add("BinaryExpression",x,function(e){var t=e.operator;return"|>"===t},function(e){var t=e.left,n=e.right;return r.CallExpression.create(null,n,[t])}),P.add("BinaryExpression",x,function(e){var t=e.operator;return"<|"===t},function(e){var t=e.left,n=e.right;return r.CallExpression.create(null,t,[n])}),h=C.bind(null,P),t.normalize=h}),define("khepri-compile/stages/post_normalize",["require","exports","bes/object","akh/error","../normalize/post_normalize"],function(e,t,n,r,i){var s,o=n.setProperty;return s=function(e){var t=e.tree,n=e.data;return r.of(o(e,"tree",i.normalize(t,n)))},s}),define("khepri-compile/builtin",["require","exports","khepri-ast/pattern","khepri-ast/expression","khepri-ast/value","./ast","./fun"],function(e,t,n,r,i,s,o){var u,a,f,l=s.setUd,c=s.getUid,h=s.setUid,p=o.flip,d=function(e,t){return h(t,i.Identifier.create(null,e))},v=function(){var e=0;return function(){return e+=1,e}}();a={},u={};var m=function(e,t,n){u[e]=t,a[e]=n},g=function(e,t,n){m(e,d(t,v()),n)},y=v();u.require=h(y,i.Identifier.create(null,"require"));var b=v();u.exports=h(b,i.Identifier.create(null,"exports"));var w=v();u.module=h(w,i.Identifier.create(null,"module"));var E=v();u["undefined"]=h(E,i.Identifier.create(null,"undefined"));var S,x,T,N,C,k,L,A,O,M,_;[["typeof","__typeof"],["void","__void"],["~","__bnot"],["!","__lnot"],["++","__plus"],["--","__minus"]].forEach(function(e){var t=e[0],i=e[1],s,o,u;g(t,i,(s=d("x",v()),o=r.FunctionExpression.create(null,null,n.ArgumentsPattern.create(null,null,[n.IdentifierPattern.create(null,s)]),r.UnaryExpression.create(null,t,s)),u=[c(s)],l("locals",u,o)))}),m("_",(S=v(),h(S,i.Identifier.create(null,"_"))),(A=v(),O=h(A,i.Identifier.create(null,"x")),M=r.FunctionExpression.create(null,null,n.ArgumentsPattern.create(null,null,[n.IdentifierPattern.create(null,O)]),(x=v(),T=h(x,i.Identifier.create(null,"x")),N=v(),C=h(N,i.Identifier.create(null,"y")),k=r.FunctionExpression.create(null,null,n.ArgumentsPattern.create(null,null,[n.IdentifierPattern.create(null,T),n.IdentifierPattern.create(null,C)]),r.CallExpression.create(null,O,[C,T])),L=[c(T),c(C)],l("locals",L,k))),_=[c(O)],l("locals",_,M)));var D=v(),P=h(D,i.Identifier.create(null,"x")),H=v(),B=h(H,i.Identifier.create(null,"y")),j=v(),F=h(j,i.Identifier.create(null,"z")),I=r.FunctionExpression.create(null,null,n.ArgumentsPattern.create(null,null,[n.IdentifierPattern.create(null,P),n.IdentifierPattern.create(null,B),n.IdentifierPattern.create(null,F)]),r.ConditionalExpression.create(null,P,B,F)),q=[c(P),c(B),c(F)],R=l("locals",q,I);g("?","__cond",R);var U=function(e){var t=d("x",v()),i=d("y",v()),s=r.FunctionExpression.create(null,null,n.ArgumentsPattern.create(null,null,[n.IdentifierPattern.create(null,t),n.IdentifierPattern.create(null,i)]),e(t,i)),o=[c(t),c(i)];return l("locals",o,s)},z=function(e,t,n){g(e,t,U(n))},W=function(e){return function(t,n){return r.BinaryExpression.create(null,e,t,n)}};[["+","__add"],["-","__sub"],["*","__mul"],["/","__div"],["%","__mod"],["<<","__blas"],[">>","__bras"],[">>>","__brls"],["&","__band"],["^","__bxor"],["|","__bor"],["<","__lt"],[">","__gt"],["<=","__lte"],[">=","__gte"],["==","__eq"],["!=","__neq"],["===","__seq"],["!==","__sneq"],["instanceof","__instanceof"],["||","__or"],["&&","__and"]].forEach(function(e){var t=e[0],n=e[1];z(t,n,W(t))}),z("new","__new",function(e,t){return r.NewExpression.create(null,e,[t])}),z(".","__dot",function(e,t){return r.MemberExpression.create(null,e,t,!0)}),z("@","__curry",function(e,t){return r.CurryExpression.create(null,e,[t])});var X=function(e,t){return r.CallExpression.create(null,e,[t])};z("<|","__pipe",X),z("|>","__rpipe",p(X));var V=function(e,t){var i=d("z",v()),s=r.FunctionExpression.create(null,null,n.ArgumentsPattern.create(null,null,[n.IdentifierPattern.create(null,i)]),r.CallExpression.create(null,e,[r.CallExpression.create(null,t,[i])])),o=[c(i)];return l("locals",o,s)};z("<\\","__compose",V),z("\\>","__rcompose",p(V));var $=function(e,t){var s=d("args",v()),o=r.FunctionExpression.create(null,null,n.ArgumentsPattern.create(null,n.IdentifierPattern.create(null,s),[],null),r.CallExpression.create(null,e,[r.CallExpression.create(null,r.MemberExpression.create(null,t,d("apply")),[i.Literal.create(null,"null"),s])])),u=[c(s)];return l("locals",u,o)};z("<<\\","__composen",$),z("\\>>","__rcomposen",p($)),f=function(e,t){var i=d("x",t),s=r.FunctionExpression.create(null,null,n.ArgumentsPattern.create(null,null,[n.IdentifierPattern.create(null,i)]),r.MemberExpression.create(null,i,d(e),!1)),o=[c(i)];return l("locals",o,s)},t.builtins=u,t.definitions=a,t.member=f}),define("khepri-compile/inline/binding",["require","exports","bes/record"],function(e,t,n){var r,i,s;r=n.declare(null,["value","immutable","simple"]),i=!0,s=!1,t.Binding=r,t.IMMUTABLE=i,t.MUTABLE=s}),define("khepri-compile/inline/state",["require","exports","bes/record","hamt","../fun","./binding"],function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y=i.concat,b=s.Binding,w=s.MUTABLE,E=s.IMMUTABLE;o=n.declare(null,["bindings","working","globals","outer","locals"]),o.empty=new o(r.empty,r.empty,r.empty,null,[[],null]),l=function(e){return e.setOuter(e).setWorking(r.empty)};var S=r.fold.bind(null,function(e,t){var n=t.key;return r.set(n,null,e)});c=function(e){return e.outer.setBindings(e.bindings).setGlobals(e.globals).setWorking(S(e.outer.working,e.working))},u=function(e,t){return r.get(e,t.bindings)||r.get(e,t.working)},a=function(e,t,n,i){var s=b.create(t,E,n);return i.setBindings(r.set(e,s,i.bindings))},f=function(e,t,n,i){var s=b.create(t,w,n);return i.setWorking(r.set(e,s,i.working))};var x=r.keys;h=function(e){return x(e.globals)},p=function(e,t){return t.setGlobals(r.set(e,e,t.globals))},d=function(e,t){return t.setLocals([y(e,t.locals[0]),t.locals[1]])},v=function(e){return e.locals[0]},m=function(e){return e.setLocals([[],e.locals])},g=function(e){return e.setLocals(e.locals[1])},t.State=o,t.getBinding=u,t.addBinding=a,t.addWorking=f,t.push=l,t.pop=c,t.getGlobals=h,t.addGlobal=p,t.addLocals=d,t.getLocals=v,t.pushLocals=m,t.popLocals=g}),define("khepri-compile/inline/expansion",["require","exports","bes/record","khepri-ast/node","../ast"],function(e,t,n,r,i){var s,o,u,a,f,l=r.setData,c=i.getUd,h=n.declare(null,["count","value"]);u=c.bind(null,"expand"),a=u,s=function(e,t,n){var r=h.create(t,n);return l(e,"expand",r)},o=function(e,t,n){var r=u(e),i=(r&&r.count||t)+1,s=h.create(i,n);return l(e,"expand",s)},f=function(e){var t;return u(e)?(t=u(e),t.count<1?t.value:l(e,"expand",null)):e},t.markExpansion=s,t.incrementCount=o,t.getExpansion=u,t.isExpansion=a,t.expandNode=f}),define("khepri-compile/inline/rename",["require","exports","khepri-ast-zipper","neith/walk","neith/tree","khepri-ast/node","../fun","../ast","./expansion"],function(e,t,n,r,i,s,o,u,a){var f,l,c,h=n.khepriZipper,p=r.preWalk,d=s.setData,v=o.contains,m=u.type,g=u.tryGetUd,y=u.getUid,b=u.setUid,w=a.incrementCount;f=function(e,t){return g([],"locals",e).map(function(e){return t+"-"+e})};var E=function(e,t,n){var r=g([],"locals",e),i=r.map(function(e){return v(n,e)?t+"-"+e:e});return d(e,"locals",i)};l=function(e,t,n){return i.node(p(function(n){var r=i.node(n),s=y(r);return v(t,s)?i.setNode(b(e+"-"+s,r),n):m(r)==="FunctionExpression"?i.setNode(E(r,e,t),n):n},h(n)))},c=function(e,t,n,r){return i.node(p(function(r){var s=i.node(r),o=y(s);return s&&e===o?i.setNode(w(s,t,n),r):r},h(r)))},t.getLocals=f,t.rename=l,t.incCount=c}),define("khepri-compile/inline/expand",["require","exports","khepri-ast/declaration","khepri-ast/expression","khepri-ast/pattern","khepri-ast/value","khepri-ast/node","../ast","../fun","./rename","../builtin"],function(e,t,n,r,i,s,o,u,a,f,l){var c,h,p=o.modify,d=u.type,v=u.getUid,m=u.tryGetUd,g=a.concat,y=a.map,b=f.rename,w=l.builtins,E=m.bind(null,[],"locals");c=function(e,t,i){var s,o=d(t)==="LetExpression"?t.body:t,u=E(o),a=o.params,l=y(function(t,r){return n.Binding.create(null,b(e,u,t),i[r]||w.undefined)},a.elements),c=o.params.id?(s=o.params.id,n.Binding.create(null,b(e,u,s),r.ArrayExpression.create(null,i.map(function(e,t){return l[t]?l[t].pattern.id:e})))):[],h=g(t.bindings?b(e,u,t.bindings):[],l,c),p=g(h.map(function(e){return v(e.pattern.id)}),f.getLocals(o,e),u);return[p,r.LetExpression.create(null,h,b(e,u,o.body))]},h=function(e,t,s){var o=t.type==="LetExpression"?t.body:t,u,a,f,l;return o.params.elements.length?(u=o.params.elements[0],a=o.params.elements.slice(1),f=E(o),l=p(o,{id:null,params:i.ArgumentsPattern.create(null,null,b(e,f,a),o.params.self),body:b(e,f,o.body)}),!u||u.type!=="IdentifierPattern"&&u.type!=="AsPattern"&&u.type!=="ObjectPattern"?l:r.LetExpression.create(null,g(t.bindings,n.Binding.create(null,b(e,f,u),s[0])),l)):t},t.expandCallee=c,t.expandCurry=h}),define("khepri-compile/inline/inline",["require","exports","khepri-ast/node","khepri-ast/declaration","khepri-ast/statement","khepri-ast/expression","khepri-ast/value","akh/base","akh/unique","akh/trans/state","zipper-m/trans/tree","../ast","../builtin","../fun","./state","./expand","./expansion","./rename"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){var y,b=n.modify,w=n.setData,E=u.next,S=u.sequence,x=u.sequencea,T=c.type,N=c.isIdentifier,C=c.getUid,k=c.isLambda,L=c.isLambdaWithoutArgs,A=c.isPrimitive,O=c.isNumberish,M=c.isTruthy,_=h.builtins,D=h.definitions,P=p.flattenr,H=p.flatten,B=p.foldl,j=p.concat,F=d.State,I=v.expandCallee,q=v.expandCurry,R=m.markExpansion,U=m.getExpansion,z=m.isExpansion,W=m.expandNode,X=g.incCount,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Ht,Bt,jt,Ft,It,qt,Rt,Ut,zt,Wt,Xt,Vt,$t,Jt,Kt,Qt,Gt,Yt,Zt,en,tn,nn,rn,sn,on,un,an,fn,ln,cn,hn,pn,dn,vn,mn,gn,yn,bn,wn,En,Sn,xn,Tn,Nn,Cn,kn,Ln,An,On,Mn,_n,Dn,Pn,Hn,Bn,jn,Fn,In,qn,Rn,Un,zn,Wn,Xn,Vn,$n,Jn,Kn,Qn,Gn,Yn,Zn,er,tr,nr,rr,ir,sr,or,ur,ar,fr,lr,cr,hr,pr,dr,vr,mr,gr,yr,br,wr,Er,Sr,xr,Tr,Nr,Cr,kr,Lr=function(e,t){return e&&t},Ar=function(e){return+e},Or=function(e){return-e},Mr=function(e,t){return e<<t},_r=function(e,t){return e||t},Dr=function(e,t){return e>>t},Pr=function(e){return!e},Hr=function(e,t){return e<=t},Br=function(e,t){return e%t},jr=function(e,t){return e*t},Fr=function(e,t){return e+t},Ir=function(e,t){return e-t},qr=function(e,t){return e/t},Rr=function(e){return typeof e},Ur=function(e,t){return e<t},zr=function(e,t){return e>t},Wr=function(e){return~e},Xr=function(e,t){return e>>>t},Vr=function(e,t){return e>=t},$r,Jr=l(f(a)),Kr=function(e,t,n,r){return a.runUnique(f.evalStateT(l.runTreeZipperT(e,t),n),r)},Qr=Jr.of(null),Gr=Jr.chain.bind(null,Jr.liftInner(a.unique)),Yr=Jr.lift(Jr.inner.get),Zr=(V=Jr.lift,$=Jr.inner.modify,function(e){return V($(e))}),ei=Jr.get,ti=Jr.chain.bind(null,Jr.node),ni=Jr.modifyNode,ri=Jr.setNode,ii=Jr.up,si=Jr.down,oi=Jr.right,ui=Jr.child,ai=function(e,t,n){return Zr(d.addBinding.bind(null,e,t,n))},fi=function(e,t,n){return Zr(d.addWorking.bind(null,e,t,n))},li=function(e){return e?Yr.map(d.getBinding.bind(null,e)):Qr},ci=function(e){var t=C(e);return li(t).chain(function(e){return e&&e.simple&&!z(e.value)&&(A(e.value)||e.immutable&&N(e.value))?ri([]):Qr})},hi=Zr(d.push),pi=Zr(d.pop),di=Jr.chain.bind(null,Yr.map(d.getGlobals)),vi=function(e){return Zr(d.addGlobal.bind(null,e))},mi=function(e){return r.VariableDeclaration.create(null,e.map(function(e){return r.VariableDeclarator.create(null,_[e],D[e])}))},gi=Yr.map(d.getLocals),yi=Zr(d.pushLocals),bi=Zr(d.popLocals),wi=function(e){var t=arguments,n=[].slice.call(t,1);return S(ui(e),x(n),ii)},Ei=ti(function(e){return $r(e)}),Si=function(e){return wi(e,Ei)},xi=function(e,t){var n=C(e);return A(t)?ai(n,t,!0):k(t)?ai(n,R(e,0,t),!0):N(t)?li(C(t)).chain(function(e){return e&&e.immutable?ai(n,e.simple&&e.value?e.value:t,!0):ai(n,t,!1)}):ai(n,t,!1)},Ti=function(e,t){var n=C(e);return A(t)?fi(n,t,!0):k(t)?fi(n,R(e,0,t),!0):N(t)?li(C(t)).chain(function(e){return e&&e.immutable?fi(n,e.simple&&e.value?e.value:t,!0):fi(n,t,!1)}):fi(n,t,!1)},Ni=function(e,t){return li(C(e)).chain(function(n){return!n||n.value?Ti(e,t):Qr})},Ci={},ki=function(e,t){Array.isArray(e)?e.forEach(function(e){return ki(e,t)}):Ci[e]=t};ki("UnaryOperator",S(ti(function(e){var t=e.name;return _[t]?S(vi(t),ri(_[t])):Gr(function(e){return ri(h.member(t.substring(1),e))})}),Ei)),ki("BinaryOperator",S(ti(function(e){var t=e.name;return S(vi(t),ri(_[t]))}),Ei)),ki("TernaryOperator",S(Zr(d.addGlobal.bind(null,"?")),ri(_["?"]),Ei)),ki("OperatorExpression",S((J=["operator",Ei],K=[].slice.call(J,1),S(ui("operator"),x(K),ii)),(Q=ni(function(e){var t=e.operator;return s.CallExpression.create(null,_._,[t])}),G=ni(function(e){return e.operator}),ti(function(e){return e.flipped?Q:G||Qr})),Ei)),ki("Program",S((Y=["body",Ei],Z=[].slice.call(Y,1),S(ui("body"),x(Z),ii)),(et=di(function(e){return ni(function(t){return b(t,{body:j(mi(e),t.body)})})}),ti(function(e){var t,n;return(t=e.body,n=T(t),"Package"!==n)?et:undefined||Qr})))),ki("Package",S((tt=["body",Ei],nt=[].slice.call(tt,1),S(ui("body"),x(nt),ii)),di(function(e){return ni(function(t){return b(t,{body:T(t.body)==="WithStatement"?i.WithStatement.create(t.body.loc,t.body.bindings,i.BlockStatement.create(null,j(mi(e),t.body.body.body))):j(mi(e),t.body)},{})})}))),ki("SwitchCase",S((rt=["test",Ei],it=[].slice.call(rt,1),S(ui("test"),x(it),ii)),(st=["consequent",Ei],ot=[].slice.call(st,1),S(ui("consequent"),x(ot),ii)))),ki("CatchClause",S((ut=["param",Ei],at=[].slice.call(ut,1),S(ui("param"),x(at),ii)),(ft=["body",Ei],lt=[].slice.call(ft,1),S(ui("body"),x(lt),ii)))),ki("VariableDeclaration",(ct=["declarations",Ei],ht=[].slice.call(ct,1),S(ui("declarations"),x(ht),ii))),ki("VariableDeclarator",S((pt=["init",Ei],dt=[].slice.call(pt,1),S(ui("init"),x(dt),ii)),(vt=ti(function(e){return e.immutable?S(xi(e.id,e.init),ci(e.id)):fi(C(e.id),e.init,A(e.init)||N(e.init)||k(e.init))}),ti(function(e){return e.init?vt:undefined||Qr})))),ki("Binding",S((mt=["value",Ei],gt=[].slice.call(mt,1),S(ui("value"),x(gt),ii)),(yt=ti(function(e){return S(xi(e.pattern.id,e.value),ci(e.pattern.id))}),ti(function(e){return e.pattern.type==="IdentifierPattern"&&C(e.pattern.id)?yt:undefined||Qr})),(bt=ti(function(e){var t=H(j(e.value.bindings,r.Binding.create(null,e.pattern,e.value.body)));return S(ri(t),Si(t.length-1))}),ti(function(e){return e&&e.type==="Binding"&&e.value&&e.value.type==="LetExpression"?bt:undefined||Qr})))),ki("BlockStatement",(wt=["body",Ei],Et=[].slice.call(wt,1),S(ui("body"),x(Et),ii))),ki("ExpressionStatement",(St=["expression",Ei],xt=[].slice.call(St,1),S(ui("expression"),x(xt),ii))),ki("WithStatement",S((Tt=["bindings",Ei],Nt=[].slice.call(Tt,1),S(ui("bindings"),x(Nt),ii)),(Ct=["body",Ei],kt=[].slice.call(Ct,1),S(ui("body"),x(kt),ii)))),ki("SwitchStatement",S((Lt=["discriminant",Ei],At=[].slice.call(Lt,1),S(ui("discriminant"),x(At),ii)),(Ot=["cases",Ei],Mt=[].slice.call(Ot,1),S(ui("cases"),x(Mt),ii)))),ki(["ReturnStatement","ThrowStatement"],(_t=["argument",Ei],Dt=[].slice.call(_t,1),S(ui("argument"),x(Dt),ii))),ki("TryStatement",S((Pt=["block",Ei],Ht=[].slice.call(Pt,1),S(ui("block"),x(Ht),ii)),(Bt=["handler",Ei],jt=[].slice.call(Bt,1),S(ui("handler"),x(jt),ii)),(Ft=["finalizer",Ei],It=[].slice.call(Ft,1),S(ui("finalizer"),x(It),ii)))),ki("WhileStatement",(Wt=[(qt=["test",Ei],Rt=[].slice.call(qt,1),S(ui("test"),x(Rt),ii)),(Ut=["body",Ei],zt=[].slice.call(Ut,1),S(ui("body"),x(zt),ii))],S(hi,x(Wt),pi))),ki("DoWhileStatement",(Kt=[(Xt=["body",Ei],Vt=[].slice.call(Xt,1),S(ui("body"),x(Vt),ii)),($t=["test",Ei],Jt=[].slice.call($t,1),S(ui("test"),x(Jt),ii))],S(hi,x(Kt),pi))),ki("ForStatement",S((Qt=["init",Ei],Gt=[].slice.call(Qt,1),S(ui("init"),x(Gt),ii)),(sn=[(Yt=["test",Ei],Zt=[].slice.call(Yt,1),S(ui("test"),x(Zt),ii)),(en=["update",Ei],tn=[].slice.call(en,1),S(ui("update"),x(tn),ii)),(nn=["body",Ei],rn=[].slice.call(nn,1),S(ui("body"),x(rn),ii))],S(hi,x(sn),pi)))),ki("FunctionExpression",(hn=[yi,(on=["id",Ei],un=[].slice.call(on,1),S(ui("id"),x(un),ii)),(an=["params",Ei],fn=[].slice.call(an,1),S(ui("params"),x(fn),ii)),(ln=["body",Ei],cn=[].slice.call(ln,1),S(ui("body"),x(cn),ii)),gi.chain(function(e){return ni(function(t){return w(t,"locals",j(t.ud.locals,e))})}),bi],S(hi,x(hn),pi))),ki("UnaryExpression",(pn={"!":Pr,"~":Wr,"typeof":Rr,"++":Ar,"--":Or},S((dn=["argument",Ei],vn=[].slice.call(dn,1),S(ui("argument"),x(vn),ii)),(mn=ni(function(e){var t=e.loc,n=e.operator,r=e.argument,i=pn[n](r.value);return o.Literal.create(t,typeof i,i)}),ti(function(e){var t,n;return(t=e.operator,n=e.argument,pn[t]&&A(n))?mn:undefined||Qr}))))),ki("BinaryExpression",(gn={"+":Fr,"-":Ir,"*":jr,"/":qr,"%":Br,"<<":Mr,">>":Dr,">>>":Xr,"<":Ur,">":zr,"<=":Hr,">=":Vr,"||":_r,"&&":Lr},S((yn=["left",Ei],bn=[].slice.call(yn,1),S(ui("left"),x(bn),ii)),(wn=["right",Ei],En=[].slice.call(wn,1),S(ui("right"),x(En),ii)),(Sn=ni(function(e){var t=e.operator,n=e.left,r=e.right,i=gn[t](n.value,r.value);return o.Literal.create(null,typeof i,i)}),ti(function(e){var t,n,r;return(t=e.operator,n=e.left,r=e.right,gn[t]&&A(n)&&A(r))?Sn:undefined||Qr})),(xn=ti(function(e){var t=e.operator,n=e.left,r=e.right;return S(vi(t),ri(s.CallExpression.create(null,_[t],[n,r])),Ei)}),ti(function(e){var t;return(t=e.operator,t==="\\>"||t==="\\>>"||t==="<\\"||t==="<<\\")?xn:undefined||Qr}))))),ki("AssignmentExpression",S((Tn=["right",Ei],Nn=[].slice.call(Tn,1),S(ui("right"),x(Nn),ii)),(Cn=ti(function(e){var t=e.operator,n=e.left,r=e.right;return t==="="?Ni(n,r):xi(n,r)}),ti(function(e){var t,n;return(t=e.left,n=T(t),"Identifier"===n)?Cn:undefined||Qr})))),ki(["ConditionalExpression","IfStatement"],S((kn=["test",Ei],Ln=[].slice.call(kn,1),S(ui("test"),x(Ln),ii)),(Dn=ti(function(e){var t=e.test,n=e.consequent,r=e.alternate;return S(ri(M(t)?n:r),Ei)}),Pn=S((An=["consequent",Ei],On=[].slice.call(An,1),S(ui("consequent"),x(On),ii)),(Mn=["alternate",Ei],_n=[].slice.call(Mn,1),S(ui("alternate"),x(_n),ii))),ti(function(e){return A(e.test)?Dn:Pn||Qr})))),ki("MemberExpression",S((Hn=["object",Ei],Bn=[].slice.call(Hn,1),S(ui("object"),x(Bn),ii)),(jn=["property",Ei],Fn=[].slice.call(jn,1),In=S(ui("property"),x(Fn),ii),ti(function(e){return e.computed?In:undefined||Qr})),(qn=ni(function(e){var t=e.object,n=e.property;return t.elements[n.value]||_.undefined}),ti(function(e){return e.computed&&e.object.type==="ArrayExpression"&&O(e.property)?qn:undefined||Qr})),(Rn=ni(function(e){var t=e.object;return o.Literal.create(null,"number",t.elements.length)}),ti(function(e){return e.type==="MemberExpression"&&e.object.type==="ArrayExpression"&&(!e.computed&&e.property.name==="length"||e.computed&&e.property.type==="Literal"&&e.property.value==="length")?Rn:undefined||Qr})),(Un=ni(function(e){var t=e.object.value,n=e.property.value;return n<t.length?o.Literal.create(null,"string",t[n]):_.undefined}),ti(function(e){return e.computed&&e.object.type==="Literal"&&e.object.kind==="string"&&O(e.property)?Un:undefined||Qr})))),ki("NewExpression",S((zn=["callee",Ei],Wn=[].slice.call(zn,1),S(ui("callee"),x(Wn),ii)),(Xn=["args",Ei],Vn=[].slice.call(Xn,1),S(ui("args"),x(Vn),ii)))),ki("CallExpression",S(($n=["callee",Ei],Jn=[].slice.call($n,1),S(ui("callee"),x(Jn),ii)),(Kn=["args",Ei],Qn=[].slice.call(Kn,1),S(ui("args"),x(Qn),ii)),(Gn=Jr.node.map(function(e){return e.callee}),Yn=Gn.chain(function(e){var t=W(e);return ni(function(e){return X(C(e.callee),U(e.callee).count||1,U(e.callee).countvalue,s.CallExpression.create(e.loc,t,e.args))})}),ti(function(e){return z(e.callee)?Yn:undefined||Qr})),(Zn=S(Gr(function(e){return ti(function(t){var n=I(e,t.callee,t.args),r=n[0],i=n[1];return S(Zr(d.addLocals.bind(null,r)),ri(i))})}),Ei),ti(function(e){return k(e.callee)||e.callee.type==="LetExpression"&&k(e.callee.body)?Zn:undefined||Qr})))),ki("CurryExpression",S((er=["base",Ei],tr=[].slice.call(er,1),S(ui("base"),x(tr),ii)),(nr=["args",Ei],rr=[].slice.call(nr,1),S(ui("args"),x(rr),ii)),(ir=Jr.node.map(function(e){return e.base}),sr=ir.chain(function(e){var t=W(e);return ni(function(e){return X(C(e.base),U(e.base),U(e.base).value,s.CurryExpression.create(e.loc,t,e.args))})}),ti(function(e){return z(e.base)?sr:undefined||Qr})),(or=S(Gr(function(e){return ni(function(t){return q(e,t.base,t.args)})}),Ei),ti(function(e){return L(e.base)||e.base.type==="LetExpression"&&L(e.base.body)?or:undefined||Qr})))),ki("LetExpression",S((ur=["bindings",Ei],ar=[].slice.call(ur,1),S(ui("bindings"),x(ar),ii)),(fr=["body",Ei],lr=[].slice.call(fr,1),S(ui("body"),x(lr),ii)),(cr=ni(function(e){var t=e.loc,n=e.bindings,r=e.body;return s.LetExpression.create(t,j(n,r.bindings),r.body)}),ti(function(e){var t,n;return(t=e.body,n=T(t),"LetExpression"===n)?cr:undefined||Qr})),ni(function(e){var t=e.loc,n=e.bindings,r=e.body;return s.LetExpression.create(t,P(n),r)}),(hr=ni(function(e){return e.body}),ti(function(e){var t;return(t=e.bindings,!t.length)?hr:undefined||Qr})))),ki(["SliceUnpack","RelativeUnpack"],(pr=["target",Ei],dr=[].slice.call(pr,1),S(ui("target"),x(dr),ii))),ki("ArgumentsPattern",S((vr=["id",Ei],mr=[].slice.call(vr,1),S(ui("id"),x(mr),ii)),(gr=["elements",Ei],yr=[].slice.call(gr,1),S(ui("elements"),x(yr),ii)),(br=["self",Ei],wr=[].slice.call(br,1),S(ui("self"),x(wr),ii)))),ki("IdentifierPattern",ti(function(e){return ai(C(e.id),null,!0)})),ki("ArrayExpression",(Er=["elements",Ei],Sr=[].slice.call(Er,1),S(ui("elements"),x(Sr),ii))),ki("ObjectExpression",(xr=["properties",Ei],Tr=[].slice.call(xr,1),S(ui("properties"),x(Tr),ii))),ki("ObjectValue",(Nr=["value",Ei],Cr=[].slice.call(Nr,1),S(ui("value"),x(Cr),ii))),ki("Identifier",(kr=ti(function(e){return li(C(e)).chain(function(e){return e&&e.value&&e.simple?ri(e.value):Qr})}),ti(function(e){return C(e)&&!z(e)?kr:undefined||Qr}))),$r=function(e){return Array.isArray(e)?e.length?S(si,x(e.map(function(t,n){return n===e.length-1?Ei:E(Ei,oi)})),ii):Qr:Ci[T(e)]||Qr};var Li=S(Ei,ei.chain(function(e){return Gr(function(t){return Jr.of({tree:e,data:{unique:t}})})})),Ai=d.addGlobal("_",B(function(e,t){var n=_[t],r=D[t];return d.addBinding(C(n),R(n,0,r),!0,e)},F.empty,Object.keys(_)));y=function(e,t){return Kr(Li,e,Ai,t.unique)},t.optimize=y}),define("khepri-compile/stages/inline",["require","exports","bes/object","akh/error","../inline/inline"],function(e,t,n,r,i){var s,o=n.setProperty;return s=function(e){var t=e.tree,n=e.data,s=i.optimize(t,n);return r.of(o(o(e,"tree",s.tree),"data",s.data))},s}),define("khepri-compile/khepri_peep",["require","exports","khepri-ast/declaration","khepri-ast/statement","khepri-ast/expression","./ast","./fun","./rewriter"],function(e,t,n,r,i,s,o,u){var a,f=s.type,l=o.concat,c=o.flattenr,h=u.UP,p=u.DOWN,d=u.Rewriter,v=u.rewrite,m=new d,g=function(e){return!0};m.add("LetExpression",h,function(e){var t=e.body,n=f(t);return"LetExpression"===n},function(e){return i.LetExpression.create(e.loc,l(e.bindings,e.body.bindings),e.body.body)}),m.add("CurryExpression",h,function(e){var t=e.base,n=f(t);return"CurryExpression"===n},function(e){return i.CurryExpression.create(e.loc,e.base.base,l(e.base.args,e.args))}),m.add("CallExpression",h,function(e){var t=e.callee,n=f(t);return"CurryExpression"===n},function(e){return i.CallExpression.create(e.loc,e.callee.base,l(e.callee.args,e.args))}),m.add("VariableDeclaration",h,g,function(e){var t=e.loc,r=e.declarations,i=c(r);return i.length?n.VariableDeclaration.create(t,i):null}),m.add("LetExpression",h,g,function(e){var t=e.loc,n=e.bindings,r=e.body,s=c(n);return s.length?i.LetExpression.create(t,s,r):r}),m.add("WithStatement",h,g,function(e){var t=e.loc,n=e.bindings,i=e.body,s=c(n);return s.length?r.WithStatement.create(t,s,i):i}),m.add("ReturnStatement",!1,function(e){var t=e.argument,n=f(t);return"LetExpression"===n},function(e){return r.WithStatement.create(null,e.argument.bindings,r.BlockStatement.create(null,[r.ReturnStatement.create(e.loc,e.argument.body)]))}),m.add("FunctionExpression",p,function(e){var t=e.body,n=f(t);return"LetExpression"===n},function(e){return i.FunctionExpression.create(null,e.id,e.params,r.BlockStatement.create(null,[r.WithStatement.create(null,e.body.bindings,r.BlockStatement.create(null,[r.ReturnStatement.create(e.loc,e.body.body)]))]))}),m.add("ExpressionStatement",h,function(e){var t=e.expression,n=f(t);return"LetExpression"===n},function(e){return r.WithStatement.create(null,e.expression.bindings,r.BlockStatement.create(null,[r.ExpressionStatement.create(e.loc,e.expression.body)]))}),m.add("ExpressionStatement",h,function(e){return e.expression&&e.expression.type==="AssignmentExpression"&&e.expression.right.type==="LetExpression"},function(e){return r.WithStatement.create(null,e.expression.right.bindings,r.BlockStatement.create(null,[r.ExpressionStatement.create(e.loc,i.AssignmentExpression.create(e.expression.loc,e.expression.operator,e.expression.left,e.expression.right.body))]))}),a=v.bind(null,m),t.optimize=a}),define("khepri-compile/stages/khepri_peep",["require","exports","akh/error","bes/object","../khepri_peep"],function(e,t,n,r,i){var s,o=r.setProperty;return s=function(e){var t=e.tree,r=e.data;return n.of(o(e,"tree",i.optimize(t,r)))},s}),define("ecma-ast/serialization",["require","exports","./node"],function(e,t,n){var r=n.Node,i,s,o,u=Object.keys,a=Function.prototype.call.bind(Array.prototype.map),f=Function.prototype.call.bind(Array.prototype.reduce),l=function(e){return e},c={};i=function(e,t){c[e]=t};var h=function(e,t,n){return e?Array.isArray(e)?a(e,function(e){return h(e,t,n)}):e instanceof r?{type:e.type,loc:t(e.loc),ud:n(e.ud),children:f(e.children,function(r,i){return r[i]=h(e[i],t,n),r},{}),attributes:f(e.attributes,function(t,n){return t[n]=e[n],t},{})}:e:e};s=function(e,t,n){var r=h(e,t||l,n||l);return{version:"2.1.0",kind:"ecma",program:r}};var p=function(e,t,r){if(!e)return e;if(Array.isArray(e))return a(e,function(e){return p(e,t,r)});var i=c[e.type];if(!i)return e;var s=t(e.loc),o=r(e.ud),l=f(u(e.children),function(n,i){return n[i]=p(e.children[i],t,r),n},{}),h=f(u(e.attributes),function(t,n){return t[n]=e.attributes[n],t},{});return n.construct(i.prototype,s,o,l,h)};o=function(e,t,n){return p(e.program,t||l,n||l)},t.registerNode=i,t.serialize=s,t.unserialize=o}),define("ecma-ast/node",["require","exports","./serialization"],function(e,t,n){var r=n.registerNode,i,s,o,u,a,f,l,c,h,p,d=Object.keys,v=function(e,t,n){var r={},i=d(e);for(var s=0,o=i.length;s<o;s+=1){var u=i[s];r[u]=e[u]}return r[t]=n,r};i=function(e,t){var n=this;Object.defineProperties(n,{loc:{value:e,enumerable:!1,writable:!0},ud:{value:t||null,enumerable:!1,writable:!0}})},s=function(e,t,n,r,i){var s=new e.constructor(t);s.ud=n;var o=e.children;for(var u=0,a=o.length;u<a;u+=1){var f=o[u];s[f]=r[f]||null}var l=e.attributes;for(var c=0,h=l.length;c<h;c+=1){var p=l[c];s[p]=i[p]||null}return s},o=function(e,t,n){return s(e,e.loc,e.ud,t,n)},u=function(e,t,n){var r=new e.constructor(e.loc);r.ud=e.ud;var i=e.children;for(var s=0,o=i.length;s<o;s+=1){var u=i[s];r[u]=t[u]||e[u]}var a=e.attributes;for(var f=0,l=a.length;f<l;f+=1){var c=a[f];r[c]=n[c]||e[c]}return r},a=function(e,t){return s(e,t,e.ud,e,e)},f=function(e,t){return s(e,e.loc,t,e,e)},l=function(e,t){return e.ud&&e.ud[t]},c=function(e,t,n){return h(e,t,n(l(e,t)))},h=function(e,t,n){return f(e,v(e.ud||{},t,n))},p=function(e,t,n,i,s){s.type=t,s.prototype=new e,s.prototype.constructor=s,s.prototype.children=n,s.prototype.attributes=i,s.prototype.type=s.type;var o=function(e){var t=this;return s.apply(t,e)};return o.prototype=s.prototype,s.create=function(){var e=arguments;return new o(e)},r(t,s),s},t.Node=i,t.construct=s,t.reconstruct=o,t.modify=u,t.setLoc=a,t.setUserData=f,t.getData=l,t.modifyData=c,t.setData=h,t.defineNode=p}),define("ecma-ast-zipper",["require","exports","nu-stream/gen","nu-stream/stream","neith/tree","ecma-ast/node"],function(e,t,n,r,i,s){var o=n.range,u=r.foldl,a=r.from,f=r.NIL,l=i.treeZipper,c=s.Node,h=s.modify,p,d=function(e){return u(function(e,t){var n=t.key,r=t.value;return e[n]=r,e},[],e)};p=l.bind(null,function(e){return e?Array.isArray(e)?o(0,e.length):a(e.children):f},function(e,t){return e[t]},function(e,t,n){return e instanceof c?h(e,n(),{}):d(t)}),t.ecmaZipper=p}),define("khepri-compile/transform/unpack",["require","exports","khepri-ast/expression","khepri-ast/value","../ast","../fun","../normalize/unpack"],function(e,t,n,r,i,s,o){var u,a,f,l=i.type,c=s.concat,h=s.flatten,p=s.map,d=o.innerPattern,v=r.Identifier.create.bind(null,null),m=r.Literal.create.bind(null,null,"number"),g=function(e,t,r,i){return d(n.MemberExpression.create(null,e,n.BinaryExpression.create(null,"-",n.CallExpression.create(null,n.MemberExpression.create(null,v("Math"),v("max")),[n.MemberExpression.create(null,e,v("length")),m(t)]),m(r)),!0),i)},y=function(e,t,r,i){return d(n.CallExpression.create(null,n.MemberExpression.create(null,n.MemberExpression.create(null,n.ArrayExpression.create(null,[]),v("slice")),v("call")),i===0?[e,m(r)]:[e,m(r),m(-i)]),t)},b=p.bind(null,function(e){switch(l(e.value)){case"RelativeUnpack":return g(e.value.target,e.value.min,e.value.index,e.pattern);case"SliceUnpack":return y(e.value.target,e.pattern,e.value.from,e.value.to);default:return e}}),w=b;a=function(){var e=arguments,t=d.apply(null,e);return h(w(t))},u=function(e){return a(e.value,e.pattern)},f=function(e,t){var n=e.id?a(v("arguments"),e.id):[],r=e.self?a(t,e.self):[];return c(n,r)},t.expandBinding=u,t.expandBindings=a,t.expandArgumentsPattern=f}),define("khepri-compile/transform/state",["require","exports","bes/record","nu-stream/stream","../lexical/scope"],function(e,t,n,r,i){var s,o,u,a,f,l=r.append,c=r.first,h=r.rest,p=r.cons,d=r.NIL,v=r.toArray,m=i.Scope;s=n.declare(null,["scope","packageManager","bindings"]),s.empty=s.create(m.empty,null,p(d,d)),o=function(e){var t=e.bindings;return v(c(t))},u=function(e,t){return t.setBindings(p(l(c(t.bindings),r.from(e)),h(t.bindings)))},a=function(e){return e.setBindings(p(d,e.bindings))},f=function(e){return e.setBindings(h(e.bindings))},t.State=s,t.getBindings=o,t.addBindings=u,t.pushBindings=a,t.popBindings=f}),define("ecma-ast/clause",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s,o,u=function(){};u.prototype=new r,s=i(u,"SwitchCase",["test","consequent"],[],function(e,t,n){var i=this;r.call(i,e),i.test=t||null,i.consequent=n}),o=i(u,"CatchClause",["param","body"],[],function(e,t,n){var i=this;r.call(i,e),i.param=t,i.body=n}),t.SwitchCase=s,t.CatchClause=o}),define("ecma-ast/declaration",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s,o,u,a;s=function(){},s.prototype=new r,o=i(s,"FunctionDeclaration",["id","params","body"],[],function(e,t,n,i){var s=this;r.call(s,e),s.id=t,s.params=n,s.body=i}),u=i(s,"VariableDeclaration",["declarations"],[],function(e,t){var n=this;r.call(n,e),n.declarations=t}),a=i(s,"VariableDeclarator",["id","init"],[],function(e,t,n){var i=this;r.call(i,e),i.id=t,i.init=n||null}),t.Declaration=s,t.FunctionDeclaration=o,t.VariableDeclaration=u,t.VariableDeclarator=a}),define("ecma-ast/expression",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;s=function(){var e=this},s.prototype=new r,o=i(s,"ThisExpression",[],[],function(e){var t=this;r.call(t,e)}),u=i(s,"SequenceExpression",["expressions"],[],function(e,t){var n=this;r.call(n,e),n.expressions=t}),a=i(s,"UnaryExpression",["argument"],["operator"],function(e,t,n){var i=this;r.call(i,e),i.operator=t,i.argument=n}),f=i(s,"BinaryExpression",["left","right"],["operator"],function(e,t,n,i){var s=this;r.call(s,e),s.operator=t,s.left=n,s.right=i}),l=i(s,"AssignmentExpression",["left","right"],["operator"],function(e,t,n,i){var s=this;r.call(s,e),s.operator=t,s.left=n,s.right=i}),c=i(s,"UpdateExpression",["argument"],["operator","prefix"],function(e,t,n,i){var s=this;r.call(s,e),s.operator=t,s.argument=n,s.prefix=i}),h=i(s,"LogicalExpression",["left","right"],["operator"],function(e,t,n,i){var s=this;r.call(s,e),s.operator=t,s.left=n,s.right=i}),p=i(s,"ConditionalExpression",["test","consequent","alternate"],[],function(e,t,n,i){var s=this;r.call(s,e),s.test=t,s.consequent=n,s.alternate=i}),d=i(s,"NewExpression",["callee","args"],[],function(e,t,n){var i=this;r.call(i,e),i.callee=t,i.args=n}),v=i(s,"CallExpression",["callee","args"],[],function(e,t,n){var i=this;r.call(i,e),i.callee=t,i.args=n}),m=i(s,"MemberExpression",["object","property"],["computed"],function(e,t,n,i){var s=this;r.call(s,e),s.object=t,s.property=n,s.computed=i}),g=i(s,"FunctionExpression",["id","params","body"],[],function(e,t,n,i){var s=this;r.call(s,e),s.id=t||null,s.params=n,s.body=i}),y=i(s,"ArrayExpression",["elements"],[],function(e,t){var n=this;r.call(n,e),n.elements=t}),b=i(s,"ObjectExpression",["properties"],[],function(e,t){var n=this;r.call(n,e),n.properties=t}),t.Expression=s,t.ThisExpression=o,t.SequenceExpression=u,t.UnaryExpression=a,t.BinaryExpression=f,t.AssignmentExpression=l,t.UpdateExpression=c,t.LogicalExpression=h,t.ConditionalExpression=p,t.NewExpression=d,t.CallExpression=v,t.MemberExpression=m,t.FunctionExpression=g,t.ArrayExpression=y,t.ObjectExpression=b}),define("ecma-ast/program",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s;s=i(r,"Program",["body"],[],function(e,t){var n=this;r.call(n,e),n.body=t}),t.Program=s}),define("ecma-ast/statement",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;s=function(){var e=this},s.prototype=new r,f=i(s,"EmptyStatement",[],[],function(e){var t=this;r.call(t,e)}),o=i(s,"DebuggerStatement",[],[],function(e){var t=this;r.call(t,e)}),u=i(s,"BlockStatement",["body"],[],function(e,t){var n=this;r.call(n,e),n.body=t}),a=i(s,"ExpressionStatement",["expression"],[],function(e,t){var n=this;r.call(n,e),n.expression=t}),l=i(s,"IfStatement",["test","consequent","alternate"],[],function(e,t,n,i){var s=this;r.call(s,e),s.test=t,s.consequent=n,s.alternate=i||null}),c=i(s,"LabeledStatement",["body"],[],function(e,t,n){var i=this;r.call(i,e),i.label=t,i.body=n}),h=i(s,"BreakStatement",["label"],[],function(e,t){var n=this;r.call(n,e),n.label=t||null}),p=i(s,"ContinueStatement",["label"],[],function(e,t){var n=this;r.call(n,e),n.label=t||null}),d=i(s,"WithStatement",["object","body"],[],function(e,t,n){var i=this;r.call(i,e),i.object=t,i.body=n}),v=i(s,"SwitchStatement",["discriminant","cases"],[],function(e,t,n){var i=this;r.call(i,e),i.discriminant=t,i.cases=n}),m=i(s,"ReturnStatement",["argument"],[],function(e,t){var n=this;r.call(n,e),n.argument=t||null}),g=i(s,"ThrowStatement",["argument"],[],function(e,t){var n=this;r.call(n,e),n.argument=t}),y=i(s,"TryStatement",["block","handler","finalizer"],[],function(e,t,n,i){var s=this;r.call(s,e),s.block=t,s.handler=n,s.finalizer=i}),b=i(s,"WhileStatement",["test","body"],[],function(e,t,n){var i=this;r.call(i,e),i.test=t,i.body=n}),w=i(s,"DoWhileStatement",["body","test"],[],function(e,t,n){var i=this;r.call(i,e),i.test=n,i.body=t}),E=i(s,"ForStatement",["init","test","update","body"],[],function(e,t,n,i,s){var o=this;r.call(o,e),o.init=t||null,o.test=n||null,o.update=i||null,o.body=s}),S=i(s,"ForInStatement",["left","right","body"],[],function(e,t,n,i){var s=this;r.call(s,e),s.left=t,s.right=n,s.body=i}),t.Statement=s,t.DebuggerStatement=o,t.BlockStatement=u,t.ExpressionStatement=a,t.EmptyStatement=f,t.IfStatement=l,t.LabeledStatement=c,t.BreakStatement=h,t.ContinueStatement=p,t.WithStatement=d,t.SwitchStatement=v,t.ReturnStatement=m,t.ThrowStatement=g,t.TryStatement=y,t.WhileStatement=b,t.DoWhileStatement=w,t.ForStatement=E,t.ForInStatement=S}),define("ecma-ast/value",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s,o,u,a,f;s=i(r,"Identifier",[],["name"],function(e,t){var n=this;r.call(n,e),n.name=t}),o=i(r,"Literal",[],["kind","value"],function(e,t,n){var i=this;r.call(i,e),i.kind=t,i.value=n}),u=i(r,"ObjectValue",["key","value"],[],function(e,t,n){var i=this;r.call(i,t,n),i.key=t,i.value=n}),a=i(r,"ObjectGetter",["key","value"],[],function(e,t,n){var i=this;r.call(i,t,n),i.key=t,i.value=n}),f=i(r,"ObjectSetter",["key","value"],[],function(e,t,n){var i=this;r.call(i,t,n),i.key=t,i.value=n}),t.Identifier=s,t.Literal=o,t.ObjectValue=u,t.ObjectGetter=a,t.ObjectSetter=f}),define("khepri-compile/transform/translation",["require","exports","ecma-ast/clause","ecma-ast/declaration","ecma-ast/expression","ecma-ast/node","ecma-ast/program","ecma-ast/statement","ecma-ast/value","khepri-ast/expression","khepri-ast/statement","khepri-ast/value","../ast","../fun","./unpack"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y=h.type,Z=h.tryGetUd,et=h.setUid,tt=p.concat,nt=p.flatten,rt=p.filter,it=p.map,st=p.reduce,ot=d.expandBinding,ut=d.expandArgumentsPattern,at,ft,lt,ct;v=u.ExpressionStatement.create(null,a.Literal.create(null,"string","use strict")),m=function(e,t,n){return et(n,a.Identifier.create(e,t))},y=function(e){return r.VariableDeclaration.create(e.loc,e.declarations)},b=function(e){return r.VariableDeclarator.create(e.loc,e.id,e.init)};var ht=(at=it.bind(null,function(e){return e&&r.VariableDeclarator.create(null,m(null,e))}),ft=r.VariableDeclaration.create.bind(null,null),function(e){return ft(at(e))}),pt=function(e){return r.VariableDeclarator.create(null,e.pattern.id,e.value)},dt=(lt=it.bind(null,function(e){return r.VariableDeclarator.create(null,e.pattern.id,e.value)}),function(e){return lt(ot(e))}),vt=(ct=it.bind(null,function(e){return i.AssignmentExpression.create(null,"=",e.pattern.id,e.value)}),function(e){return ct(ot(e))});g=function(e,t){return o.Program.create(t.loc,tt(Z([],"prefix",t),ht(e),t.body))},w=function(e){return i.AssignmentExpression.create(e.loc,"=",e.left,e.right)};var mt=function(e){switch(e){case"++":return"+";case"--":return"-";default:return e}};E=function(e){return i.UnaryExpression.create(e.loc,mt(e.operator),e.argument)},S=function(e){return i.BinaryExpression.create(e.loc,e.operator,e.left,e.right)},x=function(e){return i.LogicalExpression.create(e.loc,e.operator,e.left,e.right)},T=function(e){return i.ConditionalExpression.create(e.loc,e.test,e.consequent,e.alternate)},N=function(e){return i.NewExpression.create(e.loc,e.callee,e.args)},C=function(e){return i.CallExpression.create(e.loc,e.callee,e.args)},k=function(e){return i.MemberExpression.create(e.loc,e.object,e.property,e.computed)},D=function(e){return i.SequenceExpression.create(e.loc,nt(tt(it(vt,e.bindings),e.body)))},P=function(e){return i.CallExpression.create(e.loc,i.MemberExpression.create(null,e.base,m(null,"bind")),tt(a.Literal.create(null,"null",null),e.args))},M=function(e,t,n,s,o){var u=n.elements,a=it(pt,ut(n,i.ThisExpression.create(null))),c=Y(s)==="BlockStatement"?s.body:l.ReturnStatement.create(null,s);return f.FunctionExpression.create(e,t,u,l.BlockStatement.create(c.loc,tt(o||[],r.VariableDeclaration.create(null,a),c)))},_=function(e){return i.FunctionExpression.create(null,e.id,e.params,e.body)},L=function(e){return i.ArrayExpression.create(e.loc,e.elements)},A=function(e){return i.ObjectExpression.create(e.loc,e.properties)},O=function(e){return a.ObjectValue.create(e.loc,e.key,e.value)},H=function(e){return n.CatchClause.create(e.loc,e.param,e.body)},B=function(e){return n.SwitchCase.create(e.loc,e.test,e.consequent)},j=function(e){return u.EmptyStatement.create(e.loc)},F=function(e,t){return u.BlockStatement.create(t.loc,tt(ht(e),t.body))},I=function(e){var t=nt(it(dt,e.bindings)),n=r.VariableDeclaration.create(null,t);return u.BlockStatement.create(e.loc,tt(n,e.body.body))},q=function(e){return u.ExpressionStatement.create(e.loc,e.expression)},X=function(e){return u.IfStatement.create(e.loc,e.test,e.consequent,e.alternate)},V=function(e){return u.SwitchStatement.create(e.loc,e.discriminant,e.cases)},R=function(e){return u.ReturnStatement.create(e.loc,e.argument)},U=function(e){return u.ThrowStatement.create(e.loc,e.argument)},z=function(e){return u.BreakStatement.create(e.loc,null)},W=function(e){return u.ContinueStatement.create(e.loc,null)},Q=function(e){return u.TryStatement.create(e.loc,e.block,e.handler,e.finalizer)},K=function(e){return u.WhileStatement.create(e.loc,e.test,e.body)},J=function(e){return u.DoWhileStatement.create(e.loc,e.body,e.test)},$=function(e){return u.ForStatement.create(e.loc,e.init,e.test,e.update,e.body)};var gt=rt.bind(null,function(e){var t=e.value,n=Y(t);return"Import"===n}),yt=rt.bind(null,function(e){var t=e.value,n=Y(t);return"Import"!==n});G=function(e,t){var n=t.loc,r=t.exports,i=t.body,s=Y(i)==="WithStatement"?gt(i.bindings):[],o=st(s,function(e,t){return e[t.value.from]=t.pattern.id,e},{}),u=Y(i)==="WithStatement"?l.WithStatement.create(null,yt(i.bindings),i.body):i;return e.definePackage(n,r,s,o,u)},t.useStrict=v,t.identifier=m,t.program=g,t.variableDeclaration=y,t.variableDeclarator=b,t.assignmentExpression=w,t.unaryExpression=E,t.binaryExpression=S,t.logicalExpression=x,t.conditionalExpression=T,t.newExpression=N,t.callExpression=C,t.memberExpression=k,t.arrayExpression=L,t.objectExpression=A,t.objectValue=O,t.functionExpression=M,t.functionExpressionPost=_,t.letExpression=D,t.curryExpression=P,t.catchClause=H,t.switchCase=B,t.emptyStatement=j,t.blockStatement=F,t.withStatement=I,t.expressionStatement=q,t.returnStatement=R,t.throwStatement=U,t.breakStatement=z,t.continueStatement=W,t.ifStatement=X,t.switchStatement=V,t.forStatement=$,t.doWhileStatement=J,t.whileStatement=K,t.tryStatement=Q,t.packageBlock=G}),define("khepri-compile/transform/package_manager/amd",["require","exports","khepri-ast/declaration","khepri-ast/expression","khepri-ast/node","khepri-ast/pattern","khepri-ast/program","khepri-ast/statement","khepri-ast/value","../../fun","../../builtin"],function(e,t,n,r,i,s,o,u,a,f,l){var c,h,p,d=i.setData,v=l.builtins,m=Function.prototype.call.bind(Array.prototype.concat),g=Function.prototype.call.bind(Array.prototype.map),y=function(e){return e.split("::").join("/")};h=function(e){return o.Program.create(null,f.concat(u.ExpressionStatement.create(null,a.Literal.create(null,"string","use strict")),e))},p=function(e){var t=y(e);return r.CallExpression.create(null,v.require,[a.Literal.create(null,"string",t)])},c=function(e,t,i,o,l){var c=t.type==="PackageExports"?f.map(function(e){return e.id.name},t.exports):[t.id.name],h=n.VariableDeclaration.create(null,g(c,function(e){return n.VariableDeclarator.create(null,a.Identifier.create(null,e))})),p=t.type==="PackageExports"?g(t.exports,function(e){return u.ExpressionStatement.create(null,r.AssignmentExpression.create(null,"=",r.MemberExpression.create(null,v.exports,e.alias,!0),e.id))}):u.ReturnStatement.create(null,t.id),b=d(r.FunctionExpression.create(null,null,s.ArgumentsPattern.create(null,null,m(s.IdentifierPattern.create(null,v.require),s.IdentifierPattern.create(null,v.exports),g(i,function(e){return o[e.value.from]}))),u.BlockStatement.create(l.loc,m(h,l,p))),"prefix",[u.ExpressionStatement.create(null,a.Literal.create(null,"string","use strict"))]);return u.ExpressionStatement.create(e,r.CallExpression.create(e,a.Identifier.create(null,"define"),[r.ArrayExpression.create(null,m(a.Literal.create(null,"string","require"),a.Literal.create(null,"string","exports"),g(i,function(e){return a.Literal.create(null,"string",y(e.value.from))}))),b]))},t.definePackage=c,t.defineProgram=h,t.importPackage=p}),define("khepri-compile/transform/package_manager/node",["require","exports","khepri-ast/declaration","khepri-ast/expression","khepri-ast/statement","khepri-ast/program","khepri-ast/value","../../fun","../../builtin"],function(e,t,n,r,i,s,o,u,a){var f,l,c,h=a.builtins,p=Array.prototype.concat.bind([]),d=Function.prototype.call.bind(Array.prototype.map);l=function(e){return s.Program.create(null,u.concat(i.ExpressionStatement.create(null,o.Literal.create(null,"string","use strict")),e))},c=function(e){var t=e.split("::");return t.slice(1).reduce(function(e,t){return r.MemberExpression.create(null,e,o.Literal.create(null,"string",t),!0)},r.CallExpression.create(null,h.require,[o.Literal.create(null,"string",t[0])]))},f=function(e,t,s,a,f){var l=t.type==="PackageExports"?u.map(function(e){return e.id.name},t.exports):[t.id.name],h=n.VariableDeclaration.create(null,d(l,function(e){return n.VariableDeclarator.create(null,o.Identifier.create(null,e))})),v=t.type==="PackageExports"?d(t.exports,function(e){return i.ExpressionStatement.create(null,r.AssignmentExpression.create(null,"=",r.MemberExpression.create(null,o.Identifier.create(null,"exports"),e.alias,!0),e.id))}):i.ExpressionStatement.create(null,r.AssignmentExpression.create(null,"=",r.MemberExpression.create(null,o.Identifier.create(null,"module"),o.Identifier.create(null,"exports")),t.id));return i.BlockStatement.create(e,[i.ExpressionStatement.create(null,o.Literal.create(null,"string","use strict")),i.WithStatement.create(null,d(s,function(e){return n.Binding.create(null,e.pattern,c(e.value.from))}),i.BlockStatement.create(null,p(h,f,v)))])},t.definePackage=f,t.defineProgram=l,t.importPackage=c}),define("khepri-compile/transform/transform",["require","exports","akh/unique","akh/trans/statei","akh/base","zipper-m/trans/tree","ecma-ast-zipper","../ast","../lexical/scope","../fun","../builtin","./unpack","./state","./translation","./package_manager/amd","./package_manager/node"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m,g=i.liftM2,y=i.sequence,b=i.sequencea,w=o.ecmaZipper,E=u.type,S=u.getUd,x=u.setUd,T=u.getUid,N=f.concat,C=f.flatten,k=f.flip,L=f.foldr,A=f.map,O=l.builtins,M=c.expandBindings,_=h.State,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Ht,Bt,jt,Ft,It,qt,Rt,Ut,zt,Wt,Xt,Vt,$t,Jt,Kt,Qt,Gt,Yt,Zt,en,tn,nn,rn,sn,on,un,an,fn,ln,cn,hn,pn,dn,vn,mn,gn,yn,bn,wn,En,Sn,xn,Tn,Nn,Cn,kn,Ln,An,On,Mn,_n,Dn,Pn,Hn,Bn,jn,Fn,In,qn,Rn,Un,zn,Wn,Xn,Vn,$n,Jn,Kn,Qn,Gn,Yn,Zn,er,tr,nr,rr,ir,sr,or,ur,ar,fr,lr,cr,hr,pr,dr,vr,mr=s(r(n)),gr=function(e,t,i,o){return n.runUnique(r.evalStateT(s.runTreeZipperT(e,i),t),o)},yr=mr.of(null),br=g.bind(null,N),wr=L.bind(null,k(br),mr.of([])),Er=mr.node,Sr=mr.chain.bind(null,Er),xr=mr.modifyNode,Tr=mr.setNode,Nr=mr.up,Cr=mr.down,kr=mr.right,Lr=mr.child,Ar=Er.chain(function(e){return vr(e)}),Or=mr.lift(mr.inner.get),Mr=(D=mr.lift,P=mr.inner.modify,function(e){return D(P(e))}),_r=mr.chain.bind(null,Or),Dr=Or.map(function(e){return e.packageManager}),Pr=function(e){return Or.map(function(t){return e(t.scope)})},Hr=function(e){return Mr(function(t){return t.setScope(e(t.scope))})},Br=(H=a.push,Mr(function(e){return e.setScope(H(e.scope))})),jr=(B=a.pop,Mr(function(e){return e.setScope(B(e.scope))})),Fr=function(e){return Pr(a.getMapping.bind(null,e))},Ir=Mr(h.pushBindings),qr=Mr(h.popBindings),Rr=mr.chain.bind(null,_r((j=A.bind(null,Fr),F=h.getBindings,function(e){var t=F(e);return wr(j(t))}))),Ur=(q=A.bind(null,(I=M.bind(null,null),function(e){return I(e.pattern)})),R=A.bind(null,function(e){var t=e.pattern;return T(t.id)}),function(e){var t=q(e),n=C(t),r=R(n);return Mr(h.addBindings.bind(null,r))}),zr={},Wr=function(e,t){Array.isArray(e)?e.forEach(function(e){return Wr(e,t)}):zr[e]=t};Wr("VariableDeclaration",y((U=["declarations",Ar],z=[].slice.call(U,1),y(Lr("declarations"),b(z),Nr)),xr(p.variableDeclaration))),Wr("Binding",y((V=["pattern",(W=["id",Ar],X=[].slice.call(W,1),y(Lr("id"),b(X),Nr))],$=[].slice.call(V,1),y(Lr("pattern"),b($),Nr)),(J=["value",Ar],K=[].slice.call(J,1),y(Lr("value"),b(K),Nr)))),Wr("VariableDeclarator",y((Q=["id",Ar],G=[].slice.call(Q,1),y(Lr("id"),b(G),Nr)),(Y=["init",Ar],Z=[].slice.call(Y,1),y(Lr("init"),b(Z),Nr)),xr(p.variableDeclarator))),Wr("StaticDeclaration",xr(p.emptyStatement)),Wr("CatchClause",y((et=["param",Ar],tt=[].slice.call(et,1),y(Lr("param"),b(tt),Nr)),(nt=["body",Ar],rt=[].slice.call(nt,1),y(Lr("body"),b(rt),Nr)),xr(p.catchClause))),Wr("SwitchCase",y((it=["test",Ar],st=[].slice.call(it,1),y(Lr("test"),b(st),Nr)),(ot=["consequent",Ar],ut=[].slice.call(ot,1),y(Lr("consequent"),b(ut),Nr)),xr(p.switchCase))),Wr("BlockStatement",y(Ir,(at=["body",Ar],ft=[].slice.call(at,1),y(Lr("body"),b(ft),Nr)),Rr(function(e){return xr(p.blockStatement.bind(null,e))}),qr)),Wr("ExpressionStatement",y((lt=["expression",Ar],ct=[].slice.call(lt,1),y(Lr("expression"),b(ct),Nr)),xr(p.expressionStatement))),Wr("IfStatement",y((ht=["test",Ar],pt=[].slice.call(ht,1),y(Lr("test"),b(pt),Nr)),(dt=["consequent",Ar],vt=[].slice.call(dt,1),y(Lr("consequent"),b(vt),Nr)),(mt=["alternate",Ar],gt=[].slice.call(mt,1),y(Lr("alternate"),b(gt),Nr)),xr(p.ifStatement))),Wr("WithStatement",y((yt=["bindings",Ar],bt=[].slice.call(yt,1),y(Lr("bindings"),b(bt),Nr)),(wt=["body",Ar],Et=[].slice.call(wt,1),y(Lr("body"),b(Et),Nr)),xr(p.withStatement))),Wr("SwitchStatement",y((St=["discriminant",Ar],xt=[].slice.call(St,1),y(Lr("discriminant"),b(xt),Nr)),(Tt=["cases",Ar],Nt=[].slice.call(Tt,1),y(Lr("cases"),b(Nt),Nr)),xr(p.switchStatement))),Wr("ReturnStatement",y((Ct=["argument",Ar],kt=[].slice.call(Ct,1),y(Lr("argument"),b(kt),Nr)),xr(p.returnStatement))),Wr("ThrowStatement",y((Lt=["argument",Ar],At=[].slice.call(Lt,1),y(Lr("argument"),b(At),Nr)),xr(p.throwStatement))),Wr("BreakStatement",xr(p.breakStatement)),Wr("ContinueStatement",xr(p.continueStatement)),Wr("TryStatement",y((Ot=["block",Ar],Mt=[].slice.call(Ot,1),y(Lr("block"),b(Mt),Nr)),(_t=["handler",Ar],Dt=[].slice.call(_t,1),y(Lr("handler"),b(Dt),Nr)),(Pt=["finalizer",Ar],Ht=[].slice.call(Pt,1),y(Lr("finalizer"),b(Ht),Nr)),xr(p.tryStatement))),Wr("WhileStatement",y((Bt=["test",Ar],jt=[].slice.call(Bt,1),y(Lr("test"),b(jt),Nr)),(Ft=["body",Ar],It=[].slice.call(Ft,1),y(Lr("body"),b(It),Nr)),xr(p.whileStatement))),Wr("DoWhileStatement",y((qt=["body",Ar],Rt=[].slice.call(qt,1),y(Lr("body"),b(Rt),Nr)),(Ut=["test",Ar],zt=[].slice.call(Ut,1),y(Lr("test"),b(zt),Nr)),xr(p.doWhileStatement))),Wr("ForStatement",y((Wt=["init",Ar],Xt=[].slice.call(Wt,1),y(Lr("init"),b(Xt),Nr)),(Vt=["test",Ar],$t=[].slice.call(Vt,1),y(Lr("test"),b($t),Nr)),(Jt=["update",Ar],Kt=[].slice.call(Jt,1),y(Lr("update"),b(Kt),Nr)),(Qt=["body",Ar],Gt=[].slice.call(Qt,1),y(Lr("body"),b(Gt),Nr)),xr(p.forStatement))),Wr("AssignmentExpression",y((Yt=["left",Ar],Zt=[].slice.call(Yt,1),y(Lr("left"),b(Zt),Nr)),(en=["right",Ar],tn=[].slice.call(en,1),y(Lr("right"),b(tn),Nr)),xr(p.assignmentExpression))),Wr("UnaryExpression",y((nn=["argument",Ar],rn=[].slice.call(nn,1),y(Lr("argument"),b(rn),Nr)),xr(p.unaryExpression))),Wr("BinaryExpression",y((sn=["operator",Ar],on=[].slice.call(sn,1),y(Lr("operator"),b(on),Nr)),(un=["left",Ar],an=[].slice.call(un,1),y(Lr("left"),b(an),Nr)),(fn=["right",Ar],ln=[].slice.call(fn,1),y(Lr("right"),b(ln),Nr)),xr(p.binaryExpression))),Wr("ConditionalExpression",y((cn=["test",Ar],hn=[].slice.call(cn,1),y(Lr("test"),b(hn),Nr)),(pn=["consequent",Ar],dn=[].slice.call(pn,1),y(Lr("consequent"),b(dn),Nr)),(vn=["alternate",Ar],mn=[].slice.call(vn,1),y(Lr("alternate"),b(mn),Nr)),xr(p.conditionalExpression))),Wr("NewExpression",y((gn=["callee",Ar],yn=[].slice.call(gn,1),y(Lr("callee"),b(yn),Nr)),(bn=["args",Ar],wn=[].slice.call(bn,1),y(Lr("args"),b(wn),Nr)),xr(p.newExpression))),Wr("CallExpression",y((En=["callee",Ar],Sn=[].slice.call(En,1),y(Lr("callee"),b(Sn),Nr)),(xn=["args",Ar],Tn=[].slice.call(xn,1),y(Lr("args"),b(Tn),Nr)),xr(p.callExpression))),Wr("MemberExpression",y((Nn=["object",Ar],Cn=[].slice.call(Nn,1),y(Lr("object"),b(Cn),Nr)),(kn=["property",Ar],Ln=[].slice.call(kn,1),y(Lr("property"),b(Ln),Nr)),xr(p.memberExpression))),Wr("LetExpression",y((An=["bindings",Ar],On=[].slice.call(An,1),y(Lr("bindings"),b(On),Nr)),Sr(function(e){return Ur(e.bindings)}),(Mn=["body",Ar],_n=[].slice.call(Mn,1),y(Lr("body"),b(_n),Nr)),xr(p.letExpression))),Wr("CurryExpression",y((Dn=["base",Ar],Pn=[].slice.call(Dn,1),y(Lr("base"),b(Pn),Nr)),(Hn=["args",Ar],Bn=[].slice.call(Hn,1),y(Lr("args"),b(Bn),Nr)),xr(p.curryExpression))),Wr("FunctionExpression",(zn=[(jn=["id",Ar],Fn=[].slice.call(jn,1),y(Lr("id"),b(Fn),Nr)),xr(function(e){return p.functionExpression(e.loc,e.id,e.params,e.body,S("prefix",e))}),(In=["params",Ar],qn=[].slice.call(In,1),y(Lr("params"),b(qn),Nr)),(Rn=["body",Ar],Un=[].slice.call(Rn,1),y(Lr("body"),b(Un),Nr)),xr(p.functionExpressionPost)],y(Br,b(zn),jr))),Wr("ArrayExpression",y((Wn=["elements",Ar],Xn=[].slice.call(Wn,1),y(Lr("elements"),b(Xn),Nr)),xr(p.arrayExpression))),Wr("ObjectExpression",y((Vn=["properties",Ar],$n=[].slice.call(Vn,1),y(Lr("properties"),b($n),Nr)),xr(p.objectExpression))),Wr("ObjectValue",y((Jn=["key",Ar],Kn=[].slice.call(Jn,1),y(Lr("key"),b(Kn),Nr)),(Qn=["value",Ar],Gn=[].slice.call(Qn,1),y(Lr("value"),b(Gn),Nr)),xr(p.objectValue))),Wr("IdentifierPattern",y((Yn=["id",Ar],Zn=[].slice.call(Yn,1),y(Lr("id"),b(Zn),Nr)),xr(function(e){return e.id}))),Wr(["RelativeUnpack","SliceUnpack"],(er=["target",Ar],tr=[].slice.call(er,1),y(Lr("target"),b(tr),Nr))),Wr("ArgumentsPattern",y((nr=["id",Ar],rr=[].slice.call(nr,1),y(Lr("id"),b(rr),Nr)),(ir=["elements",Ar],sr=[].slice.call(ir,1),y(Lr("elements"),b(sr),Nr)),(or=["self",Ar],ur=[].slice.call(or,1),y(Lr("self"),b(ur),Nr)))),Wr("Program",y(Ir,xr(function(e){return E(e.body)==="Package"?e:x("prefix",p.useStrict,e)}),(ar=["body",Ar],fr=[].slice.call(ar,1),y(Lr("body"),b(fr),Nr)),Rr(function(e){return xr(p.program.bind(null,e))}))),Wr("Package",y(Dr.chain(function(e){return xr(p.packageBlock.bind(null,e))}),Ar)),Wr("Import",Dr.chain(function(e){var t;return xr((t=e.importPackage,function(e){return t(e.from)}))})),Wr("Identifier",Sr(function(e){var t,n,r;return T(e)?y((t=e.name,n=T(e),Hr(a.addVar.bind(null,t,n))),(r=T(e),Pr(a.getMapping.bind(null,r))).chain(function(t){return Tr(p.identifier(e.loc,t,T(e)))})):Tr(p.identifier(e.loc,e.name))}));var Xr=(lr=function(e,t,n){return t===n.length-1?Ar:y(Ar,kr)},function(e){return e.length?y(Cr,b(A(lr,e)),Nr):yr});vr=function(e){return Array.isArray(e)?Xr(e):zr[E(e)]||yr};var Vr=y((cr=T(O.require),hr=a.addVar.bind(null,"require",cr),Mr(function(e){return e.setScope(hr(e.scope))})),(pr=T(O.exports),dr=a.addVar.bind(null,"exports",pr),Mr(function(e){return e.setScope(dr(e.scope))})),Ar,Er.map(w)),$r=function(t){var n=e("./package_manager/amd"),r=e("./package_manager/node");return t==="node"?r:n};m=function(e,t){var n=$r(t),r=_.empty.setPackageManager(n);return gr(Vr,r,e)},t.transform=m}),define("khepri-compile/stages/transform",["require","exports","akh/error","bes/object","../transform/transform"],function(e,t,n,r,i){var s,o=r.setProperty;return s=function(e){var t=e.options,r=e.tree,s=e.data;return n.of(o(e,"tree",i.transform(r,t.package_manager||"amd",s)))},s}),define("khepri-compile/ecma_peep",["require","exports","ecma-ast/node","./ast","./fun","./rewriter"],function(e,t,n,r,i,s){var o,u=n.modify,a=r.type,f=i.concat,l=i.flatten,c=i.map,h=i.foldr,p=s.UP,d=s.DOWN,v=s.Rewriter,m=s.rewrite,g,y=(g=c.bind(null,function(e){return!e||a(e)==="EmptyStatement"?[]:a(e)==="BlockStatement"?e.body:e}),function(e){return l(g(e))}),b=h.bind(null,function(e,t){return a(t)==="VariableDeclaration"&&a(e[0])==="VariableDeclaration"?f(u(t,{declarations:f(t.declarations,e[0].declarations)}),e.slice(1)):f(t,e)},[]),w=new v,E=function(e){return!0};w.add("VariableDeclaration",d,E,function(e){var t=e.declarations.filter(function(e){return!!e});return u(e,{declarations:t})}),w.add("VariableDeclaration",p,function(e){return!e.declarations.length},function(e){return null}),w.add(["Program","BlockStatement"],p,E,function(e){return u(e,{body:y(e.body)})}),w.add(["Program","BlockStatement"],p,E,function(e){return u(e,{body:b(e.body)})}),o=m.bind(null,w),t.optimize=o}),define("khepri-compile/stages/ecma_peep",["require","exports","akh/error","bes/object","neith/tree","../ecma_peep"],function(e,t,n,r,i,s){var o,u=r.setProperty,a=i.node;return o=function(e){var t=e.tree;return n.of(u(e,"tree",a(s.optimize(t))))},o}),define("khepri-compile/compile",["require","exports","akh/error","khepri-ast-zipper","./stages/pre_normalize","./stages/lexical","./stages/reachable","./stages/post_normalize","./stages/inline","./stages/khepri_peep","./stages/transform","./stages/ecma_peep"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h,p=r.khepriZipper,d=function(e){var t=e.tree;return t},v=function(e){throw e};return h=function(e,t,r){var h;return n.runError((h={tree:p(e),options:t||{}},i(h).chain(s).chain(u).chain(a).chain(o).chain(f).chain(l).chain(c)),d,r||v)},h}),define("ecma-ast/token",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s,o,u,a,f,l,c,h,p,d,v,m;s=function(e,t){var n=this;r.call(n,e),n.value=t},s.prototype=new r,o=i(s,"String",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),u=i(s,"Number",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),a=i(s,"RegularExpression",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),f=i(s,"Boolean",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),l=i(s,"Null",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),c=i(s,"Identifier",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),h=i(s,"Keyword",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),p=i(s,"Punctuator",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),d=i(s,"Comment",[],["value","multiline","linebreak"],function(e,t,n,r){var i=this;s.call(i,e,t),i.multiline=!!n,i.linebreak=!!r}),v=i(s,"Whitespace",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),m=i(s,"LineTerminator",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),t.Token=s,t.StringToken=o,t.NumberToken=u,t.RegularExpressionToken=a,t.BooleanToken=f,t.NullToken=l,t.IdentifierToken=c,t.KeywordToken=h,t.PunctuatorToken=p,t.CommentToken=d,t.WhitespaceToken=v,t.LineTerminatorToken=m}),define("ecma-unparse/unparse",["require","exports","nu-stream/stream","ecma-ast/token","ecma-ast/node"],function(e,t,n,r,i){var s=n.NIL,o,u=Array.prototype.slice,a=function(e,t){return e.length===0?s:e.length===1?e[0]:n.append(e[0],n.cons(t,a(e.slice(1),t)))},f=function(e,t){return e.length===0?s:e.length===1?e[0]:n.append(e[0],n.append(t,f(e.slice(1),t)))},l=function(e){return new r.KeywordToken(null,e)},c=function(e){return new r.LineTerminatorToken(null,e)},h=function(e){return new r.PunctuatorToken(null,e)},p=function(e){return new r.WhitespaceToken(null,e)},d=c("\n"),v=p(" "),m=function(){var e=arguments;if(e.length===0)return s;var t=e[0],r=m.apply(undefined,u.call(e,1));return t===undefined||n.isEmpty(t)?r:n.isStream(t)?n.append(t,r):n.cons(t,r)},g=function(){var e=arguments;return m(m.apply(undefined,e),d)},y=function(){var e=arguments;return m.apply(undefined,e)},b=function(){var e=arguments;return m.apply(undefined,e)},w=function(){var e=arguments;return m(m.apply(undefined,e),d)},E=function(){var e=arguments;return m.apply(undefined,e)},S=function(e){return E(new r.IdentifierToken(null,e))},x=function(e){return E(new r.StringToken(null,e))},T=function(e){return E(new r.NumberToken(null,e))},N=function(e){return E(new r.NullToken(null,e))},C=function(e){return E(new r.BooleanToken(null,e))},k=function(e){return E(new r.RegularExpressionToken(null,e))},L=function(e){return m.apply(undefined,e)},A=function(e){return g(l("var"),v,a(e,h(",")),h(";"))},O=function(e,t){return b(e,t?m(v,h("="),v,t):s)},M=function(e,t,n){return y(h("("),l("function"),e?m(v,e):s,h("("),f(t,m(h(","),v)),h(")"),v,n,h(")"))},_=function(e,t,n){return b(l("function"),v,h("("),f(t,m(h(","),v)),h(")"),v,n)},D=function(e,t){return m(e?m(l("case"),v,e):l("default"),h(":"),d,m.apply(undefined,t))},P=function(e,t){return m(l("catch"),h("("),e,h(")"),t)},H=function(){return g(h(";"))},B=function(){return g(l("debugger"),h(";"))},j=function(e){return g(h("{"),d,m.apply(undefined,e),h("}"))},F=function(e){return g(e,h(";"))},I=function(e,t,n){return g(l("if"),v,h("("),e,h(")"),t,n?m(l("else"),v,n):s)},q=function(e,t){return g(S(e),h(":"),t)},R=function(e){return g(l("break"),v,e,h(";"))},U=function(e){return g(l("continue"),v,e,h(";"))},z=function(e,t){return g(l("with"),h("("),e,h(")"),h("{"),t,h("}"))},W=function(e,t){return g(l("switch"),h("("),e,h(")"),h("{"),d,m.apply(undefined,t),h("}"))},X=function(e){return g(l("return"),v,e,h(";"))},V=function(e){return g(l("throw"),v,e,h(";"))},$=function(e,t,n){return g(l("try"),e,t?t:s,n?m(l("finally"),n):s)},J=function(e,t){return g(l("while"),h("("),e,h(")"),t)},K=function(e,t){return g(l("do"),e,l("while"),h("("),t,h(")"),h(";"))},Q=function(e,t,n,r){return g(l("for"),h("("),e,v,t,h(";"),n,h(")"),r)},G=function(e,t,n,r){return g(l("for"),h("("),e,h(";"),t,h(";"),n,h(")"),r)},Y=function(e,t){return g(l("for"),h("("),i.left,h("in"),i.right,h(")"),i.body)},Z=function(){return y(l("this"))},et=function(e){return y(h("("),a(e,h(",")),h(")"))},tt=function(e,t){return y(h("("),e,v,t,h(")"))},nt=function(e,t,n){return y(h("("),t,v,e,v,n,h(")"))},rt=function(e,t,n){return n?y(e,t):y(t,e)},it=function(e,t,n){return y(h("("),e,v,h("?"),v,t,v,h(":"),v,n,h(")"))},st=function(e,t){return y(l("new"),v,h("("),e,h(")"),t?m(h("("),f(t,m(h(","),v)),h(")")):s)},ot=function(e,t){return y(e,h("("),f(t,m(h(","),v)),h(")"))},ut=function(e,t,n){return n?y(e,h("["),t,h("]")):y(e,h("."),t)},at=function(e){return y(h("["),f(e,m(h(","),v)),h("]"))},ft=function(e){return y(h("("),h("{"),e&&e.length?m(d,f(e,m(h(","),d)),d):s,h("}"),h(")"))},lt=function(e,t){return m(S("get"),v,e,h("("),h(")"),v,t)},ct=function(e,t,n){return m(S("set"),v,e,h("("),m.apply(undefined,t),h(")"),v,n)},ht=function(e,t){return m(e,h(":"),v,t)},pt=function(e){if(!e)return s;switch(e.type){case"SwitchCase":return D(e.test?pt(e.test):null,e.consequent.map(pt));case"CatchClause":return P(pt(e.param),pt(e.body));case"EmptyStatement":return H();case"DebuggerStatement":return B();case"BlockStatement":return j(e.body.map(pt));case"ExpressionStatement":return F(pt(e.expression));case"IfStatement":return I(pt(e.test),pt(e.consequent),e.alternate?pt(e.alternate):null);case"LabeledStatement":return q(pt(e.label),pt(e.body));case"BreakStatement":return R(pt(e.label));case"ContinueStatement":return U(pt(e.label));case"WithStatement":return z(pt(e.object),pt(e.body));case"SwitchStatement":return W(pt(e.discriminant),e.cases.map(pt));case"ReturnStatement":return X(pt(e.argument));case"ThrowStatement":return V(pt(e.argument));case"TryStatement":return $(pt(e.block),e.handler?pt(e.handler):null,e.finalizer?pt(e.finalizer):null);case"WhileStatement":return J(pt(e.test),pt(e.body));case"DoWhileStatement":return K(pt(e.body),pt(e.test));case"ForStatement":var t=e.init?pt(e.init):null,n=e.test?pt(e.test):null,r=e.update?pt(e.update):null,i=pt(e.body);return e.init&&e.init.type==="VariableDeclaration"?Q(t,n,r,i):G(t,n,r,i);case"ForInStatement":return Y(pt(e.left),pt(e.right),pt(e.body));case"ThisExpression":return Z();case"SequenceExpression":return et(e.expressions.map(pt));case"UnaryExpression":return tt(h(e.operator),pt(e.argument));case"BinaryExpression":case"LogicalExpression":case"AssignmentExpression":return nt(h(e.operator),pt(e.left),pt(e.right));case"UpdateExpression":return rt(h(e.operator),pt(e.argument),e.prefix);case"ConditionalExpression":return it(pt(e.test),pt(e.consequent),pt(e.alternate));case"NewExpression":return st(pt(e.callee),e.args?e.args.map(pt):null);case"CallExpression":return ot(pt(e.callee),e.args.map(pt));case"MemberExpression":return ut(pt(e.object),pt(e.property),e.computed);case"ArrayExpression":return at(e.elements.map(pt));case"ObjectExpression":return ft(e.properties.map(pt));case"ObjectValue":return ht(pt(e.key),pt(e.value));case"ObjectGetter":return lt(pt(e.key),pt(e.value.body));case"ObjectSetter":return ct(pt(e.key),e.value.params.map(pt),pt(e.value.body));case"FunctionExpression":return M(e.id?pt(e.id):null,e.params.map(pt),pt(e.body));case"FunctionDeclaration":return _(pt(e.id),e.params.map(pt),pt(e.body));case"Program":return L(e.body.map(pt));case"VariableDeclaration":return A(e.declarations.map(pt));case"VariableDeclarator":return O(pt(e.id),e.init?pt(e.init):null);case"Identifier":return S(e.name);case"Literal":switch(e.kind){case"string":return x(e.value);case"number":return T(e.value);case"null":return N(e.value);case"boolean":return C(e.value);case"regexp":return k(e.value);default:return s};default:return s}};o=pt,t.unparse=o}),function(){function e(e,n){var r=new t(e,n);return r.beautify()}function t(e,t){function A(e,t){var n=0;e&&(n=e.indentation_level,n+=e.var_line&&e.var_line_reindented?1:0,!H()&&e.line_indent_level>n&&(n=e.line_indent_level));var i={mode:t,parent:e,last_text:e?e.last_text:"",last_word:e?e.last_word:"",var_line:!1,var_line_tainted:!1,var_line_reindented:!1,in_html_comment:!1,multiline_frame:!1,if_block:!1,do_block:!1,do_while:!1,in_case_statement:!1,in_case:!1,case_body:!1,indentation_level:n,line_indent_level:e?e.line_indent_level:n,start_line_index:r.length,ternary_depth:0};return i}function O(){return{text:[]}}function M(e){e=e===undefined?!1:e;if(r.length){_(r[r.length-1],e);while(e&&r.length>1&&r[r.length-1].text.length===0)r.pop(),_(r[r.length-1],e)}}function _(e){while(e.text.length&&(e.text[e.text.length-1]===" "||e.text[e.text.length-1]===a||e.text[e.text.length-1]===L))e.text.pop()}function D(e){return e.replace(/^\s+|\s+$/g,"")}function P(e){e=e.replace(/\x0d/g,"");var t=[],n=e.indexOf("\n");while(n!==-1)t.push(e.substring(0,n)),e=e.substring(n+1),n=e.indexOf("\n");return e.length&&t.push(e),t}function H(){var e=r[r.length-1];return e.text.length===0}function B(){if(H()){if(r.length===1)return!0;var e=r[r.length-2];return e.text.length===0}return!1}function j(e){e=e===undefined?!1:e;if(k.wrap_line_length&&!e){var t=r[r.length-1],n=0;t.text.length>0&&(n=t.text.join("").length+i.length+(E?1:0),n>=k.wrap_line_length&&(e=!0))}(k.preserve_newlines&&b||e)&&!H()&&(F(!1,!0),!$(f.mode)&&!J(f.mode)&&(w=!0))}function F(e,t){w=!1,E=!1;if(!t&&f.last_text!==";")while(f.mode===C.Statement&&!f.if_block&&!f.do_block)K();if(r.length===1&&H())return;if(e||!H())f.multiline_frame=!0,r.push(O())}function I(){if(H()){var e=r[r.length-1];if(k.keep_array_indentation&&$(f.mode)&&b){e.text.push("");for(var t=0;t<T.length;t+=1)e.text.push(T[t])}else L&&e.text.push(L),q(f.indentation_level+(f.var_line&&f.var_line_reindented?1:0)+(w?1:0))}}function q(e){if(r.length>1){var t=r[r.length-1];f.line_indent_level=e;for(var n=0;n<e;n+=1)t.text.push(a)}}function R(){var e=r[r.length-1];if(E&&e.text.length){var t=e.text[e.text.length-1];t!==" "&&t!==a&&e.text.push(" ")}}function U(e){e=e||i,I(),w=!1,R(),E=!1,r[r.length-1].text.push(e)}function z(){f.indentation_level+=1}function W(){f.indentation_level>0&&(!f.parent||f.indentation_level>f.parent.indentation_level)&&(f.indentation_level-=1)}function X(e){if(e.multiline_frame)return;var t=e.start_line_index,n=0,i;while(t<r.length){i=r[t],t++;if(i.text.length===0)continue;L&&i.text[0]===L?n=1:n=0,i.text[n]===a&&i.text.splice(n,1)}}function V(e){f?(c.push(f),l=f):l=A(null,e),f=A(l,e)}function $(e){return e===C.ArrayLiteral}function J(e){return et(e,[C.Expression,C.ForInitializer,C.Conditional])}function K(){c.length>0&&(l=f,f=c.pop())}function Q(){return f.mode===C.ObjectLiteral&&f.last_text===":"&&f.ternary_depth===0}function G(){return f.last_text==="do"||f.last_text==="else"&&i!=="if"||o==="TK_END_EXPR"&&(l.mode===C.ForInitializer||l.mode===C.Conditional)?(j(et(i,["do","for","if","while"])),V(C.Statement),H()&&(z(),w=!1),!0):!1}function Y(e,t){for(var n=0;n<e.length;n++){var r=D(e[n]);if(r.charAt(0)!==t)return!1}return!0}function Z(e){return et(e,["case","return","do","if","throw","else"])}function et(e,t){for(var n=0;n<t.length;n+=1)if(t[n]===e)return!0;return!1}function tt(e){var t=!1,n="",r=0,i="",s=0,o;while(t||r<e.length){o=e.charAt(r),r++;if(t){t=!1;if(o==="x")i=e.substr(r,2),r+=2;else{if(o!=="u"){n+="\\"+o;continue}i=e.substr(r,4),r+=4}if(!i.match(/^[0123456789abcdefABCDEF]+$/))return e;s=parseInt(i,16);if(s>=0&&s<32){o==="x"?n+="\\x"+i:n+="\\u"+i;continue}if(s===34||s===39||s===92)n+="\\"+String.fromCharCode(s);else{if(o==="x"&&s>126&&s<=255)return e;n+=String.fromCharCode(s)}}else o==="\\"?t=!0:n+=o}return n}function nt(e){var t=v,r=n.charAt(t);while(et(r,h)&&r!==e){t++;if(t>=S)return!1;r=n.charAt(t)}return r===e}function rt(){var e,t;x=0;if(v>=S)return["","TK_EOF"];b=!1,T=[];var i=n.charAt(v);v+=1;while(et(i,h)){i==="\n"?(x+=1,T=[]):x&&(i===a?T.push(a):i!=="\r"&&T.push(" "));if(v>=S)return["","TK_EOF"];i=n.charAt(v),v+=1}if(et(i,p)){if(v<S)while(et(n.charAt(v),p)){i+=n.charAt(v),v+=1;if(v===S)break}if(v===S||!i.match(/^[0-9]+[Ee]$/)||n.charAt(v)!=="-"&&n.charAt(v)!=="+")return i==="in"?[i,"TK_OPERATOR"]:[i,"TK_WORD"];var s=n.charAt(v);v+=1;var u=rt();return i+=s+u[0],[i,"TK_WORD"]}if(i==="("||i==="[")return[i,"TK_START_EXPR"];if(i===")"||i==="]")return[i,"TK_END_EXPR"];if(i==="{")return[i,"TK_START_BLOCK"];if(i==="}")return[i,"TK_END_BLOCK"];if(i===";")return[i,"TK_SEMICOLON"];if(i==="/"){var c="",m=!0;if(n.charAt(v)==="*"){v+=1;if(v<S)while(v<S&&(n.charAt(v)!=="*"||!n.charAt(v+1)||n.charAt(v+1)!=="/")){i=n.charAt(v),c+=i;if(i==="\n"||i==="\r")m=!1;v+=1;if(v>=S)break}return v+=2,m&&x===0?["/*"+c+"*/","TK_INLINE_COMMENT"]:["/*"+c+"*/","TK_BLOCK_COMMENT"]}if(n.charAt(v)==="/"){c=i;while(n.charAt(v)!=="\r"&&n.charAt(v)!=="\n"){c+=n.charAt(v),v+=1;if(v>=S)break}return[c,"TK_COMMENT"]}}if(i==="'"||i==='"'||(i==="/"||k.e4x&&i==="<"&&n.slice(v-1).match(/^<([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*\/?\s*>/))&&(o==="TK_WORD"&&Z(f.last_text)||o==="TK_END_EXPR"&&et(l.mode,[C.Conditional,C.ForInitializer])||et(o,["TK_COMMENT","TK_START_EXPR","TK_START_BLOCK","TK_END_BLOCK","TK_OPERATOR","TK_EQUALS","TK_EOF","TK_SEMICOLON","TK_COMMA"]))){var y=i,w=!1,E=!1;t=i;if(v<S)if(y==="/"){var N=!1;while(w||N||n.charAt(v)!==y){t+=n.charAt(v),w?w=!1:(w=n.charAt(v)==="\\",n.charAt(v)==="["?N=!0:n.charAt(v)==="]"&&(N=!1)),v+=1;if(v>=S)return[t,"TK_STRING"]}}else if(k.e4x&&y==="<"){var L=/<(\/?)([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*(\/?)\s*>/g,A=n.slice(v-1),O=L.exec(A);if(O&&O.index===0){var M=O[2],_=0;while(O){var P=!!O[1],H=O[2],B=!!O[O.length-1]||H.slice(0,8)==="![CDATA[";H===M&&!B&&(P?--_:++_);if(_<=0)break;O=L.exec(A)}var j=O?O.index+O[0].length:A.length;return v+=j-1,[A.slice(0,j),"TK_STRING"]}}else while(w||n.charAt(v)!==y){t+=n.charAt(v);if(w){if(n.charAt(v)==="x"||n.charAt(v)==="u")E=!0;w=!1}else w=n.charAt(v)==="\\";v+=1;if(v>=S)return[t,"TK_STRING"]}v+=1,t+=y,E&&k.unescape_strings&&(t=tt(t));if(y==="/")while(v<S&&et(n.charAt(v),p))t+=n.charAt(v),v+=1;return[t,"TK_STRING"]}if(i==="#"){if(r.length===1&&r[0].text.length===0&&n.charAt(v)==="!"){t=i;while(v<S&&i!=="\n")i=n.charAt(v),t+=i,v+=1;return[D(t)+"\n","TK_UNKNOWN"]}var F="#";if(v<S&&et(n.charAt(v),g)){do i=n.charAt(v),F+=i,v+=1;while(v<S&&i!=="#"&&i!=="=");return i!=="#"&&(n.charAt(v)==="["&&n.charAt(v+1)==="]"?(F+="[]",v+=2):n.charAt(v)==="{"&&n.charAt(v+1)==="}"&&(F+="{}",v+=2)),[F,"TK_WORD"]}}if(i==="<"&&n.substring(v-1,v+3)==="<!--"){v+=3,i="<!--";while(n.charAt(v)!=="\n"&&v<S)i+=n.charAt(v),v++;return f.in_html_comment=!0,[i,"TK_COMMENT"]}if(i==="-"&&f.in_html_comment&&n.substring(v-1,v+2)==="-->")return f.in_html_comment=!1,v+=2,["-->","TK_COMMENT"];if(i===".")return[i,"TK_DOT"];if(et(i,d)){while(v<S&&et(i+n.charAt(v),d)){i+=n.charAt(v),v+=1;if(v>=S)break}return i===","?[i,"TK_COMMA"]:i==="="?[i,"TK_EQUALS"]:[i,"TK_OPERATOR"]}return[i,"TK_UNKNOWN"]}function it(){G();var e=C.Expression;if(i==="["){if(o==="TK_WORD"||f.last_text===")"){et(f.last_text,m)&&(E=!0),V(e),U(),z(),k.space_in_paren&&(E=!0);return}e=C.ArrayLiteral,$(f.mode)&&(f.last_text==="["||f.last_text===","&&(u==="]"||u==="}"))&&(k.keep_array_indentation||F())}else f.last_text==="for"?e=C.ForInitializer:et(f.last_text,["if","while"])&&(e=C.Conditional);f.last_text===";"||o==="TK_START_BLOCK"?F():o==="TK_END_EXPR"||o==="TK_START_EXPR"||o==="TK_END_BLOCK"||f.last_text==="."?(j(b),w=!1):o!=="TK_WORD"&&o!=="TK_OPERATOR"?E=!0:f.last_word==="function"||f.last_word==="typeof"?k.jslint_happy&&(E=!0):(et(f.last_text,m)||f.last_text==="catch")&&k.space_before_conditional&&(E=!0),i==="("&&(o==="TK_EQUALS"||o==="TK_OPERATOR")&&(Q()||j()),V(e),U(),k.space_in_paren&&(E=!0),z()}function st(){while(f.mode===C.Statement)K();i==="]"&&$(f.mode)&&f.multiline_frame&&!k.keep_array_indentation&&F(),f.multiline_frame&&j(),k.space_in_paren&&(o==="TK_START_EXPR"?(M(),E=!1):E=!0),i==="]"&&k.keep_array_indentation?(U(),K()):(K(),U()),X(l),f.do_while&&l.mode===C.Conditional&&(l.mode=C.Expression,f.do_block=!1,f.do_while=!1)}function ot(){V(C.BlockStatement);var e=nt("}"),t=e&&f.last_word==="function"&&o==="TK_END_EXPR";k.brace_style==="expand"?o!=="TK_OPERATOR"&&(t||o==="TK_EQUALS"||Z(f.last_text)&&f.last_text!=="else")?E=!0:F():o!=="TK_OPERATOR"&&o!=="TK_START_EXPR"?o==="TK_START_BLOCK"?F():E=!0:$(l.mode)&&f.last_text===","&&(u==="}"?E=!0:F()),U(),z()}function ut(){while(f.mode===C.Statement)K();var e=o==="TK_START_BLOCK";k.brace_style==="expand"?e||F():e||($(f.mode)&&k.keep_array_indentation?(k.keep_array_indentation=!1,F(),k.keep_array_indentation=!0):F()),K(),U()}function at(){G()||b&&!J(f.mode)&&(o!=="TK_OPERATOR"||f.last_text==="--"||f.last_text==="++")&&o!=="TK_EQUALS"&&(k.preserve_newlines||f.last_text!=="var")&&F();if(f.do_block&&!f.do_while){if(i==="while"){E=!0,U(),E=!0,f.do_while=!0;return}F(),f.do_block=!1}if(f.if_block&&i!=="else"){while(f.mode===C.Statement)K();f.if_block=!1}if(i==="case"||i==="default"&&f.in_case_statement){F();if(f.case_body||k.jslint_happy)W(),f.case_body=!1;U(),f.in_case=!0,f.in_case_statement=!0;return}i==="function"&&(f.var_line&&o!=="TK_EQUALS"&&(f.var_line_reindented=!0),(H()||f.last_text===";"||f.last_text==="}")&&f.last_text!=="{"&&!$(f.mode)&&(B()||(F(),F(!0))),o==="TK_WORD"?f.last_text==="get"||f.last_text==="set"||f.last_text==="new"||f.last_text==="return"?E=!0:F():o==="TK_OPERATOR"||f.last_text==="="?E=!0:J(f.mode)||F());if(o==="TK_COMMA"||o==="TK_START_EXPR"||o==="TK_EQUALS"||o==="TK_OPERATOR")Q()||j();if(i==="function"){U(),f.last_word=i;return}y="NONE",o==="TK_END_BLOCK"?et(i,["else","catch","finally"])?k.brace_style==="expand"||k.brace_style==="end-expand"?y="NEWLINE":(y="SPACE",E=!0):y="NEWLINE":o==="TK_SEMICOLON"&&f.mode===C.BlockStatement?y="NEWLINE":o==="TK_SEMICOLON"&&J(f.mode)?y="SPACE":o==="TK_STRING"?y="NEWLINE":o==="TK_WORD"?y="SPACE":o==="TK_START_BLOCK"?y="NEWLINE":o==="TK_END_EXPR"&&(E=!0,y="NEWLINE"),et(i,m)&&f.last_text!==")"&&(f.last_text==="else"?y="SPACE":y="NEWLINE");if(et(i,["else","catch","finally"]))if(o!=="TK_END_BLOCK"||k.brace_style==="expand"||k.brace_style==="end-expand")F();else{M(!0);var e=r[r.length-1];e.text[e.text.length-1]!=="}"&&F(),E=!0}else y==="NEWLINE"?Z(f.last_text)?E=!0:o!=="TK_END_EXPR"?(o!=="TK_START_EXPR"||i!=="var")&&f.last_text!==":"&&(i==="if"&&f.last_word==="else"&&f.last_text!=="{"?E=!0:(f.var_line=!1,f.var_line_reindented=!1,F())):et(i,m)&&f.last_text!==")"&&(f.var_line=!1,f.var_line_reindented=!1,F()):$(f.mode)&&f.last_text===","&&u==="}"?F():y==="SPACE"&&(E=!0);U(),f.last_word=i,i==="var"&&(f.var_line=!0,f.var_line_reindented=!1,f.var_line_tainted=!1),i==="do"&&(f.do_block=!0),i==="if"&&(f.if_block=!0)}function ft(){G()&&(E=!1);while(f.mode===C.Statement&&!f.if_block&&!f.do_block)K();U(),f.var_line=!1,f.var_line_reindented=!1,f.mode===C.ObjectLiteral&&(f.mode=C.BlockStatement)}function lt(){G()?E=!0:o==="TK_WORD"?E=!0:o==="TK_COMMA"||o==="TK_START_EXPR"||o==="TK_EQUALS"||o==="TK_OPERATOR"?Q()||j():F(),U()}function ct(){f.var_line&&(f.var_line_tainted=!0),E=!0,U(),E=!0}function ht(){if(f.var_line){if(J(f.mode)||o==="TK_END_BLOCK")f.var_line_tainted=!1;f.var_line&&(f.var_line_reindented=!0),U(),f.var_line_tainted?(f.var_line_tainted=!1,F()):E=!0;return}o==="TK_END_BLOCK"&&f.mode!==C.Expression?(U(),f.mode===C.ObjectLiteral&&f.last_text==="}"?F():E=!0):f.mode===C.ObjectLiteral?(U(),F()):(U(),E=!0)}function pt(){var e=!0,t=!0;if(Z(f.last_text)){E=!0,U();return}if(i==="*"&&o==="TK_DOT"&&!u.match(/^\d+$/)){U();return}if(i===":"&&f.in_case){f.case_body=!0,z(),U(),F(),f.in_case=!1;return}if(i==="::"){U();return}b&&(i==="--"||i==="++")&&F(),et(i,["--","++","!"])||et(i,["-","+"])&&(et(o,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||et(f.last_text,m)||f.last_text===",")?(e=!1,t=!1,f.last_text===";"&&J(f.mode)&&(e=!0),o==="TK_WORD"&&et(f.last_text,m)&&(e=!0),(f.mode===C.BlockStatement||f.mode===C.Statement)&&(f.last_text==="{"||f.last_text===";")&&F()):i===":"?f.ternary_depth===0?(f.mode===C.BlockStatement&&(f.mode=C.ObjectLiteral),e=!1):f.ternary_depth-=1:i==="?"&&(f.ternary_depth+=1),E=E||e,U(),E=t}function dt(){var e=P(i),t,n=!1;F(!1,!0),e.length>1&&Y(e.slice(1),"*")&&(n=!0),U(e[0]);for(t=1;t<e.length;t++)F(!1,!0),n?U(" "+D(e[t])):r[r.length-1].text.push(e[t]);F(!1,!0)}function vt(){E=!0,U(),E=!0}function mt(){b?F(!1,!0):M(!0),E=!0,U(),F(!1,!0)}function gt(){Z(f.last_text)?E=!0:j(f.last_text===")"&&k.break_chained_methods),U()}function yt(){U(),i[i.length-1]==="\n"&&F()}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L="";h="\n\r	 ".split(""),p="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split(""),g="0123456789".split(""),d="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::",d+=" <%= <% %> <?= <? ?>",d=d.split(" "),m="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(","),C={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",ForInitializer:"ForInitializer",Conditional:"Conditional",Expression:"Expression"},N={TK_START_EXPR:it,TK_END_EXPR:st,TK_START_BLOCK:ot,TK_END_BLOCK:ut,TK_WORD:at,TK_SEMICOLON:ft,TK_STRING:lt,TK_EQUALS:ct,TK_OPERATOR:pt,TK_COMMA:ht,TK_BLOCK_COMMENT:dt,TK_INLINE_COMMENT:vt,TK_COMMENT:mt,TK_DOT:gt,TK_UNKNOWN:yt},t=t?t:{},k={},t.space_after_anon_function!==undefined&&t.jslint_happy===undefined&&(t.jslint_happy=t.space_after_anon_function),t.braces_on_own_line!==undefined&&(k.brace_style=t.braces_on_own_line?"expand":"collapse"),k.brace_style=t.brace_style?t.brace_style:k.brace_style?k.brace_style:"collapse",k.brace_style==="expand-strict"&&(k.brace_style="expand"),k.indent_size=t.indent_size?parseInt(t.indent_size,10):4,k.indent_char=t.indent_char?t.indent_char:" ",k.preserve_newlines=t.preserve_newlines===undefined?!0:t.preserve_newlines,k.break_chained_methods=t.break_chained_methods===undefined?!1:t.break_chained_methods,k.max_preserve_newlines=t.max_preserve_newlines===undefined?0:parseInt(t.max_preserve_newlines,10),k.space_in_paren=t.space_in_paren===undefined?!1:t.space_in_paren,k.jslint_happy=t.jslint_happy===undefined?!1:t.jslint_happy,k.keep_array_indentation=t.keep_array_indentation===undefined?!1:t.keep_array_indentation,k.space_before_conditional=t.space_before_conditional===undefined?!0:t.space_before_conditional,k.unescape_strings=t.unescape_strings===undefined?!1:t.unescape_strings,k.wrap_line_length=t.wrap_line_length===undefined?0:parseInt(t.wrap_line_length,10),k.e4x=t.e4x===undefined?!1:t.e4x,t.indent_with_tabs&&(k.indent_char="	",k.indent_size=1),a="";while(k.indent_size>0)a+=k.indent_char,k.indent_size-=1;while(e&&(e.charAt(0)===" "||e.charAt(0)==="	"))L+=e.charAt(0),e=e.substring(1);n=e,S=e.length,o="TK_START_BLOCK",u="",r=[O()],w=!1,E=!1,T=[],c=[],V(C.BlockStatement),v=0,this.beautify=function(){var e,t,n,a;for(;;){e=rt(),i=e[0],s=e[1];if(s==="TK_EOF")break;n=k.keep_array_indentation&&$(f.mode),b=x>0;if(n)for(t=0;t<x;t+=1)F(t>0);else{k.max_preserve_newlines&&x>k.max_preserve_newlines&&(x=k.max_preserve_newlines);if(k.preserve_newlines&&x>1){F();for(t=1;t<x;t+=1)F(!0)}}N[s](),s!=="TK_INLINE_COMMENT"&&s!=="TK_COMMENT"&&s!=="TK_UNKNOWN"&&(u=f.last_text,o=s,f.last_text=i)}a=r[0].text.join("");for(var l=1;l<r.length;l++)a+="\n"+r[l].text.join("");return a=a.replace(/[\r\n ]+$/,""),a}}typeof define=="function"?typeof define.amd=="undefined"?define("ecma-unparse/beautify",["require","exports","module"],function(t,n,r){n.js_beautify=e}):define("ecma-unparse/beautify",[],function(){return e}):typeof exports!="undefined"?exports.js_beautify=e:typeof window!="undefined"?window.js_beautify=e:typeof global!="undefined"&&(global.js_beautify=e)}(),define("ecma-unparse/print",["require","exports","nu-stream/stream","./beautify"],function(e,t,n,r){var i=n.foldl,s=n.map,o,u=i.bind(null,function(e,t){return e+t},""),a=s.bind(null,function(e){if(!e)return"";switch(e.type){case"Null":return"null";case"Comment":return"/*"+e.value+"*/";case"String":return JSON.stringify(e.value).replace("\u2028","\\u2028").replace("\u2029","\\u2029");default:return e.value}}),f={preserve_newlines:!1,wrap_line_length:120,break_chained_methods:!0},l=r.js_beautify||r;o=function(e,t){return function(n){return e(t(n))}}(function(e){return l(e,f)},function(e,t){return function(n){return e(t(n))}}(u,a)),t.print=o}),require(["nu-stream/stream","khepri-parse/lex/lexer","khepri-parse/parse/parser","khepri-compile/compile","ecma-unparse/unparse","ecma-unparse/print"],function(e,t,n,r,i,s){var o=CodeMirror.fromTextArea(document.getElementById("khepri-console-input"),{mode:"javascript",lineNumbers:!0}),u=CodeMirror.fromTextArea(document.getElementById("javascript-console-output"),{mode:"javascript",lineNumbers:!0,readOnly:!0}),a=function(e){$("#text-out").text("");var o={package_manager:$("#package_manager").val()};try{var a=t.lex(e),f=n.parseStream(a),l=r(f,o),c=i.unparse(l),h=s.print(c);return u.doc.setValue(h),$("#text-out").removeClass("error"),h}catch(p){$("#text-out").addClass("error").text(p)}};$(function(){$("#translate-button").click(function(){a(o.doc.getValue("\n"))})})}),define("javascripts/console.js",function(){});