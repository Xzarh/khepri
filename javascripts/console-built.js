/*

  The MIT License (MIT)

  Copyright (c) 2007-2013 Einar Lielmanis and contributors.

  Permission is hereby granted, free of charge, to any person
  obtaining a copy of this software and associated documentation files
  (the "Software"), to deal in the Software without restriction,
  including without limitation the rights to use, copy, modify, merge,
  publish, distribute, sublicense, and/or sell copies of the Software,
  and to permit persons to whom the Software is furnished to do so,
  subject to the following conditions:

  The above copyright notice and this permission notice shall be
  included in all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
  MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS
  BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN
  ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
  CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.

 JS Beautifier
---------------


  Written by Einar Lielmanis, <einar@jsbeautifier.org>
      http://jsbeautifier.org/

  Originally converted to javascript by Vital, <vital76@gmail.com>
  "End braces on own line" added by Chris J. Shull, <chrisjshull@gmail.com>
  Parsing improvements for brace-less statements by Liam Newman <bitwiseman@gmail.com>


  Usage:
    js_beautify(js_source_text);
    js_beautify(js_source_text, options);

  The options are:
    indent_size (default 4)          - indentation size,
    indent_char (default space)      - character to indent with,
    preserve_newlines (default true) - whether existing line breaks should be preserved,
    max_preserve_newlines (default unlimited) - maximum number of line breaks to be preserved in one chunk,

    jslint_happy (default false) - if true, then jslint-stricter mode is enforced.

            jslint_happy   !jslint_happy
            ---------------------------------
             function ()      function()

    brace_style (default "collapse") - "collapse" | "expand" | "end-expand"
            put braces on the same line as control statements (default), or put braces on own line (Allman / ANSI style), or just put end braces on own line.

    space_before_conditional (default true) - should the space before conditional statement be added, "if(true)" vs "if (true)",

    unescape_strings (default false) - should printable characters in strings encoded in \xNN notation be unescaped, "example" vs "\x65\x78\x61\x6d\x70\x6c\x65"

    wrap_line_length (default unlimited) - lines should wrap at next opportunity after this number of characters.
          NOTE: This is not a hard limit. Lines will continue until a point where a newline would
                be preserved if it were present.

    e.g

    js_beautify(js_source_text, {
      'indent_size': 1,
      'indent_char': '\t'
    });

*/

// if (a) if (b) if(c) d(); else e(); else f();

define("nu-stream/stream",["require","exports"],function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L=Function.prototype.call.bind(Array.prototype.reduce),A=function(e){var t;return function(n){return t===undefined&&(t=e(n)),t}};n=null,r=null,i=function(e,t){return{first:e,rest:t}},s=function(e,t){var n=A(t);return{first:e,rest:n}},c=function(e){return e.first},h=function(e){return e.rest()},p=function(e){return null===e},d=function(e){return e&&e.hasOwnProperty("first")&&e.hasOwnProperty("rest")||null===e},o=function(e,t){var n=function(){return t};return{first:e,rest:n}},a=function(e,t){var n,r,i;return null===e?t():(n=e.first,r=a.bind(null,e.rest(),t),i=A(r),{first:n,rest:i})};var O=function(e,t){return a(e,function(){return t})};u=function(){var e=arguments;return L(e,O,null)},f=function(e){return null===e?e:a(e.first,f.bind(null,e.rest()))};var M=function(e,t,n){var r,i,s;return t>=n?null:(r=e[t],i=M.bind(null,e,t+1,n),s=A(i),{first:r,rest:s})};l=function(e){var t,n,r,i=e.length;return 0>=i?null:(t=e[0],n=M.bind(null,e,1,i),r=A(n),{first:t,rest:r})},x=function(e,t,n){var r,i,s;return null===t||null===n?null:(r=e(t.first,n.first),i=x.bind(null,e,t.rest(),n.rest()),s=A(i),{first:r,rest:s})},S=x.bind(null,function(e,t){return[e,t]});var _,D=function(e){var t=D.bind(null,e+1);return{first:e,rest:t}};T=S.bind(null,(_=D.bind(null,1),{first:0,rest:_})),v=function(e,t){var n,r,i;for(var s=t;n=s,null!==n;s=(r=s,r.rest()))e((i=s,i.first))},g=function(e,t,n){var r,i,s=t;for(var o=n;r=o,null!==r;o=(i=o,i.rest())){var u;s=e(s,(u=o,u.first))}return s},m=g.bind(null,function(e,t){var n=function(){return e};return{first:t,rest:n}},null),y=function(e,t,n){return g(e,t,m(n))},b=function(e,t){return g(e,t.first,t.rest())},w=function(e,t){return b(e,m(t))};var P=function(e,t){return e.push(t),e};E=function(e){return g(P,[],e)},N=function(e,t){var n,r,i;return null===t?t:(n=e(t.first),r=N.bind(null,e,t.rest()),i=A(r),{first:n,rest:i})},C=function(e,t){var n,r;for(var i=t;n=i,null!==n;i=(r=i,r.rest())){var s=i,o=s.first;if(e(o)){var u,a=C.bind(null,e,(u=i,u.rest())),f=A(a);return{first:o,rest:f}}}return null};var H=f;k=function(){return H(N.apply(null,arguments))},t.end=n,t.NIL=r,t.stream=i,t.memoStream=s,t.cons=o,t.append=u,t.appendz=a,t.concat=f,t.from=l,t.first=c,t.rest=h,t.isEmpty=p,t.isStream=d,t.forEach=v,t.reverse=m,t.foldl=g,t.foldr=y,t.reduce=b,t.reduceRight=w,t.toArray=E,t.zip=S,t.zipWith=x,t.indexed=T,t.map=N,t.filter=C,t.bind=k}),define("seshet",["require","exports"],function(e,t){var n,r,i,s,o=function(e,t){return e>t?e:t},u=function(e){return e?1+e.height:0},a=function(e){return e?o(u(e.left),u(e.right)):0},f=function(e){return e?u(e.left)-u(e.right):0},l=function(e,t,n){this.id=e,this.val=t,this.delegate=n};l.lookup=function(e,t,n){for(var r=e;r;r=r.delegate)if(t(r.id,n))return r.val;return null};var c=function(e,t,n,r,i){this.key=e,this.cell=t,this.left=n,this.right=r,this.height=i};c.setChildren=function(e,t,n){return new c(e.key,e.cell,t,n,t||n?1+o(a(t),a(n)):0)},c.setLeft=function(e,t){return c.setChildren(e,t,e.right)},c.setRight=function(e,t){return c.setChildren(e,e.left,t)},c.lookup=function(e,t,n,r,i){for(var s=e;s;){var o=t(r,s.key);if(o===0)return l.lookup(s.cell,n,i);s=o<0?s.left:s.right}return null},c.put=function(e,t,n){return new c(e.key,new l(t,n,e.cell),e.left,e.right,e.height)};var h=function(e){return e?c.setLeft(e.right,c.setRight(e,e.right.left)):e},p=function(e){return e?c.setRight(e.left,c.setLeft(e,e.left.right)):e},d=function(e){return p(c.setLeft(e,h(e.left)))},v=function(e){return h(c.setRight(e,p(e.right)))},m=function(e){var t=f(e);return t>1?f(e.left)<=-1?d(e):p(e):t<-1?f(e.right)>=1?v(e):h(e):e};c.update=function(e,t,n,r,i){if(!e)return new c(n,new l(r,i,null),null,null,0);var s=t(n,e.key);return s===0?c.put(e,r,i):m(s<0?c.setLeft(e,c.update(e.left,t,n,r,i)):c.setRight(e,c.update(e.right,t,n,r,i)))},c.rebalance=function(e){return Math.abs(f(e))<=1?e:m(c.setChildren(e,c.rebalance(e.left),c.rebalance(e.right)))},c.prune=function(e,t,n,r){if(!e)return e;if(n!==undefined){var i=t(e.key,n);if(i<0)return c.prune(e.right,t,n,r);if(i===0)return c.setChildren(e,null,c.prune(e.right,t,undefined,r))}return r!==undefined&&t(e.key,r)>=0?c.prune(e.left,t,n,r):c.setChildren(e,c.prune(e.left,t,n,r),c.prune(e.right,t,n,r))};var g=function(e,t,n){this.compare=e,this.eq=t,this.root=n};g.setRoot=function(e,t){return new g(e.compare,e.eq,t)},n=function(){var e=function(e,t){return e===t};return function(t,n){return new g(t,n||e,null)}}.call(this),r=function(e,t,n){return c.lookup(e.root,e.compare,e.eq,t,n)},i=function(e,t,n,r){return g.setRoot(e,c.update(e.root,e.compare,t,n,r))},s=function(e,t,n){return g.setRoot(e,c.rebalance(c.prune(e.root,e.compare,t,n)))},t.create=n,t.lookup=r,t.update=i,t.prune=s}),define("bennu/parse",["require","exports","nu-stream/stream","seshet"],function(e,t,n,r){var i=n.NIL,s=n.first,o=n.isEmpty,u=n.rest,a=n.foldl,f=n.reduceRight,l=n.foldr,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At=function(){var e=arguments;return e},Ot=function(e){return function(){return e}};c=function(e,t,n,r,i,s,o){var u=this;u.p=e,u.state=t,u.m=n,u.cok=r,u.cerr=i,u.eok=s,u.eerr=o},h=function(e){var t=e;while(t instanceof c)t=t.p(t.state,t.m,t.cok,t.cerr,t.eok,t.eerr);return t};var Mt=function(e,t){var n=this;n.memoer=e,n.frames=t};Mt.empty=new Mt(r.create(function(e,t){return e.compare(t)},function(e,t){return e.id===t.id&&(e.state===t.state||e.state&&e.state.eq(t.state))}),i),Mt.pushWindow=function(e,t){return new Mt(e.memoer,n.cons(t,e.frames))},Mt.popWindow=function(e){var t=e.frames,n=u(t);return new Mt(o(n)?r.prune(e.memoer,s(t)):e.memoer,n)},Mt.prune=function(e,t){return o(e.frames)?new Mt(r.prune(e.memoer,t),e.frames):e},Mt.lookup=function(e,t,n){return r.lookup(e.memoer,t,n)},Mt.update=function(e,t,n,i){return new Mt(r.update(e.memoer,t,n,i),e.frames)},w=function(e){var t=this;t.index=e},w.initial=new w(0),w.prototype.toString=function(){var e=this;return""+e.index},w.prototype.increment=function(e,t){var n=this;return new w(n.index+1)},w.prototype.compare=function(e){var t=this;return t.index-e.index},b=function(e,t,n){var r=this;r.input=e,r.position=t,r.userState=n},b.prototype.eq=function(e){var t=this;return e&&t.input===e.input&&t.userState===e.userState},b.prototype.isEmpty=function(){var e=this;return o(e.input)},b.prototype.first=function(){var e=this;return s(e.input)},b.prototype.next=function(e){var t=this;if(!t._next){var n=u(t.input),r=new b(n,t.position.increment(e,n),t.userState);t._next=new E(function(t,n,i){return i(e,r,n)})}return t._next},b.prototype.setInput=function(e){var t=this;return new b(e,t.position,t.userState)},b.prototype.setPosition=function(e){var t=this;return new b(t.input,e,t.userState)},b.prototype.setUserState=function(e){var t=this;return new b(t.input,t.position,e)},p=function(e){var t=this;t.message=e},p.prototype=new Error,p.prototype.constructor=p,p.prototype.name="ParserError",d=function(e,t){var n=this;n.position=e,n._msg=t||""},d.prototype=new Error,d.prototype.constructor=d,d.prototype.name="ParseError",d.prototype.toString=function(){var e=this;return e.message},Object.defineProperties(d.prototype,{message:{configurable:!0,get:function(){var e=this;return"At "+e.position+" "+e.errorMessage}},errorMessage:{configurable:!0,get:function(){var e=this;return e._msg}}}),v=function(e,t){var n=this;n.position=e,n.errors=t||[]},v.prototype=new d,v.prototype.constructor=v,v.prototype.name="MultipleError",Object.defineProperty(v.prototype,"errorMessage",{get:function(){var e=this;return"["+e.errors.map(function(e){return e.message}).join(", ")+"]"}});var _t=function(e,t,n){var r=this;r.position=e,r._pErr=t,r._qErr=n};_t.prototype=new v,_t.prototype.constructor=v,_t.prototype.name="ChoiceError",Object.defineProperty(_t.prototype,"errors",{get:function(){var e=this;return[e._pErr].concat(e._qErr.errors)}}),m=function(e){var t=this;t.position=e},m.prototype=new d,m.prototype.constructor=m,m.prototype.name="UnknownError",Object.defineProperty(m.prototype,"errorMessage",{value:"unknown error"}),g=function(e,t){var n=this;n.position=e,n.unexpected=t},g.prototype=new d,g.prototype.constructor=g,g.prototype.name="UnexpectError",Object.defineProperty(g.prototype,"errorMessage",{get:function(){var e=this;return"unexpected: "+e.unexpected}}),y=function(e,t,n){var r=this;r.position=e,r.expected=t,r.found=n},y.prototype=new d,y.prototype.constructor=y,y.prototype.name="ExpectError",Object.defineProperty(y.prototype,"errorMessage",{get:function(){var e=this;return"expected: "+e.expected+(e.found?" found: "+e.found:"")}}),E=function(e){var t=this;t.run=e},N=function(e,t,n,r,i,s,o){return new c(e.run,t,n,r,i,s,o)},S=function(e,t){return t.run.hasOwnProperty("displayName")?S(e,new E(function(e,t,n,r,i,s,o){return N(e,t,n,r,i,s,o)})):new E(Object.defineProperty(t.run,"displayName",{value:e,writable:!1}))},x=function(e){var t;return new E(function(n,r,i,s,o,u){return t=t||e(),N(t,n,r,i,s,o,u)})},T=function(e){var t=e(x(function(){return t}));return t},C=function(e){return new E(function(t,n,r,i,s,o){return s(e,t,n)})},k=function(e){return new E(function(t,n,r,i,s,o){return o(e,t,n)})},L=function(e,t){return new E(function(n,r,i,s,o,u){return N(e,n,r,function(e,n,r){return N(t(e),n,r,i,s,i,s)},s,function(e,n,r){return N(t(e),n,r,i,s,o,u)},u)})},_=function(e){return new E(function(t,n,r,i,s,o){var u=e(t);return s(u,u,n)})},O=S("Get Parser State",_(function(e){return e})),M=function(e){return _(Ot(e))},A=function(e){return new E(function(t,n,r,i,s,o){return s(e(t),t,n)})},H=function(e){return _(function(t){return t.setUserState(e(t.userState))})},D=S("Get State",A(function(e){return e.userState})),P=function(e){return H(Ot(e))},F=S("Get Position",A(function(e){return e.position})),I=function(e){return _(function(t){return t.setPosition(e)})},B=S("Get Input",A(function(e){return e.input})),j=function(e){return _(function(t){return t.setInput(e)})};var Dt=function(e,t,n){return L(e,function(e){return L(t,function(t){return n(e,t)})})},Pt=function(e){return L(F,function(t){return k(e(t))})};q=function(e){var t=e?d:m;return Pt(function(n){return new t(n,e)})},R=function(e){return new E(function(t,n,r,i,s,o){var u=function(e,t,n){return o(e,t,Mt.popWindow(n))};return N(e,t,Mt.pushWindow(n,t.position),function(e,t,n){return r(e,t,Mt.popWindow(n))},u,function(e,t,n){return s(e,t,Mt.popWindow(n))},u)})},U=function(e){return Dt(O,e,function(e,t){return W(M(e),C(t))})},z=function(e){return Dt(B,F,function(t,n){return L(e,function(e){return $(I(n),j(t),C(e))})})},W=function(e,t){return L(e,Ot(t))};var Ht;X=f.bind(null,(Ht=W,function(e,t){return Ht(t,e)}));var Bt=n.from,jt=X;V=function(e){return jt(Bt(e))};var Ft=At,It=V;$=function(){return It(Ft.apply(null,arguments))},J=function(e,t){return new E(function(n,r,i,s,o,u){var a=n.position,f=function(e,r,f){var l=function(t,r,i){return u(new v(a,[e,t]),n,i)};return N(t,n,f,i,s,o,l)};return N(e,n,r,i,s,o,f)})},K=l.bind(null,function(e,t){return new E(function(n,r,i,s,o,u){var a=n.position,f=function(t,r,f){var l=function(e,r,i){return u(new _t(a,t,e),n,i)};return N(e,n,f,i,s,o,l)};return N(t,n,r,i,s,o,f)})},k(new v(null,[])));var qt=n.from,Rt=K;Q=function(e){return Rt(qt(e))};var Ut=At,zt=Q;G=function(){return zt(Ut.apply(null,arguments))},Y=function(e,t){return t?J(t,C(e)):J(e,C(null))},Z=function(e,t){return new E(function(n,r,i,s,o,u){return N(t,n,r,i,s,o,function(t,n,r){return u(new y(n.position,e),n,r)})})},E.map=function(e,t){var n;return L(t,(n=C,function(t){return n(e(t))}))},gt=E.map,E.prototype.map=function(e){var t=this;return gt(e,t)},E.ap=function(e,t){return L(e,function(e){return t.map(e)})},dt=E.ap,E.prototype.ap=function(e){var t=this;return dt(t,e)},E.chain=L,yt=E.chain,E.prototype.chain=function(e){var t=this;return yt(t,e)},E.prototype.of=C,E.of=E.prototype.of,mt=E.of,E.prototype.empty=q(),E.empty=E.prototype.empty,pt=E.empty,E.concat=J,vt=E.concat,E.prototype.concat=function(e){var t=this;return vt(t,e)},et=gt.bind(null,n.toArray),tt=function(e,t){return L(et(e),function(e){return t.apply(undefined,e)})};var Wt=n.cons;nt=function(e,t){return L(e,function(e){return gt(function(t){return Wt(e,t)},t)})};var Xt=n.append;rt=function(e,t){return L(e,function(e){return gt(function(t){return Xt(e,t)},t)})};var Vt;it=l.bind(null,(Vt=nt,function(e,t){return Vt(t,e)}),C(i));var $t=n.from,Jt=it;st=function(e){return Jt($t(e))};var Kt=At,Qt=st;ot=function(){return Qt(Kt.apply(null,arguments))};var Gt=Y.bind(null,i),Yt=new p("Many parser applied to a parser that accepts an empty string"),Zt=function(){throw Yt};ut=function(e){var t=new E(function(t,n,r,i,s,o){return N(e,t,n,r,i,Zt,o)});return T(function(e){return Gt(nt(t,e))})},at=function(e){return nt(e,ut(e))},ft=function(e){return new E(function(t,n,r,i,s,o){var u=t.position,a={id:e,state:t},f=Mt.lookup(n,u,a);if(f){var l=f[0],c=f[1],h=f[2];switch(l){case"cok":return r(c,h,n);case"ceerr":return i(c,h,n);case"eok":return s(c,h,n);case"eerr":return o(c,h,n)}}return N(e,t,n,function(e,t,n){return r(e,t,Mt.update(n,u,a,["cok",e,t]))},function(e,t,n){return i(e,t,Mt.update(n,u,a,["cerr",e,t]))},function(e,t,n){return s(e,t,Mt.update(n,u,a,["eok",e,t]))},function(e,t,n){return o(e,t,Mt.update(n,u,a,["eerr",e,t]))})})};var en=function(e,t){return new g(e,t===null?"end of input":t)};lt=function(e,t){var n=t||en;return new E(function(t,r,i,s,o,u){var a,f;return t.isEmpty()?u(n(t.position,null),t,r):(a=t.first(),e(a)?(f=function(e,t,n){return i(e,t,Mt.prune(n,t.position))},N(t.next(a),t,r,f,s,f,s)):u(n(t.position,a),t,r))})},ct=S("Any Token",lt(function(){return!0}));var tn;ht=S("EOF",(tn=C(null),L(O,function(e){return e.isEmpty()?tn:Pt(function(t){return new y(t,"end of input",e.first())})})));var nn=N,rn=h;bt=function(){return rn(nn.apply(null,arguments))},wt=function(e,t,n,r){return bt(e,t,Mt.empty,n,r,n,r)},Et=function(e,t,n,r,i){return wt(e,new b(t,w.initial,n),r,i)},St=function(e,t,r,i,s){return Et(e,n.from(t),r,i,s)};var sn=function(e){return e},on=function(e){throw e};xt=function(e,t){return wt(e,t,sn,on)},Tt=function(e,t,n){return xt(e,new b(t,w.initial,n))},Nt=function(e,t,r){return Tt(e,n.from(t),r)};var un=function(){return!0},an=function(){return!1};Ct=function(e,t){return wt(e,t,un,an)},kt=function(e,t,n){return Ct(e,new b(t,w.initial,n))},Lt=function(e,t,r){return kt(e,n.from(t),r)},t.Tail=c,t.trampoline=h,t.ParserError=p,t.ParseError=d,t.MultipleError=v,t.UnknownError=m,t.UnexpectError=g,t.ExpectError=y,t.ParserState=b,t.Position=w,t.Parser=E,t.label=S,t.late=x,t.rec=T,t.unparser=N,t.always=C,t.never=k,t.bind=L,t.extract=A,t.getParserState=O,t.setParserState=M,t.modifyParserState=_,t.getState=D,t.setState=P,t.modifyState=H,t.getInput=B,t.setInput=j,t.getPosition=F,t.setPosition=I,t.fail=q,t.attempt=R,t.look=U,t.lookahead=z,t.next=W,t.sequences=X,t.sequencea=V,t.sequence=$,t.either=J,t.choices=K,t.choicea=Q,t.choice=G,t.optional=Y,t.expected=Z,t.eager=et,t.binds=tt,t.cons=nt,t.append=rt,t.enumerations=it,t.enumerationa=st,t.enumeration=ot,t.many=ut,t.many1=at,t.memo=ft,t.token=lt,t.anyToken=ct,t.eof=ht,t.empty=pt,t.ap=dt,t.concat=vt,t.of=mt,t.map=gt,t.chain=yt,t.exec=bt,t.parseState=wt,t.parseStream=Et,t.parse=St,t.runState=xt,t.runStream=Tt,t.run=Nt,t.testState=Ct,t.testStream=kt,t.test=Lt}),define("nu-stream/gen",["require","exports","./stream"],function(e,t,n){var r=n.NIL,i=n.memoStream,s,o;s=function(e,t){return e<=0?r:i(t,s.bind(null,e-1,t))};var u=function(e,t,n){return(n>0?t<=e:t>=e)?r:i(e,u.bind(null,e+n,t,n))};o=function(e,t,n){var s=isNaN(e)?Infinity:+e,o=isNaN(n)?1:+n;return isNaN(t)?(o>0?s<=0:s>=0)?r:i(0,u.bind(null,0+o,s,o)):(o>0?t<=s:t>=s)?r:i(s,u.bind(null,s+o,t,o))},t.repeat=s,t.range=o}),define("bennu/lang",["require","exports","nu-stream/stream","nu-stream/gen","./parse"],function(e,t,n,r,i){var s=n.NIL,o=r.repeat,u=i.append,a=i.always,f=i.bind,l=i.cons,c=i.either,h=i.enumerations,p=i.late,d=i.many,v=i.many1,m=i.next,g=i.optional,y=i.ParserError,b=i.rec,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H=a(s),B=g.bind(null,s),j=o,F=h;w=function(){return F(j.apply(null,arguments))},E=function(e,t){return e<=0?H:B(l(t,p(function(){return E(e-1,t)})))},S=function(e,t,n){if(t<e)throw new y("between max < min");return u(w(e,n),E(t-e,n))},x=function(e,t){return f(e,function(e){return m(t,a(e))})},T=function(e,t,n){return m(e,x(n,t))},N=function(e,t){return l(t,d(m(e,t)))};var I=N,q=B;C=function(){return q(I.apply(null,arguments))},k=function(e,t){return b(function(n){return l(t,B(m(e,B(n))))})},L=function(e,t){return c(k(e,t),m(g(null,e),H))},A=function(e,t){return v(x(t,e))},O=function(e,t){return d(x(t,e))},M=function(e,t){return f(t,function n(r){return g(r,f(e,function(e){return f(t,function(t){return n(e(r,t))})}))})},_=function(e,t,n){return g(t,M(e,n))},D=function(e,t){return b(function(n){return f(t,function(t){return g(t,f(e,function(e){return n.map(function(n){return e(t,n)})}))})})},P=function(e,t,n){return g(t,D(e,n))},t.times=w,t.atMostTimes=E,t.betweenTimes=S,t.then=x,t.between=T,t.sepBy1=N,t.sepBy=C,t.sepEndBy1=k,t.sepEndBy=L,t.endBy1=A,t.endBy=O,t.chainl1=M,t.chainl=_,t.chainr1=D,t.chainr=P}),define("khepri-ast/serialization",["require","exports","./node"],function(e,t,n){var r,i,s,o=Object.keys,u=Function.prototype.call.bind(Array.prototype.map),a=Function.prototype.call.bind(Array.prototype.reduce),f=function(e){return e},l={};r=function(e,t){l[e]=t};var c=function(e,t,r){return e?Array.isArray(e)?u(e,function(e){return c(e,t,r)}):e instanceof n.Node?{type:e.type,loc:t(e.loc),ud:r(e.ud),children:a(e.children,function(n,i){return n[i]=c(e[i],t,r),n},{}),attributes:a(e.attributes,function(t,n){return t[n]=e[n],t},{})}:e:e};i=function(e,t,n){var r=c(e,t||f,n||f);return{version:"2.1.0",kind:"ecma",program:r}};var h=function(e,t,r){if(!e)return e;if(Array.isArray(e))return u(e,function(e){return h(e,t,r)});var i=l[e.type];if(!i)return e;var s=t(e.loc),f=r(e.ud),c=a(o(e.children),function(n,i){return n[i]=h(e.children[i],t,r),n},{}),p=a(o(e.attributes),function(t,n){return t[n]=e.attributes[n],t},{});return n.construct(i.prototype,s,f,c,p)};s=function(e,t,n){return h(e.program,t||f,n||f)},t.registerNode=r,t.serialize=i,t.unserialize=s}),define("khepri-ast/node",["require","exports","./serialization"],function(e,t,n){var r=n.registerNode,i,s,o,u,a,f,l,c,h,p,d=Object.keys,v=function(e,t,n){var r={},i=d(e);for(var s=0,o=i.length;s<o;s+=1){var u=i[s];r[u]=e[u]}return r[t]=n,r};i=function(e,t){var n=this;Object.defineProperties(n,{loc:{value:e,enumerable:!1,writable:!0},ud:{value:t||null,enumerable:!1,writable:!0}})},s=function(e,t,n,r,i){var s=new e.constructor(t);s.ud=n;var o=e.children;for(var u=0,a=o.length;u<a;u+=1){var f=o[u];s[f]=r[f]||null}var l=e.attributes;for(var c=0,h=l.length;c<h;c+=1){var p=l[c];s[p]=i[p]||null}return s},o=function(e,t,n){return s(e,e.loc,e.ud,t,n)},u=function(e,t,n){var r=new e.constructor(e.loc);r.ud=e.ud;var i=e.children;for(var s=0,o=i.length;s<o;s+=1){var u=i[s];r[u]=t[u]||e[u]}var a=e.attributes;for(var f=0,l=a.length;f<l;f+=1){var c=a[f];r[c]=n[c]||e[c]}return r},a=function(e,t){return s(e,t,e.ud,e,e)},f=function(e,t){return s(e,e.loc,t,e,e)},l=function(e,t){return e.ud&&e.ud[t]},c=function(e,t,n){return h(e,t,n(l(e,t)))},h=function(e,t,n){return f(e,v(e.ud||{},t,n))},p=function(e,t,n,i,s){s.type=t,s.prototype=new e,s.prototype.constructor=s,s.prototype.children=n,s.prototype.attributes=i,s.prototype.type=s.type;var o=function(e){var t=this;return s.apply(t,e)};return o.prototype=s.prototype,s.create=function(){var e=arguments;return new o(e)},r(t,s),s},t.Node=i,t.construct=s,t.reconstruct=o,t.modify=u,t.setLoc=a,t.setUserData=f,t.getData=l,t.modifyData=c,t.setData=h,t.defineNode=p}),define("khepri-ast/token",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s,o,u,a,f,l,c,h,p,d,v,m;s=function(e,t){var n=this;i.call(n,e),n.value=t},s.prototype=new i,o=r(s,"String",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),u=r(s,"Number",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),a=r(s,"RegularExpression",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),f=r(s,"Boolean",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),l=r(s,"Null",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),c=r(s,"Identifier",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),h=r(s,"Keyword",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),p=r(s,"Punctuator",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),d=r(s,"Comment",[],["value","multiline","linebreak"],function(e,t,n,r){var i=this;s.call(i,e,t),i.multiline=!!n,i.linebreak=!!r}),v=r(s,"Whitespace",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),m=r(s,"LineTerminator",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),t.Token=s,t.StringToken=o,t.NumberToken=u,t.RegularExpressionToken=a,t.BooleanToken=f,t.NullToken=l,t.IdentifierToken=c,t.KeywordToken=h,t.PunctuatorToken=p,t.CommentToken=d,t.WhitespaceToken=v,t.LineTerminatorToken=m}),define("khepri-ast/position",["require","exports"],function(e,t){var n,r;n=function(e,t){var n=this;n.line=e,n.column=t},n.initial=new n(1,0),n.prototype.increment=function(e){var t=this;return e==="\n"?new n(t.line+1,0):new n(t.line,t.column+1)},n.prototype.toString=function(){var e=this;return"{line:"+e.line+" col:"+e.column+"}"},n.prototype.compare=function(e){var t=this;return t.line===e.line?t.column-e.column:t.line-e.line},r=function(e,t){var n=this;n.start=e,n.end=t},r.prototype.toString=function(){var e=this;return"{start:"+e.start+" end:"+e.end+"}"},r.merge=function(e,t){return new r(e.start.compare(t.start)>0?t.start:e.start,e.end.compare(t.end)>0?e.end:t.end)},t.SourcePosition=n,t.SourceLocation=r}),define("bennu/text",["require","exports","./parse"],function(e,t,n){var r=n.always,i=n.attempt,s=n.bind,o=n.either,u=n.expected,a=n.ExpectError,f=n.next,l=n.label,c=n.token,h,p,d,v,m,g,y,b,w,E,S=Function.prototype.call.bind(Array.prototype.join),x=Function.prototype.call.bind(Array.prototype.map),T=Function.prototype.call.bind(Array.prototype.reduce),N=Function.prototype.call.bind(Array.prototype.reduceRight),C=function(e,t,n,r,i){var s=this;a.call(s,e,r,i),s.string=t,s.index=n};C.prototype=new a,C.prototype.constructor=C,Object.defineProperty(C.prototype,"errorMessage",{get:function(){var e=this;return"In string: '"+e.string+"' at index: "+e.index+", Expected: "+e.expected+" Found: "+(e.found?e.found:"end of input")}});var k=function(e){return""+e},L=function(e,t){var n;return c((n=""+e,function(e){return n===""+e}),t)};h=function(e){return L(e,function(t,n){return new a(t,e,n===null?"end of input":n)})},p=function(e){var t,n=x(e,k);return c(function(e){return n.indexOf(""+e)>=0},(t=S(n," or "),function(e,n){return new a(e,t,n===null?"end of input":n)}))},d=function(e){var t,n=x(e,k);return c(function(e){var t=n.indexOf(""+e)>=0;return!t},(t="none of:"+S(n," or "),function(e,n){return new a(e,t,n===null?"end of input":n)}))};var A=function(e,t,n,r){return f(L(t,function(e,i){return new C(e,r,n,t,i)}),e)};v=function(e){return i(N(e,A,r(""+e)))};var O=function(e,t){return e[t]=e[t]||{},e[t]},M=function(e,t){var n=T(t,O,e);return n[""]=t,e},_=function(e){var t=Object.keys(e),n=T(t,function(t,n){return n.length&&(t[n]=_(e[n])),t},{}),u=i(s(p(t),function(e){return n[e]}));return e.hasOwnProperty("")?o(u,r(e[""])):u};m=function(e){var t,n,u,a;return i((t=T(e,M,{}),n=Object.keys(t),u=T(n,function(e,n){return n.length&&(e[n]=_(t[n])),e},{}),a=i(s(p(n),function(e){return u[e]})),t.hasOwnProperty("")?o(a,r(t[""])):a))},g=function(e,t){return c(RegExp.prototype.test.bind(e),function(e,n){return new a(e,t,n===null?"end of input":n)})},y=l("Any Character",g(/^.$/,"any character")),b=l("Any Letter",g(/^[a-z]$/i,"any letter character")),w=l("Any Whitespace",g(/^\s$/i,"any space character")),E=l("Any Digit",g(/^[0-9]$/i,"any digit character")),t.character=h,t.oneOf=p,t.noneOf=d,t.string=v,t.trie=m,t.match=g,t.anyChar=y,t.letter=b,t.space=w,t.digit=E}),define("khepri-parse/lex/boolean_lexer",["require","exports","bennu/parse","bennu/text"],function(e,t,n,r){var i=n.always,s=n.either,o=n.next,u=n.label,a=r.string,f,l,c;f=u("True Literal Lexer",o(a("true"),i(!0))),l=u("False Literal Lexer",o(a("false"),i(!1))),c=u("Boolean Literal Lexer",s(f,l)),t.trueLiteral=f,t.falseLiteral=l,t.booleanLiteral=c}),define("khepri-parse/lex/line_terminator_lexer",["require","exports","bennu/parse","bennu/text"],function(e,t,n,r){var i=n.always,s=n.choice,o=n.next,u=n.optional,a=n.label,f=n.token,l=r.character,c=r.oneOf,h,p,d,v,m,g;h=a("Line Feed Lexer",l("\n")),p=a("Carriage Return Lexer",l("\r")),d=a("Line Separator Lexer",l("\u2028")),v=a("Paragraph Separator Lexer",l("\u2029")),m=a("Line Terminator Lexer",c(["\n","\r","\u2028","\u2029"])),g=a("Line Terminator Sequence Lexer",s(h,d,v,o(p,u("\r",o(h,i("\r\n")))))),t.lf=h,t.cr=p,t.ls=d,t.ps=v,t.lineTerminator=m,t.lineTerminatorSequence=g}),define("khepri-parse/lex/comment_lexer",["require","exports","bennu/parse","bennu/text","nu-stream/stream","./line_terminator_lexer"],function(e,t,n,r,i,s){var o=n.anyToken,u=n.always,a=n.bind,f=n.cons,l=n.either,c=n.many,h=n.map,p=n.next,d=n.label,v=n.rec,m=n.test,g=n.token,y=r.character,b=r.string,w=i.foldl,E=i.NIL,S=s.lineTerminator,x,T,N,C,k,L,A,O,M,_=function(e,t){return e+t},D=h.bind(null,w.bind(null,_,""));x=b("//");var P;T=g((P=m.bind(null,S),function(e){var t=P(e);return!t})),N=c(T),C=d("Single Line Comment Lexer",p(x,D(N))),k=b("/*"),L=b("*/"),A=d("Multi Line Comment Characters Lexer",v(function(e){return l(p(y("*"),l(p(y("/"),u(E)),f(u("*"),e))),f(o,e))})),O=d("Multi Line Comment Lexer",p(k,D(A))),M=d("Comment Lexer",l(C,O)),t.singleLineCommentMarker=x,t.singleLineCommentChar=T,t.singleLineCommentChars=N,t.singleLineComment=C,t.multiLineCommentStartMarker=k,t.multiLineCommentEndMarker=L,t.multiLineCommentChars=A,t.multiLineComment=O,t.comment=M}),define("khepri-parse/lex/null_lexer",["require","exports","bennu/parse","bennu/text"],function(e,t,n,r){var i=n.always,s=n.next,o=n.label,u=r.string,a;a=o("Null Lexer",s(u("null"),i(null))),t.nullLiteral=a}),define("khepri-parse/lex/reserved_word_lexer",["require","exports","bennu/parse","bennu/text","./boolean_lexer","./null_lexer"],function(e,t,n,r,i,s){var o=n.attempt,u=n.choice,a=n.label,f=r.string,l=r.trie,c=i.booleanLiteral,h=s.nullLiteral,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st=["break","case","catch","continue","debugger","default","delete","do","else","finally","for","function","if","in","instanceof","typeof","new","var","return","void","switch","while","this","with","throw","try","export","package","class","enum","interface","extends","implements","private","public","protected","super","const","yield","import","let","static","_"];m=f("break"),g=f("case"),y=f("catch"),b=f("continue"),w=f("debugger"),E=f("default"),S=f("delete"),x=f("do"),T=f("else"),N=f("finally"),C=f("for"),k=f("function"),L=f("if"),A=f("in"),O=f("instanceof"),M=f("typeof"),_=f("new"),D=f(""),P=f("return"),H=f("void"),B=f("switch"),j=f("while"),F=f("this"),I=f("with"),q=f("throw"),R=f("try"),U=u(o(m),o(g),o(y),o(b),o(w),o(E),o(S),o(x),o(T),o(N),o(C),o(k),o(L),o(A),o(O),o(M),o(_),o(D),o(P),o(H),o(B),o(j),o(F),o(I),o(q),o(R)),z=f("class"),W=f("enum"),X=f("extends"),V=f("super"),$=f("const"),J=f("export"),K=f("import"),Q=f("implements"),G=f("let"),Y=f("private"),Z=f("public"),et=f("interface"),tt=f("package"),nt=f("protected"),rt=f("static"),it=f("yield"),v=u(o(z),o(W),o(X),o(V),o($),o(J),o(K),o(Q),o(G),o(Y),o(Z),o(et),o(tt),o(nt),o(rt),it),d=a("ReservedWordLexer",u(l(st),h,c)),p=st.concat("null","true","false"),t.reservedWordList=p,t.reservedWord=d,t.futureReservedWord=v,t.breakKeyword=m,t.caseKeyword=g,t.catchKeyword=y,t.continueKeyword=b,t.debuggerKeyword=w,t.defaultKeyword=E,t.deleteKeyword=S,t.doKeyword=x,t.elseKeyword=T,t.finallyKeyword=N,t.forKeyword=C,t.functionKeyword=k,t.ifKeyword=L,t.inKeyword=A,t.instanceofKeyword=O,t.typeofKeyword=M,t.newKeyword=_,t.Keyword=D,t.returnKeyword=P,t.voidKeyword=H,t.switchKeyword=B,t.whileKeyword=j,t.thisKeyword=F,t.withKeyword=I,t.throwKeyword=q,t.tryKeyword=R,t.keyword=U,t.classKeyword=z,t.enumKeyword=W,t.extendsKeyword=X,t.superKeyword=V,t.constKeyword=$,t.exportKeyword=J,t.importKeyword=K,t.implementsKeyword=Q,t.letKeyword=G,t.privateKeyword=Y,t.publicKeyword=Z,t.interfaceKeyword=et,t.packageKeyword=tt,t.protectedKeyword=nt,t.staticKeyword=rt,t.yieldKeyword=it}),define("khepri-parse/lex/identifier_lexer",["require","exports","bennu/parse","bennu/text","nu-stream/stream","./reserved_word_lexer"],function(e,t,n,r,i,s){var o=n.always,u=n.attempt,a=n.bind,f=n.cons,l=n.choice,c=n.either,h=n.eof,p=n.fail,d=n.many,v=n.never,m=n.next,g=n.label,y=n.testStream,b=n.token,w=r.character,E=r.oneOf,S=r.digit,x=r.letter,T=r.string,N=i.foldl,C=s.reservedWordList,k,L,A,O,M,_,D,P,H,B,j,F=function(e,t){return e+t},I=N.bind(null,F,"");k=w("‌"),L=w("‍"),A=x,O=S,M=E(["_","‿","⁀","⁔","︳","︴","﹍","﹎","﹏","＿"]),_=v(),D=c(A,E("$_")),P=l(u(D),_,O,M,k,L),H=d(P),B=f(D,H),j=g("Identifier Lexer",a(B,function(e){var t=I(e);return C.indexOf(t)>=0?p():o(t)})),t.zwnj=k,t.zwj=L,t.unicodeLetter=A,t.unicodeDigit=O,t.unicodeConnectorPunctuation=M,t.unicodeCombiningMark=_,t.identifierStart=D,t.identifierPart=P,t.identifierParts=H,t.identifierName=B,t.identifier=j}),define("khepri-parse/lex/number_lexer",["require","exports","bennu/parse","bennu/lang","bennu/text","nu-stream/stream"],function(e,t,n,r,i,s){var o=n.always,u=n.attempt,a=n.bind,f=n.binds,l=n.choice,c=n.either,h=n.enumeration,p=n.expected,d=n.many,v=n.many1,m=n.map,g=n.next,y=n.optional,b=n.label,w=r.then,E=i.character,S=i.oneOf,x=i.match,T=i.string,N=s.foldl,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z=function(e){return-e},W=function(e,t){return e+t},X=m.bind(null,N.bind(null,W,""));C=E("."),k=E("-"),L=E("+"),A=S("eE"),O=c(T("0x"),T("0X")),M=S("0123456789"),_=S("123456789"),D=S("0123456789abcdefABCDEF"),P=b("Decimal Digits Lexer",X(v(M))),H=b("Hex Digits Lexer",X(v(D))),B=b("Unsigned Integer Lexer",m(parseInt,P)),j=b("Signed Integer Lexer",c(g(k,m(z,B)),g(y(L),B)));var V=b("Hex Integer Literal Digits Lexer",m(function(e){return parseInt(e,16)},H));F=b("Exponent Part Lexer",g(A,j)),I=b("Hex Integer Literal Lexer",g(O,V)),q=b("Decimal Integer Literal",m(parseInt,P)),R=b("Decimal Literal Lexer",f(h(f(h(P,y(0,u(g(C,P)))),function(e,t){return o(parseFloat(e+"."+t))}),y(0,F)),function(e,t){return o(e*Math.pow(10,parseInt(t)))})),U=b("Numeric Literal Lexer",c(g(u(O),p("hex digits",V)),R)),t.decimal=C,t.negativeSign=k,t.positiveSign=L,t.exponentIndicator=A,t.hexIndicator=O,t.decimalDigit=M,t.nonZeroDigit=_,t.hexDigit=D,t.decimalDigits=P,t.hexDigits=H,t.unsignedInteger=B,t.signedInteger=j,t.exponentPart=F,t.hexIntegerLiteral=I,t.decimalIntegerLiteral=q,t.decimalLiteral=R,t.numericLiteral=U}),define("khepri-parse/lex/punctuator_lexer",["require","exports","bennu/parse","bennu/text"],function(e,t,n,r){var i=n.label,s=r.character,o=r.string,u=r.trie,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et=["{","}","(",")","[","]",",",".",";",":","?","&&","||","<<",">>",">>>","<=","<",">=",">","===","!==","==","!=","=",":=","=:","!","~","++","--","&","|","^","+","-","*","/","%","@","\\>","\\>>","<\\","<<\\","|>","<|","...","#","\\","->","<-","§"];a=s("{"),f=s("}"),l=s("("),c=s(""),h=s("["),p=s("]"),d=s("."),v=s(";"),m=s(","),g=s(":"),y=s("?"),b=o("&&"),w=o("||"),E=o("<<"),S=o(">>"),x=o(">>>"),T=o("<="),N=s("<"),C=o(">="),k=s(">"),L=o("==="),A=o("!=="),O=o("=="),M=o("!="),H=s("="),B=s("!"),j=s("~"),_=s("&"),D=s("|"),P=s("^"),F=s("+"),I=s("-"),q=s("*"),U=s("/"),R=s("%"),Q=s("#"),K=o("..."),G=s("\\"),Y=o("->"),Z=i("Punctuator Lexer",u(et)),t.openBrace=a,t.closeBrace=f,t.openParenthesis=l,t.closeParenthesis=c,t.openBracket=h,t.closeBracket=p,t.period=d,t.semicolon=v,t.comma=m,t.colon=g,t.questionMark=y,t.logicalAnd=b,t.logicalOr=w,t.leftShift=E,t.signedRightShift=S,t.unsignedRightShift=x,t.lessThanOrEqualTo=T,t.lessThan=N,t.greaterThanOrEqualTo=C,t.greaterThan=k,t.strictEquals=L,t.strictDoesNotEqual=A,t.equals=O,t.doesNotEqual=M,t.and=_,t.or=D,t.xor=P,t.assign=H,t.logicalNot=B,t.bitwiseNot=j,t.addition=F,t.subtration=I,t.multiplication=q,t.mod=R,t.division=U,t.compose=z,t.composeNary=W,t.reverseCompose=X,t.reverseComposeNary=V,t.pipe=$,t.reversePipe=J,t.ellipsis=K,t.as=Q,t.argumentList=G,t.lambda=Y,t.punctuator=Z}),define("khepri-parse/lex/string_lexer",["require","exports","bennu/parse","bennu/text","bennu/lang","nu-stream/stream","./line_terminator_lexer","./number_lexer"],function(e,t,n,r,i,s,o,u){var a=n.always,f=n.attempt,l=n.bind,c=n.choice,h=n.either,p=n.eof,d=n.many,v=n.map,m=n.next,g=n.sequence,y=n.label,b=n.test,w=n.token,E=r.character,S=i.between,x=i.times,T=s.foldl,N=o.lineTerminatorSequence,C=o.lineTerminator,k=u.decimalDigit,L=u.hexDigit,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W=function(e,t){return e+t},X=T.bind(null,W,""),V=v.bind(null,function(e){return String.fromCharCode(parseInt(X(e),16))});A=E('"'),M=E("'"),O=E("\\"),_=g(O,N,a(""));var $=c(A,M,O,m(E("b"),a("\b")),m(E("f"),a("\f")),m(E("n"),a("\n")),m(E("r"),a("\r")),m(E("t"),a("	")),m(E("v"),a(""))),J=c($,k,E("u"),E("x")),K=w(function(e){return!b(J,e)&&!b(C,e)});P=m(E("x"),V(x(2,L))),D=m(E("u"),V(x(4,L))),H=h($,K);var Q;B=c(H,g(E("0"),h(p,w((Q=b.bind(null,k),function(e){var t=Q(e);return!t}))),a("\0")),P,D),j=y("Single String Character",c(f(_),m(O,B),w(function(e){return!(b(M,e)||b(O,e)||b(C,e))}))),F=d(j),I=y("Single String Literal",S(M,M,v(X,F))),q=c(f(_),m(O,B),w(function(e){return!(b(A,e)||b(O,e)||b(C,e))})),R=d(q),U=y("Double String Literal",S(A,A,v(X,R))),z=y("Sting Literal Lexer",h(I,U)),t.doubleQuote=A,t.escape=O,t.singleQuote=M,t.lineContinuation=_,t.unicodeEscapeSequence=D,t.hexEscapeSequence=P,t.characterEscapeSequence=H,t.escapeSequence=B,t.singleStringCharacter=j,t.singleStringCharacters=F,t.singleStringLiteral=I,t.doubleStringCharacter=q,t.doubleStringCharacters=R,t.doubleStringLiteral=U,t.stringLiteral=z}),define("khepri-parse/lex/whitespace_lexer",["require","exports","bennu/parse","bennu/text"],function(e,t,n,r){var i=n.map,s=n.label,o=r.character,u=r.oneOf,a=r.match,f,l,c,h,p,d,v,m;f=o("	"),l=o(""),c=o("\f"),h=o(" "),p=o(" "),d=o("﻿"),v=a(/^\s$/),m=s("Whitespace Character Lexer",u(["	","","\f"," "," ","﻿"])),t.tab=f,t.vt=l,t.ff=c,t.sp=h,t.nbsp=p,t.bom=d,t.usp=v,t.whitespace=m}),define("khepri-parse/lex/regular_expression_lexer",["require","exports","bennu/parse","bennu/lang","bennu/text","nu-stream/stream","./identifier_lexer","./line_terminator_lexer"],function(e,t,n,r,i,s,o,u){var a=n.always,f=n.attempt,l=n.bind,c=n.binds,h=n.choice,p=n.cons,d=n.either,v=n.enumeration,m=n.many,g=n.map,y=n.next,b=n.label,w=n.token,E=n.test,S=r.between,x=i.character,T=s.foldl,N=o.identifierPart,C=u.lineTerminator,k,L,A,O,M,_,D,P,H,B,j,F=function(e,t){return e+t},I=T.bind(null,F,""),q;k=w((q=E.bind(null,C),function(e){var t=q(e);return!t})),L=y(x("\\"),g(function(e){return"\\"+e},k)),A=d(f(w(function(e){return!E(C,e)&&e!=="]"&&e!=="\\"})),L),O=m(A),M=S(x("["),x("]"),g(function(e){return"["+I(e)+"]"},O)),P=h(w(function(e){return!E(C,e)&&e!=="*"&&e!=="\\"&&e!=="`"&&e!=="["}),L,M),_=h(w(function(e){return!E(C,e)&&e!=="\\"&&e!=="`"&&e!=="["}),L,M),D=m(_),H=m(N),B=g(I,p(P,D)),j=b("Regular Expression Lexer",c(v(S(x("`"),x("`"),B),H),function(e,t){return a(new RegExp(e,I(t)))})),t.regularExpressionNonTerminator=k,t.regularExpressionBackslashSequence=L,t.regularExpressionClassChar=A,t.regularExpressionClassChars=O,t.regularExpressionClass=M,t.regularExpressionChar=_,t.regularExpressionChars=D,t.regularExpressionFirstChar=P,t.regularExpressionFlags=H,t.regularExpressionBody=B,t.regularExpressionLiteral=j}),define("khepri-parse/lex/lexer",["require","exports","bennu/parse","bennu/lang","nu-stream/stream","khepri-ast/token","khepri-ast/position","./boolean_lexer","./comment_lexer","./identifier_lexer","./line_terminator_lexer","./null_lexer","./number_lexer","./punctuator_lexer","./reserved_word_lexer","./string_lexer","./whitespace_lexer","./regular_expression_lexer"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){var y=n.always,b=n.attempt,w=n.binds,E=n.bind,S=n.choice,x=n.either,T=n.eof,N=n.getPosition,C=n.enumeration,k=n.extract,L=n.expected,A=n.next,O=n.many,M=n.runState,_=n.label,D=n.ParserState,P=r.then,H=i.memoStream,B=i.NIL,j=i.from,F=o.SourceLocation,I=o.SourcePosition,q=u.booleanLiteral,R=a.comment,U=f.identifier,z=f.identifierName,W=l.lineTerminator,X=c.nullLiteral,V=h.numericLiteral,$=p.punctuator,J=d.reservedWord,K=v.stringLiteral,Q=m.whitespace,G=g.regularExpressionLiteral,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct=S((it=s.StringToken,st=K,st.map(function(e){return[it,e]})),(ot=s.RegularExpressionToken,ut=G,ut.map(function(e){return[ot,e]})),(at=s.BooleanToken,ft=q,ft.map(function(e){return[at,e]})),(lt=s.NullToken,ct=X,ct.map(function(e){return[lt,e]})),(ht=s.NumberToken,pt=V,pt.map(function(e){return[ht,e]}))),kt=S(b((dt=s.IdentifierToken,vt=U,vt.map(function(e){return[dt,e]}))),b(Ct),(mt=s.KeywordToken,gt=J,gt.map(function(e){return[mt,e]})),(yt=s.PunctuatorToken,bt=$,bt.map(function(e){return[yt,e]}))),Lt=S((wt=s.CommentToken,Et=R,Et.map(function(e){return[wt,e]})),(St=s.WhitespaceToken,xt=Q,xt.map(function(e){return[St,e]})),(Tt=s.LineTerminatorToken,Nt=W,Nt.map(function(e){return[Tt,e]})),kt),At=Ct;Y=w(C(N,At,N),function(e,t,n){var r=t[0],i=t[1];return y(new r(new F(e,n),i))});var Ot=kt;Z=w(C(N,Ot,N),function(e,t,n){var r=t[0],i=t[1];return y(new r(new F(e,n),i))});var Mt=Lt;et=w(C(N,Mt,N),function(e,t,n){var r=t[0],i=t[1];return y(new r(new F(e,n),i))}),tt=P(O(et),T),rt=function(e){return M(tt,new D(j(e),I.initial))},t.literal=Y,t.token=Z,t.inputElement=et,t.lexer=tt,t.lexManyState=nt,t.lex=rt}),define("khepri-ast/program",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s;s=r(i,"Program",["body"],[],function(e,t){var n=this;i.call(n,e),n.body=t}),t.Program=s}),define("khepri-parse/parse/common",["require","exports","bennu/parse","nu-stream/stream","khepri-ast/position"],function(e,t,n,r,i){var s=n.always,o=n.bind,u=n.binds,a=n.extract,f=n.enumeration,l=n.eager,c=n.optional,h=r.NIL,p=i.SourceLocation,d,v,m,g;d=function(e,t){var r=n.choicea(t.map(function(e){return o(e.sep,function(t){var n=t.value;return s({value:n,node:e.node,precedence:e.precedence,right:e.right})})}));return o(l(n.rec(function(t){return n.cons(e,c(h,n.cons(r,n.expected("binary expression",t))))})),function(e){var t=[],n=[];while(e.length>0){var r=e.shift();if(r.type)n.push(r);else{while(t.length>0){var i=t[t.length-1];if(!(!r.right&&i.precedence===r.precedence||i.precedence<r.precedence))break;t.pop();var o=n.pop(),u=n.pop();n.push(new i.node(p.merge(u.loc,o.loc),i.value,u,o))}t.push(r)}}while(t.length>0){var a=t.pop(),f=n.pop(),l=n.pop();n.push(new a.node(p.merge(l.loc,f.loc),a.value,l,f))}return s(n.pop())})},g=a(function(e){var t=e.position;return t.sourcePosition});var y=a(function(e){var t=e.position;return t.prevEnd});v=function(e,t){return u(f(g,e,y),function(e,n,r){return s(t(new p(e,r),n))})},m=function(e,t){return u(f(g,e,y),function(e,n,i){return s(t.apply(undefined,r.toArray(r.cons(new p(e,i),n))))})},t.precedence=d,t.node=v,t.nodea=m,t.positionParser=g}),define("khepri-ast/package",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s,o,u;o=r(i,"PackageExport",["id","alias"],[],function(e,t,n){var r=this;i.call(r,e),r.id=t,r.alias=n}),u=r(i,"PackageExports",["exports"],[],function(e,t){var n=this;i.call(n,e),n.exports=t}),s=r(i,"Package",["exports","body"],[],function(e,t,n){var r=this;i.call(r,e),r.exports=t,r.body=n}),t.Package=s,t.PackageExport=o,t.PackageExports=u}),define("khepri-parse/parse/token_parser",["require","exports","bennu/parse"],function(e,t,n){var r=n.ExpectError,i=n.token,s,o,u,a,f,l,c,h,p,d=Function.prototype.call.bind(Array.prototype.indexOf),v=Function.prototype.call.bind(Array.prototype.join),m=function(e){return function(t,n){return new r(t,e,n?n.value:"end of input")}};s=function(){var e=arguments;return i(function(t){return t.type==="Punctuator"&&d(e,t.value)>=0},m(v(e,", ")))},o=function(){var e=arguments;return i(function(t){return t.type==="Keyword"&&d(e,t.value)>=0},m(v(e,", ")))},a=i(function(e){return e.type==="Identifier"},function(e,t){return new r(e,"any identifier",t?t.value:"end of input")}),u=function(){var e=arguments;return i(function(t){return t.type==="Identifier"&&d(e,t.value)>=0},m(v(e,", ")))},f=i(function(e){return e.type==="Null"},function(e,t){return new r(e,"Null literal",t?t.value:"end of input")}),l=i(function(e){return e.type==="Boolean"},function(e,t){return new r(e,"boolean literal",t?t.value:"end of input")}),c=i(function(e){return e.type==="Number"},function(e,t){return new r(e,"numeric literal",t?t.value:"end of input")}),h=i(function(e){return e.type==="String"},function(e,t){return new r(e,"string literal",t?t.value:"end of input")}),p=i(function(e){return e.type==="RegularExpression"},function(e,t){return new r(e,"regular expression literal",t?t.value:"end of input")}),t.punctuator=s,t.keyword=o,t.identifier=u,t.anyIdentifier=a,t.nullLiteral=f,t.booleanLiteral=l,t.numericLiteral=c,t.stringLiteral=h,t.regularExpressionLiteral=p}),define("khepri-ast/value",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s,o,u;s=r(i,"Identifier",[],["name"],function(e,t){var n=this;i.call(n,e),n.name=t}),o=r(i,"Literal",[],["kind","value"],function(e,t,n){var r=this;i.call(r,e),r.kind=t,r.value=n}),u=r(i,"ObjectValue",["key","value"],[],function(e,t,n){var r=this;i.call(r,e),r.key=t,r.value=n}),t.Identifier=s,t.Literal=o,t.ObjectValue=u}),define("khepri-parse/parse/value_parser",["require","exports","bennu/parse","khepri-ast/value","./token_parser"],function(e,t,n,r,i){var s=n.bind,o=n.choice,u=n.label,a,f,l,c,h,p,d,v;f=u("Null Literal",(v=i.nullLiteral,v.map(function(e){return r.Literal.create(e.loc,"null",e.value)})));var m;l=u("Boolean Literal",(m=i.booleanLiteral,m.map(function(e){return r.Literal.create(e.loc,"boolean",e.value)})));var g;c=u("Numeric Literal",(g=i.numericLiteral,g.map(function(e){return r.Literal.create(e.loc,"number",e.value)})));var y;h=u("String Literal",(y=i.stringLiteral,y.map(function(e){return r.Literal.create(e.loc,"string",e.value)})));var b;p=u("Regular Expression Literal",(b=i.regularExpressionLiteral,b.map(function(e){return r.Literal.create(e.loc,"regexp",e.value)}))),a=u("Literal",o(f,l,c,h,p)),d=u("Identifier",i.anyIdentifier.map(function(e){return r.Identifier.create(e.loc,e.value)})),t.literal=a,t.nullLiteral=f,t.booleanLiteral=l,t.numericLiteral=c,t.stringLiteral=h,t.regularExpressionLiteral=p,t.identifier=d}),define("khepri-ast/clause",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s,o,u;s=function(){},s.prototype=new i,o=r(s,"SwitchCase",["test","consequent"],[],function(e,t,n){var r=this;i.call(r,e),r.test=t||null,r.consequent=n}),u=r(s,"CatchClause",["param","body"],[],function(e,t,n){var r=this;i.call(r,e),r.param=t,r.body=n}),t.Clause=s,t.SwitchCase=o,t.CatchClause=u}),define("khepri-ast/declaration",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s,o,u,a,f,l;s=function(){},s.prototype=new i,o=r(s,"VariableDeclaration",["declarations"],[],function(e,t){var n=this;i.call(n,e),n.declarations=t}),u=r(s,"VariableDeclarator",["id","init"],["immutable","recursive"],function(e,t,n,r,s){var o=this;i.call(o,e),o.id=t,o.init=n||null,o.immutable=!!r,o.recursive=s}),a=r(s,"Binding",["pattern","value"],["recursive"],function(e,t,n,r){var s=this;i.call(s,e),s.pattern=t,s.value=n,s.recursive=r}),f=r(s,"StaticDeclaration",["declarations"],[],function(e,t){var n=this;i.call(n,e),n.declarations=t}),l=r(s,"StaticDeclarator",["id","init"],[],function(e,t,n){var r=this;i.call(r,e),r.id=t,r.init=n}),t.Declaration=s,t.VariableDeclaration=o,t.VariableDeclarator=u,t.Binding=a,t.StaticDeclaration=f,t.StaticDeclarator=l}),define("khepri-ast/statement",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;s=function(){var e=this},s.prototype=new i,o=r(s,"EmptyStatement",[],[],function(e){var t=this;i.call(t,e)}),u=r(s,"DebuggerStatement",[],[],function(e){var t=this;i.call(t,e)}),f=r(s,"BlockStatement",["body"],[],function(e,t){var n=this;i.call(n,e),n.body=t}),l=r(s,"ExpressionStatement",["expression"],[],function(e,t){var n=this;i.call(n,e),n.expression=t}),c=r(s,"IfStatement",["test","consequent","alternate"],[],function(e,t,n,r){var s=this;i.call(s,e),s.test=t,s.consequent=n,s.alternate=r||null}),a=r(s,"WithStatement",["bindings","body"],[],function(e,t,n){var r=this;i.call(r,e),r.bindings=t,r.body=n}),h=r(s,"BreakStatement",[],[],function(e){var t=this;i.call(t,e)}),p=r(s,"ContinueStatement",[],[],function(e){var t=this;i.call(t,e)}),d=r(s,"SwitchStatement",["discriminant","cases"],[],function(e,t,n){var r=this;i.call(r,e),r.discriminant=t,r.cases=n}),v=r(s,"ReturnStatement",["argument"],[],function(e,t){var n=this;i.call(n,e),n.argument=t||null}),m=r(s,"ThrowStatement",["argument"],[],function(e,t){var n=this;i.call(n,e),n.argument=t}),g=r(s,"TryStatement",["block","handler","finalizer"],[],function(e,t,n,r){var s=this;i.call(s,e),s.block=t,s.handler=n,s.finalizer=r}),y=r(s,"WhileStatement",["test","body"],[],function(e,t,n){var r=this;i.call(r,e),r.test=t,r.body=n}),b=r(s,"DoWhileStatement",["body","test"],[],function(e,t,n){var r=this;i.call(r,e),r.test=n,r.body=t}),w=r(s,"ForStatement",["init","test","update","body"],[],function(e,t,n,r,s){var o=this;i.call(o,e),o.init=t||null,o.test=n||null,o.update=r||null,o.body=s}),t.Statement=s,t.EmptyStatement=o,t.DebuggerStatement=u,t.WithStatement=a,t.BlockStatement=f,t.ExpressionStatement=l,t.IfStatement=c,t.BreakStatement=h,t.ContinueStatement=p,t.SwitchStatement=d,t.ReturnStatement=v,t.ThrowStatement=m,t.TryStatement=g,t.WhileStatement=y,t.DoWhileStatement=b,t.ForStatement=w}),define("khepri-ast/expression",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;s=function(){var e=this},s.prototype=new i,o=r(s,"ThisExpression",[],[],function(e){var t=this;i.call(t,e)}),u=r(s,"UnaryExpression",["argument"],["operator"],function(e,t,n){var r=this;i.call(r,e),r.operator=t,r.argument=n}),a=r(s,"BinaryExpression",["left","right"],["operator"],function(e,t,n,r){var s=this;i.call(s,e),s.operator=t,s.left=n,s.right=r}),f=r(s,"AssignmentExpression",["left","right"],["operator"],function(e,t,n,r){var s=this;i.call(s,e),s.operator=t,s.left=n,s.right=r}),l=r(s,"LogicalExpression",["left","right"],["operator"],function(e,t,n,r){var s=this;i.call(s,e),s.operator=t,s.left=n,s.right=r}),c=r(s,"ConditionalExpression",["test","consequent","alternate"],[],function(e,t,n,r){var s=this;i.call(s,e),s.test=t,s.consequent=n,s.alternate=r}),h=r(s,"NewExpression",["callee","args"],[],function(e,t,n){var r=this;i.call(r,e),r.callee=t,r.args=n}),p=r(s,"CallExpression",["callee","args"],[],function(e,t,n){var r=this;i.call(r,e),r.callee=t,r.args=n}),d=r(s,"MemberExpression",["object","property"],["computed"],function(e,t,n,r){var s=this;i.call(s,e),s.object=t,s.property=n,s.computed=r}),v=r(s,"FunctionExpression",["id","params","body"],[],function(e,t,n,r){var s=this;i.call(s,e),s.id=t||null,s.params=n,s.body=r}),m=r(s,"ArrayExpression",["elements"],[],function(e,t){var n=this;i.call(n,e),n.elements=t}),g=r(s,"ObjectExpression",["properties"],[],function(e,t){var n=this;i.call(n,e),n.properties=t}),y=r(s,"LetExpression",["bindings","body"],[],function(e,t,n){var r=this;i.call(r,e),r.bindings=t,r.body=n}),b=r(s,"CurryExpression",["base","args"],[],function(e,t,n){var r=this;i.call(r,e),r.base=t,r.args=n}),w=r(s,"ApplyExpression",["callee","arg"],[],function(e,t,n){var r=this;i.call(r,e),r.callee=t,r.arg=n}),E=r(s,"UnaryOperatorExpression",[],["op"],function(e,t){var n=this;i.call(n,e),n.op=t}),S=r(s,"BinaryOperatorExpression",[],["op","flipped"],function(e,t,n){var r=this;i.call(r,e),r.op=t,r.flipped=n}),x=r(s,"TernaryOperatorExpression",[],["op"],function(e,t){var n=this;i.call(n,e),n.op=t}),t.Expression=s,t.ThisExpression=o,t.UnaryExpression=u,t.BinaryExpression=a,t.AssignmentExpression=f,t.LogicalExpression=l,t.ConditionalExpression=c,t.NewExpression=h,t.CallExpression=p,t.MemberExpression=d,t.FunctionExpression=v,t.ArrayExpression=m,t.ObjectExpression=g,t.LetExpression=y,t.CurryExpression=b,t.ApplyExpression=w,t.UnaryOperatorExpression=E,t.BinaryOperatorExpression=S,t.TernaryOperatorExpression=x}),define("khepri-ast/pattern",["require","exports","./node"],function(e,t,n){var r=n.defineNode,i=n.Node,s,o,u,a,f,l,c,h,p,d,v;s=function(e){var t=this;i.call(t,e)},s.prototype=new i,o=r(s,"IdentifierPattern",["id"],[],function(e,t){var n=this;s.call(n,e),n.id=t}),u=r(s,"EllipsisPattern",["id"],[],function(e,t){var n=this;s.call(n,e),n.id=t||null}),a=r(s,"SinkPattern",[],[],function(e){var t=this;s.call(t,e)}),f=r(i,"ImportPattern",["from","pattern"],[],function(e,t,n){var r=this;i.call(r,e),r.from=t,r.pattern=n}),l=r(s,"ArrayPattern",["elements"],[],function(e,t){var n=this;s.call(n,e),n.elements=t}),c=r(s,"ObjectPatternElement",["key","target"],[],function(e,t,n){var r=this;s.call(r,e),r.key=t,r.target=n||null}),h=r(s,"ObjectPattern",["elements"],[],function(e,t){var n=this;s.call(n,e),n.elements=t}),v=r(s,"AsPattern",["id","target"],[],function(e,t,n){var r=this;s.call(r,e),r.id=t,r.target=n}),d=r(s,"SubPattern",["id","elements"],[],function(e,t,n){var r=this;s.call(r,e),r.id=t,r.elements=n}),p=r(s,"ArgumentsPattern",["id","elements","self"],[],function(e,t,n,r){var i=this;s.call(i,e),i.id=t,i.elements=n,i.self=r}),t.Pattern=s,t.IdentifierPattern=o,t.EllipsisPattern=u,t.SinkPattern=a,t.ImportPattern=f,t.ArrayPattern=l,t.ObjectPatternElement=c,t.ObjectPattern=h,t.ArgumentsPattern=p,t.SubPattern=d,t.AsPattern=v}),define("khepri-parse/parse/pattern_parser",["require","exports","bennu/parse","bennu/lang","nu-stream/stream","khepri-ast/pattern","./common","./token_parser","./value_parser"],function(e,t,n,r,i,s,o,u,a){var f=n.attempt,l=n.append,c=n.bind,h=n.binds,p=n.choice,d=n.cons,v=n.eager,m=n.either,g=n.expected,y=n.enumeration,b=n.next,w=n.optional,E=n.rec,S=n.label,x=n.late,T=r.between,N=r.sepBy,C=r.sepBy1,k=r.sepEndBy,L=r.then,A=i.NIL,O=o.node,M=o.nodea,_=u.keyword,D=u.punctuator,P=a.identifier,H=a.stringLiteral,B,j,F,I,q,R,U,z,W,X,V,$,J,K=function(e,t,n){return E(function(r){return d(n,w(A,b(e,m(y(t),r))))})},Q=function(e,t,n){return m(y(t),K(e,t,n))},G=function(e,t,n){return w(A,Q(e,t,n))};q=x(function(){return q}),I=x(function(){return I}),J=x(function(){return J});var Y=w(D(","));B=function(e,t,n){return l(Q(Y,t,e),b(Y,N(Y,n)))},j=function(e,t,n){return l(G(Y,t,e),b(Y,N(Y,n)))},R=S("Identifier Pattern",P.map(function(e){return s.IdentifierPattern.create(e.loc,e)})),U=S("Sink Pattern",_("_").map(function(e){return s.SinkPattern.create(e.loc)})),z=S("Ellipsis Pattern",m(T(D("("),D(")"),D("...")).map(function(e){return s.EllipsisPattern.create(e.loc,null)}),O(b(D("..."),w(R)),s.EllipsisPattern.create)));var Z;X=S("Array Pattern",(Z=q,O(T(D("["),D("]"),v(B(g("array pattern element",Z),z,g("non-ellipsis array pattern element",Z)))),s.ArrayPattern.create))),V=m(M(y(H,b(D(":"),I)),s.ObjectPatternElement.create),O(m(J,R),function(e,t){return s.ObjectPatternElement.create(e,t,null)})),$=S("Object Pattern",O(T(D("{"),D("}"),v(C(Y,g("object pattern element",V)))),s.ObjectPattern.create)),J=S("As Pattern",M(y(f(L(R,D("#"))),g("object or array pattern",p(X,$))),s.AsPattern.create)),W=S("Import Pattern",b(_("import"),M(y(H,q),s.ImportPattern.create))),I=S("Unpack",p(X,$,J,R)),q=S("Top Level Pattern",p(U,I)),t.listPattern=B,t.listPattern0=j,t.pattern=F,t.unpack=I,t.topLevelPattern=q,t.identifierPattern=R,t.sinkPattern=U,t.ellipsisPattern=z,t.importPattern=W,t.arrayPattern=X,t.objectPatternElement=V,t.objectPattern=$,t.asPattern=J}),define("khepri-parse/parse/function_parser",["require","exports","bennu/parse","bennu/lang","khepri-ast/expression","khepri-ast/statement","khepri-ast/pattern","./common","./token_parser","./value_parser","./pattern_parser","./expression_parser"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=n.attempt,p=n.bind,d=n.binds,v=n.choice,m=n.eager,g=n.either,y=n.enumeration,b=n.expected,w=n.next,E=n.optional,S=n.late,x=n.label,T=r.sepBy,N=r.sepBy1,C=r.then,k=u.node,L=u.nodea,A=a.keyword,O=a.punctuator,M=f.identifier,_=l.topLevelPattern,D=l.listPattern0,P=l.ellipsisPattern,H=l.unpack,B=l.identifierPattern,j,F,I,q,R,U=S(function(){var t=e("./statement_parser"),n=t.blockStatement;return n}),z=S(function(){var t=e("./expression_parser"),n=t.expression;return n}),W=(R=_,m(D(b("pattern",R),P,b("non-ellipsis pattern",R)))),X=w(O("="),H);j=x("Argument List",L(y(W,E(X)),function(e,t,n){return o.ArgumentsPattern.create(e,null,t,n)})),F=x("Named Argument List",L(y(h(C(E(B),O("("))),C(W,O(")")),E(X)),o.ArgumentsPattern.create)),I=x("Arguments Pattern",g(F,j));var V,$;q=x("Function Expression",(V=E(w(A("function"),E(M))),$=g(U,C(z,E(O("§")))),L(y(V,w(O("\\"),I),w(O("->"),b("function body",$))),i.FunctionExpression.create))),t.argumentList=j,t.namedArgumentList=F,t.argumentsPattern=I,t.functionExpression=q}),define("khepri-parse/parse/expression_parser",["require","exports","bennu/parse","bennu/lang","nu-stream/stream","khepri-ast/declaration","khepri-ast/expression","khepri-ast/value","khepri-ast/position","./common","./token_parser","./value_parser","./pattern_parser","./function_parser"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){var d=n.always,v=n.append,m=n.attempt,g=n.bind,y=n.binds,b=n.choice,w=n.eager,E=n.either,S=n.enumeration,x=n.expected,T=n.many,N=n.memo,C=n.next,k=n.optional,L=n.rec,A=n.late,O=n.label,M=r.between,_=r.chainl1,D=r.sepBy,P=r.sepBy1,H=r.then,B=i.foldl,j=i.foldr,F=a.SourceLocation,I=f.node,q=f.nodea,R=f.precedence,U=l.keyword,z=l.punctuator,W=c.identifier,X=c.literal,V=c.stringLiteral,$=c.numericLiteral,J=h.topLevelPattern,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt=A(function(){var t=e("./function_parser"),n=t.functionExpression;return n});ct=A(function(){return ct}),tt=A(function(){return tt}),rt=A(function(){return tt});var yt=O("Arguments",(pt=ct,I(M(z("("),z(")"),w(D(z(","),x("argument",pt)))),function(e,t){return t.loc=e,t}))),bt,wt;K=O("Array Literal",(bt=ct,wt=D(z(","),x("array element",bt)),I(M(z("["),z("]"),w(wt)),o.ArrayExpression.create)));var Et,St,xt;Q=O("Object Literal",(Et=b(V,$,W),St=O("Property Initializer",q(S(H(Et,z(":")),ct),u.ObjectValue.create)),xt=D(z(","),x("object property",St)),I(M(z("{"),z("}"),w(xt)),o.ObjectExpression.create)));var Tt=O("Let Binding",q(S(x("pattern",J),z("=","=:",":="),x("bound value",ct)),function(e,t,n,r){return s.Binding.create(e,t,r,n.value===":=")})),Nt,Ct;Y=O("Let Expression",(Nt=P(z(","),Tt),Ct=ct,q(C(U("let"),S(x("let bindings",w(Nt)),C(U("in"),x("let body expression",Ct)))),o.LetExpression.create))),at=O("Conditional Expression",q(C(z("?"),S(ct,C(z(":"),x("conditional consequent expression",ct)),C(z(":"),x("conditional alternate expression",ct)))),o.ConditionalExpression.create));var kt=O("Unary Operator Expression",E(E(U("typeof"),z("void","~","!","++","--")).map(function(e){var t=e.loc,n=e.value;return o.UnaryOperatorExpression.create(t,n)}),m(C(z("."),W).map(function(e){var t=e.loc,n=e.name;return o.UnaryOperatorExpression.create(t,n)})))),Lt=O("Binary Operator Expression",q(S(k(!1,U("_")),E(U("instanceof","new"),z(".","*","/","+","-","%","<<",">>",">>>","<",">","<=",">=","==","!=","===","!==","&","^","|","||","&&","|>","\\>","\\>>","<|","<\\","<<\\","@"))),function(e,t,n){return o.BinaryOperatorExpression.create(e,n.value,!!t)})),At=O("Ternary Operator Expression",z("?").map(function(e){var t=e.loc,n=e.value;return o.TernaryOperatorExpression.create(t,n)})),Ot;G=O("Operator Expression",(Ot=b(kt,Lt,At),q(M(z("("),z(")"),S(Ot,k(C(z(","),w(P(z(","),x("argument",ct))))))),function(e,t,n){return n?o.CurryExpression.create(e,t,n):t}))),Z=O("Primary Expression",b(Y,at,W,X,K,Q,gt,m(G),M(z("("),z(")"),x("expression",ct))));var Mt=O("Argument List",E(m(I(G,function(e,t){var n=[t];return n.loc=e,n})),yt));et=O("Accessor",I(C(z("."),E(W.map(function(e){return[e,!1]}),M(z("("),z(")"),x("accessor expression",ct)).map(function(e){return[e,!0]}))),function(e,t){var n=t[0],r=t[1];return{loc:e,property:n,computed:r}})),nt=O("New Expression",q(C(U("new"),S(x("member expression",tt),x("argument list",E(yt,w(S(rt)))))),o.NewExpression.create));var _t,Dt;tt=O("Member Expression",y(S(E(Z,nt),T(N(et))),(_t=B.bind(null,function(e,t){return o.MemberExpression.create(F.merge(e.loc,t.loc),e,t.property,t.computed)}),Dt=d,function(){return Dt(_t.apply(null,arguments))})));var Pt=O("Call Expression",(dt=function(e,t){return t.hasOwnProperty("property")?o.MemberExpression.create(F.merge(e.loc,t.loc),e,t.property,t.computed):o.CallExpression.create(F.merge(e.loc,t.loc),e,t)},y(S(tt,T(E(Mt,et))),(vt=B.bind(null,dt),mt=d,function(){return mt(vt.apply(null,arguments))})))),Ht,Bt,jt;rt=O("Curry Expression",(Ht=function(e,t){return o.CurryExpression.create(F.merge(e.loc,t.loc),e,[].concat(t))},y(S(Pt,T(C(z("@"),x("curry argument",E(Mt,Pt))))),(Bt=B.bind(null,Ht),jt=d,function(){return jt(Bt.apply(null,arguments))})))),it=O("Call Expression",_(d(function(e,t){return o.CallExpression.create(F.merge(e.loc,t.loc),e,[t])}),rt)),st=O("Unary Operator",E(U("typeof","void"),z("++","--","~","!")));var Ft;ot=O("Unary Expression",(Ft=function(e,t){return o.UnaryExpression.create(F.merge(t.loc,e.loc),t.value,e)},y(S(T(st),x("unary argument",it)),function(e,t){return d(j(Ft,t,e))})));var It=[{sep:z("*","/","%"),precedence:1,node:o.BinaryExpression},{sep:z("+","-"),precedence:2,node:o.BinaryExpression},{sep:z("<<",">>",">>>"),precedence:3,node:o.BinaryExpression},{sep:E(z("<",">","<=",">="),U("instanceof")),precedence:4,node:o.BinaryExpression},{sep:z("==","!=","===","!=="),precedence:5,node:o.BinaryExpression},{sep:z("&"),precedence:6,node:o.BinaryExpression},{sep:z("^"),precedence:7,node:o.BinaryExpression},{sep:z("|"),precedence:8,node:o.BinaryExpression},{sep:z("\\>","\\>>"),precedence:9,right:!0,node:o.BinaryExpression},{sep:z("<\\","<<\\"),precedence:9,node:o.BinaryExpression},{sep:z("|>"),precedence:10,node:o.BinaryExpression},{sep:z("<|"),precedence:10,right:!0,node:o.BinaryExpression},{sep:z("||"),precedence:11,node:o.LogicalExpression},{sep:z("&&"),precedence:12,node:o.LogicalExpression}];ut=O("Binary Expression",R(N(ot),It)),ct=ut;var qt,Rt;ft=O("Left Hand Reference Expression",y(S(W,T(N(et))),(qt=B.bind(null,function(e,t){return o.MemberExpression.create(F.merge(e.loc,t.loc),e,t.property,t.computed)}),Rt=d,function(){return Rt(qt.apply(null,arguments))}))),lt=O("Assignment Expression",L(function(e){return q(v(m(S(ft,z("=",":="))),S(x("expression",E(e,ct)))),function(e,t,n,r){return o.AssignmentExpression.create(e,n.value,t,r)})}));var Ut=O("Delete Expression",I(C(U("delete"),x("reference expression",ft)),function(e,t){return o.UnaryExpression.create(e,"delete",t)}));ht=b(Ut,lt,ct),t.arrayLiteral=K,t.objectLiteral=Q,t.operatorExpression=G,t.letExpression=Y,t.primaryExpression=Z,t.accessor=et,t.memberExpression=tt,t.newExpression=nt,t.curryExpression=rt,t.applicationExpression=it,t.unaryOperator=st,t.unaryExpression=ot,t.binaryExpression=ut,t.conditionalExpression=at,t.leftHandReferenceExpression=ft,t.assignmentExpression=lt,t.expression=ct,t.topLevelExpression=ht}),define("khepri-parse/parse/statement_parser",["require","exports","nu-stream/stream","bennu/parse","bennu/lang","khepri-ast/clause","khepri-ast/declaration","khepri-ast/statement","./common","./token_parser","./expression_parser","./pattern_parser","./value_parser"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){var p=n.NIL,d=r.append,v=r.choice,m=r.cons,g=r.eager,y=r.either,b=r.enumeration,w=r.expected,E=r.many,S=r.next,x=r.optional,T=r.label,N=r.late,C=i.between,k=i.sepBy1,L=i.then,A=a.node,O=a.nodea,M=f.keyword,_=f.punctuator,D=l.expression,P=l.topLevelExpression,H=c.importPattern,B=c.topLevelPattern,j=h.identifier,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot;Z=N(function(){return Z});var ut=_(";"),at=g(E(Z));F=T("Block Statement",A(C(_("{"),_("}"),at),u.BlockStatement.create)),R=T("Empty Statement",A(ut,u.EmptyStatement.create)),Y=T("Debugger Statement",A(S(M("debugger"),ut),u.DebuggerStatement.create)),U=T("Expression Statement",A(L(P,ut),u.ExpressionStatement.create));var ft,lt;I=T("Static Statement",(ft=A(j,o.StaticDeclarator.create),lt=g(k(_(","),ft)),A(C(M("static"),ut,lt),o.StaticDeclaration.create)));var ct=(et=b(_("=",":=","=:"),w("variable initilizer",D)),tt=O(m(j,x(p,et)),function(e,t,n,r){return o.VariableDeclarator.create(e,t,r,n&&(n.value===":="||n.value==="=:"),!n||n.value!=="=:")}),g(k(_(","),tt)));q=T("Variable Statement",A(C(M("var"),ut,ct),o.VariableDeclaration.create));var ht,pt,dt;W=T("With Statement",(ht=w("pattern",B),pt=y(H,O(b(ht,_("=","=:",":="),D),function(e,t,n,r){return o.Binding.create(e,t,r,n.value===":=")})),dt=g(k(_(","),pt)),O(b(C(M("with"),M("in"),w("with bindings",dt)),F),u.WithStatement.create)));var vt,mt;z=T("If Statement",(vt=C(_("("),_(")"),w("if condition",D)),mt=S(M("else"),Z),O(S(M("if"),b(vt,Z,x(mt))),u.IfStatement.create)));var gt,yt,bt,wt;K=T("Switch Statement",(gt=O(b(C(M("case"),_(":"),w("case test",D)),at),s.SwitchCase.create),yt=A(S(M("default"),S(_(":"),at)),function(e,t){return s.SwitchCase.create(e,null,t)}),bt=E(gt),wt=g(C(_("{"),_("}"),d(x(p,bt),x(p,b(yt))))),O(S(M("switch"),b(C(_("("),_(")"),w("switch discriminant",D)),wt)),u.SwitchStatement.create)));var Et=T("While Statement",(nt=C(_("("),_(")"),D),O(S(M("while"),b(nt,Z)),u.WhileStatement.create))),St=T("Do While Statement",(rt=C(_("("),_(")"),D),O(S(M("do"),b(F,C(M("while"),ut,rt))),u.DoWhileStatement.create))),xt=T("For Statement",(it=y(A(S(M("var"),ct),o.VariableDeclaration.create),P),st=D,ot=P,O(S(M("for"),b(S(_("("),x(it)),S(ut,x(st)),S(ut,x(ot)),S(_(")"),Z))),u.ForStatement.create)));X=T("Iteration Statement",v(St,Et,xt)),V=T("Continue Statement",A(S(M("continue"),ut),u.ContinueStatement.create)),$=T("Break Statement",A(S(M("break"),ut),u.BreakStatement.create)),J=T("Return Statement",A(C(M("return"),ut,x(D)),u.ReturnStatement.create)),Q=T("Throw Statement",A(C(M("throw"),ut,D),u.ThrowStatement.create));var Tt,Nt;G=T("Try Statement",(Tt=O(S(M("catch"),b(C(_("("),_(")"),j),F)),s.CatchClause.create),Nt=S(M("finally"),F),O(S(M("try"),b(F,x(Tt),x(Nt))),u.TryStatement.create))),Z=w("statement",T("Statement",v(F,I,q,R,z,W,X,V,$,J,K,Q,G,Y,U))),t.blockStatement=F,t.staticStatement=I,t.variableStatement=q,t.emptyStatement=R,t.expressionStatement=U,t.ifStatement=z,t.withStatement=W,t.iterationStatement=X,t.continueStatement=V,t.breakStatement=$,t.returnStatement=J,t.switchStatement=K,t.throwStatement=Q,t.tryStatement=G,t.debuggerStatement=Y,t.statement=Z}),define("khepri-parse/parse/package_parser",["require","exports","bennu/parse","bennu/lang","khepri-ast/package","./common","./token_parser","./value_parser","./statement_parser"],function(e,t,n,r,i,s,o,u,a){var f=n.eager,l=n.either,c=n.enumeration,h=n.expected,p=n.next,d=n.optional,v=n.label,m=n.late,g=r.between,y=r.sepBy,b=s.node,w=s.nodea,E=o.keyword,S=o.punctuator,x=u.identifier,T=u.stringLiteral,N=a.withStatement,C=a.blockStatement,k,L=v("Package Export",l(b(x,i.PackageExport.create),w(c(T,p(S(":"),x)),function(e,t,n){return i.PackageExport.create(e,n,t)}))),A=v("Package Export List",b(g(S("("),S(")"),f(y(d(S(",")),L))),i.PackageExports.create)),O=v("Package Exports",l(A,b(x,i.PackageExport.create))),M=v("Package Body",l(N,C));k=v("Package",w(p(E("package"),c(h("package exports",O),h("package body",M))),i.Package.create)),t.khepriPackage=k}),define("khepri-parse/parse/program_parser",["require","exports","bennu/parse","bennu/lang","khepri-ast/program","./common","./package_parser","./statement_parser"],function(e,t,n,r,i,s,o,u){var a=n.eager,f=n.either,l=n.eof,c=n.many,h=n.label,p=n.late,d=r.then,v=s.node,m=o.khepriPackage,g=u.statement,y,b,w;y=g,b=a(c(y)),w=h("Program",v(d(f(m,b),l),i.Program.create)),t.sourceElement=y,t.sourceElements=b,t.program=w}),define("khepri-parse/parse/parser",["require","exports","bennu/parse","nu-stream/stream","khepri-ast/position","./program_parser"],function(e,t,n,r,i,s){var o=n.ParserState,u=r.filter,a=r.isEmpty,f=r.first,l=r.from,c=i.SourceLocation,h=i.SourcePosition,p=s.program,d,v,m,g;d=u.bind(null,function(e){switch(e.type){case"Whitespace":case"LineTerminator":case"Comment":return!1;default:return!0}}),v=function(e,t,n){var r=this;r.tokenPosition=e,r.sourcePosition=t,r.prevEnd=n},v.prototype=new n.Position,v.prototype.constructor=v,v.initial=new v(n.Position.initial,h.initial,n.Position.initial),v.prototype.increment=function(e,t){var n=this;return new v(n.tokenPosition.increment(e),a(t)?e.loc.end:f(t).loc.start,e.loc.end)},v.prototype.toString=function(){var e=this;return""+e.sourcePosition},v.prototype.compare=function(e){var t=this;return t.tokenPosition.compare(e.tokenPosition)},g=function(e){return n.runState(p,new o(d(e),v.initial))};var y=l,b=g;m=function(e){return b(y(e))},t.parserStream=d,t.ParserPosition=v,t.parseInput=m,t.parseStream=g}),define("akh/base",["require","exports"],function(e,t){var n,r,i,s,o,u,a,f,l,c,h;n=function(e,t){return e.chain(t)},r=function(e,t){return t.map(e)},i=function(e,t){return e.ap(t)},s=function(e,t){return e.concat(t)},o=r,u=function(e,t,n){return t.chain(function(t){return n.map(function(n){return e(t,n)})})},a=function(e,t){return t.of(e).ap(t)},f=function(e,t,n){return t.of(function(t){return function(n){return e(t,n)}}).ap(t).ap(n)},l=function(e,t){return e.chain(function(){return t})},c=function(e){return Array.prototype.reduce.call(e,l)},h=function(){var e=arguments;return Array.prototype.reduce.call(e,l)},t.chain=n,t.map=r,t.ap=i,t.concat=s,t.liftM=o,t.liftM2=u,t.liftA=a,t.liftA2=f,t.next=l,t.sequencea=c,t.sequence=h}),define("akh/structure",["require","exports","./base"],function(e,t,n){var r=n.liftA2,i,s,o,u,a,f,l,c,h=function(e,t){return e.bind(null,t)};i=function(e,t,i){return e.prototype.of=t,e.of=e.prototype.of,e.ap=n.ap,e.prototype.ap=i,o(e,e.prototype.map||function(e){var n=this;return t(e).ap(n)}),e.ac=r.bind(null,h),e.prototype.ac=function(e){var t=this;return r(h,t,e)},e},s=function(e,t){return e.chain=n.chain,e.prototype.chain=t,e},o=function(e,t){return e.map=n.map,e.prototype.map=t,e},a=function(e,t,n){return e.prototype.zero=t,e.zero=e.prototype.zero,f(e,n),e},u=function(e,t,n){return e.prototype.of=t,e.of=e.prototype.of,s(e,n),o(e,e.prototype.map||function(e){var t,n=this;return n.chain((t=n.of,function(n){return t(e(n))}))}),i(e,t,e.prototype.ap||function(e){var t=this;return t.chain(function(t){return e.map(t)})}),e},f=function(e,t){return e.concat=n.concat,e.prototype.concat=t,e};var p=function(e,t,n){if(n.liftInner){var r;t.liftInner=p(e,(r=n.liftInner,function(t){return e(r(t))}),n.liftInner)}return t};l=function(e,t,n){if(t.lift){var r;e.prototype.liftInner=p(n,(r=t.lift,function(e){return n(r(e))}),t),e.liftInner=e.prototype.liftInner}return e},c=function(e,t,n){return e.prototype.inner=t,e.inner=e.prototype.inner,e.prototype.lift=n,e.lift=e.prototype.lift,l(e,t,n),e},t.Applicative=i,t.Chain=s,t.Functor=o,t.Monad=u,t.Monoid=a,t.Semigroup=f,t.LiftInner=l,t.Transformer=c}),define("akh/identity",["require","exports","./structure"],function(e,t,n){var r=n.Functor,i=n.Monad,s;return s=function(e){var t=this;t.value=e},i(s,function(e){return new s(e)},function(e){var t=this;return e(s.runIdentity(t))}),s.runIdentity=function(e){return e.value},s}),define("akh/spec/error",["require","exports"],function(e,t){var n;return n=function(e,t,n){e.prototype.fail=t,e.fail=e.prototype.fail,e.prototype.handle=n,e.handle=function(e,t){return e.handle(t)}},n}),define("akh/spec/state",["require","exports"],function(e,t){var n;return n=function(e,t,n){e.prototype.get=t,e.get=e.prototype.get,e.prototype.put=n,e.put=e.prototype.put,e.prototype.modify=function(e){return t.chain(function(t){return n(e(t))})},e.modify=e.prototype.modify},n.tryLiftState=function(e,t){var r,i;t.get&&t.put&&n(e,e.lift(t.get),(r=e.lift,i=t.put,function(e){return r(i(e))}))},n}),define("akh/spec/either",["require","exports"],function(e,t){var n;return n=function(e,t,n){e.prototype.right=n,e.right=e.prototype.right,e.prototype.left=t,e.left=e.prototype.left},n}),define("akh/trans/either",["require","exports","../structure","../spec/either","../spec/state"],function(e,t,n,r,i){var s=n.Monad,o=n.Monoid,u=n.Transformer,a;return a=function(e){var t,n,a,f=function(e){var t=this;t.run=e};return s(f,(t=e.of,function(e){var n={right:!0,x:e},r=t(n);return new f(r)}),function(t){var n=this;return new f(n.run.chain(function(n){var r,i=n.right,s=n.x;return i?(r=t(s),r.run):e.of({right:!1,x:s})}))}),o(f,new f(e.of((n=e.zero,{right:!1,x:n}))),function(t){var n=this;return new f(n.run.chain(function(n){var r=n.right,i=n.x;return r?e.of({right:!0,x:i}):t.run}))}),u(f,e,function(t){return new f(t.chain(function(t){return e.of({right:!0,x:t})}))}),r(f,(a=e.of,function(e){var t={right:!1,x:e},n=a(t);return new f(n)}),f.of),i.tryLiftState(f,e),f},a.eitherT=function(e,t,n){return e.run.chain(function(e){var r=e.right,i=e.x;return r?n(i):t(i)})},a}),define("akh/trans/error",["require","exports","../structure","../spec/error","../spec/state","./either"],function(e,t,n,r,i,s){var o=n.Monad,u=n.Monoid,a=s.eitherT,f;return f=function(e){var t=s(e);return r(t,t.left,function(e){var t=this;return f.runErrorT(t,t.of,e)}),i.tryLiftState(t,e),t},f.runErrorT=function(e,t,n){return a(e,n,t)},f}),define("akh/error",["require","exports","./identity","./trans/error"],function(e,t,n,r){var i=r.runErrorT,s,o=function(e){return e};s=r(n);var u=function(e,t,r){var s,o;return i(e,(s=n.of,function(e){return s(t(e))}),(o=n.of,function(e){return o(r(e))}))},a=n.runIdentity;return s.runError=function(){return a(u.apply(null,arguments))},s.tryError=function(e,t){return s.runError(e,o,t)},s.attemptError=function(e,t){return s.tryError(e,function(){return t})},s}),define("nu-stream/select",["require","exports","./stream"],function(e,t,n){var r=n.NIL,i=n.first,s=n.isEmpty,o=n.map,u=n.stream,a=n.rest,f=n.indexed,l,c,h,p,d=function(e){var t=e[1];return t};l=function(e,t){var n;return s(t)?t:(n=i(t),e(n)?u(n,l.bind(null,e,a(t))):r)},c=function(e,t){return isNaN(e)||e<0?t:o(d,l(function(t){var n=t[0];return e>n},f(t)))},h=function(e,t){for(var n=t;!s(n);n=a(n))if(!e(i(n)))return n;return r},p=function(e,t){return isNaN(e)||e<=0?t:o(d,h(function(t){var n=t[0];return e>n},f(t)))},t.takeWhile=l,t.take=c,t.skipWhile=h,t.skip=p}),define("neith/zipper",["require","exports","nu-stream/stream","nu-stream/select"],function(e,t,n,r){var i=n.append,s=n.cons,o=n.first,u=n.rest,a=n.isEmpty,f=n.map,l=n.NIL,c=n.reverse,h=n.stream,p=r.skip,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt=Function.prototype.call.bind(Array.prototype.reduceRight),rt=function(e,t,n){var r=this;r.loc=e,r.children=t,r.constructNode=n};rt.prototype.setLoc=function(e){var t=this;return new rt(e,t.children,t.constructNode)};var it=function(e,t,n){var r=this;r.focus=e,r.dirty=t,r.children=n};it.prototype.setDirty=function(e){var t=this;return t.dirty=e,e&&(t.children=null),t},it.prototype.setChildren=function(e){var t=this;return t.children=e,t};var st=f.bind(null,function(e){return new it(e)}),ot=f.bind(null,function(e){return e.focus}),ut=function(e,t,n,r){var i=this;i.focus=e,i.parent=t,i.left=n,i.right=r};ut.empty=new ut(null,null,l,l),ut.prototype.setFocus=function(e){var t=this;return new ut(e,t.parent,t.left,t.right)},ut.prototype.setParent=function(e){var t=this;return new ut(t.focus,e,t.left,t.right)},ut.prototype.setLeft=function(e){var t=this;return new ut(t.focus,t.parent,e,t.right)},ut.prototype.setRight=function(e){var t=this;return new ut(t.focus,t.parent,t.left,e)};var at=function(e,t,n,r){return new ut(n,e.parent,t,r)},ft=function(e){if(e.loc.focus.children)return e.loc.focus.children;var t=st(v(e));return e.loc.focus.setChildren(t),t},lt=function(e){var t=e.loc;return t.focus},ct=function(e){var t=e.loc;return t.parent},ht=function(e){var t=e.loc;return t.left},pt=function(e){var t=e.loc;return t.right},dt=function(e){var t=e.parent;return t&&t.focus.setDirty(!0),e},vt=function(e,t,n){return new it(e.constructNode(t,ot(n)),!1,n)},mt=function(e){return vt(e,ct(e).focus.focus,i(c(ht(e)),s(lt(e),l),pt(e)))};d=function(e){var t=lt(e);return t.focus},g=function(e){return e?h(d(e),function(){return g(k(e))}):l},y=function(e){return ot(ht(e))},b=function(e){return ot(pt(e))},m=function(e){var t;return d((t=ct(e),t&&t.focus.dirty?dt(t.setFocus(mt(e))):t))},v=function(e){return e.children(d(e))};var gt=a,yt=ft;T=function(e){return gt(yt(e))};var bt=T;w=function(e){var t=bt(e);return!t},E=function(e){var t=ct(e);return null!==t};var wt=E;S=function(e){var t=wt(e);return!t},x=E;var Et=a;N=function(e){return Et(ht(e))};var St=a;C=function(e){return St(pt(e))},k=function(e){var t;return S(e)?null:e.setLoc((t=ct(e),t&&t.focus.dirty?dt(t.setFocus(mt(e))):t))},L=function(e){var t,n=ft(e);return a(n)?null:(t=new ut(o(n),e.loc,l,u(n)),e.setLoc(t))},A=function(e){var t,n;return N(e)?null:(t=ht(e),n=at(e.loc,u(t),o(t),s(lt(e),pt(e))),e.setLoc(n))},O=function(e){var t,n;return C(e)?null:(t=pt(e),n=at(e.loc,s(lt(e),ht(e)),o(t),u(t)),e.setLoc(n))},M=function(e,t,n){return n&&e(n)?M(e,t,t(n)):n},_=function(e,t){var n=e(t);return n?_(e,n):t};var xt=function(e,t){return function(n){var r;return n&&(r=t(n),r&&e(r))}};D=function(){var e=arguments;return nt(e,xt)};var Tt=function(e,t){return function(n){return n&&(t(n)||e(n))}};P=function(){var e=arguments;return nt(e,Tt)},H=_.bind(null,k),B=_.bind(null,A),j=_.bind(null,O),F=_.bind(null,L),I=_.bind(null,D(L,j)),q=function(e){var t=k(e);return t?O(t)||q(t):t},R=P(L,O,q),U=function(e){var t=A(e);return t?I(t):k(e)},z=function(e,t){var n=new it(e),r=t.loc,i=r.setFocus(n),s=t.setLoc(i),o=dt(s.loc);return s.setLoc(o)},W=function(e,t){var n=e(d(t)),r=new it(n),i=t.loc,s=i.setFocus(r),o=t.setLoc(s),u=dt(o.loc);return o.setLoc(u)},X=function(e){var t;return C(e)?N(e)?E(e)?(t=ct(e).setFocus(vt(e,ct(e),l)),e.setLoc(t)):null:J(l,A(e)):$(p.bind(null,1),O(e))},V=function(e,t){var n=t.loc,r=n.setLeft(st(e)),i=t.setLoc(r),s=dt(i.loc);return i.setLoc(s)},$=function(e,t){return V(e(ot(ht(t))),t)},J=function(e,t){var n=t.loc,r=n.setRight(st(e)),i=t.setLoc(r),s=dt(i.loc);return i.setLoc(s)},K=function(e,t){return J(e(ot(pt(t))),t)},Q=function(e,t){return $(s.bind(null,e),t)},G=function(e,t){return K(s.bind(null,e),t)},Y=function(e,t){var n,r,i,o,u,a;return w(t)?k(Q(e,L(t))):(n=vt(t,d(t),s(new it(e),l)).focus,r=new it(n),i=t.loc,o=i.setFocus(r),u=t.setLoc(o),a=dt(u.loc),u.setLoc(a))},Z=function(e,t){return w(t)?k(G(e,j(L(t)))):Y(e,t)},et=function(e){var t=ut.empty.setFocus(new it(d(e)));return e.setLoc(t)},tt=function(e,t,n){return new rt(ut.empty.setFocus(new it(n)),e,t)},t.extract=d,t.children=v,t.parent=m,t.path=g,t.lefts=y,t.rights=b,t.hasChildren=w,t.hasParent=E,t.isRoot=S,t.isChild=x,t.isLeaf=T,t.isFirst=N,t.isLast=C,t.up=k,t.down=L,t.left=A,t.right=O,t.whilst=M,t.recur=_,t.seq=D,t.any=P,t.root=H,t.leftmost=B,t.rightmost=j,t.leftLeaf=F,t.rightLeaf=I,t.nextUpDfs=q,t.nextDfs=R,t.prevDfs=U,t.replace=z,t.modify=W,t.remove=X,t.setLefts=V,t.modifyLefts=$,t.setRights=J,t.modifyRights=K,t.insertLeft=Q,t.insertRight=G,t.insertChild=Y,t.appendChild=Z,t.detach=et,t.zipper=tt}),define("neith/tree",["require","exports","./zipper","nu-stream/stream"],function(e,t,n,r){var i=n.right,s=n.left,o=n.up,u=n.down,a=r.foldl,f=r.map,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;l=function(e,t){return{key:e,value:t}},c=function(e){return e.key},h=function(e){return e.value};var _=n.extract;v=function(e){var t=_(e);return t.value};var D=n.extract;m=function(e){var t=D(e);return t.key};var P=n.path,H=f.bind(null,h);d=function(e){return H(P(e))};var B=n.path,j=f.bind(null,c);p=function(e){return j(B(e))};var F=n.parent;y=function(e){var t=F(e);return t.value};var I=n.children,q=f.bind(null,h);b=function(e){return q(I(e))};var R=n.children,U=f.bind(null,c);w=function(e){return U(R(e))},g=function(e,t){var n=E(e,t);return n&&v(n)},S=function(e,t){var r,o,u;return(r=s,n.whilst(function(t){var n=m(t);return e!==n},r,t))||(o=i,u=i(t),n.whilst(function(t){var n=m(t);return e!==n},o,u))},E=function(e,t){return S(e,u(t))},x=function(e,t){var r;return n.replace((r=m(t),{key:r,value:e}),t)},T=function(e,t){return x(e(v(t)),t)},N=function(e,t){var r;return n.replace((r=v(t),{key:e,value:r}),t)},C=function(e,t){return N(e(m(t)),t)},k=function(e,t,r){return n.insertLeft({key:e,value:t},r)},L=function(e,t,r){return n.insertRight({key:e,value:t},r)},A=function(e,t,r){return n.insertChild({key:e,value:t},r)},O=function(e,t,r){return n.appendChild({key:e,value:t},r)};var z=function(e,t){var n=t.key,r=t.value;return e.hasOwnProperty(n)||(e[n]=r),e};M=function(e,t,r,i){var s=function(n){var r=n.value;return f(function(e){var n=t(r,e);return{key:e,value:n}},e(r))},o=function(e,t){var n=e.key,i=r(e.value,t,a.bind(null,z,{},t));return{key:n,value:i}};return n.zipper(s,o,{key:null,value:i})},t.Pair=l,t.pairKey=c,t.pairValue=h,t.edgePath=p,t.nodePath=d,t.node=v,t.edge=m,t.childNode=g,t.parentNode=y,t.childNodes=b,t.edges=w,t.child=E,t.sibling=S,t.setNode=x,t.modifyNode=T,t.setEdge=N,t.modifyEdge=C,t.insertLeft=k,t.insertRight=L,t.insertChild=A,t.appendChild=O,t.treeZipper=M}),define("khepri-ast-zipper",["require","exports","nu-stream/gen","nu-stream/stream","neith/tree","khepri-ast/node"],function(e,t,n,r,i,s){var o=n.range,u=r.foldl,a=r.from,f=r.NIL,l=i.treeZipper,c=s.Node,h=s.modify,p,d,v,m,g=function(e){return u(function(e,t){var n=t.key,r=t.value;return e[n]=r,e},[],e)};v=function(e){return e?Array.isArray(e)?o(0,e.length):a(e.children):f},d=function(e,t){return e[t]},m=function(e,t,n){return e?Array.isArray(e)?g(t):h(e,n(),{}):e},p=l.bind(null,v,d,m),t.khepriZipper=p,t.getChild=d,t.getChildren=v,t.construct=m}),define("khepri-compile/pseudo/pattern",["require","exports","khepri-ast/node","khepri-ast/pattern"],function(e,t,n,r){var i=n.defineNode,s=n.Node,o=r.Pattern,u,a;u=i(o,"RelativeUnpack",["pattern"],["index","min"],function(e,t,n,r){var i=this;s.call(i,e),i.pattern=t,i.index=n,i.min=r}),a=i(o,"SliceUnpack",["pattern"],["from","to"],function(e,t,n,r){var i=this;s.call(i,e),i.pattern=t,i.from=n,i.to=r}),t.RelativeUnpack=u,t.SliceUnpack=a}),define("khepri-compile/ast",["require","exports"],function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;n=function(e){return e&&e.type},r=function(e){return n(e)==="Identifier"},i=function(e){return n(e)==="Literal"},s=function(e){return o(e)&&!isNaN(e.value)},o=function(e){return i(e)&&(e.kind==="string"||e.kind==="number"||e.kind==="boolean"||e.kind==="null")},u=function(e){return i(e)||e.type==="ArrayExpression"||e.type==="ObjectExpression"},a=function(e){return(o(e)||e.type==="ArrayExpression")&&(e.elements.every(a)||e.type==="ObjectExpression")&&e.elements.every(function(e){return a(e.value)})},f=function(e){return o(e)&&!!e.value},l=function(e){return n(e)==="FunctionExpression"&&n(e.body)==="BlockStatement"},c=function(e){return n(e)==="FunctionExpression"&&!e.id&&!l(e)&&!e.params.self&&!e.params.id&&(!e.params.ud||!e.params.ud.arguments)},h=function(e,t){return t&&t.ud&&t.ud[e]},p=h.bind(null,"uid"),t.type=n,t.isIdentifier=r,t.isLiteral=i,t.isNumberish=s,t.isPrimitive=o,t.isSimple=u,t.isPod=a,t.isTruthy=f,t.isBlockFunction=l,t.isLambda=c,t.getUd=h,t.getUid=p}),define("khepri-compile/fun",["require","exports"],function(e,t){var n,r,i,s,o,u,a,f,l,c,h;n=function(e){return function(){return e}},r=function(e){return function(t,n){return e(n,t)}},i=Function.prototype.call.bind(Array.prototype.reduce),s=Function.prototype.call.bind(Array.prototype.reduceRight),o=function(e,t,n){return i(n,e,t)},u=function(e,t,n){return s(n,e,t)},a=Array.prototype.concat.bind([]),f=function(e,t){return Array.prototype.filter.call(t,e)},l=function(e,t){return Array.prototype.map.call(t,e)},c=function(e){return Array.isArray(e)?Array.prototype.concat.apply([],e.filter(function(e){return!!e})):e},h=function(e){return Array.isArray(e)?c(e.map(h)):e},t.constant=n,t.flip=r,t.reduce=i,t.reduceRight=s,t.foldl=o,t.foldr=u,t.concat=a,t.filter=f,t.map=l,t.flatten=c,t.flattenr=h}),define("neith/walk",["require","exports","./zipper"],function(e,t,n){var r=n.isLeaf,i=n.up,s=n.down,o=n.right,u=n.seq,a=n.whilst,f,l,c,h,p=function(e){return e};f=function(e,t){return!t||r(t)?t:i(e(a(o,u(e,o),s(t))))},l=function(e,t,n){var r=function(n){return t(f(r,e(n)))};return t(f(r,e(n)))},c=function(e,t){return l(p,e,t)},h=function(e,t){return l(e,p,t)},t.forChildren=f,t.walk=l,t.postWalk=c,t.preWalk=h}),define("khepri-compile/rewriter",["require","exports","neith/zipper","neith/tree","neith/walk","./fun"],function(e,t,n,r,i,s){var o=i.walk,u=s.concat,a,f,l,c;a=!0,f=!1;var h=function(e,t){return t.length?r.modifyNode(function(e){return t.reduce(function(e,t){return t.map(e)},e)},e):e};l=function(){var e=this;e.peepholes=[]},l.prototype.add=function(e,t,n,r){var i=this;if(Array.isArray(e))return e.map(function(e){return i.add(e,t,n,r)});i.peepholes[e]=u(i.peepholes[e]||[],{condition:n,map:r,up:t})},l.prototype.rewriters=function(e){var t=this;return e&&t.peepholes[e.type]||[]},l.prototype.upTransforms=function(e){var t=this;return t.rewriters(e).filter(function(t){return t.up&&t.condition(e)})},l.prototype.downTransforms=function(e){var t=this;return t.rewriters(e).filter(function(t){return!t.up&&t.condition(e)})},l.prototype.transform=function(e){var t=this,n=r.node(e);return h(e,t.downTransforms(n))},l.prototype.transformPost=function(e){var t=this,n=r.node(e);return h(e,t.upTransforms(n))};var p=function(e,t){return o(e.transform.bind(e),e.transformPost.bind(e),t)},d=n.root;c=function(){return d(p.apply(null,arguments))},t.UP=a,t.DOWN=f,t.Rewriter=l,t.rewrite=c}),define("khepri-compile/pre_normalize",["require","exports","khepri-ast/node","khepri-ast/expression","khepri-ast/pattern","khepri-ast/package","khepri-ast/value","./pseudo/pattern","./ast","./fun","./rewriter"],function(e,t,n,r,i,s,o,u,a,f,l){var c=n.modify,h=n.setData,p=u.SliceUnpack,d=u.RelativeUnpack,v=a.type,m=f.concat,g=f.map,y=f.foldl,b=f.foldr,w=f.flatten,E=l.UP,S=l.DOWN,x=l.Rewriter,T=l.rewrite,N,C=o.Literal.create.bind(null,null,"string"),k=o.Literal.create.bind(null,null,"number"),L=new x;L.add("PackageExport",E,function(e){return!e.alias},function(e){return s.PackageExport.create(e.loc,e.id,C(e.id.name))}),L.add("LetExpression",E,function(e){return e.bindings.length>1},function(e){var t=e.bindings,n=e.body;return b(function(e,t){return r.LetExpression.create(null,[t],e)},n,t)}),L.add("CurryExpression",S,function(e){return e.args.length>1},function(e){var t=e.base,n=e.args;return y(function(e,t){return r.CurryExpression.create(null,e,[t])},t,n)});var A=function(e){var t=e.map(v).indexOf("EllipsisPattern");return t<0?[e,null,[]]:[e.slice(0,t),e[t],e.slice(t+1)]},O=function(e,t,n){return m(e,t&&t.id?p.create(null,t.id,e.length,n.length):[],g(function(t,r){return d.create(null,t,n.length-r,n.length+e.length)},n))};L.add("ArrayPattern",S,function(e){return!0},function(e){var t=e.loc,n=e.elements,r=A(n),s=r[0],o=r[1],u=r[2];return i.ObjectPattern.create(t,O(g(function(e,t){return i.ObjectPatternElement.create(null,k(t),e)},s),o,u))}),L.add("ArgumentsPattern",E,function(e){return e.elements.map(v).indexOf("EllipsisPattern")>=0},function(e){var t=A(e.elements),n=t[0],r=t[1],s=t[2],u=e.id||h(i.IdentifierPattern.create(null,o.Identifier.create(null,"__args")),"reserved",!0);return c(e,{id:u,elements:O(n,r,s)},{})}),L.add("ObjectPatternElement",S,function(e){return!e.target},function(e){var t=e.key;switch(t.type){case"IdentifierPattern":return i.ObjectPatternElement.create(e.loc,C(t.id.name),t);case"AsPattern":return i.ObjectPatternElement.create(e.loc,C(t.id.id.name),t);default:return e}}),L.add("AsPattern",S,function(e){return!e.target.ud||!e.target.ud.id},function(e){return i.AsPattern.create(e.loc,e.id,h(e.target,"id",e.id))}),L.add("ObjectPattern",E,function(e){return!e.ud||!e.ud.id},function(e){var t=h(i.IdentifierPattern.create(null,o.Identifier.create(null,"__o")),"reserved",!0);return i.AsPattern.create(null,t,h(e,"id",t))}),N=T.bind(null,L),t.normalize=N}),define("khepri-compile/stages/pre_normalize",["require","exports","akh/error","../pre_normalize"],function(e,t,n,r){var i;return i=function(e){var t=e.options,i=e.tree;return n.of({options:t,tree:r.normalize(i)})},i}),define("akh/trans/statei",["require","exports","../structure","../base","../spec/state"],function(e,t,n,r,i){var s=n.Monad,o=n.Monoid,u=n.Transformer,a=r.map,f,l=function(e,t){return e.run(t)};f=function(e){var t=function(e){var t=this;t.run=e};return s(t,function(n){return new t(function(t){return e.of({x:n,s:t})})},function(e){var n=this;return new t(function(t){return n.run(t).chain(function(t){var n=t.x,r=t.s,i=e(n);return i.run(r)})})}),o(t,new t(function(t){return e.zero}),function(e){var n=this;return new t(function(t){return n.run(t).concat(e.run(t))})}),u(t,e,function(n){return new t(function(t){return n.chain(function(n){return e.of({x:n,s:t})})})}),i(t,new t(function(t){return e.of({x:t,s:t})}),function(n){return new t(function(t){return e.of({x:n,s:n})})}),t},f.runStateT=l;var c=f.runStateT,h=a.bind(null,function(e){var t=e.x;return t});f.evalStateT=function(){return h(c.apply(null,arguments))};var p=f.runStateT,d=a.bind(null,function(e){var t=e.s;return t});return f.execStateT=function(){return d(p.apply(null,arguments))},f}),define("akh/_tail",["require","exports"],function(e,t){var n,r;n=function(e,t){var n=this;n.f=e,n.x=t},r=function(e){var t=e;while(t instanceof n)t=t.f(t.x);return t},t.Tail=n,t.trampoline=r}),define("akh/trans/codensity",["require","exports","../structure","../_tail","../spec/state"],function(e,t,n,r,i){var s=n.Monad,o=n.Monoid,u=n.Transformer,a=r.Tail,f=r.trampoline,l,c=function(e,t){return new a(e.run,t)};l=function(e){var t=function(e){var t=this;t.run=e};return s(t,function(e){return new t(function(t){return t(e)})},function(e){var n=this;return new t(function(t){var r=function(n){var r=e(n);return new a(r.run,t)};return new a(n.run,r)})}),o(t,new t(function(t){return e.zero}),function(e){var n=this;return new t(function(t){return l.runCodensity(n,t).concat(l.runCodensity(e,t))})}),u(t,e,function(e){return new t(function(t){var n;return e.chain((n=f,function(e){return n(t(e))}))})}),i.tryLiftState(t,e),t};var h=f;return l.runCodensity=function(){return h(c.apply(null,arguments))},l}),define("akh/trans/state",["require","exports","../structure","../base","./codensity","./statei"],function(e,t,n,r,i,s){var o=n.LiftInner,u=r.map,a,f=function(e,t){var n=i(e),r=n.lift,s=e.lift;return n.prototype.lift=function(e){return r(s(e))},n.lift=n.prototype.lift,n.inner=t,o(n,t,n.lift),n};a=function(e){return f(s(e),e)},a.runStateT=function(e,t){return s.runStateT(i.runCodensity(e,e.inner.of),t)};var l=a.runStateT,c=u.bind(null,function(e){var t=e.x;return t});a.evalStateT=function(){return c(l.apply(null,arguments))};var h=a.runStateT,p=u.bind(null,function(e){var t=e.s;return t});return a.execStateT=function(){return p(h.apply(null,arguments))},a}),define("akh/trans/unique",["require","exports","./state"],function(e,t,n){var r;return r=function(e){var t=n(e);return t.prototype.unique=t.modify(function(e){return 1+e}),t.unique=t.prototype.unique,t},r.runUniqueT=function(e,t){return n.evalStateT(e,isNaN(t)?1:t)},r}),define("akh/unique",["require","exports","./trans/unique","./identity"],function(e,t,n,r){var i;i=n(r);var s=n.runUniqueT,o=r.runIdentity;return i.runUnique=function(){return o(s.apply(null,arguments))},i}),define("zipper-m/trans/zipper",["require","exports","akh/trans/state","neith/zipper"],function(e,t,n,r){var i,s=function(e,t,n){return e.prototype.inspect=t.map.bind(t),e.inspect=e.prototype.inspect,e.prototype.extract=t.map(r.extract),e.extract=e.prototype.extract,e.inspectWith=e.extract.chain.bind(e.extract),e.prototype.move=n,e.move=e.prototype.move,e.prototype.up=n(r.up),e.up=e.prototype.up,e.prototype.down=n(r.down),e.down=e.prototype.down,e.prototype.left=n(r.left),e.left=e.prototype.left,e.prototype.right=n(r.right),e.right=e.prototype.right,e.prototype.root=n(r.root),e.root=e.prototype.root,e.prototype.leftmost=n(r.leftmost),e.leftmost=e.prototype.leftmost,e.prototype.rightmost=n(r.rightmost),e.rightmost=e.prototype.rightmost,e.prototype.leftLeaf=n(r.leftLeaf),e.leftLeaf=e.prototype.leftLeaf,e.prototype.rightLeaf=n(r.rightLeaf),e.rightLeaf=e.prototype.rightLeaf,e.prototype.replace=function(e){return n(r.replace.bind(null,e))},e.replace=e.prototype.replace,e.prototype.modify=function(e){return n(r.modify.bind(null,e))},e.modify=e.prototype.modify,e.prototype.remove=n(r.remove),e.remove=e.prototype.remove,e.prototype.insertLeft=function(e){return n(r.insertLeft.bind(null,e))},e.insertLeft=e.prototype.insertLeft,e.prototype.insertRight=function(e){return n(r.insertRight.bind(null,e))},e.insertRight=e.prototype.insertRight,e.prototype.insertChild=function(e){return n(r.insertChild.bind(null,e))},e.insertChild=e.prototype.insertChild,e.prototype.appendChild=function(e){return n(r.appendChild.bind(null,e))},e.appendChild=e.prototype.appendChild,e};return i=function(e){var t=n(e);return s(t,t.get,t.modify),t},i.runZipperT=n.evalStateT,i}),define("zipper-m/trans/tree",["require","exports","neith/zipper","neith/tree","./zipper"],function(e,t,n,r,i){var s,o=function(e){return e.node=e.inspect(r.node),e.child=function(t){return e.move(r.child.bind(null,t))},e.sibling=function(t){return e.move(r.sibling.bind(null,t))},e.modifyNode=function(t){return e.move(r.modifyNode.bind(null,t))},e.setNode=function(t){return e.move(r.setNode.bind(null,t))},e};return s=function(e){var t=i(e);return o(t),t},s.runTreeZipperT=i.runZipperT,s}),define("bes/object",["require","exports"],function(e,t){var n,r,i,s=function(e){var t=Object.getOwnPropertyNames(e),n=t.length,r={};for(var i=0;i<n;i+=1){var s=t[i];r[s]=Object.getOwnPropertyDescriptor(e,s)}return r};n=function(e,t,n,r){var i=s(e),o=i[t];return i[t]={value:n,enumerable:!o||r!==undefined?r:o.enumerable},Object.create(Object.getPrototypeOf(e),i)},r=function(e,t){var n=s(e),r=Object.keys(e);for(var i=0,o=r.length;i<o;i+=1){var u=r[i],a=n[u],f=t[u].value,l=t[u].enumerable;n[u]={value:f,enumerable:!a||l!==undefined?l:a.enumerable}}return Object.create(Object.getPrototypeOf(e),n)},i=function(e,t){var n=s(e);return delete n[t],Object.create(Object.getPrototypeOf(e),n)},t.setProperty=n,t.setProperties=r,t.deleteProperty=i}),define("bes/record",["require","exports","./object"],function(e,t,n){var r=n.setProperty,i,s,o=Function.prototype.call.bind(Array.prototype.concat),u=Function.prototype.call.bind(Array.prototype.map),a=function(e){return e.match(/\w\S*/g).map(function(e){var t=e[0];return t.toUpperCase()+e.slice(1)}).join("")},f=function(e){return function(){var t=this,n=arguments;return e.apply(t,n)}},l=function(e){var t=e.length;return function(){var n=this,r=arguments;for(var i=0;i<t;i+=1)n[e[i]]=r[i]}},c=function(e){return function(t){var n=this;return r(n,e,t)}},h=function(e){return Function.prototype.call.bind(c(e))};i=function(e,t,n){var r=n||l(t);r.__keys=t,r.prototype=Object.create(e||new Object),r.prototype.constructor=r,t.forEach(function(e){var t="set"+a(e+"");r[t]=h(e),r.prototype[t]=c(e)});var i=function(e){var t=this;return r.apply(t,e)};return i.prototype=r.prototype,r.create=function(){var e=arguments;return new i(e)},r},s=function(e,t,n){return t&&t.length?i(new e,o(e.__keys,t),n):i(new e,e.__keys,n||f(e))},t.declare=i,t.extend=s}),define("hamt",["require","exports"],function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E=Math.pow(2,5),S=E-1,x=E/2,T=E/4,N={},C=function(e){var t=e-(e>>1&1431655765),n=(t&858993459)+(t>>2&858993459),r=n+(n>>4)&252645135,i=r+(r>>8),s=i+(i>>16);return s&127},k=function(e,t,n){var r=n.slice();return r[e]=t,r},L=function(e,t){var n=t.slice();return n.splice(e,1),n},A=function(e,t,n){var r=n.slice();return r.splice(e,0,t),r};n=function(e){if(typeof e=="number")return e;var t=0;for(var n=0,r=e.length;n<r;n+=1){var i=e.charCodeAt(n);t=(t<<5)-t+i|0}return t},r=null;var O=function(e,t,n){var r=this;r.hash=e,r.key=t,r.value=n},M=function(e,t){var n=this;n.hash=e,n.children=t},_=function(e,t){var n=this;n.mask=e,n.children=t},D=function(e,t){var n=this;n.count=e,n.children=t},P=function(e){return e===null||e instanceof O||e instanceof M},H=function(e,t,n,r){var i=n,s=[],o=0;for(var u=0;i;u+=1)i&1&&(s[u]=r[o],o+=1),i>>>=1;return s[e]=t,new D(o+1,s)},B=function(e,t){var n=[],r=0;for(var i=0,s=t.length;i<s;i+=1){var o=t[i];i!==e&&!!o&&(n.push(o),r|=1<<i)}return new _(r,n)},j=function(e,t,n){var r=t.hash,i,s,o=n.hash;return r===o?new M(r,[n,t]):(i=r>>>e&S,s=o>>>e&S,new _(1<<i|1<<s,i===s?[j(e+5,t,n)]:i<s?[t,n]:[n,t]))},F=function(e,t,n){var r,i,s;return e.length?(r=e[0],i=e.slice(1),r.key===n?(s=t(r.value),N===s?i:[s].concat(i)):[r].concat(F(i,t,n))):[]},I;O.prototype.lookup=function(e,t,n){var r=this;return n===r.key?r.value:N},M.prototype.lookup=function(e,t,n){var r=this;for(var i=0,s=r.children.length;i<s;i+=1){var o=r.children[i],u=o.key,a=o.value;if(n===u)return a}return N},_.prototype.lookup=function(e,t,n){var r=this,i=t>>>e&S,s,o=1<<i;return r.mask&o?I(r.children[s=r.mask,C(s&o-1)],e+5,t,n):N},D.prototype.lookup=function(e,t,n){var r=this,i=t>>>e&S,s=r.children[i];return I(s,e+5,t,n)},I=function(e,t,n,r){return e?e.lookup(t,n,r):N};var q;O.prototype.modify=function(e,t,n,r){var i,s,o=this;return r===o.key?(i=t(o.value),N===i?null:new O(n,r,i)):(s=t(),N===s?o:j(e,o,new O(n,r,s)))},M.prototype.modify=function(e,t,n,r){var i=this,s=F(i.children,t,r);return s.length>1?new M(i.hash,s):s[0]},_.prototype.modify=function(e,t,n,r){var i=this,s=i.children,o=n>>>e&S,u=1<<o,a=i.mask,f=C(a&u-1),l=i.mask&u,c=q(l?s[f]:null,e+5,t,n,r),h=l&&!c,p=!l&&!!c,d=h?i.mask&~u:p?i.mask|u:i.mask;return d?h?s.length<=2&&P(s[f^1])?s[f^1]:new _(d,L(f,i.children)):p?i.children.length>=x?H(o,c,i.mask,s):new _(d,A(f,c,s)):new _(d,k(f,c,s)):null},D.prototype.modify=function(e,t,n,r){var i=this,s=n>>>e&S,o=i.children[s],u=q(o,e+5,t,n,r);return!o&&!!u?new D(i.count+1,k(s,u,i.children)):!!o&&!u?i.count-1<=T?B(s,i.children):new D(i.count-1,k(s,null,i.children)):new D(i.count,k(s,u,i.children))},q=function(e,t,n,r,i){var s;return e?e.modify(t,n,r,i):(s=n(),N===s?null:new O(r,i,s))},i=function(e,t,n,r){var i=r?r.lookup(0,t,n):N;return N===i?e:i},s=function(e,t,r){var i=n(t),s=r?r.lookup(0,i,t):N;return N===s?e:s},o=function(e,t,n){var r=n?n.lookup(0,e,t):N;return N===r?null:r},u=function(e,t){var r=n(e),i=t?t.lookup(0,r,e):N;return N===i?null:i},a=function(e,t,n){var r;return r=n?n.lookup(0,e,t):N,N!==r},f=function(e,t){var r,i=n(e);return r=t?t.lookup(0,i,e):N,N!==r},h=function(e,t,n,r){var i;return r?r.modify(0,n,e,t):(i=n(),N===i?null:new O(e,t,i))},p=function(e,t,r){var i,s=n(e);return r?r.modify(0,t,s,e):(i=t(),N===i?null:new O(s,e,i))},l=function(e,t,n,r){var i=function(){return n};return r?r.modify(0,i,e,t):N===n?null:new O(e,t,n)},c=function(e,t,r){var i=n(e),s=function(){return t};return r?r.modify(0,s,i,e):N===t?null:new O(i,e,t)};var R=function(){return N};d=function(e,t,n){return n?n.modify(0,R,e,t):N===N?null:new O(e,t,N)},v=function(e,t){return d(n(e),e,t)},O.prototype.fold=function(e,t){var n=this;return e(t,n)},M.prototype.fold=function(e,t){var n=this,r=n.children;return r.reduce(e,t)},_.prototype.fold=function(e,t){var n=this,r=n.children,i=t;for(var s=0,o=r.length;s<o;s+=1){var u=r[s];i=u instanceof O?e(i,u):u.fold(e,i)}return i},D.prototype.fold=function(e,t){var n=this,r=n.children,i=t;for(var s=0,o=r.length;s<o;s+=1){var u=r[s];u&&(i=u instanceof O?e(i,u):u.fold(e,i))}return i},m=function(e,t,n){return n?n.fold(e,t):t};var U=function(e){return 1+e};g=function(e){return e?e.fold(U,0):0};var z=function(e,t){var n=t.key,r=t.value;return e.push([n,r]),e};y=function(e){var t=[];return e?e.fold(z,t):t};var W=function(e,t){var n=t.key;return e.push(n),e};b=function(e){var t=[];return e?e.fold(W,t):t};var X=function(e,t){var n=t.value;return e.push(n),e};w=function(e){var t=[];return e?e.fold(X,t):t},t.hash=n,t.empty=r,t.tryGetHash=i,t.tryGet=s,t.getHash=o,t.get=u,t.hasHash=a,t.has=f,t.setHash=l,t.set=c,t.modifyHash=h,t.modify=p,t.removeHash=d,t.remove=v,t.fold=m,t.count=g,t.pairs=y,t.keys=b,t.values=w}),define("khepri-compile/scope",["require","exports","bes/record","hamt"],function(e,t,n,r){var i,s,o,u,a,f,l,c,h;i=n.declare(null,["record","outer","mapping","definitions"]),i.empty=i.create(r.empty,null,r.empty,r.empty),i.prototype.hasOwnBinding=function(e){var t=this;return r.has(e,t.record)},i.prototype.hasBinding=function(e){var t=this;return t.hasOwnBinding(e)||t.outer&&t.outer.hasBinding(e)},i.prototype.hasMutableBinding=function(e){var t=this,n=t.getBinding(e);return n&&n.mutable},i.prototype.getBinding=function(e){var t=this;return r.get(e,t.record)||(t.outer?t.outer.getBinding(e):null)},i.prototype.getUid=function(e){var t=this;return t.hasOwnBinding(e)?r.get(e,t.definitions):t.outer?t.outer.getUid(e):null},i.prototype.hasOwnMapping=function(e){var t=this;return r.has(e,t.mapping)},i.prototype.hasMapping=function(e){var t=this;return t.hasOwnMapping(e)||t.outer&&t.outer.hasMapping(e)},i.prototype.getMapping=function(e){var t=this;return t.hasOwnMapping(e)?r.get(e,t.mapping):t.outer&&t.outer.getMapping(e)},i.prototype.getUnusedId=function(e){var t=this;if(!t.hasBinding(e))return e;for(var n=0;;n+=1)if(!t.hasBinding(e+n))return e+n},s=function(e,t,n){return e.setDefinitions(r.set(t,n,e.definitions))},o=function(e,t,n){return e.setRecord(r.set(t,n,e.record))},u=function(e,t,n){return o(e,t,{mutable:1,loc:n})},a=function(e,t,n){return o(e,t,{mutable:0,loc:n})},f=function(e,t,n){return e.hasOwnBinding(t)?e.setRecord(r.modify(t,function(e){return{loc:e.loc,mutable:n?1:0}},e.record)):e.outer&&e.setOuter(f(e.outer,t,n))},l=function(e,t,n){return e.setMapping(r.set(t,n,e.mapping))},c=function(e){return i.empty.setOuter(e).setDefinitions(e.definitions)},h=function(e){return e.outer},t.Scope=i,t.addUid=s,t.addBinding=o,t.addMutableBinding=u,t.addImmutableBinding=a,t.setBindingMutability=f,t.addMapping=l,t.push=c,t.pop=h}),define("khepri-compile/lexical",["require","exports","khepri-ast/node","khepri-ast/pattern","khepri-ast/value","akh/base","akh/trans/statei","akh/identity","akh/error","akh/trans/error","akh/unique","zipper-m/trans/tree","./ast","./scope","./fun"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v=n.setData,m=n.setUserData,g=s.next,y=s.sequence,b=s.sequencea,w=h.type,E=p.Scope,S=d.foldl,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R=function(e){return e&&e.ud&&e.ud.reserved},U,z=f(c(o(l))),W=function(e,t,n,r,i){var s,u;return l.runUnique(o.evalStateT(c.runTreeZipperT(f.runErrorT(e,(s=z.inner.of,function(e){return s(r(e))}),(u=z.inner.of,function(e){return u(i(e))})),n),t),1e3)},X=z.fail,V=z.lift,$=z.chain.bind(null,z.liftInner.liftInner(l.unique)),J=z.liftInner(z.inner.inner.get),K=z.chain.bind(null,J),Q=(T=z.liftInner,N=z.inner.inner.modify,function(e){return T(N(e))}),G=Q(p.push),Y=Q(p.pop),Z=V(z.inner.get),et=V(z.inner.node),tt=z.chain.bind(null,et),nt=V(z.inner.up),rt=V(z.inner.down),it=V(z.inner.right),st=V(z.inner.root),ot=(C=V,k=z.inner.child,function(e){return C(k(e))}),ut=(L=V,A=z.inner.modifyNode,function(e){return L(A(e))}),at=(O=V,M=z.inner.setNode,function(e){return O(M(e))}),ft=tt(function(e){return U(e)}),lt=function(e){var t=arguments,n=[].slice.call(t,1);return y(ot(e),b(n),nt)},ct=function(e){return lt(e,ft)},ht=z.of(),pt=function(){var e=arguments;return y(G,b(e),Y)},dt=function(e){return $(function(t){return Q(function(n){return p.addUid(n,e,t)})})},vt=function(e,t){return K(function(n){return n.hasBinding(e)?ht:X("Undeclared identifier:'"+e+"' at:"+t)})},mt=function(e,t){return K(function(n){var r,i,s;return n.hasOwnBinding(e)?(r=t&&t.start,i=n.getBinding(e),s=i.loc&&i.loc.start,X("'"+e+"' at:"+r+" already bound for scope from:"+s)):ht})},gt=function(e,t){return K(function(n){return n.hasMutableBinding(e)?ht:X("Assign to immutable variable:'"+e+"' at:"+t.start)})},yt=function(e,t){return K(function(n){return n.hasOwnBinding(e)?Q(function(t){return p.setBindingMutability(t,e,!1)}):X("Cannot mark variable:'"+e+"' at:"+t.start+" immutable in enclosed scope")})},bt=function(e,t){return y(Q(function(n){return p.addMutableBinding(n,e,t)}),dt(e))},wt=function(e,t){return Q(function(n){return p.addImmutableBinding(n,e,t)})},Et=function(e,t){return y(Q(function(n){return p.addImmutableBinding(n,e,t)}),dt(e))},St=function(e,t){return y(mt(e,t),bt(e,t))},xt=function(e,t){return y(mt(e,t),Et(e,t))},Tt=function(e,t){return y(mt(e,t),wt(e,t))},Nt={},Ct=function(e,t){Array.isArray(e)?e.forEach(function(e){return Ct(e,t)}):Nt[e]=t};Ct("Program",pt(lt("body",ft))),Ct("PackageExports",lt("exports",ft)),Ct("PackageExport",tt(function(e){return St(e.id.name,e.loc)})),Ct("Package",pt(lt("exports",ft),lt("body",(_=w,D=y(lt("bindings",ft),lt("body",lt("body",ft))),P=lt("body",ft),tt(function(e){var t;return(t=_(e),"WithStatement"===t)?D:P||ht}))))),Ct("SwitchCase",y(lt("test",ft),lt("consequent",ft))),Ct("CatchClause",pt(tt(function(e){return xt(e.param.name,e.param.loc)}),lt("param",ft),lt("body",lt("body",ft)))),Ct(["StaticDeclaration","VariableDeclaration"],lt("declarations",ft)),Ct("StaticDeclarator",tt(function(e){return Tt(e.id.name,e.loc)})),Ct("VariableDeclarator",tt(function(e){var t=e.immutable?xt(e.id.name,e.loc):St(e.id.name,e.loc);return e.recursive?y(t,ct("id"),ct("init")):y(ct("init"),t,ct("id"))})),Ct("Binding",(H=y(lt("pattern",ft),lt("value",ft)),B=y(lt("value",ft),lt("pattern",ft)),tt(function(e){return e.recursive?H:B||ht}))),Ct("BlockStatement",pt(lt("body",ft))),Ct("ExpressionStatement",lt("expression",ft)),Ct("IfStatement",y(lt("test",ft),pt(lt("consequent",ft)),pt(lt("alternate",ft)))),Ct("WithStatement",pt(lt("bindings",ft),lt("body",lt("body",ft)))),Ct("SwitchStatement",pt(lt("discriminant",ft),lt("cases",ft))),Ct(["ReturnStatement","ThrowStatement"],lt("argument",ft)),Ct("TryStatement",y(lt("block",ft),pt(lt("handler",ft)),pt(lt("finalizer",ft)))),Ct("WhileStatement",y(lt("test",ft),pt(lt("body",ft)))),Ct("DoWhileStatement",y(pt(lt("body",ft)),lt("test",ft))),Ct("ForStatement",pt(lt("init",ft),lt("test",ft),lt("update",ft),pt(lt("body",ft)))),Ct("FunctionExpression",pt(tt(function(e){return e.id?Et(e.id.name,e.loc):ht}),lt("id",ft),lt("params",ft),lt("body",(j=w,F=lt("body",ft),I=ft,tt(function(e){var t;return(t=j(e),"BlockStatement"===t)?F:I||ht}))))),Ct("UnaryExpression",lt("argument",ft)),Ct("AssignmentExpression",y(lt("left",ft),tt(function(e){var t=e.operator,n=e.left;return n.type==="Identifier"?y(gt(n.name,n.loc),t===":="?yt(n.name,n.loc):ht):ht}),lt("right",ft))),Ct(["LogicalExpression","BinaryExpression"],y(lt("left",ft),lt("right",ft))),Ct("ConditionalExpression",y(lt("test",ft),lt("consequent",ft),lt("alternate",ft))),Ct(["CallExpression","NewExpression"],y(lt("callee",ft),lt("args",ft))),Ct("MemberExpression",y(lt("object",ft),(q=lt("property",ft),tt(function(e){return e.computed?q:undefined||ht})))),Ct("ArrayExpression",lt("elements",ft)),Ct("ObjectExpression",lt("properties",ft)),Ct("LetExpression",pt(lt("bindings",ft),lt("body",ft))),Ct("CurryExpression",y(lt("base",ft),lt("args",ft))),Ct("SinkPattern",$(function(e){return ut(function(t){return r.IdentifierPattern.create(t.loc,v(i.Identifier.create(null,"_"),"uid",e))})})),Ct("EllipsisPattern",lt("id",ft)),Ct(["SliceUnpack","RelativeUnpack","ImportPattern"],lt("pattern",ft)),Ct("IdentifierPattern",y(tt(function(e){return R(e)?Et(e.id.name,e.loc):xt(e.id.name,e.loc)}),lt("id",ft))),Ct("AsPattern",y(lt("id",ft),tt(function(e){return lt("target",ut(function(t){return v(t,"id",e.id)}),ft)}))),Ct("ObjectPattern",lt("elements",ft)),Ct("ObjectPatternElement",y(lt("target",ft),lt("key",ft))),Ct("ArgumentsPattern",y(lt("id",ft),lt("elements",ft),lt("self",ft))),Ct("ObjectValue",lt("value",ft)),Ct("Identifier",tt(function(e){var t=e.name,n=e.loc;return y(K(function(n){return at(v(e,"uid",n.getUid(t)))}),vt(t,n))})),U=function(e){return Array.isArray(e)?e.length?y(rt,b(e.map(function(t,n){return n===e.length-1?ft:g(ft,it)})),nt):ht:e instanceof n.Node&&Nt[e.type]?Nt[e.type]:ht};var kt=function(e){return e.concat("require","module","exports")},Lt=S.bind(null,p.addImmutableBinding,E.empty);x=function(e,t,n){return W(y(ft,st,Z.chain(function(e){return $(function(t){return J.map(function(n){return{tree:e,data:{unique:t}}})})})),Lt(kt(t||[])),e,a.of,a.fail,n)},t.check=x}),define("khepri-compile/stages/lexical",["require","exports","akh/error","../lexical"],function(e,t,n,r){var i,s=["Array","Boolean","Date","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","Error","eval","EvalError","Function","Infinity","isFinite","isNaN","JSON","Math","NaN","Number","Object","parseInt","parseFloat","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","undefined","URIError"];return i=function(e){var t=e.options,n=e.tree,i=e.data;return r.check(n,t&&t.globals||s,i).map(function(e){var n=e.tree,r=e.data;return{tree:n,data:r,options:t}})},i}),define("akh/state",["require","exports","./identity","./trans/state"],function(e,t,n,r){var i;i=r(n);var s=r.runStateT,o=n.runIdentity;i.runState=function(){return o(s.apply(null,arguments))};var u=r.evalStateT,a=n.runIdentity;i.evalState=function(){return a(u.apply(null,arguments))};var f=r.execStateT,l=n.runIdentity;return i.execState=function(){return l(f.apply(null,arguments))},i}),define("zipper-m/walk",["require","exports","neith/zipper","akh/base"],function(e,t,n,r){var i=r.next,s;return s=function(e,t,r){return i(t,e.get.chain(function(o){if(n.isLeaf(o)){var u=i(r,e.get.chain(function(o){return n.isLast(o)?n.isRoot(o)?e.of(null):i(e.up,u):i(e.right,s(e,t,r))}));return u}return i(e.down,s(e,t,r))}))},s}),define("khepri-compile/reachable",["require","exports","bes/record","hamt","neith/zipper","khepri-ast/node","akh/base","akh/state","zipper-m/trans/tree","zipper-m/walk","./ast"],function(e,t,n,r,i,s,o,u,a,f,l){var c=s.Node,h=s.setData,p=o.next,d=o.sequence,v=o.sequencea,m=l.type,g=l.getUid,y,b,w,E,S,x=n.declare(null,["bindings"]);x.empty=x.create(r.empty),x.prototype.setReference=function(e,t){var n=this,i=n.bindings;return x.create(r.set(e,t,i))},x.prototype.addReference=function(e){var t=this,n=t.bindings;return x.create(r.modify(e,function(e){return e+1||1},n))},x.prototype.getCount=function(e){var t=this,n=t.bindings;return r.get(e,n)},x.prototype.isReachable=x.prototype.getCount;var T,N=a(u),C=function(e,t){return u.evalState(a.runTreeZipperT(e,t),x.empty)},k=N.of(null),L=N.lift(N.inner.get),A=(b=N.lift,w=N.inner.modify,function(e){return b(w(e))}),O=function(e,t,n){return e?L.chain(function(r){return r.isReachable(e)?t:n}):t},M=N.get,_=N.chain.bind(null,N.node),D=N.setNode,P=N.up,H=N.down,B=N.left,j=N.move(i.rightmost),F=N.child,I=function(e){var t=arguments,n=[].slice.call(t,1);return d(F(e),v(n),P)},q=_(function(e){return T(e)}),R={},U=function(e,t){Array.isArray(e)?e.forEach(function(e){return U(e,t)}):R[e]=t};U("Program",I("body",q)),U("Package",I("body",q)),U("SwitchCase",d(I("test",q),I("consequent",q))),U("CatchClause",d(I("param",q),I("body",q))),U("VariableDeclaration",I("declarations",q)),U("VariableDeclarator",_(function(e){return O(g(e.id),I("init",q),D([]))})),U("Binding",_(function(e){return O(g(e.pattern.id),I("value",q),D([]))})),U("BlockStatement",I("body",q)),U("ExpressionStatement",I("expression",q)),U("WithStatement",d(I("body",q),I("bindings",q))),U("SwitchStatement",d(I("discriminant",q),I("cases",q))),U(["ReturnStatement","ThrowStatement"],I("argument",q)),U("TryStatement",d(I("block",q),I("handler",q),I("finalizer",q))),U(["WhileStatement","DoWhileStatement"],d(I("test",q),I("body",q))),U("ForStatement",d(I("body",q),I("update",q),I("test",q),I("init",q))),U(["ConditionalExpression","IfStatement"],d(I("test",q),I("consequent",q),I("alternate",q))),U("FunctionExpression",d(I("id",q),I("params",q),I("body",q))),U("UnaryExpression",I("argument",q)),U(["LogicalExpression","BinaryExpression"],d(I("left",q),I("right",q))),U("AssignmentExpression",d(I("left",q),I("right",q))),U("MemberExpression",d(I("object",q),(E=I("property",q),_(function(e){return e.computed?E:undefined||k})))),U("NewExpression",d(I("callee",q),I("args",q))),U("CallExpression",d(I("callee",q),I("args",q))),U("CurryExpression",d(I("base",q),I("args",q))),U("LetExpression",d(I("body",q),I("bindings",q))),U("ArrayExpression",I("elements",q)),U("ObjectExpression",I("properties",q)),U("ObjectValue",I("value",q)),U("Identifier",_((S=g,function(e){var t=S(e);return t?A(function(e){return e.addReference(t)}):k}))),T=function(e){return Array.isArray(e)?e.length?d(H,j,e.reduceRight(function(e,t,n){return p(e,n?p(q,B):q)},k),P):k:e instanceof c&&R[e.type]?R[e.type]:k},y=function(e,t){return C(p(q,M.chain(function(e){return N.of({tree:e})})),e)},t.optimize=y}),define("khepri-compile/stages/reachable",["require","exports","bes/object","akh/error","../reachable"],function(e,t,n,r,i){var s=n.setProperty,o;return o=function(e){var t=e.tree,n=e.data,o=i.optimize(t,n);return r.of(s(e,"tree",o.tree))},o}),define("khepri-compile/unpack",["require","exports","khepri-ast/expression","khepri-ast/declaration","khepri-ast/pattern","khepri-ast/value","./ast","./fun"],function(e,t,n,r,i,s,o,u){var a=o.type,f=u.concat,l=u.flatten,c,h,p=s.Identifier.create.bind(null,null),d=s.Literal.create.bind(null,null,"number"),v=function(e,t,r,i){return c(n.MemberExpression.create(null,e,n.BinaryExpression.create(null,"-",n.CallExpression.create(null,n.MemberExpression.create(null,p("Math"),p("max")),[n.MemberExpression.create(null,e,p("length")),d(t)]),d(r)),!0),i)},m=function(e,t,r,i){return c(n.CallExpression.create(null,n.MemberExpression.create(null,n.MemberExpression.create(null,n.ArrayExpression.create(null,[]),p("slice")),p("call")),i===0?[e,d(r)]:[e,d(r),d(-i)]),t)};c=function(e,t,o){switch(t.type){case"IdentifierPattern":return[r.Binding.create(null,t,e,o)];case"AsPattern":return u.concat(c(e,t.id),l(c(t.id,t.target,o)));case"ObjectPattern":return l(u.map(function(e){var u,f,h,p;return a(e)==="SliceUnpack"?m(t.ud.id.id,e.pattern,e.from,e.to):a(e)==="RelativeUnpack"?v(t.ud.id.id,e.min,e.index,e.pattern):(u=t.ud.id.id,f=e.target,h=e.key,p=n.MemberExpression.create(null,u,h,!0),f?l(c(p,f)):r.Binding.create(null,i.IdentifierPattern.create(null,s.Identifier.create(null,h.value)),p,o))},t.elements));default:return[]}},h=function(e,t){return l(u.map(function(t){switch(t.type){case"SinkPattern":case"IdentifierPattern":return[];case"SliceUnpack":return m(e,t.pattern,t.from,t.to);case"RelativeUnpack":return v(e,t.min,t.index,t.pattern);case"AsPattern":return l(c(t.id,t.target));default:return c(t,t)}},t))},t.innerPattern=c,t.unpackParameters=h}),define("khepri-compile/builtin",["require","exports","khepri-ast/node","khepri-ast/pattern","khepri-ast/expression","khepri-ast/value"],function(e,t,n,r,i,s){var o=n.setData,u=n.setUserData,a,f,l,c=function(){var e=0;return function(){return e+=1,e}}(),h=function(e,t){return o(s.Identifier.create(null,e),"uid",t)};f={},a={};var p=function(e,t,n){a[e]=t,f[e]=n},d=function(e,t,n){p(e,h(t,c()),n)},v=c();a.require=o(s.Identifier.create(null,"require"),"uid",v);var m=c();a.exports=o(s.Identifier.create(null,"exports"),"uid",m);var g=c();a.module=o(s.Identifier.create(null,"module"),"uid",g);var y=c();a["undefined"]=o(s.Identifier.create(null,"undefined"),"uid",y),[["typeof","__typeof"],["void","__void"],["~","__bnot"],["!","__lnot"],["++","__plus"],["--","__minus"]].forEach(function(e){var t,n=e[0],s=e[1];d(n,s,(t=h("x",c()),i.FunctionExpression.create(null,null,r.ArgumentsPattern.create(null,null,[r.IdentifierPattern.create(null,t)]),i.UnaryExpression.create(null,n,t))))});var b=c(),w=o(s.Identifier.create(null,"x"),"uid",b),E=c(),S=o(s.Identifier.create(null,"y"),"uid",E),x=c(),T=o(s.Identifier.create(null,"z"),"uid",x),N=i.FunctionExpression.create(null,null,r.ArgumentsPattern.create(null,null,[r.IdentifierPattern.create(null,w),r.IdentifierPattern.create(null,S),r.IdentifierPattern.create(null,T)]),i.ConditionalExpression.create(null,w,S,T));d("?","__cond",N);var C=function(e){var t=h("x",c()),n=h("y",c());return i.FunctionExpression.create(null,null,r.ArgumentsPattern.create(null,null,[r.IdentifierPattern.create(null,t),r.IdentifierPattern.create(null,n)]),e(t,n))},k=function(e,t,n){d(e,t,C(n)),d("_"+e,t+"r",C(function(e,t){return n(t,e)}))},L=function(e){return function(t,n){return i.BinaryExpression.create(null,e,t,n)}};[["+","__add"],["-","__sub"],["*","__mul"],["/","__div"],["%","__mod"],["<<","__blas"],[">>","__bras"],[">>>","__brls"],["&","__band"],["^","__bxor"],["|","__bor"],["<","__lt"],[">","__gt"],["<=","__lte"],[">=","__gte"],["==","__eq"],["!=","__neq"],["===","__seq"],["!==","__sneq"],["instanceof","__instanceof"]].forEach(function(e){var t=e[0],n=e[1];k(t,n,L(t))}),[["||","__or"],["&&","__and"]].forEach(function(e){var t=e[0],n=e[1];k(t,n,function(e,n){return i.LogicalExpression.create(null,t,e,n)})}),k("new","__new",function(e,t){return i.NewExpression.create(null,e,[t])}),k(".","__dot",function(e,t){return i.MemberExpression.create(null,e,t,!0)}),k("@","__curry",function(e,t){return i.CurryExpression.create(null,e,[t])});var A=function(e,t){return i.CallExpression.create(null,e,[t])};k("<|","__pipe",A),k("|>","__rpipe",function(e,t){return i.CallExpression.create(null,t,[e])});var O=function(e,t){var n=h("x",c());return i.FunctionExpression.create(null,null,r.ArgumentsPattern.create(null,null,[r.IdentifierPattern.create(null,n)]),i.CallExpression.create(null,e,[i.CallExpression.create(null,t,[n])]))};k("<\\","__compose",O),k("\\>","__rcompose",function(e,t){var n=h("x",c());return i.FunctionExpression.create(null,null,r.ArgumentsPattern.create(null,null,[r.IdentifierPattern.create(null,n)]),i.CallExpression.create(null,t,[i.CallExpression.create(null,e,[n])]))});var M=function(e,t){return i.FunctionExpression.create(null,null,r.ArgumentsPattern.create(null,null,[]),i.CallExpression.create(null,e,[i.CallExpression.create(null,i.MemberExpression.create(null,t,h("apply")),[s.Literal.create(null,"null"),h("arguments")])]))};k("<<\\","__composen",M),k("\\>>","__rcomposen",function(e,t){return i.FunctionExpression.create(null,null,r.ArgumentsPattern.create(null,null,[]),i.CallExpression.create(null,t,[i.CallExpression.create(null,i.MemberExpression.create(null,e,h("apply")),[s.Literal.create(null,"null"),h("arguments")])]))}),l=function(e,t){var n=h("x",t);return i.FunctionExpression.create(null,null,r.ArgumentsPattern.create(null,null,[r.IdentifierPattern.create(null,n)]),i.MemberExpression.create(null,n,h(e),!1))},t.builtins=a,t.definitions=f,t.member=l}),define("khepri-compile/post_normalize",["require","exports","khepri-ast/node","khepri-ast/statement","khepri-ast/expression","./ast","./fun","./unpack","./builtin","./rewriter"],function(e,t,n,r,i,s,o,u,a,f){var l=n.modify,c=s.type,h=s.isBlockFunction,p=o.concat,d=o.flattenr,v=o.map,m=u.innerPattern,g=u.unpackParameters,y=a.builtins,b=a.definitions,w=f.UP,E=f.DOWN,S=f.Rewriter,x=f.rewrite,T,N,C,k,L=(N=d,C=v.bind(null,function(e){switch(e.type){case"IdentifierPattern":return e;case"AsPattern":return e.id;case"SliceUnpack":case"RelativeUnpack":return[];default:return e.ud.id}}),function(e){return N(C(e))}),A=new S,O=function(e){return!0};A.add(["LetExpression","WithStatement"],w,O,(k=function(e){return c(e)==="ImportPattern"?e:m(e.value,e.pattern,e.recursive)},function(e){return l(e,{bindings:d(v(k,e.bindings))},{})})),A.add("FunctionExpression",w,O,function(e){var t=L(e.params.elements),n=g(e.params.id,e.params.elements),s=h(e)?r.BlockStatement.create(null,[r.WithStatement.create(null,n,e.body)]):i.LetExpression.create(null,n,e.body);return i.FunctionExpression.create(e.loc,e.id,l(e.params,{elements:t},{}),s)});var M=function(e){var t;return e.right.type==="AssignmentExpression"?(t=M(e.right),p(t,i.AssignmentExpression.create(null,"=",e.left,t[t.length-1].left))):[e]};A.add("ExpressionStatement",w,function(e){var t=e.expression;return t.type==="AssignmentExpression"},function(e){var t,n;return r.BlockStatement.create(null,v(r.ExpressionStatement.create.bind(null,null),d((t=e.expression,t.right.type==="AssignmentExpression"?(n=M(t.right),p(n,i.AssignmentExpression.create(null,"=",t.left,n[n.length-1].left))):[t]))))}),A.add("BinaryExpression",w,function(e){return e.operator==="|>"},function(e){var t=e.left,n=e.right;return i.CallExpression.create(null,n,[t])}),A.add("BinaryExpression",w,function(e){return e.operator==="<|"},function(e){var t=e.left,n=e.right;return i.CallExpression.create(null,t,[n])}),A.add("BinaryExpression",w,function(e){return e.operator==="\\>"||e.operator==="\\>>"||e.operator==="<\\"||e.operator==="<<\\"},function(e){var t=e.operator,n=e.left,r=e.right;return i.CallExpression.create(null,b[t],[n,r])}),T=x.bind(null,A),t.normalize=T}),define("khepri-compile/stages/post_normalize",["require","exports","bes/object","akh/error","../post_normalize"],function(e,t,n,r,i){var s=n.setProperty,o;return o=function(e){var t=e.tree,n=e.data;return r.of(s(e,"tree",i.normalize(t,n)))},o}),define("khepri-compile/inline/bindings",["require","exports","hamt"],function(e,t,n){var r,i,s;r=n.empty,i=n.set,s=n.get,t.empty=r,t.setBinding=i,t.getBinding=s}),define("khepri-compile/inline/rename",["require","exports","khepri-ast-zipper","neith/walk","neith/tree","khepri-ast/node","../ast"],function(e,t,n,r,i,s,o){var u=n.khepriZipper,a=r.preWalk,f=s.setData,l=o.getUid,c,h;c=function(e,t,n){return i.node(a(function(n){var r=i.node(n),s=l(r);return t.indexOf(s)>=0?i.setNode(f(r,"uid",e+"-"+s),n):n},u(n)))},h=function(e,t,n,r){return i.node(a(function(r){var s=i.node(r),o=l(s),u=s&&s.ud&&s.ud.expand;return e&&s&&e===o?i.setNode(f(s,"expand",{count:(u&&u.count||t)+1,value:n}),r):r},u(r)))},t.rename=c,t.incCount=h}),define("khepri-compile/inline/expand",["require","exports","khepri-ast/declaration","khepri-ast/expression","khepri-ast/pattern","khepri-ast/value","../ast","../fun","./rename","../builtin"],function(e,t,n,r,i,s,o,u,a,f){var l=o.getUid,c=u.concat,h=u.map,p=a.rename,d=f.builtins,v,m,g=h.bind(null,function(e){return l(e.id)});v=function(e,t,i){var s=t.type==="LetExpression"?t.body:t,o=g(s.params.elements),u=s.params,a=h(function(t,r){return n.Binding.create(null,p(e,o,t),i[r]||d.undefined)},u.elements);return r.LetExpression.create(null,c(t.bindings||[],a),p(e,o,s.body))},m=function(e,t,s){var o,u,a,f,h=t.type==="LetExpression"?t.body:t;return h.params.elements.length?(o=h.params.elements[0],u=h.params.elements.slice(1),a=[l(o.id)],f=r.FunctionExpression.create(null,null,i.ArgumentsPattern.create(null,null,u,h.params.self),p(e,a,h.body)),!o||o.type!=="IdentifierPattern"&&o.type!=="AsPattern"&&o.type!=="ObjectPattern"?f:r.LetExpression.create(null,c(t.bindings||[],n.Binding.create(null,p(e,a,o),s[0])),f)):t},t.expandCallee=v,t.expandCurry=m}),define("khepri-compile/inline",["require","exports","bes/record","hamt","khepri-ast/node","khepri-ast/declaration","khepri-ast/statement","khepri-ast/expression","khepri-ast/pattern","khepri-ast/package","khepri-ast/program","khepri-ast/value","akh/base","akh/unique","akh/trans/state","zipper-m/trans/tree","zipper-m/walk","./ast","./builtin","./fun","./inline/bindings","./inline/expand","./inline/rename"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S){var x=i.Node,T=i.setData,N=i.modify,C=h.next,k=h.sequence,L=h.sequencea,A=g.isIdentifier,O=g.getUd,M=g.getUid,_=g.isLambda,D=g.isPrimitive,P=g.isNumberish,H=g.isTruthy,B=y.builtins,j=y.definitions,F=b.flattenr,I=b.flatten,q=b.concat,R=E.expandCallee,U=E.expandCurry,z=S.rename,W=S.incCount,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt=function(e){return+e},bt=function(e,t){return e<<t},wt=function(e,t){return e||t},Et=function(e){return-e},St=function(e,t){return e&&t},xt=function(e,t){return e>>t},Tt=function(e){return!e},Nt=function(e,t){return e<=t},Ct=function(e){return typeof e},kt=function(e,t){return e%t},Lt=function(e,t){return e*t},At=function(e,t){return e+t},Ot=function(e,t){return e<t},Mt=function(e,t){return e-t},_t=function(e,t){return e>t},Dt=function(e){return~e},Pt=function(e,t){return e>>>t},Ht=function(e,t){return e/t},Bt=function(e,t){return e>=t},jt,Ft=n.declare(null,["value","immutable","simple"]),It=n.declare(null,["bindings","working","globals","outer","ctx"]);It.empty=new It(w.empty,w.empty,r.empty,null,r.empty),It.prototype.addBinding=function(e,t,n){var r=this;return r.setBindings(w.setBinding(e,Ft.create(t,!0,n),r.bindings))},It.prototype.addWorking=function(e,t,n){var r=this;return r.setWorking(w.setBinding(e,Ft.create(t,!1,n),r.working))},It.prototype.push=function(){var e=this;return e.setOuter(e).setWorking(w.empty)},It.prototype.pop=function(){var e=this;return e.outer.setBindings(e.bindings).setGlobals(e.globals).setCtx(e.ctx).setWorking(r.fold(function(e,t){var n=t.key;return r.set(n,null,e)},e.outer.working,e.working))};var qt=function(e,t,n){return T(e,"expand",{count:t,value:n})},Rt=O.bind(null,"expand"),Ut=v(d(p)),zt=function(e,t,n,r){return p.runUnique(d.evalStateT(v.runTreeZipperT(e,t),n),r)},Wt=Ut.of(null),Xt=Ut.chain.bind(null,Ut.liftInner(p.unique)),Vt=Ut.lift(Ut.inner.get),$t=(V=Ut.lift,$=Ut.inner.modify,function(e){return V($(e))}),Jt=Ut.get,Kt=Ut.chain.bind(null,Ut.node),Qt=Ut.modifyNode,Gt=Ut.setNode,Yt=Ut.up,Zt=Ut.down,en=Ut.right,tn=Ut.child,nn=function(e,t,n){return $t(function(r){return r.addBinding(e,t,n)})},rn=function(e,t,n){return $t(function(r){return r.addWorking(e,t,n)})},sn=function(e){return e?Vt.map(function(t){var n=t.bindings,r=t.working;return w.getBinding(e,n)||w.getBinding(e,r)}):Wt},on=function(e){var t=M(e);return sn(t).chain(function(e){return e&&e.simple&&!Rt(e.value)&&(D(e.value)||e.immutable&&A(e.value))?Gt([]):Wt})},un=$t(function(e){return e.push()}),an=$t(function(e){return e.pop()}),fn=function(){var e=arguments;return k(un,L(e),an)},ln=Ut.chain.bind(null,Vt.map(function(e){return r.keys(e.globals)})),cn=function(e){return $t(function(t){return t.setGlobals(r.set(e,e,t.globals))})},hn=function(e){return s.VariableDeclaration.create(null,e.map(function(e){return s.VariableDeclarator.create(null,B[e],j[e])}))},pn=function(e){var t=arguments,n=[].slice.call(t,1);return k(tn(e),L(n),Yt)},dn=Kt(function(e){return jt(e)}),vn=function(e){return pn(e,dn)},mn=function(e,t){var n=M(e);return D(t)?nn(n,t,!0):_(t)?nn(n,qt(e,0,t),!0):A(t)?sn(M(t)).chain(function(e){return e&&e.immutable?nn(n,e.simple&&e.value?e.value:t,!0):nn(n,t,!1)}):nn(n,t,!1)},gn={},yn=function(e,t){Array.isArray(e)?e.forEach(function(e){return yn(e,t)}):gn[e]=t};yn("UnaryOperatorExpression",k(Kt(function(e){var t=e.op;return B[t]?k(cn(t),Gt(B[t])):Xt(function(e){return Gt(y.member(t,e))})}),dn)),yn("BinaryOperatorExpression",k(Kt(function(e){var t=e.op,n=e.flipped,r=n?"_"+t:t;return k(cn(r),Gt(B[r]))}),dn)),yn("TernaryOperatorExpression",k($t(function(e){return e.setGlobals(r.set("?","?",e.globals))}),Gt(B["?"]),dn)),yn("Program",k(pn("body",dn),(J=ln(function(e){return Qt(function(t){return l.Program.create(t.loc,q(hn(e),t.body))})}),Kt(function(e){return e.body.type!=="Package"?J:undefined||Wt})))),yn("Package",k(pn("body",dn),ln(function(e){return Qt(function(t){return N(t,{body:t.body.type==="WithStatement"?o.WithStatement.create(t.body.loc,t.body.bindings,o.BlockStatement.create(null,q(hn(e),t.body.body.body))):q(hn(e),t.body)},{})})}))),yn("SwitchCase",k(pn("test",dn),pn("consequent",dn))),yn("CatchClause",k(pn("param",dn),pn("body",dn))),yn("VariableDeclaration",pn("declarations",dn)),yn("VariableDeclarator",k(pn("init",dn),(K=Kt(function(e){return e.immutable?k(mn(e.id,e.init),on(e.id)):rn(M(e.id),e.init,D(e.init)||A(e.init)||_(e.init))}),Kt(function(e){return e.init?K:undefined||Wt})))),yn("Binding",k(pn("value",dn),(Q=Kt(function(e){return k(mn(e.pattern.id,e.value),on(e.pattern.id))}),Kt(function(e){return e.pattern.type==="IdentifierPattern"&&M(e.pattern.id)?Q:undefined||Wt})),(G=Kt(function(e){var t=b.flatten(q(e.value.bindings,s.Binding.create(null,e.pattern,e.value.body)));return k(Gt(t),vn(t.length-1))}),Kt(function(e){return e&&e.type==="Binding"&&e.value&&e.value.type==="LetExpression"?G:undefined||Wt})))),yn("BlockStatement",pn("body",dn)),yn("ExpressionStatement",pn("expression",dn)),yn("WithStatement",k(pn("bindings",dn),pn("body",dn))),yn("SwitchStatement",k(pn("discriminant",dn),pn("cases",dn))),yn(["ReturnStatement","ThrowStatement"],pn("argument",dn)),yn("TryStatement",k(pn("block",dn),pn("handler",dn),pn("finalizer",dn))),yn("WhileStatement",fn(pn("test",dn),pn("body",dn))),yn("DoWhileStatement",fn(pn("body",dn),pn("test",dn))),yn("ForStatement",k(pn("init",dn),fn(pn("test",dn),pn("update",dn),pn("body",dn)))),yn("FunctionExpression",fn(pn("id",dn),pn("params",dn),pn("body",dn))),yn("UnaryExpression",(Y={"!":Tt,"~":Dt,"typeof":Ct,"++":yt,"--":Et},k(pn("argument",dn),(Z=Qt(function(e){var t=e.operator,n=e.argument,r=Y[t](n.value);return c.Literal.create(e.loc,typeof r,r)}),Kt(function(e){var t,n;return(t=e.operator,n=e.argument,Y[t]&&D(n))?Z:undefined||Wt}))))),yn("AssignmentExpression",k(pn("right",dn),(et=Kt(function(e){var t=e.operator,n=e.left,r=e.right;return t==="="?rn(M(n),r):mn(n,r)}),Kt(function(e){var t;return(t=e.left,t.type==="Identifier")?et:undefined||Wt})))),yn(["LogicalExpression","BinaryExpression"],(tt={"+":At,"-":Mt,"*":Lt,"/":Ht,"%":kt,"<<":bt,">>":xt,">>>":Pt,"<":Ot,">":_t,"<=":Nt,">=":Bt,"||":wt,"&&":St},k(pn("left",dn),pn("right",dn),(nt=Qt(function(e){var t=e.operator,n=e.left,r=e.right,i=tt[t](n.value,r.value);return c.Literal.create(null,typeof i,i)}),Kt(function(e){var t,n,r;return(t=e.operator,n=e.left,r=e.right,tt[t]&&D(n)&&D(r))?nt:undefined||Wt}))))),yn(["ConditionalExpression","IfStatement"],k(pn("test",dn),(rt=D,it=Kt(function(e){var t=e.test,n=e.consequent,r=e.alternate;return k(Gt(H(t)?n:r),dn)}),st=k(pn("consequent",dn),pn("alternate",dn)),Kt(function(e){return rt(e.test)?it:st||Wt})))),yn("MemberExpression",k(pn("object",dn),(ot=pn("property",dn),Kt(function(e){return e.computed?ot:undefined||Wt})),(ut=Qt(function(e){var t=e.object,n=e.property;return t.elements[n.value]||B.undefined}),Kt(function(e){return e.computed&&e.object.type==="ArrayExpression"&&P(e.property)?ut:undefined||Wt})),(at=Qt(function(e){var t=e.object;return c.Literal.create(null,"number",t.elements.length)}),Kt(function(e){return e.type==="MemberExpression"&&e.object.type==="ArrayExpression"&&(!e.computed&&e.property.name==="length"||e.computed&&e.property.type==="Literal"&&e.property.value==="length")?at:undefined||Wt})),(ft=Qt(function(e){var t=e.object.value,n=e.property.value;return n<t.length?c.Literal.create(null,"string",t[n]):B.undefined}),Kt(function(e){return e.computed&&e.object.type==="Literal"&&e.object.kind==="string"&&P(e.property)?ft:undefined||Wt})))),yn("NewExpression",k(pn("callee",dn),pn("args",dn))),yn("CallExpression",k(pn("callee",dn),pn("args",dn),(lt=Ut.node.map(function(e){return e.callee}),ct=lt.chain(function(e){var t,n=Rt(e)?(t=Rt(e),t.count<1?t.value:T(e,"expand",null)):e;return Qt(function(e){return W(M(e.callee),Rt(e.callee).count||1,Rt(e.callee).countvalue,u.CallExpression.create(e.loc,n,e.args))})}),Kt(function(e){return Rt(e.callee)?ct:undefined||Wt})),(ht=k(Xt(function(e){return Qt(function(t){return R(e,t.callee,t.args)})}),dn),Kt(function(e){return _(e.callee)||e.callee.type==="LetExpression"&&_(e.callee.body)?ht:undefined||Wt})))),yn("CurryExpression",k(pn("base",dn),pn("args",dn),(pt=Ut.node.map(function(e){return e.base}),dt=pt.chain(function(e){var t,n=Rt(e)?(t=Rt(e),t.count<1?t.value:T(e,"expand",null)):e;return Qt(function(e){return W(M(e.base),Rt(e.base),Rt(e.base).value,u.CurryExpression.create(e.loc,n,e.args))})}),Kt(function(e){return Rt(e.base)?dt:undefined||Wt})),(vt=k(Xt(function(e){return Qt(function(t){return U(e,t.base,t.args)})}),dn),Kt(function(e){return _(e.base)||e.base.type==="LetExpression"&&_(e.base.body)?vt:undefined||Wt})))),yn("LetExpression",k(pn("bindings",dn),pn("body",dn),Qt(function(e){var t=e.loc,n=e.bindings,r=e.body;return u.LetExpression.create(t,F(n),r)}),(mt=Qt(function(e){var t=e.body;return t}),Kt(function(e){var t;return(t=e.bindings,!t.length)?mt:undefined||Wt})))),yn("ArgumentsPattern",k(pn("id",dn),pn("elements",dn),pn("self",dn))),yn("IdentifierPattern",Kt(function(e){return nn(M(e.id),null,!0)})),yn("ArrayExpression",pn("elements",dn)),yn("ObjectExpression",pn("properties",dn)),yn("ObjectValue",pn("value",dn)),yn("Identifier",(gt=Kt(function(e){return sn(M(e)).chain(function(e){return e&&e.value&&e.simple?Gt(e.value):Wt})}),Kt(function(e){return M(e)&&!Rt(e)?gt:undefined||Wt}))),jt=function(e){return Array.isArray(e)?e.length?k(Zt,L(e.map(function(t,n){return n===e.length-1?dn:C(dn,en)})),Yt):Wt:e instanceof x&&gn[e.type]?gn[e.type]:Wt};var bn=b.foldl(function(e,t){var n=B[t],r=j[t];return e.addBinding(M(n),qt(n,0,r),!0)},It.empty,Object.keys(B));X=function(e,t){return zt(C(dn,Jt.chain(function(e){return ln(function(t){return Xt(function(n){return Ut.of({tree:e,data:{globals:t,unique:n}})})})})),e,bn,t.unique)},t.optimize=X}),define("khepri-compile/stages/inline",["require","exports","bes/object","akh/error","../inline"],function(e,t,n,r,i){var s=n.setProperty,o;return o=function(e){var t=e.tree,n=e.data,o=i.optimize(t,n);return r.of(s(s(e,"tree",o.tree),"data",o.data))},o}),define("khepri-compile/khepri_peep",["require","exports","khepri-ast/declaration","khepri-ast/statement","khepri-ast/expression","khepri-ast/value","./fun","./rewriter"],function(e,t,n,r,i,s,o,u){var a=o.concat,f=o.flattenr,l=u.UP,c=u.DOWN,h=u.Rewriter,p=u.rewrite,d,v=new h,m=function(e){return!0};v.add("LetExpression",l,function(e){return e.body.type==="LetExpression"},function(e){return i.LetExpression.create(e.loc,a(e.bindings,e.body.bindings),e.body.body)}),v.add("CurryExpression",l,function(e){return e.base.type==="CurryExpression"},function(e){return i.CurryExpression.create(e.loc,e.base.base,a(e.base.args,e.args))}),v.add("CallExpression",l,function(e){return e.callee.type==="CurryExpression"},function(e){return i.CallExpression.create(e.loc,e.callee.base,a(e.callee.args,e.args))}),v.add("VariableDeclaration",l,m,function(e){var t=e.loc,r=e.declarations,i=f(r);return i.length?n.VariableDeclaration.create(t,i):null}),v.add("LetExpression",l,m,function(e){var t=e.loc,n=e.bindings,r=e.body,s=f(n);return s.length?i.LetExpression.create(t,s,r):r}),v.add("WithStatement",l,m,function(e){var t=e.loc,n=e.bindings,i=e.body,s=f(n);return s.length?r.WithStatement.create(t,s,i):i}),v.add("ReturnStatement",!1,function(e){return e.argument&&e.argument.type==="LetExpression"},function(e){return r.WithStatement.create(null,e.argument.bindings,r.BlockStatement.create(null,[r.ReturnStatement.create(e.loc,e.argument.body)]))}),v.add("FunctionExpression",c,function(e){return e.body.type==="LetExpression"},function(e){return i.FunctionExpression.create(null,e.id,e.params,r.BlockStatement.create(null,[r.WithStatement.create(null,e.body.bindings,r.BlockStatement.create(null,[r.ReturnStatement.create(e.loc,e.body.body)]))]))}),v.add("ExpressionStatement",l,function(e){return e.expression&&e.expression.type==="LetExpression"},function(e){return r.WithStatement.create(null,e.expression.bindings,r.BlockStatement.create(null,[r.ExpressionStatement.create(e.loc,e.expression.body)]))}),v.add("ExpressionStatement",l,function(e){return e.expression&&e.expression.type==="AssignmentExpression"&&e.expression.right.type==="LetExpression"},function(e){return r.WithStatement.create(null,e.expression.right.bindings,r.BlockStatement.create(null,[r.ExpressionStatement.create(e.loc,i.AssignmentExpression.create(e.expression.loc,e.expression.operator,e.expression.left,e.expression.right.body))]))}),d=p.bind(null,v),t.optimize=d}),define("khepri-compile/stages/khepri_peep",["require","exports","akh/error","bes/object","../khepri_peep"],function(e,t,n,r,i){var s=r.setProperty,o;return o=function(e){var t=e.tree,r=e.data;return n.of(s(e,"tree",i.optimize(t,r)))},o}),define("ecma-ast/serialization",["require","exports","./node"],function(e,t,n){var r=n.Node,i,s,o,u=Object.keys,a=Function.prototype.call.bind(Array.prototype.map),f=Function.prototype.call.bind(Array.prototype.reduce),l=function(e){return e},c={};i=function(e,t){c[e]=t};var h=function(e,t,n){return e?Array.isArray(e)?a(e,function(e){return h(e,t,n)}):e instanceof r?{type:e.type,loc:t(e.loc),ud:n(e.ud),children:f(e.children,function(r,i){return r[i]=h(e[i],t,n),r},{}),attributes:f(e.attributes,function(t,n){return t[n]=e[n],t},{})}:e:e};s=function(e,t,n){var r=h(e,t||l,n||l);return{version:"2.1.0",kind:"ecma",program:r}};var p=function(e,t,r){if(!e)return e;if(Array.isArray(e))return a(e,function(e){return p(e,t,r)});var i=c[e.type];if(!i)return e;var s=t(e.loc),o=r(e.ud),l=f(u(e.children),function(n,i){return n[i]=p(e.children[i],t,r),n},{}),h=f(u(e.attributes),function(t,n){return t[n]=e.attributes[n],t},{});return n.construct(i.prototype,s,o,l,h)};o=function(e,t,n){return p(e.program,t||l,n||l)},t.registerNode=i,t.serialize=s,t.unserialize=o}),define("ecma-ast/node",["require","exports","./serialization"],function(e,t,n){var r=n.registerNode,i,s,o,u,a,f,l,c,h,p,d=Object.keys,v=function(e,t,n){var r={},i=d(e);for(var s=0,o=i.length;s<o;s+=1){var u=i[s];r[u]=e[u]}return r[t]=n,r};i=function(e,t){var n=this;Object.defineProperties(n,{loc:{value:e,enumerable:!1,writable:!0},ud:{value:t||null,enumerable:!1,writable:!0}})},s=function(e,t,n,r,i){var s=new e.constructor(t);s.ud=n;var o=e.children;for(var u=0,a=o.length;u<a;u+=1){var f=o[u];s[f]=r[f]||null}var l=e.attributes;for(var c=0,h=l.length;c<h;c+=1){var p=l[c];s[p]=i[p]||null}return s},o=function(e,t,n){return s(e,e.loc,e.ud,t,n)},u=function(e,t,n){var r=new e.constructor(e.loc);r.ud=e.ud;var i=e.children;for(var s=0,o=i.length;s<o;s+=1){var u=i[s];r[u]=t[u]||e[u]}var a=e.attributes;for(var f=0,l=a.length;f<l;f+=1){var c=a[f];r[c]=n[c]||e[c]}return r},a=function(e,t){return s(e,t,e.ud,e,e)},f=function(e,t){return s(e,e.loc,t,e,e)},l=function(e,t){return e.ud&&e.ud[t]},c=function(e,t,n){return h(e,t,n(l(e,t)))},h=function(e,t,n){return f(e,v(e.ud||{},t,n))},p=function(e,t,n,i,s){s.type=t,s.prototype=new e,s.prototype.constructor=s,s.prototype.children=n,s.prototype.attributes=i,s.prototype.type=s.type;var o=function(e){var t=this;return s.apply(t,e)};return o.prototype=s.prototype,s.create=function(){var e=arguments;return new o(e)},r(t,s),s},t.Node=i,t.construct=s,t.reconstruct=o,t.modify=u,t.setLoc=a,t.setUserData=f,t.getData=l,t.modifyData=c,t.setData=h,t.defineNode=p}),define("ecma-ast/clause",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s,o,u=function(){};u.prototype=new r,s=i(u,"SwitchCase",["test","consequent"],[],function(e,t,n){var i=this;r.call(i,e),i.test=t||null,i.consequent=n}),o=i(u,"CatchClause",["param","body"],[],function(e,t,n){var i=this;r.call(i,e),i.param=t,i.body=n}),t.SwitchCase=s,t.CatchClause=o}),define("ecma-ast/declaration",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s,o,u,a;s=function(){},s.prototype=new r,o=i(s,"FunctionDeclaration",["id","params","body"],[],function(e,t,n,i){var s=this;r.call(s,e),s.id=t,s.params=n,s.body=i}),u=i(s,"VariableDeclaration",["declarations"],[],function(e,t){var n=this;r.call(n,e),n.declarations=t}),a=i(s,"VariableDeclarator",["id","init"],[],function(e,t,n){var i=this;r.call(i,e),i.id=t,i.init=n||null}),t.Declaration=s,t.FunctionDeclaration=o,t.VariableDeclaration=u,t.VariableDeclarator=a}),define("ecma-ast/expression",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;s=function(){var e=this},s.prototype=new r,o=i(s,"ThisExpression",[],[],function(e){var t=this;r.call(t,e)}),u=i(s,"SequenceExpression",["expressions"],[],function(e,t){var n=this;r.call(n,e),n.expressions=t}),a=i(s,"UnaryExpression",["argument"],["operator"],function(e,t,n){var i=this;r.call(i,e),i.operator=t,i.argument=n}),f=i(s,"BinaryExpression",["left","right"],["operator"],function(e,t,n,i){var s=this;r.call(s,e),s.operator=t,s.left=n,s.right=i}),l=i(s,"AssignmentExpression",["left","right"],["operator"],function(e,t,n,i){var s=this;r.call(s,e),s.operator=t,s.left=n,s.right=i}),c=i(s,"UpdateExpression",["argument"],["operator","prefix"],function(e,t,n,i){var s=this;r.call(s,e),s.operator=t,s.argument=n,s.prefix=i}),h=i(s,"LogicalExpression",["left","right"],["operator"],function(e,t,n,i){var s=this;r.call(s,e),s.operator=t,s.left=n,s.right=i}),p=i(s,"ConditionalExpression",["test","consequent","alternate"],[],function(e,t,n,i){var s=this;r.call(s,e),s.test=t,s.consequent=n,s.alternate=i}),d=i(s,"NewExpression",["callee","args"],[],function(e,t,n){var i=this;r.call(i,e),i.callee=t,i.args=n}),v=i(s,"CallExpression",["callee","args"],[],function(e,t,n){var i=this;r.call(i,e),i.callee=t,i.args=n}),m=i(s,"MemberExpression",["object","property"],["computed"],function(e,t,n,i){var s=this;r.call(s,e),s.object=t,s.property=n,s.computed=i}),g=i(s,"FunctionExpression",["id","params","body"],[],function(e,t,n,i){var s=this;r.call(s,e),s.id=t||null,s.params=n,s.body=i}),y=i(s,"ArrayExpression",["elements"],[],function(e,t){var n=this;r.call(n,e),n.elements=t}),b=i(s,"ObjectExpression",["properties"],[],function(e,t){var n=this;r.call(n,e),n.properties=t}),t.Expression=s,t.ThisExpression=o,t.SequenceExpression=u,t.UnaryExpression=a,t.BinaryExpression=f,t.AssignmentExpression=l,t.UpdateExpression=c,t.LogicalExpression=h,t.ConditionalExpression=p,t.NewExpression=d,t.CallExpression=v,t.MemberExpression=m,t.FunctionExpression=g,t.ArrayExpression=y,t.ObjectExpression=b}),define("ecma-ast/program",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s;s=i(r,"Program",["body"],[],function(e,t){var n=this;r.call(n,e),n.body=t}),t.Program=s}),define("ecma-ast/statement",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;s=function(){var e=this},s.prototype=new r,f=i(s,"EmptyStatement",[],[],function(e){var t=this;r.call(t,e)}),o=i(s,"DebuggerStatement",[],[],function(e){var t=this;r.call(t,e)}),u=i(s,"BlockStatement",["body"],[],function(e,t){var n=this;r.call(n,e),n.body=t}),a=i(s,"ExpressionStatement",["expression"],[],function(e,t){var n=this;r.call(n,e),n.expression=t}),l=i(s,"IfStatement",["test","consequent","alternate"],[],function(e,t,n,i){var s=this;r.call(s,e),s.test=t,s.consequent=n,s.alternate=i||null}),c=i(s,"LabeledStatement",["body"],[],function(e,t,n){var i=this;r.call(i,e),i.label=t,i.body=n}),h=i(s,"BreakStatement",["label"],[],function(e,t){var n=this;r.call(n,e),n.label=t||null}),p=i(s,"ContinueStatement",["label"],[],function(e,t){var n=this;r.call(n,e),n.label=t||null}),d=i(s,"WithStatement",["object","body"],[],function(e,t,n){var i=this;r.call(i,e),i.object=t,i.body=n}),v=i(s,"SwitchStatement",["discriminant","cases"],[],function(e,t,n){var i=this;r.call(i,e),i.discriminant=t,i.cases=n}),m=i(s,"ReturnStatement",["argument"],[],function(e,t){var n=this;r.call(n,e),n.argument=t||null}),g=i(s,"ThrowStatement",["argument"],[],function(e,t){var n=this;r.call(n,e),n.argument=t}),y=i(s,"TryStatement",["block","handler","finalizer"],[],function(e,t,n,i){var s=this;r.call(s,e),s.block=t,s.handler=n,s.finalizer=i}),b=i(s,"WhileStatement",["test","body"],[],function(e,t,n){var i=this;r.call(i,e),i.test=t,i.body=n}),w=i(s,"DoWhileStatement",["body","test"],[],function(e,t,n){var i=this;r.call(i,e),i.test=n,i.body=t}),E=i(s,"ForStatement",["init","test","update","body"],[],function(e,t,n,i,s){var o=this;r.call(o,e),o.init=t||null,o.test=n||null,o.update=i||null,o.body=s}),S=i(s,"ForInStatement",["left","right","body"],[],function(e,t,n,i){var s=this;r.call(s,e),s.left=t,s.right=n,s.body=i}),t.Statement=s,t.DebuggerStatement=o,t.BlockStatement=u,t.ExpressionStatement=a,t.EmptyStatement=f,t.IfStatement=l,t.LabeledStatement=c,t.BreakStatement=h,t.ContinueStatement=p,t.WithStatement=d,t.SwitchStatement=v,t.ReturnStatement=m,t.ThrowStatement=g,t.TryStatement=y,t.WhileStatement=b,t.DoWhileStatement=w,t.ForStatement=E,t.ForInStatement=S}),define("ecma-ast/value",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s,o,u,a,f;s=i(r,"Identifier",[],["name"],function(e,t){var n=this;r.call(n,e),n.name=t}),o=i(r,"Literal",[],["kind","value"],function(e,t,n){var i=this;r.call(i,e),i.kind=t,i.value=n}),u=i(r,"ObjectValue",["key","value"],[],function(e,t,n){var i=this;r.call(i,t,n),i.key=t,i.value=n}),a=i(r,"ObjectGetter",["key","value"],[],function(e,t,n){var i=this;r.call(i,t,n),i.key=t,i.value=n}),f=i(r,"ObjectSetter",["key","value"],[],function(e,t,n){var i=this;r.call(i,t,n),i.key=t,i.value=n}),t.Identifier=s,t.Literal=o,t.ObjectValue=u,t.ObjectGetter=a,t.ObjectSetter=f}),define("khepri-compile/transform/package_manager/amd",["require","exports","khepri-ast/declaration","khepri-ast/expression","khepri-ast/node","khepri-ast/pattern","khepri-ast/program","khepri-ast/statement","khepri-ast/value","../../fun","../../builtin"],function(e,t,n,r,i,s,o,u,a,f,l){var c=i.setData,h=l.builtins,p,d,v,m=Function.prototype.call.bind(Array.prototype.concat),g=Function.prototype.call.bind(Array.prototype.map),y=function(e){return e.split("::").join("/")};d=function(e){return o.Program.create(null,f.concat(u.ExpressionStatement.create(null,a.Literal.create(null,"string","use strict")),e))},v=function(e){var t=y(e);return r.CallExpression.create(null,h.require,[a.Literal.create(null,"string",t)])},p=function(e,t,i,o,l){var p=t.type==="PackageExports"?f.map(function(e){return e.id.name},t.exports):[t.id.name],d=n.VariableDeclaration.create(null,g(p,function(e){return n.VariableDeclarator.create(null,a.Identifier.create(null,e))})),v=t.type==="PackageExports"?g(t.exports,function(e){return u.ExpressionStatement.create(null,r.AssignmentExpression.create(null,"=",r.MemberExpression.create(null,h.exports,e.alias,!0),e.id))}):u.ReturnStatement.create(null,t.id),b=c(r.FunctionExpression.create(null,null,s.ArgumentsPattern.create(null,null,m(s.IdentifierPattern.create(null,h.require),s.IdentifierPattern.create(null,h.exports),g(i,function(e){return o[e.from.value]}))),u.BlockStatement.create(l.loc,m(d,l,v))),"prefix",[u.ExpressionStatement.create(null,a.Literal.create(null,"string","use strict"))]);return u.ExpressionStatement.create(e,r.CallExpression.create(e,a.Identifier.create(null,"define"),[r.ArrayExpression.create(null,m(a.Literal.create(null,"string","require"),a.Literal.create(null,"string","exports"),g(i,function(e){return a.Literal.create(null,"string",y(e.from.value))}))),b]))},t.definePackage=p,t.defineProgram=d,t.importPackage=v}),define("khepri-compile/transform/package_manager/node",["require","exports","khepri-ast/declaration","khepri-ast/expression","khepri-ast/statement","khepri-ast/program","khepri-ast/value","../../fun","../../builtin"],function(e,t,n,r,i,s,o,u,a){var f=a.builtins,l,c,h,p=Array.prototype.concat.bind([]),d=Function.prototype.call.bind(Array.prototype.map);c=function(e){return s.Program.create(null,u.concat(i.ExpressionStatement.create(null,o.Literal.create(null,"string","use strict")),e))},h=function(e){var t=e.split("::");return t.slice(1).reduce(function(e,t){return r.MemberExpression.create(null,e,o.Literal.create(null,"string",t),!0)},r.CallExpression.create(null,f.require,[o.Literal.create(null,"string",t[0])]))},l=function(e,t,s,a,f){var l=t.type==="PackageExports"?u.map(function(e){return e.id.name},t.exports):[t.id.name],c=n.VariableDeclaration.create(null,d(l,function(e){return n.VariableDeclarator.create(null,o.Identifier.create(null,e))})),v=t.type==="PackageExports"?d(t.exports,function(e){return i.ExpressionStatement.create(null,r.AssignmentExpression.create(null,"=",r.MemberExpression.create(null,o.Identifier.create(null,"exports"),e.alias,!0),e.id))}):i.ExpressionStatement.create(null,r.AssignmentExpression.create(null,"=",r.MemberExpression.create(null,o.Identifier.create(null,"module"),o.Identifier.create(null,"exports")),t.id));return i.BlockStatement.create(e,[i.ExpressionStatement.create(null,o.Literal.create(null,"string","use strict")),i.WithStatement.create(null,d(s,function(e){return n.Binding.create(null,e.pattern,h(e.from.value))}),i.BlockStatement.create(null,p(c,f,v)))])},t.definePackage=l,t.defineProgram=c,t.importPackage=h}),define("khepri-compile/transform/transform",["require","exports","bes/record","ecma-ast/clause","ecma-ast/declaration","ecma-ast/expression","ecma-ast/node","ecma-ast/program","ecma-ast/statement","ecma-ast/value","khepri-ast/declaration","khepri-ast/expression","khepri-ast/node","khepri-ast/pattern","khepri-ast/program","khepri-ast/statement","khepri-ast/value","akh/unique","akh/trans/statei","akh/base","zipper-m/trans/tree","zipper-m/walk","../ast","../scope","../fun","../builtin","../unpack","./package_manager/amd","./package_manager/node"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L){var A=h.setData,O=b.liftM2,M=b.next,_=b.sequence,D=S.type,P=S.getUid,H=x.Scope,B=T.concat,j=T.flatten,F=T.flip,I=T.filter,q=N.builtins,R=N.definitions,U=C.innerPattern,z=C.unpackParameters,W,X,V,$,J,K,Q,G,Y,Z,et=n.declare(null,["scope","packageManager","bindings"]);et.empty=et.create(H.empty,null,[[],null]);var tt=w(y(g)),nt=function(e,t,n,r){return g.runUnique(y.evalStateT(w.runTreeZipperT(e,n),t),r)},rt=tt.of(null),it=O.bind(null,B),st=T.foldr.bind(null,F(it),tt.of([])),ot=tt.lift(tt.inner.get),ut=(X=tt.lift,V=tt.inner.modify,function(e){return X(V(e))}),at=tt.chain.bind(null,ot),ft=tt.node,lt=tt.chain.bind(null,ft),ct=tt.modifyNode,ht=tt.setNode,pt=function(e){return ot.map(function(t){return e(t.scope)})},dt=function(e){return ot.chain(function(t){return e(t.scope)})},vt=ot.map(function(e){return e.packageManager}),mt=function(e){return ut(function(t){return t.setScope(e)})},gt=($=x.push,ut(function(e){return e.setScope($(e.scope))})),yt=(J=x.pop,ut(function(e){return e.setScope(J(e.scope))})),bt=function(e){return pt(function(t){return t.getMapping(e)})},wt=function(e,t){return dt(function(n){var r;return n.hasMapping(t)?mt(x.addMutableBinding(n,e)):(r=n.getUnusedId(e),mt(x.addMapping(x.addMutableBinding(n,r),t,r)))})},Et=ut(function(e){return e.setBindings([[],e.bindings])}),St=ut(function(e){return e.setBindings(e.bindings[1])}),xt=function(e){return ut(function(t){return t.setBindings([t.bindings[0].concat(e),t.bindings[1]])})},Tt=tt.chain.bind(null,at((K=st,Q=T.map.bind(null,function(e){var t=e[1];return bt(t)}),function(e){var t=e.bindings[0];return K(Q(t))}))),Nt,Ct=lt(function(e){return Nt(e)}),kt=function(e,t){return f.Identifier.create(e,t)},Lt=function(e){return f.Literal.create(e,"null",null)},At=l.VariableDeclaration.create,Ot=i.VariableDeclarator.create,Mt=(G=T.map.bind(null,function(e){return Ot(null,e.pattern,e.value)}),function(e){return G(U(e.value,e.pattern))}),_t=(Y=T.map.bind(null,function(e){return s.AssignmentExpression.create(null,"=",e.pattern,e.value)}),function(e){return Y(U(e.value,e.pattern))}),Dt=function(e){var t=z(e.id,e.elements),n=e.self?U(s.ThisExpression.create(null),e.self):[],r=e.id?U(kt(null,"arguments"),e.id):[];return j(B(r,t,n))},Pt=function(e,t,n){var r=j(T.map(Mt,t)),i=At(null,r);return v.BlockStatement.create(e,B(i,n.body))},Ht=function(e,t,n,r){var i=function(t){return D(t)==="ImportPattern"?l.Binding.create(null,t.pattern,e.importPackage(t.from.value)):t};return Pt(t,T.map(i,n),r)},Bt=function(e,t,n,r,i){var s=n.elements,o=T.map(function(e){return Ot(null,e.pattern,e.value)},Dt(n)),u=D(r)==="BlockStatement"?r:v.BlockStatement.create(null,v.ReturnStatement.create(null,r));return c.FunctionExpression.create(e,t,s,v.BlockStatement.create(u.loc,B(i||[],o.length?At(null,o):[],u.body)))},jt=function(e,t,n){return s.SequenceExpression.create(null,j(B(T.map(_t,t),n)))},Ft=function(e,t,n){return c.CallExpression.create(e,c.MemberExpression.create(null,t,kt(null,"bind")),B(Lt(null),n))},It=function(e,t,n,r){var i,s=D(r)==="WithStatement"?I((i=D,function(e){var t=i(e);return"ImportPattern"===t}),r.bindings):[],o=T.reduce(s,function(e,t){return e[t.from.value]=t.pattern,e},{}),u,a=D(r)==="WithStatement"?v.WithStatement.create(null,I((u=D,function(e){var t=u(e);return"ImportPattern"!==t}),r.bindings),r.body):r;return e.definePackage(t,n,s,o,a)},qt={},Rt=function(e,t,n){if(Array.isArray(e))return e.map(function(e){return Rt(e,t,n)});qt[e]=[{pre:t,post:n}]};Rt("VariableDeclaration",null,ct(function(e){var t=e.loc,n=e.declarations;return i.VariableDeclaration.create(t,n)})),Rt("VariableDeclarator",null,ct(function(e){return i.VariableDeclarator.create(e.loc,e.id,e.init)})),Rt("StaticDeclaration",ct(function(e){var t=e.loc;return a.EmptyStatement.create(t)})),Rt("CatchClause",null,ct(function(e){return r.CatchClause.create(e.loc,e.param,e.body)})),Rt("SwitchCase",null,ct(function(e){return r.SwitchCase.create(e.loc,e.test,e.consequent)})),Rt("BlockStatement",Et,_(Tt(function(e){return ct(function(t){return a.BlockStatement.create(t.loc,B(i.VariableDeclaration.create(null,e.map(function(e){return i.VariableDeclarator.create(null,kt(null,e))})),t.body))})}),St)),Rt("ExpressionStatement",null,ct(function(e){return a.ExpressionStatement.create(e.loc,e.expression)})),Rt("IfStatement",null,ct(function(e){return a.IfStatement.create(e.loc,e.test,e.consequent,e.alternate)})),Rt("WithStatement",M(vt.chain(function(e){return ct(function(t){return Ht(e,t.loc,t.bindings,t.body)})}),Ct)),Rt("SwitchStatement",null,ct(function(e){return a.SwitchStatement.create(e.loc,e.discriminant,e.cases)})),Rt("ReturnStatement",null,ct(function(e){return a.ReturnStatement.create(e.loc,e.argument)})),Rt("ThrowStatement",null,ct(function(e){return a.ThrowStatement.create(e.loc,e.argument)})),Rt("BreakStatement",ct(function(e){return a.BreakStatement.create(e.loc,null)})),Rt("ContinueStatement",ct(function(e){return a.ContinueStatement.create(e.loc,null)})),Rt("TryStatement",null,ct(function(e){return a.TryStatement.create(e.loc,e.block,e.handler,e.finalizer)})),Rt("WhileStatement",null,ct(function(e){return a.WhileStatement.create(e.loc,e.test,e.body)})),Rt("DoWhileStatement",null,ct(function(e){return a.DoWhileStatement.create(e.loc,e.body,e.test)})),Rt("ForStatement",null,ct(function(e){return a.ForStatement.create(e.loc,e.init,e.test,e.update,e.body)})),Rt("AssignmentExpression",null,ct(function(e){return s.AssignmentExpression.create(e.loc,"=",e.left,e.right)})),Rt("UnaryExpression",null,ct(function(e){return s.UnaryExpression.create(e.loc,e.operator==="++"?"+":e.operator==="--"?"-":e.operator,e.argument)})),Rt("BinaryExpression",null,ct(function(e){return s.BinaryExpression.create(e.loc,e.operator,e.left,e.right)})),Rt("LogicalExpression",null,ct(function(e){return s.LogicalExpression.create(e.loc,e.operator,e.left,e.right)})),Rt("ConditionalExpression",null,ct(function(e){return s.ConditionalExpression.create(e.loc,e.test,e.consequent,e.alternate)})),Rt("NewExpression",null,ct(function(e){return s.NewExpression.create(e.loc,e.callee,e.args)})),Rt("CallExpression",null,ct(function(e){return s.CallExpression.create(e.loc,e.callee,e.args)})),Rt("MemberExpression",null,ct(function(e){return s.MemberExpression.create(e.loc,e.object,e.property,e.computed)})),Rt("LetExpression",_(lt(function(e){var t=j(T.map(function(e){return e?U(null,e.pattern):[]},e.bindings)),n=T.map(function(e){return[e.pattern.id.name,P(e.pattern.id)]},t);return xt(n)}),ct(function(e){return jt(e.loc,e.bindings,e.body)}))),Rt("CurryExpression",ct(function(e){return Ft(e.loc,e.base,e.args)})),Rt("FunctionExpression",_(gt,ct(function(e){return Bt(e.loc,e.id,e.params,e.body,e.ud&&e.ud.prefix)})),_(ct(function(e){return s.FunctionExpression.create(null,e.id,e.params,e.body)}),yt)),Rt("ArrayExpression",null,ct(function(e){return s.ArrayExpression.create(e.loc,e.elements)})),Rt("ObjectExpression",null,ct(function(e){return s.ObjectExpression.create(e.loc,e.properties)})),Rt("ObjectValue",null,ct(function(e){return f.ObjectValue.create(e.loc,e.key,e.value)})),Rt(["IdentifierPattern","AsPattern","ArgumentsPattern"],null,ct(function(e){return e.id})),Rt(["ObjectPattern","EllipsisPattern","SinkPattern"],null,ct(function(e){return e.ud&&e.ud.id})),Rt("Program",(Z=v.ExpressionStatement.create(null,m.Literal.create(null,"string","use strict")),_(Et,ct(function(e){return D(e.body)==="Package"?e:A(e,"prefix",Z)}))),Tt(function(e){return ct(function(t){return u.Program.create(t.loc,B(t.ud&&t.ud.prefix?t.ud.prefix:[],i.VariableDeclaration.create(null,e.map(function(e){return i.VariableDeclarator.create(null,kt(null,e))})),t.body))})})),Rt("Package",vt.chain(function(e){return ct(function(t){return It(e,t.loc,t.exports,t.body)})})),Rt("Identifier",null,lt(function(e){return P(e)?M(wt(e.name,P(e)),bt(P(e)).chain(function(t){return ht(kt(e.loc,t))})):ht(kt(e.loc,e.name))})),Nt=function(e){if(e&&e instanceof h.Node){var t=qt[e.type];if(t&&t[0].pre)return t[0].pre}return rt};var Ut=function(e){if(e&&e instanceof h.Node){var t=qt[e.type];if(t&&t[0].post)return t[0].post}return rt},zt=lt(Ut);W=function(t,n,r){var i=e("./package_manager/amd"),s=e("./package_manager/node"),o=i;n==="node"&&(o=s);var u=et.empty.setPackageManager(o);return nt(_(wt("require",P(q.require)),wt("exports",P(q.exports)),E(tt,Ct,zt),ft),u,t)},t.transform=W}),define("khepri-compile/stages/transform",["require","exports","akh/error","bes/object","../transform/transform"],function(e,t,n,r,i){var s=r.setProperty,o;return o=function(e){var t=e.options,r=e.tree,o=e.data;return n.of(s(e,"tree",i.transform(r,t.package_manager||"amd",o)))},o}),define("ecma-ast-zipper",["require","exports","nu-stream/gen","nu-stream/stream","neith/tree","ecma-ast/node"],function(e,t,n,r,i,s){var o=n.range,u=r.foldl,a=r.from,f=r.NIL,l=i.treeZipper,c=s.Node,h=s.modify,p,d=function(e){return u(function(e,t){var n=t.key,r=t.value;return e[n]=r,e},[],e)};p=l.bind(null,function(e){return e?Array.isArray(e)?o(0,e.length):a(e.children):f},function(e,t){return e[t]},function(e,t,n){return e instanceof c?h(e,n(),{}):d(t)}),t.ecmaZipper=p}),define("khepri-compile/ecma_peep",["require","exports","ecma-ast-zipper","ecma-ast/node","./ast","./fun","./rewriter"],function(e,t,n,r,i,s,o){var u=n.ecmaZipper,a=r.modify,f=i.type,l=s.concat,c=s.flatten,h=s.map,p=s.foldr,d=o.UP,v=o.DOWN,m=o.Rewriter,g=o.rewrite,y,b,w,E=(b=h.bind(null,function(e){return!e||f(e)==="EmptyStatement"?[]:f(e)==="BlockStatement"?e.body:e}),w=c,function(e){return w(b(e))}),S=p.bind(null,function(e,t){return f(t)==="VariableDeclaration"&&f(e[0])==="VariableDeclaration"?l(a(t,{declarations:l(t.declarations,e[0].declarations)},{}),e.slice(1)):l(t,e)},[]),x=new m,T=function(e){return!0};x.add("VariableDeclaration",v,T,function(e){var t=e.declarations.filter(function(e){return!!e});return a(e,{declarations:t},{})}),x.add("VariableDeclaration",d,function(e){return!e.declarations.length},function(e){return null}),x.add(["Program","BlockStatement"],d,T,function(e){return a(e,{body:E(e.body)},{})}),x.add(["Program","BlockStatement"],d,T,function(e){return a(e,{body:S(e.body)},{})});var N=u,C=g.bind(null,x);y=function(e){return C(N(e))},t.optimize=y}),define("khepri-compile/stages/ecma_peep",["require","exports","akh/error","bes/object","neith/tree","../ecma_peep"],function(e,t,n,r,i,s){var o=r.setProperty,u=i.node,a;return a=function(e){var t=e.tree;return n.of(o(e,"tree",u(s.optimize(t))))},a}),define("khepri-compile/compile",["require","exports","akh/error","khepri-ast-zipper","./stages/pre_normalize","./stages/lexical","./stages/reachable","./stages/post_normalize","./stages/inline","./stages/khepri_peep","./stages/transform","./stages/ecma_peep"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h=r.khepriZipper,p,d=function(e){var t=e.tree;return t},v=function(e){throw e};return p=function(e,t,r){var p;return n.runError((p={tree:h(e),options:t||{}},i(p).chain(s).chain(u).chain(a).chain(o).chain(f).chain(l).chain(c)),d,r||v)},p}),define("ecma-ast/token",["require","exports","./node"],function(e,t,n){var r=n.Node,i=n.defineNode,s,o,u,a,f,l,c,h,p,d,v,m;s=function(e,t){var n=this;r.call(n,e),n.value=t},s.prototype=new r,o=i(s,"String",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),u=i(s,"Number",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),a=i(s,"RegularExpression",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),f=i(s,"Boolean",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),l=i(s,"Null",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),c=i(s,"Identifier",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),h=i(s,"Keyword",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),p=i(s,"Punctuator",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),d=i(s,"Comment",[],["value","multiline","linebreak"],function(e,t,n,r){var i=this;s.call(i,e,t),i.multiline=!!n,i.linebreak=!!r}),v=i(s,"Whitespace",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),m=i(s,"LineTerminator",[],["value"],function(e,t){var n=this;s.call(n,e,t)}),t.Token=s,t.StringToken=o,t.NumberToken=u,t.RegularExpressionToken=a,t.BooleanToken=f,t.NullToken=l,t.IdentifierToken=c,t.KeywordToken=h,t.PunctuatorToken=p,t.CommentToken=d,t.WhitespaceToken=v,t.LineTerminatorToken=m}),define("ecma-unparse/unparse",["require","exports","nu-stream/stream","ecma-ast/token","ecma-ast/node"],function(e,t,n,r,i){var s=n.NIL,o=n.cons,u,a=Array.prototype.slice,f=function(e,t){return e.length?e.length===1?e[0]:n.append(e[0],n.append(t,f(e.slice(1),t))):s},l=function(e,t){return f(e,o(t,s))},c=function(e){return new r.KeywordToken(null,e)},h=function(e){return new r.LineTerminatorToken(null,e)},p=function(e){return new r.PunctuatorToken(null,e)},d=function(e){return new r.WhitespaceToken(null,e)},v=h("\n"),m=d(" "),g=function(){var e=arguments;if(e.length===0)return s;var t=e[0],r=g.apply(undefined,a.call(e,1));return t===undefined||n.isEmpty(t)?r:n.isStream(t)?n.append(t,r):n.cons(t,r)},y=function(){var e=arguments;return g(g.apply(undefined,e),v)},b=function(){var e=arguments;return g.apply(undefined,e)},w=function(){var e=arguments;return g.apply(undefined,e)},E=function(){var e=arguments;return g(g.apply(undefined,e),v)},S=function(){var e=arguments;return g.apply(undefined,e)},x=function(e){return S(new r.IdentifierToken(null,e))},T=function(e){return S(new r.StringToken(null,e))},N=function(e){return S(new r.NumberToken(null,e))},C=function(e){return S(new r.NullToken(null,e))},k=function(e){return S(new r.BooleanToken(null,e))},L=function(e){return S(new r.RegularExpressionToken(null,e))},A=function(e){return g.apply(undefined,e)},O=function(e){return y(c("var"),m,l(e,p(",")),p(";"))},M=function(e,t){return w(e,t?g(m,p("="),m,t):s)},_=function(e,t,n){return b(p("("),c("function"),e?g(m,e):s,p("("),f(t,g(p(","),m)),p(")"),m,n,p(")"))},D=function(e,t,n){return w(c("function"),m,p("("),f(t,g(p(","),m)),p(")"),m,n)},P=function(e,t){return g(e?g(c("case"),m,e):c("default"),p(":"),v,g.apply(undefined,t))},H=function(e,t){return g(c("catch"),p("("),e,p(")"),t)},B=function(){return y(p(";"))},j=function(){return y(c("debugger"),p(";"))},F=function(e){return y(p("{"),v,g.apply(undefined,e),p("}"))},I=function(e){return y(e,p(";"))},q=function(e,t,n){return y(c("if"),m,p("("),e,p(")"),t,n?g(c("else"),m,n):s)},R=function(e,t){return y(x(e),p(":"),t)},U=function(e){return y(c("break"),m,e,p(";"))},z=function(e){return y(c("continue"),m,e,p(";"))},W=function(e,t){return y(c("with"),p("("),e,p(")"),p("{"),t,p("}"))},X=function(e,t){return y(c("switch"),p("("),e,p(")"),p("{"),v,g.apply(undefined,t),p("}"))},V=function(e){return y(c("return"),m,e,p(";"))},$=function(e){return y(c("throw"),m,e,p(";"))},J=function(e,t,n){return y(c("try"),e,t?t:s,n?g(c("finally"),n):s)},K=function(e,t){return y(c("while"),p("("),e,p(")"),t)},Q=function(e,t){return y(c("do"),e,c("while"),p("("),t,p(")"),p(";"))},G=function(e,t,n,r){return y(c("for"),p("("),e,m,t,p(";"),n,p(")"),r)},Y=function(e,t,n,r){return y(c("for"),p("("),e,p(";"),t,p(";"),n,p(")"),r)},Z=function(e,t){return y(c("for"),p("("),i.left,p("in"),i.right,p(")"),i.body)},et=function(){return b(c("this"))},tt=function(e){return b(p("("),l(e,p(",")),p(")"))},nt=function(e,t){return b(p("("),e,m,t,p(")"))},rt=function(e,t,n){return b(p("("),t,m,e,m,n,p(")"))},it=function(e,t,n){return n?b(e,t):b(t,e)},st=function(e,t,n){return b(p("("),e,m,p("?"),m,t,m,p(":"),m,n,p(")"))},ot=function(e,t){return b(c("new"),m,p("("),e,p(")"),t?g(p("("),f(t,g(p(","),m)),p(")")):s)},ut=function(e,t){return b(e,p("("),f(t,g(p(","),m)),p(")"))},at=function(e,t,n){return n?b(e,p("["),t,p("]")):b(e,p("."),t)},ft=function(e){return b(p("["),f(e,g(p(","),m)),p("]"))},lt=function(e){return b(p("("),p("{"),e&&e.length?g(v,f(e,g(p(","),v)),v):s,p("}"),p(")"))},ct=function(e,t){return g(x("get"),m,e,p("("),p(")"),m,t)},ht=function(e,t,n){return g(x("set"),m,e,p("("),g.apply(undefined,t),p(")"),m,n)},pt=function(e,t){return g(e,p(":"),m,t)},dt={},vt=function(e,t){Array.isArray(e)?e.forEach(function(e){return vt(e,t)}):dt[e]=t},mt;vt("SwitchCase",function(e){return P(e.test?mt(e.test):null,mt(e.consequent))}),vt("CatchClause",function(e){return H(mt(e.param),mt(e.body))}),vt("EmptyStatement",B),vt("DebuggerStatement",j),vt("BlockStatement",function(e){return F(mt(e.body))}),vt("ExpressionStatement",function(e){return I(mt(e.expression))}),vt("IfStatement",function(e){return q(mt(e.test),mt(e.consequent),e.alternate?mt(e.alternate):null)}),vt("LabeledStatement",function(e){return R(mt(e.label),mt(e.body))}),vt("BreakStatement",function(e){return U(mt(e.label))}),vt("ContinueStatement",function(e){return z(mt(e.label))}),vt("WithStatement",function(e){return W(mt(e.object),mt(e.body))}),vt("SwitchStatement",function(e){return X(mt(e.discriminant),e.cases.map(mt))}),vt("ReturnStatement",function(e){return V(mt(e.argument))}),vt("ThrowStatement",function(e){return $(mt(e.argument))}),vt("TryStatement",function(e){return J(mt(e.block),e.handler?mt(e.handler):null,e.finalizer?mt(e.finalizer):null)}),vt("WhileStatement",function(e){return K(mt(e.test),mt(e.body))}),vt("DoWhileStatement",function(e){return Q(mt(e.body),mt(e.test))}),vt("ForStatement",function(e){var t=e.init?mt(e.init):null,n=e.test?mt(e.test):null,r=e.update?mt(e.update):null,i=mt(e.body);return e.init&&e.init.type==="VariableDeclaration"?G(t,n,r,i):Y(t,n,r,i)}),vt("ForInStatement",function(e){return Z(mt(e.left),mt(e.right),mt(e.body))}),vt("ThisExpression",function(e){return et()}),vt("SequenceExpression",function(e){return tt(mt(e.expressions))}),vt("UnaryExpression",function(e){return nt(p(e.operator),mt(e.argument))}),vt(["BinaryExpression","LogicalExpression","AssignmentExpression"],function(e){return rt(p(e.operator),mt(e.left),mt(e.right))}),vt("UpdateExpression",function(e){return it(p(e.operator),mt(e.argument),e.prefix)}),vt("ConditionalExpression",function(e){return st(mt(e.test),mt(e.consequent),mt(e.alternate))}),vt("NewExpression",function(e){return ot(mt(e.callee),mt(e.args))}),vt("CallExpression",function(e){return ut(mt(e.callee),e.args.map(mt))}),vt("MemberExpression",function(e){return at(mt(e.object),mt(e.property),e.computed)}),vt("ArrayExpression",function(e){return ft(mt(e.elements))}),vt("ObjectExpression",function(e){return lt(mt(e.properties))}),vt("ObjectValue",function(e){return pt(mt(e.key),mt(e.value))}),vt("ObjectGetter",function(e){return ct(mt(e.key),mt(e.value.body))}),vt("ObjectSetter",function(e){return ht(mt(e.key),mt(e.value.params),mt(e.value.body))}),vt("FunctionExpression",function(e){return _(mt(e.id),mt(e.params),mt(e.body))}),vt("FunctionDeclaration",function(e){return D(mt(e.id),mt(e.params),mt(e.body))}),vt("Program",function(e){return A(e.body.map(mt))}),vt("VariableDeclaration",function(e){return O(mt(e.declarations))}),vt("VariableDeclarator",function(e){return M(mt(e.id),e.init?mt(e.init):null)}),vt("Identifier",function(e){return x(e.name)}),vt("Literal",function(e){switch(e.kind){case"string":return T(e.value);case"number":return N(e.value);case"null":return C(e.value);case"boolean":return k(e.value);case"regexp":return L(e.value);default:return s}}),mt=function(e){if(!e)return s;if(Array.isArray(e))return e.map(mt);var t=dt[e.type];return t?t(e):s},u=mt,t.unparse=u}),function(){function e(e,n){var r=new t(e,n);return r.beautify()}function t(e,t){function A(e,t){var n=0;e&&(n=e.indentation_level,n+=e.var_line&&e.var_line_reindented?1:0,!H()&&e.line_indent_level>n&&(n=e.line_indent_level));var i={mode:t,parent:e,last_text:e?e.last_text:"",last_word:e?e.last_word:"",var_line:!1,var_line_tainted:!1,var_line_reindented:!1,in_html_comment:!1,multiline_frame:!1,if_block:!1,do_block:!1,do_while:!1,in_case_statement:!1,in_case:!1,case_body:!1,indentation_level:n,line_indent_level:e?e.line_indent_level:n,start_line_index:r.length,ternary_depth:0};return i}function O(){return{text:[]}}function M(e){e=e===undefined?!1:e;if(r.length){_(r[r.length-1],e);while(e&&r.length>1&&r[r.length-1].text.length===0)r.pop(),_(r[r.length-1],e)}}function _(e){while(e.text.length&&(e.text[e.text.length-1]===" "||e.text[e.text.length-1]===a||e.text[e.text.length-1]===L))e.text.pop()}function D(e){return e.replace(/^\s+|\s+$/g,"")}function P(e){e=e.replace(/\x0d/g,"");var t=[],n=e.indexOf("\n");while(n!==-1)t.push(e.substring(0,n)),e=e.substring(n+1),n=e.indexOf("\n");return e.length&&t.push(e),t}function H(){var e=r[r.length-1];return e.text.length===0}function B(){if(H()){if(r.length===1)return!0;var e=r[r.length-2];return e.text.length===0}return!1}function j(e){e=e===undefined?!1:e;if(k.wrap_line_length&&!e){var t=r[r.length-1],n=0;t.text.length>0&&(n=t.text.join("").length+i.length+(E?1:0),n>=k.wrap_line_length&&(e=!0))}(k.preserve_newlines&&b||e)&&!H()&&(F(!1,!0),!$(f.mode)&&!J(f.mode)&&(w=!0))}function F(e,t){w=!1,E=!1;if(!t&&f.last_text!==";")while(f.mode===C.Statement&&!f.if_block&&!f.do_block)K();if(r.length===1&&H())return;if(e||!H())f.multiline_frame=!0,r.push(O())}function I(){if(H()){var e=r[r.length-1];if(k.keep_array_indentation&&$(f.mode)&&b){e.text.push("");for(var t=0;t<T.length;t+=1)e.text.push(T[t])}else L&&e.text.push(L),q(f.indentation_level+(f.var_line&&f.var_line_reindented?1:0)+(w?1:0))}}function q(e){if(r.length>1){var t=r[r.length-1];f.line_indent_level=e;for(var n=0;n<e;n+=1)t.text.push(a)}}function R(){var e=r[r.length-1];if(E&&e.text.length){var t=e.text[e.text.length-1];t!==" "&&t!==a&&e.text.push(" ")}}function U(e){e=e||i,I(),w=!1,R(),E=!1,r[r.length-1].text.push(e)}function z(){f.indentation_level+=1}function W(){f.indentation_level>0&&(!f.parent||f.indentation_level>f.parent.indentation_level)&&(f.indentation_level-=1)}function X(e){if(e.multiline_frame)return;var t=e.start_line_index,n=0,i;while(t<r.length){i=r[t],t++;if(i.text.length===0)continue;L&&i.text[0]===L?n=1:n=0,i.text[n]===a&&i.text.splice(n,1)}}function V(e){f?(c.push(f),l=f):l=A(null,e),f=A(l,e)}function $(e){return e===C.ArrayLiteral}function J(e){return et(e,[C.Expression,C.ForInitializer,C.Conditional])}function K(){c.length>0&&(l=f,f=c.pop())}function Q(){return f.mode===C.ObjectLiteral&&f.last_text===":"&&f.ternary_depth===0}function G(){return f.last_text==="do"||f.last_text==="else"&&i!=="if"||o==="TK_END_EXPR"&&(l.mode===C.ForInitializer||l.mode===C.Conditional)?(j(et(i,["do","for","if","while"])),V(C.Statement),H()&&(z(),w=!1),!0):!1}function Y(e,t){for(var n=0;n<e.length;n++){var r=D(e[n]);if(r.charAt(0)!==t)return!1}return!0}function Z(e){return et(e,["case","return","do","if","throw","else"])}function et(e,t){for(var n=0;n<t.length;n+=1)if(t[n]===e)return!0;return!1}function tt(e){var t=!1,n="",r=0,i="",s=0,o;while(t||r<e.length){o=e.charAt(r),r++;if(t){t=!1;if(o==="x")i=e.substr(r,2),r+=2;else{if(o!=="u"){n+="\\"+o;continue}i=e.substr(r,4),r+=4}if(!i.match(/^[0123456789abcdefABCDEF]+$/))return e;s=parseInt(i,16);if(s>=0&&s<32){o==="x"?n+="\\x"+i:n+="\\u"+i;continue}if(s===34||s===39||s===92)n+="\\"+String.fromCharCode(s);else{if(o==="x"&&s>126&&s<=255)return e;n+=String.fromCharCode(s)}}else o==="\\"?t=!0:n+=o}return n}function nt(e){var t=v,r=n.charAt(t);while(et(r,h)&&r!==e){t++;if(t>=S)return!1;r=n.charAt(t)}return r===e}function rt(){var e,t;x=0;if(v>=S)return["","TK_EOF"];b=!1,T=[];var i=n.charAt(v);v+=1;while(et(i,h)){i==="\n"?(x+=1,T=[]):x&&(i===a?T.push(a):i!=="\r"&&T.push(" "));if(v>=S)return["","TK_EOF"];i=n.charAt(v),v+=1}if(et(i,p)){if(v<S)while(et(n.charAt(v),p)){i+=n.charAt(v),v+=1;if(v===S)break}if(v===S||!i.match(/^[0-9]+[Ee]$/)||n.charAt(v)!=="-"&&n.charAt(v)!=="+")return i==="in"?[i,"TK_OPERATOR"]:[i,"TK_WORD"];var s=n.charAt(v);v+=1;var u=rt();return i+=s+u[0],[i,"TK_WORD"]}if(i==="("||i==="[")return[i,"TK_START_EXPR"];if(i===")"||i==="]")return[i,"TK_END_EXPR"];if(i==="{")return[i,"TK_START_BLOCK"];if(i==="}")return[i,"TK_END_BLOCK"];if(i===";")return[i,"TK_SEMICOLON"];if(i==="/"){var c="",m=!0;if(n.charAt(v)==="*"){v+=1;if(v<S)while(v<S&&(n.charAt(v)!=="*"||!n.charAt(v+1)||n.charAt(v+1)!=="/")){i=n.charAt(v),c+=i;if(i==="\n"||i==="\r")m=!1;v+=1;if(v>=S)break}return v+=2,m&&x===0?["/*"+c+"*/","TK_INLINE_COMMENT"]:["/*"+c+"*/","TK_BLOCK_COMMENT"]}if(n.charAt(v)==="/"){c=i;while(n.charAt(v)!=="\r"&&n.charAt(v)!=="\n"){c+=n.charAt(v),v+=1;if(v>=S)break}return[c,"TK_COMMENT"]}}if(i==="'"||i==='"'||(i==="/"||k.e4x&&i==="<"&&n.slice(v-1).match(/^<([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*\/?\s*>/))&&(o==="TK_WORD"&&Z(f.last_text)||o==="TK_END_EXPR"&&et(l.mode,[C.Conditional,C.ForInitializer])||et(o,["TK_COMMENT","TK_START_EXPR","TK_START_BLOCK","TK_END_BLOCK","TK_OPERATOR","TK_EQUALS","TK_EOF","TK_SEMICOLON","TK_COMMA"]))){var y=i,w=!1,E=!1;t=i;if(v<S)if(y==="/"){var N=!1;while(w||N||n.charAt(v)!==y){t+=n.charAt(v),w?w=!1:(w=n.charAt(v)==="\\",n.charAt(v)==="["?N=!0:n.charAt(v)==="]"&&(N=!1)),v+=1;if(v>=S)return[t,"TK_STRING"]}}else if(k.e4x&&y==="<"){var L=/<(\/?)([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*(\/?)\s*>/g,A=n.slice(v-1),O=L.exec(A);if(O&&O.index===0){var M=O[2],_=0;while(O){var P=!!O[1],H=O[2],B=!!O[O.length-1]||H.slice(0,8)==="![CDATA[";H===M&&!B&&(P?--_:++_);if(_<=0)break;O=L.exec(A)}var j=O?O.index+O[0].length:A.length;return v+=j-1,[A.slice(0,j),"TK_STRING"]}}else while(w||n.charAt(v)!==y){t+=n.charAt(v);if(w){if(n.charAt(v)==="x"||n.charAt(v)==="u")E=!0;w=!1}else w=n.charAt(v)==="\\";v+=1;if(v>=S)return[t,"TK_STRING"]}v+=1,t+=y,E&&k.unescape_strings&&(t=tt(t));if(y==="/")while(v<S&&et(n.charAt(v),p))t+=n.charAt(v),v+=1;return[t,"TK_STRING"]}if(i==="#"){if(r.length===1&&r[0].text.length===0&&n.charAt(v)==="!"){t=i;while(v<S&&i!=="\n")i=n.charAt(v),t+=i,v+=1;return[D(t)+"\n","TK_UNKNOWN"]}var F="#";if(v<S&&et(n.charAt(v),g)){do i=n.charAt(v),F+=i,v+=1;while(v<S&&i!=="#"&&i!=="=");return i!=="#"&&(n.charAt(v)==="["&&n.charAt(v+1)==="]"?(F+="[]",v+=2):n.charAt(v)==="{"&&n.charAt(v+1)==="}"&&(F+="{}",v+=2)),[F,"TK_WORD"]}}if(i==="<"&&n.substring(v-1,v+3)==="<!--"){v+=3,i="<!--";while(n.charAt(v)!=="\n"&&v<S)i+=n.charAt(v),v++;return f.in_html_comment=!0,[i,"TK_COMMENT"]}if(i==="-"&&f.in_html_comment&&n.substring(v-1,v+2)==="-->")return f.in_html_comment=!1,v+=2,["-->","TK_COMMENT"];if(i===".")return[i,"TK_DOT"];if(et(i,d)){while(v<S&&et(i+n.charAt(v),d)){i+=n.charAt(v),v+=1;if(v>=S)break}return i===","?[i,"TK_COMMA"]:i==="="?[i,"TK_EQUALS"]:[i,"TK_OPERATOR"]}return[i,"TK_UNKNOWN"]}function it(){G();var e=C.Expression;if(i==="["){if(o==="TK_WORD"||f.last_text===")"){et(f.last_text,m)&&(E=!0),V(e),U(),z(),k.space_in_paren&&(E=!0);return}e=C.ArrayLiteral,$(f.mode)&&(f.last_text==="["||f.last_text===","&&(u==="]"||u==="}"))&&(k.keep_array_indentation||F())}else f.last_text==="for"?e=C.ForInitializer:et(f.last_text,["if","while"])&&(e=C.Conditional);f.last_text===";"||o==="TK_START_BLOCK"?F():o==="TK_END_EXPR"||o==="TK_START_EXPR"||o==="TK_END_BLOCK"||f.last_text==="."?(j(b),w=!1):o!=="TK_WORD"&&o!=="TK_OPERATOR"?E=!0:f.last_word==="function"||f.last_word==="typeof"?k.jslint_happy&&(E=!0):(et(f.last_text,m)||f.last_text==="catch")&&k.space_before_conditional&&(E=!0),i==="("&&(o==="TK_EQUALS"||o==="TK_OPERATOR")&&(Q()||j()),V(e),U(),k.space_in_paren&&(E=!0),z()}function st(){while(f.mode===C.Statement)K();i==="]"&&$(f.mode)&&f.multiline_frame&&!k.keep_array_indentation&&F(),f.multiline_frame&&j(),k.space_in_paren&&(o==="TK_START_EXPR"?(M(),E=!1):E=!0),i==="]"&&k.keep_array_indentation?(U(),K()):(K(),U()),X(l),f.do_while&&l.mode===C.Conditional&&(l.mode=C.Expression,f.do_block=!1,f.do_while=!1)}function ot(){V(C.BlockStatement);var e=nt("}"),t=e&&f.last_word==="function"&&o==="TK_END_EXPR";k.brace_style==="expand"?o!=="TK_OPERATOR"&&(t||o==="TK_EQUALS"||Z(f.last_text)&&f.last_text!=="else")?E=!0:F():o!=="TK_OPERATOR"&&o!=="TK_START_EXPR"?o==="TK_START_BLOCK"?F():E=!0:$(l.mode)&&f.last_text===","&&(u==="}"?E=!0:F()),U(),z()}function ut(){while(f.mode===C.Statement)K();var e=o==="TK_START_BLOCK";k.brace_style==="expand"?e||F():e||($(f.mode)&&k.keep_array_indentation?(k.keep_array_indentation=!1,F(),k.keep_array_indentation=!0):F()),K(),U()}function at(){G()||b&&!J(f.mode)&&(o!=="TK_OPERATOR"||f.last_text==="--"||f.last_text==="++")&&o!=="TK_EQUALS"&&(k.preserve_newlines||f.last_text!=="var")&&F();if(f.do_block&&!f.do_while){if(i==="while"){E=!0,U(),E=!0,f.do_while=!0;return}F(),f.do_block=!1}if(f.if_block&&i!=="else"){while(f.mode===C.Statement)K();f.if_block=!1}if(i==="case"||i==="default"&&f.in_case_statement){F();if(f.case_body||k.jslint_happy)W(),f.case_body=!1;U(),f.in_case=!0,f.in_case_statement=!0;return}i==="function"&&(f.var_line&&o!=="TK_EQUALS"&&(f.var_line_reindented=!0),(H()||f.last_text===";"||f.last_text==="}")&&f.last_text!=="{"&&!$(f.mode)&&(B()||(F(),F(!0))),o==="TK_WORD"?f.last_text==="get"||f.last_text==="set"||f.last_text==="new"||f.last_text==="return"?E=!0:F():o==="TK_OPERATOR"||f.last_text==="="?E=!0:J(f.mode)||F());if(o==="TK_COMMA"||o==="TK_START_EXPR"||o==="TK_EQUALS"||o==="TK_OPERATOR")Q()||j();if(i==="function"){U(),f.last_word=i;return}y="NONE",o==="TK_END_BLOCK"?et(i,["else","catch","finally"])?k.brace_style==="expand"||k.brace_style==="end-expand"?y="NEWLINE":(y="SPACE",E=!0):y="NEWLINE":o==="TK_SEMICOLON"&&f.mode===C.BlockStatement?y="NEWLINE":o==="TK_SEMICOLON"&&J(f.mode)?y="SPACE":o==="TK_STRING"?y="NEWLINE":o==="TK_WORD"?y="SPACE":o==="TK_START_BLOCK"?y="NEWLINE":o==="TK_END_EXPR"&&(E=!0,y="NEWLINE"),et(i,m)&&f.last_text!==")"&&(f.last_text==="else"?y="SPACE":y="NEWLINE");if(et(i,["else","catch","finally"]))if(o!=="TK_END_BLOCK"||k.brace_style==="expand"||k.brace_style==="end-expand")F();else{M(!0);var e=r[r.length-1];e.text[e.text.length-1]!=="}"&&F(),E=!0}else y==="NEWLINE"?Z(f.last_text)?E=!0:o!=="TK_END_EXPR"?(o!=="TK_START_EXPR"||i!=="var")&&f.last_text!==":"&&(i==="if"&&f.last_word==="else"&&f.last_text!=="{"?E=!0:(f.var_line=!1,f.var_line_reindented=!1,F())):et(i,m)&&f.last_text!==")"&&(f.var_line=!1,f.var_line_reindented=!1,F()):$(f.mode)&&f.last_text===","&&u==="}"?F():y==="SPACE"&&(E=!0);U(),f.last_word=i,i==="var"&&(f.var_line=!0,f.var_line_reindented=!1,f.var_line_tainted=!1),i==="do"&&(f.do_block=!0),i==="if"&&(f.if_block=!0)}function ft(){G()&&(E=!1);while(f.mode===C.Statement&&!f.if_block&&!f.do_block)K();U(),f.var_line=!1,f.var_line_reindented=!1,f.mode===C.ObjectLiteral&&(f.mode=C.BlockStatement)}function lt(){G()?E=!0:o==="TK_WORD"?E=!0:o==="TK_COMMA"||o==="TK_START_EXPR"||o==="TK_EQUALS"||o==="TK_OPERATOR"?Q()||j():F(),U()}function ct(){f.var_line&&(f.var_line_tainted=!0),E=!0,U(),E=!0}function ht(){if(f.var_line){if(J(f.mode)||o==="TK_END_BLOCK")f.var_line_tainted=!1;f.var_line&&(f.var_line_reindented=!0),U(),f.var_line_tainted?(f.var_line_tainted=!1,F()):E=!0;return}o==="TK_END_BLOCK"&&f.mode!==C.Expression?(U(),f.mode===C.ObjectLiteral&&f.last_text==="}"?F():E=!0):f.mode===C.ObjectLiteral?(U(),F()):(U(),E=!0)}function pt(){var e=!0,t=!0;if(Z(f.last_text)){E=!0,U();return}if(i==="*"&&o==="TK_DOT"&&!u.match(/^\d+$/)){U();return}if(i===":"&&f.in_case){f.case_body=!0,z(),U(),F(),f.in_case=!1;return}if(i==="::"){U();return}b&&(i==="--"||i==="++")&&F(),et(i,["--","++","!"])||et(i,["-","+"])&&(et(o,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||et(f.last_text,m)||f.last_text===",")?(e=!1,t=!1,f.last_text===";"&&J(f.mode)&&(e=!0),o==="TK_WORD"&&et(f.last_text,m)&&(e=!0),(f.mode===C.BlockStatement||f.mode===C.Statement)&&(f.last_text==="{"||f.last_text===";")&&F()):i===":"?f.ternary_depth===0?(f.mode===C.BlockStatement&&(f.mode=C.ObjectLiteral),e=!1):f.ternary_depth-=1:i==="?"&&(f.ternary_depth+=1),E=E||e,U(),E=t}function dt(){var e=P(i),t,n=!1;F(!1,!0),e.length>1&&Y(e.slice(1),"*")&&(n=!0),U(e[0]);for(t=1;t<e.length;t++)F(!1,!0),n?U(" "+D(e[t])):r[r.length-1].text.push(e[t]);F(!1,!0)}function vt(){E=!0,U(),E=!0}function mt(){b?F(!1,!0):M(!0),E=!0,U(),F(!1,!0)}function gt(){Z(f.last_text)?E=!0:j(f.last_text===")"&&k.break_chained_methods),U()}function yt(){U(),i[i.length-1]==="\n"&&F()}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L="";h="\n\r	 ".split(""),p="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split(""),g="0123456789".split(""),d="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::",d+=" <%= <% %> <?= <? ?>",d=d.split(" "),m="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(","),C={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",ForInitializer:"ForInitializer",Conditional:"Conditional",Expression:"Expression"},N={TK_START_EXPR:it,TK_END_EXPR:st,TK_START_BLOCK:ot,TK_END_BLOCK:ut,TK_WORD:at,TK_SEMICOLON:ft,TK_STRING:lt,TK_EQUALS:ct,TK_OPERATOR:pt,TK_COMMA:ht,TK_BLOCK_COMMENT:dt,TK_INLINE_COMMENT:vt,TK_COMMENT:mt,TK_DOT:gt,TK_UNKNOWN:yt},t=t?t:{},k={},t.space_after_anon_function!==undefined&&t.jslint_happy===undefined&&(t.jslint_happy=t.space_after_anon_function),t.braces_on_own_line!==undefined&&(k.brace_style=t.braces_on_own_line?"expand":"collapse"),k.brace_style=t.brace_style?t.brace_style:k.brace_style?k.brace_style:"collapse",k.brace_style==="expand-strict"&&(k.brace_style="expand"),k.indent_size=t.indent_size?parseInt(t.indent_size,10):4,k.indent_char=t.indent_char?t.indent_char:" ",k.preserve_newlines=t.preserve_newlines===undefined?!0:t.preserve_newlines,k.break_chained_methods=t.break_chained_methods===undefined?!1:t.break_chained_methods,k.max_preserve_newlines=t.max_preserve_newlines===undefined?0:parseInt(t.max_preserve_newlines,10),k.space_in_paren=t.space_in_paren===undefined?!1:t.space_in_paren,k.jslint_happy=t.jslint_happy===undefined?!1:t.jslint_happy,k.keep_array_indentation=t.keep_array_indentation===undefined?!1:t.keep_array_indentation,k.space_before_conditional=t.space_before_conditional===undefined?!0:t.space_before_conditional,k.unescape_strings=t.unescape_strings===undefined?!1:t.unescape_strings,k.wrap_line_length=t.wrap_line_length===undefined?0:parseInt(t.wrap_line_length,10),k.e4x=t.e4x===undefined?!1:t.e4x,t.indent_with_tabs&&(k.indent_char="	",k.indent_size=1),a="";while(k.indent_size>0)a+=k.indent_char,k.indent_size-=1;while(e&&(e.charAt(0)===" "||e.charAt(0)==="	"))L+=e.charAt(0),e=e.substring(1);n=e,S=e.length,o="TK_START_BLOCK",u="",r=[O()],w=!1,E=!1,T=[],c=[],V(C.BlockStatement),v=0,this.beautify=function(){var e,t,n,a;for(;;){e=rt(),i=e[0],s=e[1];if(s==="TK_EOF")break;n=k.keep_array_indentation&&$(f.mode),b=x>0;if(n)for(t=0;t<x;t+=1)F(t>0);else{k.max_preserve_newlines&&x>k.max_preserve_newlines&&(x=k.max_preserve_newlines);if(k.preserve_newlines&&x>1){F();for(t=1;t<x;t+=1)F(!0)}}N[s](),s!=="TK_INLINE_COMMENT"&&s!=="TK_COMMENT"&&s!=="TK_UNKNOWN"&&(u=f.last_text,o=s,f.last_text=i)}a=r[0].text.join("");for(var l=1;l<r.length;l++)a+="\n"+r[l].text.join("");return a=a.replace(/[\r\n ]+$/,""),a}}typeof define=="function"?typeof define.amd=="undefined"?define("ecma-unparse/beautify",["require","exports","module"],function(t,n,r){n.js_beautify=e}):define("ecma-unparse/beautify",[],function(){return e}):typeof exports!="undefined"?exports.js_beautify=e:typeof window!="undefined"?window.js_beautify=e:typeof global!="undefined"&&(global.js_beautify=e)}(),define("ecma-unparse/print",["require","exports","nu-stream/stream","./beautify"],function(e,t,n,r){var i=n.foldl,s=n.map,o,u=i.bind(null,function(e,t){return e+t},""),a=s.bind(null,function(e){if(!e)return"";switch(e.type){case"Null":return"null";case"Comment":return"/*"+e.value+"*/";case"String":return JSON.stringify(e.value).replace("\u2028","\\u2028").replace("\u2029","\\u2029");default:return e.value}}),f={preserve_newlines:!1,wrap_line_length:120,break_chained_methods:!0},l=r.js_beautify||r;o=function(e,t){return function(n){return e(t(n))}}(function(e,t){return function(n){return e(t(n))}}(function(e){return l(e,f)},u),a),t.print=o}),require(["nu-stream/stream","khepri-parse/lex/lexer","khepri-parse/parse/parser","khepri-compile/compile","ecma-unparse/unparse","ecma-unparse/print"],function(e,t,n,r,i,s){var o=CodeMirror.fromTextArea(document.getElementById("khepri-console-input"),{mode:"javascript",lineNumbers:!0}),u=CodeMirror.fromTextArea(document.getElementById("javascript-console-output"),{mode:"javascript",lineNumbers:!0,readOnly:!0}),a=function(e){$("#text-out").text("");var o={package_manager:$("#package_manager").val()};try{var a=t.lex(e),f=n.parseStream(a),l=r(f,o),c=i.unparse(l),h=s.print(c);return u.doc.setValue(h),$("#text-out").removeClass("error"),h}catch(p){$("#text-out").addClass("error").text(p)}};$(function(){$("#translate-button").click(function(){a(o.doc.getValue("\n"))})})}),define("javascripts/console.js",function(){});